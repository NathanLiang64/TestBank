      *@(#) BR0024.COB VERSION 80.395
      *@(#) LAST UPDATED ON 25/04/24 AT 17:37:17
      *@(#) THIS FILE OBTAINED FROM
      *@(#)    /fns/sccs/x/r/cob/s.BR0024.COB
      *@(#)    ON 25/07/17 AT 18:02:48
000010*** Start of PVCS Information *************************
000020* $Archive:   //fnssnap1/pvcs$/archives/Retail/cob/BR0024.COB-arc
000030* $Revision:   1.2  $
000040* $Modtime:   Sep 08 2001 12:48:00  $
000050* $Author:   pvcs  $
000060* $Date:   Sep 08 2001 14:36:26  $
000070* $Log:   //fnssnap1/pvcs$/archives/Retail/cob/BR0024.COB-arc  $
000080* 000090*   Rev 1.2   Sep 08 2001 14:36:26   pvcs 000100*Initial check in. BANCS 8.0 T 000110*** End of PVCS Information ***************************
000120*@(#) BR0024.COB version 80.14
000130*@(#) last updated on 01/08/24 at 15:53:45
000140*@(#) This file obtained from
000150*@(#)    /fns/sccs/t/r/cob/s.BR0024.COB
000160*@(#)    on 01/09/08 at 12:21:52
000170******************************************************************
000180******************************************************************
000190*   (C) COPYRIGHT FINANCIAL NETWORK SERVICES PTY LTD. 1982       *
000200*       ALL RIGHTS RESERVED. NO PART OF THIS PROGRAM MAY         *
000210*       BE PHOTOCOPIED, REPRODUCED, TRANSLATED TO ANOTHER        *
000220*       PROGRAM LANGUAGE OR USED IN ANY WAY WITHOUT THE          *
000230*       PRIOR WRITTEN CONSENT OF FINANCIAL NETWORK SERVICES      *
000240*       OR THE AUTHORISED SELLING AGENT.                         *
000250*----------------------------------------------------------------*
000260*             FINANCIAL NETWORK SERVICES PTY LTD.                *
000270*               UNIT6,70 ROSEHILL STREET REDFERN 2016            *
000280*                   SYDNEY, AUSTRALIA.                           *
000290*                     TEL. 318-1088                              *
000300******************************************************************
000310******************************************************************
000320******************************************************************
000330***                                                            ***
000340***  SYSTEM:- BORROWERS PRIMARY UPDATE                         ***
000350***                                                            ***
000360***  MODULE:- BR0000                                           ***
000370***                                                            ***
000380***  PROGRAM:-  BR0024                                         ***
000390***                                                            ***
000400***  PURPOSE:- THIS MODULE WILL TAKE CARE OF ALL ADVANCE         *
000410***             TYPE TRANSACTIONS.                             ***
000420***             THE COMMON PROCESSING IS USED FOR ALL          ***
000430***             TYPE OF TRANSACTIONS EXCEPT IN CASE OF         ***
000440***             MESSAGE FORMATTING. THE MESSAGE IS FORMATTED   ***
000450***             DEPENDING ON WHETHER IT IS ONLINE, OFFLINE     ***
000460***             OR NO PASS BOOK TYPE TRANSACTION               ***
000470***             THE MODULE WILL TAKE CARE OF FOLLOWING         ***
000480***             TRN CODES  :- 11060,11070,11080.               ***
000490***                                                            ***
000500***                                                            ***
000510******************************************************************
000520*
000530*                 P R O G R A M    H I S T O R Y
000540*  PROGRAMMERS INITIALS TOGETHER WITH THE "SPR" NUMBER MUST BE
000550*  REFLECTED IN COLUMNS 73-80 OF EVERY LINE/S CHANGED OR ADDED.
000560*
000570* PROGRAMMER : DATE :SPR NO :COMMENTS
000580****************************************************************
000590* S FOWLER   :220194: 610235: RLSE 6.1 & MVS/CICS CONV
000600*---------------------------------------------------------------
000610* S FOWLER   :050294: 610298: REMOVE A3/B3 ACCESS/UPDATE
000620*---------------------------------------------------------------
000630* F WENCESLAO:220394: 610355: TRANSFER ATM REFRESH TO MAINLINE
000640*-----------------------------------------------------------------
000650* F WENCESLAO:240894: 620022: INCLUDE GLOBAL LIMIT CHECKING
000660*-----------------------------------------------------------------
000670* ALEX LIM   :111094:  2036 : RATE TABLE, ADD CALL TO UT0298
000680*-----------------------------------------------------------------
000690* ADEL SERHAN:271094:620085 : CONSTRUCT LOAN ACCEPTANCE TXN 12440
000700*            :      :       : WHICH CHANGES STATUS FROM 3 TO 5
000710*            :      :       : AND CHANGE OLD BORM-STAT
000720*-----------------------------------------------------------------
000730* S LEE      :021194:  2038 : DO NOT CALL FT0000, IF TXN COMES
000740*            :      :       : FROM LM0000
000750*-----------------------------------------------------------------
000760* ADEL SERHAN:070195:620124 : MODIFYING REVERSAL TXN. IN ORDER TO
000770*            :      :       : GET STAT 5 IF LOAN WAS ACCEPTED AND
000780*            :      :       : BAL =0 ELSE WE GET STAT 3 IF LOAN
000790*            :      :       : WAS NOT ACCEPTED AND BAL = 0.
000800*-----------------------------------------------------------------
000810* MISHA.T.   :160195:630030 : PASING "0" TO UT0500 AS
000820*                             INSTITUTIONS LANGUAGE CODE.
000830*-----------------------------------------------------------------
000840* MISHA.T.   :300195: 631012: BYPASSING A JOURNAL NUMBER MATCHING
000850*                             FOR OFF-LINE CORRECTION TRANSACTION,
000860*                             IF HAS NOT BEEN ENTERED.
000870*-----------------------------------------------------------------
000880* B G COLE   :070295: 631011: ADD PROCESSING FOR POST-TIME
000890*-----------------------------------------------------------------
000900* B AQABANI  :110495: 620124: ADD PROCESSING FOR RE-DRAW TRNS
000910*                             CHECK TRAN-LEDGER-CODE TO DECIDE
000920*                             ON LOAN-BAL OR THEO-LOAN-BAL
000930*-----------------------------------------------------------------
000940*M VILLANUEVA:150595: HBS002: INCLUDE CREDIT ARREARS REDRAW
000950*                             CORRECTIONS TRANSACTIONS.
000960*-----------------------------------------------------------------
000970* B ASHWIN   :150695: ANZ003: EXTRA CALL PARMS FOR UT0298
000980*-----------------------------------------------------------------
000990* ADEL SERHAN:280695: 700025: FIXING DUES STRT DATE,INT.CAP.DATE
001000*                              LAST ADV DATE VALUES FOR
001010*                              CORRECTIONS, AND ADVANCES TXNS.
001020*-----------------------------------------------------------------
001030*K HUTCHINSON:020795: ANZ020: ALTER CALL FOR UT0151.
001040*-----------------------------------------------------------------
001050* K CJHRISTOS:180895: ANZ311: SENT OK FOR A LOAN REPAYMENT
001060*-----------------------------------------------------------------
001070*K MCALLISTER:250895: ANZ038: DO NOT CALL BR0013 OR FT0000 WHEN
001080*                             MULTI CURRENCY ON
001090*-----------------------------------------------------------------
001100* AYAD       :250895: ANZ017: POSTING OFF-SYST. REJECTED TRANS. TO
001110*                             SUSP. ACCOUNT
001120*-----------------------------------------------------------------
001130* PETER HAN  :050995:700034 : INTRODUCE CALLS TO CHARGE SYSTEM
001140*-----------------------------------------------------------------
001150* PETER HAN :060995 :700028 : RETROFIT RINGO'S WORK.IE FIX SO THAT
001160*                           : OK MESSAGE FOR ADV TRANS AREA SENT
001170*                           : IN BR0000 INSTEAD OF HERE.
001180*-----------------------------------------------------------------
001190* AYAD      :070995 :730001 : USE INPUT-MSG-GL CB INSTEAD OF
001200*           :       :       :  HARDCODED WA-GL-AREA.
001210*-----------------------------------------------------------------
001220*ADEL SERHAN:210995 :730007 : IF EFFECTIVE RES. IND. = 1
001230*                           : AND BORM-STAT > 5 SETTING
001240*                           : RES. BAL. TO LOAN-BAL,
001250*                           : ELSE SETTING RES.BAL. TO APP-AMT
001260*-----------------------------------------------------------------
001270*ADEL SERHAN:101095 :730046 : FIXING IR # QS167 UPDATING TXN BAL
001280*           :       :       : DIRECTLY.
001290*-----------------------------------------------------------------
001300* F WENCESLAO:131095:TRE008 : INTRODUCE NEW FACILITY PROCESSING
001310*-----------------------------------------------------------------
001320* ADEL SERHAN:201095: 730046 : ADDING NEW FIELDS TO BORM TABLE
001330*                            : AND MOVE OTHERS TO NEW TABLES
001340*                            : POINTED TO BY FIELDS IN BORM,
001350*                            : (TO MAKE ROOM ON BORM).
001360*-----------------------------------------------------------------
001370* PETER HAN :251095:730033   : ADD CS0000CA/RA TO CALLING PARAME
001380*                            : TER LIST
001390*-----------------------------------------------------------------
001400* BRIAN COLE:271095:730105 : CHANGE ERR MSG NUMBERS (IR 171, 465)
001410*-----------------------------------------------------------------
001420* PETER HAN :011195 :730033  : REVERSE THE 700028 WORK, TO FIX
001430*                            : MISSING OK IF MCURR-IND = 1 OR 0
001440*-----------------------------------------------------------------
001450* A GUESRY  :021195:730120   : PASS IN LINKAGE AREA UT0270CA AREA
001460*-----------------------------------------------------------------
001470*MILIND DIGHE:291195:ANZ064  : PASS SWIFT REFERENCE NO TO FT0000
001480*-----------------------------------------------------------------
001490*SHRIDHAR,J  :041295:ANZ069  : SELECT INTEREST METHOD
001500*-----------------------------------------------------------------
001510* JOSH HALL  :061295:ANZ070 : MODIFY PROCESSING OF NARRATIVE AND
001520*            :      :       : TRANSFER TYPE TRANSACTIONS. ADDED
001530*            :      :       : GENERIC NARRATIVE FIELD IN
001540*            :      :       : INPUT-MESSAGE.
001550*-----------------------------------------------------------------
001560* H. YANG    :050295:730232  : BULK CHEQUE PROCESSING
001570*-----------------------------------------------------------------
001580* ADEL SERHAN:010396:730477:(I.R#FNS470)CREDIT ARREARS ENHANCEMENT
001590*-----------------------------------------------------------------
001600* J.NELSON   :060396:730439 : DO NOT CALL UT0270 WITH MNMPARM CB
001610*-----------------------------------------------------------------
001620* R CHANDLER :190396:730404 : FIX CREDIT ARREARS REDRAW PROCESSING
001630*                             ON AVAILABLE FUNDS. (IR1568)
001640*-----------------------------------------------------------------
001650* W. MAZIOUN :250396:730407: INCREASE STORE AREA OF EDIT-MASK TO B 
001660*            :      :      : MATCHED WITH START AREA AND LINK AREA 
001670*-----------------------------------------------------------------  
001680* A GUESRY   :270396:730458: IRRESPECTIVE OF THE VALUE IN THE SOC-
001690*            :      :      : MULTI-CURRENCY THE O.K. MSG WILL BE
001700*            :      :      : SENT FROM BR0000.
001710*-----------------------------------------------------------------
001720*K HUTCHINSON:010496:730631:IF STRT-METHOD = 05, SET INT-START-DT
001730*            :      :      : TO DATE OF 1ST ADVANCE.
001740*-----------------------------------------------------------------
001750* M SHARMILA :190496:740003: LOAN ADVANCE BY TRANSFER TO DEPOSIT A      
001760*            :      :      : NEW TRANSACTION 11055.
001770*-----------------------------------------------------------------       
001780* M SHARMILA :070596:740003: CORRECTION, OFF SYSTEM AND OFF SYSTEM     
001790*            :      :      : FOR 11055.
001800*-----------------------------------------------------------------        
001810*K HUTCHINSON:100596:730631:IF STRT-METHOD = 05, SET BORM-PAY-DAY
001820*            :      :      : TO TODAYS DAY IF NOT STATED IN BORP O       
001830*-----------------------------------------------------------------
001840* AGNES RUPAC:130596:NBG007: ALLOW FOR BILLS DISCOUNTED WHERE
001850*            :      :      : COMMISSION IS DEDUCTED UPFRONT.
001860*-----------------------------------------------------------------
001870* M SHARMILA :170596:740021:LOAN TERM IN DAYS, PASS TERM BASIS TO        
001880*            :      :      :UT0510, CHECK THAT LOAN DOES NOT MATUR    
001890*            :      :      :HOLIDAY.
001900*-----------------------------------------------------------------      
001910* M SHARMILA :240596:740003:MOVE CODE FOR TRNS. 11055, 16055, 1115        
001920*            :      :      : TO A PARAGRAPH.
001930*-----------------------------------------------------------------        
001940* AGNES RUPAC:240596:NBG007:FOR BILLS DISCOUNTED, DO NOT ADD
001950*            :      :      :COMMISSION TO ADV-VAL.
001960*-----------------------------------------------------------------
001970* EMMA HUFFAM:280596:733173 : EXTRA MODS FOR FNSB25
001980*            :      :       : - OVERRIDING ERRORS
001990*            :      :       : - REMOVE SUSPENSE POSTING (NOW DONE
002000*            :      :       :   IN BR0000)
002010*-----------------------------------------------------------------
002020* T CARDENAS :300596:740026 : INCLUDE ADDRESS LINE 4 AS PER
002030*                           : COPYBOOK CHANGES.
002040*-----------------------------------------------------------------
002050* SANTOSH C  :030696:740037 :INCORRECT NARRATION ON STANDING ORDER
002060*-----------------------------------------------------------------
002070* J. BRADLEY :050696:733194 : RETRO -FIX OFFLINE PROCESS THRU BTM
002080*-----------------------------------------------------------------
002090* M SHARMILA :060696:740003 :USE  TRN DATE INSTEAD OF STRT-AREA PO       
002100*            :      :       :WHEN WRITING NARR TRN AND REMOVE REDU     
002110*            :      :       :IN H100 PARA.
002120*---------------------------------------------------------------
002130* JOYCE OH   :070696:730214 : FNSB45 - REPLACE SDCV WITH SORD.
002140*-----------------------------------------------------------------
002150* A MILLER   :080696:NBG003 : MOVE BORM INTEREST RELIEF FIELDS
002160*                           : TO TABLE BIRM.
002170*----------------------------------------------------------------
002180* JOSH HALL  :120696:730214 : FNSB45 - REMOVE COMMENTED CODE.
002190*----------------------------------------------------------------
002200* J. BRADLEY :130696:730574 : RETRO - OFFLINE CORRECTION MODS
002210*-----------------------------------------------------------------
002220* A GUESRY   :140696:NBG003 : UPDATE UNPAID BUCKETS
002230*----------------------------------------------------------------
002240* JOYCE OH   :210696:730214 : FNSB45 - ADD NEW FIELDS IN WA-IN0014 
002250*                           : PASSALONG.
002260*                           : INITIALISE WA-IN0014-CALL-CODE.
002270*-----------------------------------------------------------------
002280* JOYCE OH   :280696:730214 : FNSB45 - REMOVE FILLER IN WA-IN0014-
002290*                           : PASSALONG.
002300*-----------------------------------------------------------------
002310* B ASHWIN   :030796:740092 : 2101593, ERROR 551 INVALID CLEARING
002320*                           : ACCOUNT.
002330*-----------------------------------------------------------------
002340* EMMA HUFFAM:190796:733173 : CHECK STATUS AFTER CALL TO UT0800
002350*-----------------------------------------------------------------
002360* JAY POORUN :230796:74Q030 : ACFR DBIO CALL CHANGE TO 71
002370*            :      :       : MRNF STATUS ADDED INSTEAD OF END
002380*-----------------------------------------------------------------
002390* EMMA HUFFAM:310796:74Q046 : SET UT60 CALL PARAMETERS CORRECTLY
002400*-----------------------------------------------------------------
002410* EMMA HUFFAM:050896:74Q046 : SET UP PROMO NO FOR CALL TO UT0800
002420*-----------------------------------------------------------------
002430* C GARADO   :060896:733310: AMEND CHK DGT CALL  (RETRO)
002440*-----------------------------------------------------------------
002450* H. YANG    :070896:733327: CAPN METHOD 8 MNTHLY REDUCE PER LOAN
002460*-----------------------------------------------------------------
002470* H. YANG    :070896:733337: GENERIC CHARGE TRANSACTIONS
002480*                          : ADD BORV-01-PROMO-NO, REMOVE
002490*                          : BORV-01-LEDG-CODE
002500*-----------------------------------------------------------------
002510* HAERAN LEE :070896:733371:MODS TO ALLOW VARIABLE BANK ACCOUNTS
002520*                          :FOR BANK/SOCIETY CHEQUES BY FUNCTION
002530*                          :AND ALLOW MULTIPLE NARRATIVES (RETRO)
002540*-----------------------------------------------------------------
002550* EMMA HUFFAM:230996:74Q148: ALLOW FOR OVERRIDING OF TRANSFERS
002560*            :      :      : GENERATED FROM GL0000
002570*-----------------------------------------------------------------
002580* H. YANG    :250996:733426: CHANGE RE-DRAW TXNS NO FOR DEBIT.
002590*                          : 10012 -> 10066,11066
002600*                          : 10013 -> 10067,11067
002610*                          : 10022 -> 10076,11076
002620*                          : 10023 -> 10077,11077
002630*                          : ETC.....
002640*-----------------------------------------------------------------
002650*  JOYCE OH  :281196:IR3757: ADD REPLACING STATEMENT TO COPY OF
002660*            :      :      : SORDMAST AND REPLACE USE OF DBIOMOD-
002670*            :      :      : RECORD WITH SORD-RECORD-AREA.
002680*-----------------------------------------------------------------
002690* JAY POORUN :101296:IR3757:PASSED WA-PASSALONG TO CS0000 & CS0090     
002700*-----------------------------------------------------------------   
002710* H GREWAL   :131296:IR1511:MOVED CALL TO UT0681 OUT INTO BR0000
002720*-----------------------------------------------------------------   
002730*  JOYCE OH  :100297:I60679: INITALISE WA-STORE-ACT-CORR-AMT.
002740*-----------------------------------------------------------------   
002750* M SHARMILA :200297:I60322: PERFORM H100-ADV-... WITHIN M600 ALSO
002760*-----------------------------------------------------------------    
002770* J.NELSON   :120397:I60481: UTILISE COPYBOOK FOR PASSALONG AREA,    
002780*                          : GET COPYBOOK IN SYNC FOR MODULES USIN 
002790*                          : THE COPYBOOK
002800*-----------------------------------------------------------------    
002810*SYED MOHD. K:130397:I61437: SET UP WA-SAVE-GLDM-BR BEFORE CALLING
002820*                          : UT0800 SO THAT XX45 HAS THE CORRECT
002830*                          : JNRST-TRANSFER-TXN-BR.
002840*-----------------------------------------------------------------    
002850* M SHARMILA :270397:I60980: ADVANCE THE ADDITIONALLY APPROVED AMO   
002860*-----------------------------------------------------------------    
002870* M SHARMILA :180497:I61736: LOANS TRACKING DOES NOT RETURN TO MAI      
002880*                            AFTER BACKDATED TRANSACTIONS.
002890*-----------------------------------------------------------------     
002900* FELIX S    :280497:I62258: PASS COMMISSION FLAG TO UT0800 TO CAL      
002910*                          : JNRST-GL-IBB-XCURR-IND
002920*-----------------------------------------------------------------     
002930* SANTOSH C  :020597:I62383: UNABLE TO ADVANCE THE ADDITIONALLY AP      
002940*            :      :      : AMOUNT
002950*-----------------------------------------------------------------    
002960* ANUP PAI   :200597:I62802: PASS CORRECT SAVE AREA WA-SAVE-TO-BAS      
002970*            :      :     :TO UT0800 TO ARRIVE AT JNRST-FROM-BASE-      
002980*            :            : FOR TXN 1045 DURING LOAN ADVANCE BY XF   
002990*-----------------------------------------------------------------    
003000* A.K.SINGH  :300597:I62815: PREVENT ADVANCE BACKDATED PRIOR TO AP      
003010*            :      :      : DATE BY CHANGING ERROR NO 251(OVERRID     
003020*            :             : TO 2211(NON OVERRIDABLE).
003030*-----------------------------------------------------------------    
003040* A ERHAN    :091295:760006: FEES AND CHARGES UPGRADE
003050*-----------------------------------------------------------------
003060* H. YANG    :110398:760027 : FIX OVERRIDE SIZE AND "UT0060" ABORT
003070*-----------------------------------------------------------------  
003080* H. YANG    :260398: 760031 : FIX PASSBOOK LINE PRINT HANDLING
003090*-----------------------------------------------------------------
003100* P.MATARAGE :030898:760080: ANZ-RTFD
003110*            :      :      : CORRECTION DEBIT TRANSFER RESULTS IN
003120*            :      :      : LARGE TXN AMOUNT
003130*-----------------------------------------------------------------   
003140* J.JAMBU    :111198:760165: Correction of a transaction should sh  
003150*            :      :      : correcting teller.
003160*-----------------------------------------------------------------   
003170* IK ACQUAH  :231198:760204: FIX CORRECTION TRN LOAN STATUS
003180*-----------------------------------------------------------------   
003190* ADEL SERHAN:241197:HEL001: RETROFITTING TELEPAC CHANGES
003200*-----------------------------------------------------------------      
003210* BOONLERD S.:220198:HEL007: TELEPAC INTERFACE TO LOAN FOR LOAN AD      
003220*-----------------------------------------------------------------      
003230* WOOJIN KIM :260298:HEL001: USE THE TELEPAC ATM FIN TXN INPUT STR      
003240*            :      :HEL007: USED IN DEPOSITS.
003250*            :270298:HEL001: MAKE 18060, 18062 AND 18050 TXNS PROC     
003260*            :      :      : AS REDRAW TXNS.
003270*-----------------------------------------------------------------      
003280* M. MIAO    :130798:74I012: RETROFIT
003290*-----------------------------------------------------------------      
003300* R NEILANDS :171298:760167 : CHANGE 2 FIELDS TO MATCH RECENT
003310*            :      :       : CHANGES TO STRTAREA.
003320*            :      :       : STRT-ATM-TXN=>STRT-AREA-EFT-TXN
003330*            :      :       : STRT-STORE-FWD-TXN=>STRT-AREA-ADVICE
003340*-----------------------------------------------------------------      
003350* M. MIAO    :300798:74I052 : IMPLEMENT TXN REFRESH TO THE ATM SYS 
003360*-----------------------------------------------------------------      
003370* H. YANG    :220499:760298 : TIDY UP REDRAW-IND
003380*-----------------------------------------------------------------
003390* R NEILANDS :030599:760305 : RETROFIT STATEMENT EFFICIENCY I67265
003400*                           : UPDATE BACKDATE DATE FOR BACKDATES
003410*-----------------------------------------------------------------
003420* I. KENT    :110599:760306 : Fix priority code problem for redraw
003430*-----------------------------------------------------------------
003440* H. YANG    :130599:760313 : REPLACE DBIO 5X CODE TO 6X
003450*----------------------------------------------------------------- 
003460* E. UY      :300699:760416 : FULLY DRAWDOWN THE ORIGINAL APROVED
003470*            :      :       : LOAN AMT BEFORE STARTING ON THE ADD' 
003480*            :      :       : LOAN
003490*-----------------------------------------------------------------
003500* R NEILANDS :230799:760167 : ICU RETRO, REPOSITION WA-ATM-SEQ-NO,
003510*                           : CAPTURE BALANCE ON INVM UPDATE
003520*-----------------------------------------------------------------
003530* H. YANG    :240899:760471 : FIX LOOPING FOR CHARGES ERROR
003540*----------------------------------------------------------------- 
003550* A TANIOUS  :280999:760508 : REMOVE TIER RATE
003560*----------------------------------------------------------------- 
003570* E UY       :151099:MIC001 : CPM - PASS INSTITUTION TO UT0310
003580*----------------------------------------------------------------- 
003590* R NEILANDS :101299:24H002 : CALL EI0085 WITH RECOVERY FLAG
003600*-----------------------------------------------------------------
003610* W P CHIA   :SUP004: 110998 : FIX CORRECTION TRN LOAN STATUS
003620*-----------------------------------------------------------------
003630* F CATABAS  :PMT001: 1299   : RETROFIT THE FOLLOWING:
003640*   C SPEYER  CINT01A 170699   NEW CONFORM INTEREST METHOD
003650*   Y.N. KIM  220799  CINT02A  PASS TOM RATE TABLE ID AND TOM ACRU
003660*                              AMT TO CALL UT0079
003670*   Y.N. KIM  120899  NLB0032  PASS INTEREST ADJUSTMENT TO UT0079
003680*   W.EASTON  170899  CINT05A  DISCOUNT RATE ESTABLISHMENT
003690*   C FRASER  270899  CLON07A  CASH DRAWDOWN RESTRICTIONS
003700*   Y.C KIM   201099  NLB0203  AMEND CASH DRAWDOWN RESTRICTIONS
003710*                              CHECK OWNERS ACCT TRANSFER ADVANCE
003720*   W EASTON  021199  CINT03   FCC CLAUSE
003730*   C NILSSON 051199  NLB0222  WRITE A 36-RECORD FOR TRANSACTIONS
003740*                              11155 AND 16155 ALSO
003750*   Y. N KIM  161299  UAT0132  MAX CASH ADVANCE SHOULD BE PERFORME 
003760*                              ONLY WHEN BORP-MAX-CASH-ADV > 0
003770*   J HIGGS   060200  NLB019   ADD TOM INT TO UT0095 CALL
003780*-----------------------------------------------------------------
003790* GREG MCRAE :120200:NLB019 : CHANGE BSB FROM PIC 9(6) TO X(12)         
003800*-----------------------------------------------------------------      
003810* MSMOLINA   :180200:24H019 : BYPASS when in repost mode                
003820*-----------------------------------------------------------------      
003830* EG ASPIRAS :290200:MVS002 : COMMENT OUT DISPLAY STATEMENTS            
003840*-----------------------------------------------------------------      
003850* JOJO PUNO  :080300:NLB059 : USE INPUTMSL COPYBOOK IN PLACE OF
003860*            :      :       : INPUT-MSG-GL TO MEET MVS STANDARDS
003870*-----------------------------------------------------------------      
003880* MSMOLINA   :110500:24H041 : add check of the redraw-ind from BOR        
003890*-----------------------------------------------------------------      
003900* K Y CHUA   :080800:NBD263 : RETROFIT: MOVE "BOR" ONLY IF 
003910*                             WA-NARR-TRF-ACCT-SYS IS SPACES.
003920*-----------------------------------------------------------------  
003930* M.OVINGTON :140301:KEY008 : PROCESS KEYMATRIX 30 DAY LOAN             
003940*            :              : DRAWDOWNS - PHASE ONE ONLY.
003950*            :              : NEW TXNS 12422(AUTHORISATION) AND
003960*            :              : 11064 BORROW TO PAY.
003970*-----------------------------------------------------------------    
003980* SANG LEE   :160501:800058 : CONDITIONAL CALL FOR "UT0500"             
003990*-----------------------------------------------------------------      
004000* H CATLEY   :220501:KEY008 : JRNL TXNS GENERATED DURING 11064 (BT  
004010*-----------------------------------------------------------------    
004020* JOJO PUNO  :240501:800060 : RETROFIT FOR: LB0380
004030*            :      :       : C GARADO - CATER FOR 2 SCENARIOS
004040*            :      :       : FOR ERROR 899
004050*-----------------------------------------------------------------    
004060* JOJO PUNO  :280501:800060 : RETROFIT FOR: LB0386
004070*            :      :       : C GARADO - DO NOT USE ERR271 IN PLAC 
004080*            :      :       :            OF 121
004090*-----------------------------------------------------------------    
004100* H CATLEY   :010601:KEY020 : CALCULATE OUTSTANDING INT WHEN DOING
004110*                           : A BTP TXN BASED ON INT INCR.   
004120*-----------------------------------------------------------------    
004130* I ACOSTA   :190601:800074 : NLB RETROFIT LB0624 BY S.CHANCO
004140*                           : - FIX ASSIGNMENT OF BACK VALUE DATE   
004150*                           : BORV
004160*-----------------------------------------------------------------
004170* H CATLEY   :260601:KEY033 : ADD CODING FOR 12522                 
004180*-----------------------------------------------------------------    
004190* A.MOOR     :180701:KEY009 : ADD NEW FIELD IN CALL TO UT4001
004200*-----------------------------------------------------------------
004210* M.OVINGTON :100801:KEY008 : REPLACE SETTING UP INTEREST IN CALL
004220*            :      :       : TO UT4001
004230*-----------------------------------------------------------------
004240* L. Caga    :200801:80R003 : Remove hard-coded english literals a  
004250*            :      :       : replace them w/ txtm text
004260*-----------------------------------------------------------------
      * G R LADIA  :101201:TB0027 : Daily Cash Credit/Debit monitoring
      *-----------------------------------------------------------------
      * MCASTILLO  :090502:TB0082 : ADVANCES
      *-----------------------------------------------------------------
      * NZOBLAN    :130502:TB0084 : Repayment Methods
      *-----------------------------------------------------------------
      * MCASTILLO  :100602:TB0082 : Compute Maturity Date -- IRWT0001
      *-----------------------------------------------------------------
      * J CHANCO   :170802:TB0125 : ADD CUSTOMER BASED FEE
      *------------------------------------------------------------------
      * JOEL BAJO  :090902:TB0125 : CSCP ACCESS CHANGE; ACCESS BY ALT-KEY
      *------------------------------------------------------------------
      * MCASTILLO  :181102:TB0082 : Validation of Advances
      *-----------------------------------------------------------------
      * R SORIANO  :301002:TB0152 : BROKERAGE/REFERRAL COMMISSION CALC
      *------------------------------------------------------------------
      * RIZA LADIA :201102:TB0069 : TIB net rate computation,
      *                           : save BOIS-NEXT-DUE-DATE
      *-----------------------------------------------------------------
      * MCASTILLO  :101003:TB0082 : Put "MOVE ZERO TO BORM-REPAY-DAY"
      *                           : inside an IF statement, to correct 
      *                           : the correction of all backdating and
      *                           : correction. 
      *-----------------------------------------------------------------
      * Cyn M Rojas:201102:tb0104 : Pass on the ff. fields to UT0014 
      *            :      :       : for standing orders activation:
      *            :      :       : a. IN0014-INPUT-START-DD = TO
      *            :      :       :     BORM-REPAY-DAY
      *            :      :       : b. IN0014-INPUT-TDATE
      *-----------------------------------------------------------------
      * F GONZALES :300103:TB0161 : MOVE NEXT-DUE-DATE TO
      *                           :      BOIS-LAST-UNPAID-DATE for NPL
      *-----------------------------------------------------------------
      * C VILLAR   :260203:TB0196 : ADD UPDATE OF PRJB AFTER A SUCCESSFUL
      *                           : COMPLETION OF DEBIT TRANSACTION
      *-----------------------------------------------------------------
      * E Aspiras  :010303:TB0159 : amend to process requirements for    
      *                           : Drawdown(YOUBE)                  
      *-----------------------------------------------------------------
TB0221* B. TULAYAN :120203:TB0221 : PROCESS COST HISTORY RECORD ON FIRST
TB0221*                           : LOAN ADVANCE
TB0221*-----------------------------------------------------------------
TB0190* R SORIANO  :210203:TB0190 : ADD SEQNUM IN CIEA PROCESSING
TB0190*-----------------------------------------------------------------
TB0190* RIZA LADIA :210303:TB0169 : FSLON0058 - NEW ACCOUNT OPENING
TB0190*-----------------------------------------------------------------
      * Cyn M Rojas:290303:TB0104 : ALLOW SORD ACTIVATION EVEN IF
      *            :      :       : LOAN IS ONLY PARTIALLY ADVANCED
TB0190*-----------------------------------------------------------------
DUEIND* N Z Oblan  :290303:TB0143 : New field pass to ut0312 to indicate 
DUEIND*            :      :       : first due date adjustment.
DUEIND*-----------------------------------------------------------------
      * MCASTILLO  :290303:TB0020 : Accomodate Multiple Drawdown 
      * RIZA LADIA :      :       : 
      *-----------------------------------------------------------------
TB0159* M ANIBAN   :030403:TB0159 : ADD COMPUTAION OF MATURITY DATE FOR 
TB0159*                             YOUBE(paragraph validate-advances)
TB0159*-----------------------------------------------------------------
      * SY TAN     :080403:TB0237 : CUSTOMISE for TIB UPFRONT LOAN
      *-----------------------------------------------------------------
      * M CASTILLO :140403:TB0020 : Check the drawdown validations  
      *-----------------------------------------------------------------
      * EG ASPIRAS :240403:TB0159 : ADD BR0023CA/BR0024CA TO UT0074 CALL
      *                           : PARAM
      *-----------------------------------------------------------------
      * M ANIBAN   :050503:TB0236 : YOUBE 1 CARD USED DATE
      *-----------------------------------------------------------------
      * MCCASTILLO :150503:TP0019 : MOVE "WRITE" TO DBIOMOD-FUNCTION TO
      *            :              : WRITE COSHMAST RECORD
      *-----------------------------------------------------------------
      * MCCASTILLO :160503:TP0021 : FST-DRAWDOWN-PD >= APPROVAL-DATE
      *            :      :       : FST-DRAWDOWN-PD < APPROVAL-DATE +
      *            :      :       :                   FST-DRAWDOWN-LEN
      *-----------------------------------------------------------------
      * C VILLAR   :200503:TB0169 : ADDING COST-RATE-INCR TO COSH-RATE 
      *-----------------------------------------------------------------
TP0033* D CUNANAN  :220503:TP0033 : IR - FIX advance correction transfer
TP0033*                           : 11155
TP0033*-----------------------------------------------------------------
TB0212* J MADAMBA  :240503:TB0212 : Refresh Mask
TB0212*                           : Change all "EI0085" to "MI0095"
TB0212*-----------------------------------------------------------------
      * MCCASTILLO :300503:SC0085 : Put the usage of UT0079 fields inside an
      *            :              : If statement under paragraph 
      *            :              : M1300-PROCESS-ADV-UPFRONT-LOAN after
      *            :              : performing paragraph M1500-CALC-COMMISSION
      *-----------------------------------------------------------------
      * EG ASPIRAS :300503:SC0183 : DELETE COSH RECORD WHEN ADV CORR TXN
      *-----------------------------------------------------------------
      * EG ASPIRAS :040603:SC0399 : MOVE CALCULATION OF MIN DUE AMOUNT  
      *                           : FOR YOUBE ACCTS AFTER POSTING OF
      *                           : DRAWDOWN PROCESSING FEE
      *-----------------------------------------------------------------
      * JOEL BAJO  :090603:SC0430 : FIX RATE SEARCH FOR COST-RATE;
      *                           : ALSO FIXED DELETE OF COSH
      *-----------------------------------------------------------------
      * EG ASPIRAS :100603:SC0745 : FIX INTERNAL TXNS 1083/1183 FOR     
      *                           : UPFRONT LOANS
      *-----------------------------------------------------------------
      * EG ASPIRAS :100603:SC0394 : FIX NEXT DUE DATE WHEN PRINCIPAL IS
      *                           : FULLY PAID FOR YOUBE LOANS
      *-----------------------------------------------------------------
      * JOEL BAJO  :110603:TB0196 : REMOVE COST-RATE-INCR; REPLACE WITH
      *                           : COST-BASE-ID PROCESSING
      *-----------------------------------------------------------------
      * TFVILLAMOR :190503:TB0260 : MULTI CHANNEL TRANSACTION LIMIT
      *-----------------------------------------------------------------
      * JOEL BAJO  :110603:TB0196 : 2ND PHASE OFCOST-BASE-ID PROCESSING 
      *-----------------------------------------------------------------
      * EG ASPIRAS :120603:SC0905 : NO MANAGEMENT FEE WHEN LOAN BAL IS 
      *                           : LESS THAN OR EQUAL TO ZERO FOR YOUBE 
      *                           : LOANS
      *-----------------------------------------------------------------
SC0525* BERVE SON  :130603:SC0525 : MATURITY DATE FIX FOR BACKDATED
SC0525*            :              : ADVANCE.
SC0525*-----------------------------------------------------------------
      * EG ASPIRAS :150603:SC0883 : MOVE CALCULATION OF MIN DUE AMT FOR
      *                           : YOUBE LOANS TO BR0000
      *-----------------------------------------------------------------
      * EG ASPIRAS :160603:SC0838 : FIX INTERNAL TXN FOR UPFRONT LOAN  
      *                           : INT COLLECTION IN ADVANCE
      *-----------------------------------------------------------------
SC1025* CPCHEN     :200603:SC1025 : CALC THE MATURITY DATE IN MONTH,
SC1025*                           : USE THE CALL CODE 16 FOR UT0312
SC1025*-----------------------------------------------------------------004270/
      * EG ASPIRAS :230603:SC1256 : FIX MANAGEMENT FEE AMOUNT CHARGED  
      *                           : FOR YOUBE LOANS UPON ADVANCE
      *-----------------------------------------------------------------
SC1251* CPCHEN     :240603:SC1251 : BORM-DUE-AMT = UT0075CA-REPAY-AMT
SC1251*                           : WHEN REPAY-SCHED = 'F'
SC1251*-----------------------------------------------------------------
      * CPCHEN     :230603:SC1256 : INITIALIZE WA-TOT-FEE-AMT
      *-----------------------------------------------------------------
      * EA TAN     :240603:TB0276 : ADD NEW TXN INFO IN BORV
      *------------------------------------------------------------------
      * C.SANTILLAN:260603:TB0277 : ADD NEW TXN INFO IN BORV
      *------------------------------------------------------------------
SC1371* MCCASTILLO :250603:SC1371 : SYNC THE WA-IN0014-PASSALONG WITH 
SC1371*                           : UT0014 STARTAREA
SC1371*-----------------------------------------------------------------
      * RICKY TONG :260603: SC1368: ADD UT0011CA-BSB AND UT0011CA-SYSTEM 
      * ----------------------------------------------------------------
      * MCCASTILLO :030703: SC1440: ON ALL THE DRAWDOWN, 
      *            :170703: SC2128: ACCT MAT DATE SHOULD NOT BE GREATER THAN
      *                           : FACILITY LAST DATE OF ACCT EFFECTIVE PRD  
      * ----------------------------------------------------------------
      * EG ASPIRAS :040703:SC1590 : FIX NEXT DUE DATE FOR YOUBE LOANS   
      *                           : UPON CORRECTION OF ADVANCE
      *-----------------------------------------------------------------
TB0273* TFVILLAMOR :300603:TB0273 : Add new narrative field for fedi
      *                           : transaction
TB0273*------------------------------------------------------------------
      * J MADAMBA  :190603:TB0267 : Added new transaction codes for LOANs
      *                              transaction
      *-----------------------------------------------------------------
SC1614* J GONZALES :130703:sc1614 : Fixed computation of due amount for
SC1614*                           : repay-sched = 'K'
SC1614*-----------------------------------------------------------------
SC1976* BERVE SON  :160703:SC1976 : Do not allow backdated advance when
SC1976*            :      :       : next due date <= system date.
SC1976*-----------------------------------------------------------------
SC2192* BERVE SON  :180703:SC2192 : Fix computation of due-amt and int. incr.
SC2192*            :      :       : for backdated advance.
SC2192*-----------------------------------------------------------------
SC2412* R SORIANO  :250703:SC2412 : Compute subsidy int after drawdown
SC2412*-----------------------------------------------------------------
SC2605* FGONZALES  :280703:SC2605 : FIX ADVANCE IF ARREARS > 0 IR2605
SC2605*-----------------------------------------------------------------
SC2527* A-SAM      :290703:SC2527 : 11055 CHK NOT SAME CUST IN UTOVRD
SC2527*-----------------------------------------------------------------
SC2642* SYT        :290703:SC2642 : Upfront Interest call UT0079 i/o UT0075
SC2642*-----------------------------------------------------------------
SC2794* CPCHEN     :010803:SC2794 : FIX THE START DATE OF BUCV WITH 'R'
SC2794*-----------------------------------------------------------------
ST0020* Y.N.KIM    :010803:ST0020 : ADD BORM RECORD TO LINKAGE OF BR0042.
ST0020*-----------------------------------------------------------------
SC2841* BERVE SON  :040803:SC2841 : ADD INT-ADJUSTMENT IN COMPUTING BPI-INT-ACCR
SC2841*-----------------------------------------------------------------
      * J MADAMBA  :310703:TB0244 : populate delivery flag for borv
      *-----------------------------------------------------------------
SC2170* JENNIFOR   :070803:SC2170 : ADD INT-ADJUSTMENT TO BOIS-LAST-BPI-INT-ACCR
SC2170*-----------------------------------------------------------------
SC3211* CBCORRAL   :130803:SC3211 : SAME DUE DATE FOR BACKDATED ADV IN SO TXN
SC3211*-----------------------------------------------------------------
SC3160* MCCASTILLO :130803:SC3160 : INCLUDE WA-BAD-DEBT-WRITE-OFF-CNTRFEIT IN
SC3160*            :      :       : THE VALIDATION OF ADVANCE TXN.
SC3160*-----------------------------------------------------------------
      * JOEL BAJO  :140803:SC3294 : UPDATE SUBSIDY INT ON 1ST ADVANCE
      *-----------------------------------------------------------------
SC1644* BERVE SON  :180803:SC1644 : UPDATE VALUE OF BOIS-STRT-GRACE-PERIOD
SC1644*            :      :       : FOR BACKDATED ADVANCE.
SC1644*-----------------------------------------------------------------
SC3310* LISA MA    :180803:SC3310 : FIX X300-FORMAT-SORD-START FOR COMMENCE
SC3310*            :      :       : SORD WITH 10907 TXN.
SC3310*-----------------------------------------------------------------
      * S.Y.T. B   :210803:SC3580 : FIX IR 3580, REPAYENT LOOPING
      *-----------------------------------------------------------------
      * JOEL BAJO  :250803:SC2676 : FIX WA-POST-DATE CALC; FIX ERR 1559
      *-----------------------------------------------------------------
SC3810* BERVE SON  :260803:SC3810 : RESET MATURITY DATE DURING CORRECTION 
SC3810*            :      :       : OF FIRST ADVANCE.                     
SC3810*-----------------------------------------------------------------  
SC3801* V DAnO JR  :020903:SC3801 : FIX FEDI-VAL-FLG CONDITION AFFECTED
SC3801*                           : OTHER TRANSACTION SUCH AS TPS
SC3801*-----------------------------------------------------------------
SC4248* CPCHEN     :040903:SC4248 : RESET LAST-UNPAID-DUE-DATE DURING
SC4248*            :      :       : CORRECTION OF FIRST ADVANCE
SC4248*-----------------------------------------------------------------
SC3995* JENNIFOR   :050903:SC3994 : DO NOT ALLOW DRAWDOWN AMOUNT MORE THAN
SC3995*            :      :       : APPROVAL AMOUNT FOR COMM LOAN
SC3995*-----------------------------------------------------------------
SC3064* MANIBAN    :060903:SC3064 : fix ir3064
SC3064*-----------------------------------------------------------------
SC3801* V DANO JR  :060903:SC3801 : FIX FEP INITIATED SUB-LEDGER EQUAL
SC3801*                           : ZERO DEFAULT ONE.
SC3810*-----------------------------------------------------------------
SC4393* BERVE SON  :080903:SC4393 : RECALC LOAN TERM FOR BACKDATED ADVANCE
SC4393*                           : AND MATURITY DATE WAS ENTERED DURING  
SC4393*                           : ACCOUNT SETUP.                        
SC4393*-----------------------------------------------------------------  
SC4238* R SORIANO  :100903:SC4238 : FIX SUBSIDY AMT COMPUTATION
SC4238*-----------------------------------------------------------------
SC4465* J MADAMBA  :110903:SC4465 :FOR FEES AND CHARGES
SC4238*-----------------------------------------------------------------
SC4803* J MADAMBA  :190903: INCLUDE 14060 TRXN 
SC4803*------------------------------------------------------------------
SC4617* RITA HUANG :200903:SC4617 : SOME FIELDS NEED HAVE VALUE FOR ADVANCE TXN
SC4617*-----------------------------------------------------------------
SC4203* J MADAMBA  :20903:SC4203 : IR 4203
SC4203*-----------------------------------------------------------------
SC4263* B. TULAYAN :230903:SC4263 :VALIDATE DRAWDOWN AMT.
SC4263*-----------------------------------------------------------------
SC3577* J CHANCO   :230903:SC3577 :Fix validation to call UT0011
SC3577*-----------------------------------------------------------------
SC4985* MCCASTILLO :240903:SC4985 :FOR BACKDATED TXN USE TXN DATE INSTEAD OF
SC4985*                           :START AREA POST DATE
SC4985*-----------------------------------------------------------------
SC4522* LISA MA    :250903:SC4522 :1. REMOVE FEDI CIF VALIDATION TO BR0000  
SC4522*                           :2. ALLOW FEDI BP GEN ACCOUNT PROCESSING
SC4522*-----------------------------------------------------------------
SC4944* J MADAMBA  :260903:SC4944 : IR FIX FOR IR 4494
SC4944*-----------------------------------------------------------------
SC5099* M ANIBAN   :270903:SC5099 : IR FIX FOR ir5099-promo code
SC5099*------------------------------------------------------------------
      * JOEL BAJO  :290903:SC2973 : EXCLUDE FACM-FREEZE FROM ERROR 3941;
      *                           : ERR 3540 GENERATED IN UT0681
      *-----------------------------------------------------------------
SC5145* B. TULAYAN :290903:SC5145 : RECOMPUTE NEXT DUE DATE FOR PREF PERIOD
SC5145*------------------------------------------------------------------
      * J CHANCO   :300903:SC5250 : If transcation is correction, 
      *                             reverse the sign passed to UT0011.
      *------------------------------------------------------------------
      * J MADAMBA  :300903:SC3959 : FOr IR FIX 3959(limits)
      *------------------------------------------------------------------
      * Austine H. :031003:SC4731 : FIX MATURITY DATE COMPUTING 
      *                           : WHEN ADVANCE CORR. TXN OCCURS
      *------------------------------------------------------------------
ST0049*Asutine H.  :031003:ST0049 :WRITE TXN BORV-26 WHEN PORD = BORV-YOUBE
ST0049*                           :BEFORE BORV-01
ST0049*------------------------------------------------------------------   
ST0049* Austine .h :041003:ST0049:ADD NEW FIELD IN BORV-26 -------------   
ST0049*------------------------------------------------------------------   
      * LISA MA    :061003:SC5378 : FOR FEDI TXN 1045/11045/11055, FROM TXN AMT
      *            :      :       : IS GREATER THEN TO TXN AMT, IF IT CONTAINS
      *            :      :       : NET TRANSMISSION FEE.
      *---------------------------------------------------------------
      * LISA MA    :071003:SC5448 : FIX VIRTUAL TO ACCT LIMIT VALIDATE IN UT0011
      *---------------------------------------------------------------
SC4819* F GONZALES :081003:SC4819 : FIX IR 4819
SC4819*------------------------------------------------------------------
SC5125* RITA HUANG :091030:SC5125 : FOR YOUBE LET BOIS-LAST-UNPAID-DUE-DATE
SC5125*            :      :       : EQUAL TO BOIS-NEXT-DUE-DATE
SC5125*-----------------------------------------------------------------
SC4835* MANIBAN    :131003:SC4835 : FIX IR 4835
SC4835*-----------------------------------------------------------------
SC5620* J MADAMBA  :131003:SC5620 : FIXRD PROBLEM RAISED IN IR 5620
SC4835*-----------------------------------------------------------------
SC5624* J MADAMBA  :131003:SC5624 : FIXED PROBLEM RAISED IN IR 5624
SC5624*-----------------------------------------------------------------
SC5701* J MADAMBA  :151003:SC5701 : FIXED PROBLEM RAISED IN IR 5701
SC5701*-----------------------------------------------------------------
SC5617* M SANCHEZ  :161003:SC5617 : COMMENT OUT THEO-LOAN-BAL FOR
SC5617*            :      :       : CORRECTION TRANSACTIONS
SC5617*-----------------------------------------------------------------
SC4624* R SORIANO  :131003:SC4624 : INITIALIZE BINS-PREMIUM WHEN
SC4624*            :      :       : BORM-INS-IND = 2
SC4624*-----------------------------------------------------------------
SC5885* CPCHEN     :211003:SC5885 : FIXED VARIABLE LENGTH
SC5885*-----------------------------------------------------------------
SC5827* J MADAMBA  :211003:SC5827 : FIXED IR 5827
SC5827*-----------------------------------------------------------------
SC6000* JEREMY LAU :261003:SC6000 : FIX LOAN WITHDRAWAL WITH INPUT PROMO
SC6000*-----------------------------------------------------------------
ST0049* EG ASPIRAS :261003:ST0049 : YOUBE BACKDATING
ST0049*-----------------------------------------------------------------
SC6028* J MADAMBA  :271003:SC0068 : FIXED 108 ERROR FOR 14150 TRXN
SC6028*-----------------------------------------------------------------
SC6067* BERVE SON  :281003:SC6067 : FIXED CORR. OF YOUBE AVD FOR FEES   
SC6067*-----------------------------------------------------------------
SC5617* M SANCHEZ  :301003:SC5617 : REMOVE FIX FOR IR 5617                     
SC5617*-----------------------------------------------------------------
SC5578* CPCHEN     :011103:SC5578 : COMMENT OUT SC4819
SC5578*-----------------------------------------------------------------
SC5557*B. TULAYAN  :031103:SC5557 : FIX UPFRONT ADVANCE CORRECTION
SC5557*-----------------------------------------------------------------
SC6309*B. TULAYAN  :061103:SC6309 : DONT ALLOW YOUBE TO DO ADVANCE IF MATURE
SC6309*-----------------------------------------------------------------
SC6302* CBCORRAL   :061103:SC6302 : DONT ALLOW UPDATE IN SO IF REPAY IN EFFECT
SC5617*-----------------------------------------------------------------
ST0079* DCUNANAN   :081103:ST0079 : MODIFY FEE HANDLING FOR YOUBE ACCT
ST0079*                           : INSTEAD OF USING THE BAFM AND CIEP
ST0079*                           : THE SYSTEM WILL USE THE MNEMONIC PARM
ST0079*                           : TO GET THE FEE AMOUNT BY PROMO CODE
ST0079*-----------------------------------------------------------------
SC6388* DCUNANAN   :121103:SC6388 : FIX IR 6388 REMOVE SUP OVR 117 FOR 
SC6388*                           : YOUBE ACCOUNTS
SC6388*-----------------------------------------------------------------
SC6395* DCUNANAN   :131103:SC6395 : FIX IR 6395 FIX HUNDLING OF FEE
SC6395*                           : CORRECTION FOR YOUBE
SC6395*-----------------------------------------------------------------
SC6434*C.SANTILLAN :141103:SC6434 : COMMENT OUT SC5827's MOVE ZERO TO
SC6434*                             TO W800-CORR-JRNL-NO
SC6434*-----------------------------------------------------------------
SC6500*J MADAMBA   :201103:SC6500 : supply correct entried of type 20 in borv for tfr trxns
SC6500*-----------------------------------------------------------------
SC6677* BERVE SON  :211103:SC6677 : RESET DUE START DATES AFTER FIRST ADV.
SC6677*                           : CORRECTION.                           
SC6677*-----------------------------------------------------------------  
SC6621* CBCORRAL   :261103:SC6621 : RECALC LOAN TERM FOR SAME DAY CREATE AND ADV
SC6621*-----------------------------------------------------------------
SC6586* B. TULAYAN :281103:SC6586 : AUTO SETUP EFF FLOAT RATE CHANGE IND FOR NEGO 2
SC6586*-----------------------------------------------------------------
      * JOEL BAJO  :291104:SC4393 : REFINEMENT OF SC4393
      *-----------------------------------------------------------------
ST0097* BERVE SON  :011203:ST0097 : VALIDATION FOR CONVERSION CUT-OFF.
ST0097*-----------------------------------------------------------------
      * CPCHEN     :021203:SC6924 : 1ST REPAY DAY IN 17022 MUST EQUAL TO
      *                             NEXT DUE DATE WHEN DOING 1ST DRAWDOWN
      *                    SC6948 : WRITE EXTRA BORV-20 IF FEDI-TXN
      *-------------------------------------------------------------------------
      * BERVE SON  :021204:SC6946 : FIX RECALC OF LOAN TERM FOR NORMAL ADV.
      *-----------------------------------------------------------------
      * DCUNANAN   :041204:SC6571 : FIX ERROR HANDLING FOR UT0081
      *-----------------------------------------------------------------
      * LISA MA    :041203:SC7014 : REMOVE BORV-02-CODE AND COMBINE 2
      *            :              : BORV-20-CODE FOR ATM TRANSACTIONS.
      *-----------------------------------------------------------------
      * MANIBAN    :041203:SC6712 : pref int rate
      *-----------------------------------------------------------------
      * JOEL BAJO  :061203:SC7100 : ADDITIONAL CODE FOR SC6946
      *-----------------------------------------------------------------
      * C.SANTILLAN:011203:SC6854 : FIX PROC FOR VIRTUAL ACCT (ENTCODE-901-905)
      *                           : 14055 - 4045 CHANGE TO 24046
      *----------------------------------------------------------------------
      * BERVE SON  :091203:SC7172 : FIX RECALC OF TERM FOR NORMAL ADV.
      *-----------------------------------------------------------------
      * CPCHEN     :101203:SC7186 : PERFORM B120- ONLY AT TRANSFER TXN
      *-----------------------------------------------------------------
      * DCUNANAN   :121203:SC7197 :  FIX JOURNAL POSTING FOR YOUBE BACKDATING
      *-----------------------------------------------------------------
      *C.SANTILLAN :121203:SC7181 : Add UTVTACCA-CALL-PARAM on call of UT0820
      *------------------------------------------------------------------
      * MANIBAN    :121203:SC6712 : backout as confirmed by user
      *------------------------------------------------------------------
      * A-SAM      :051203:SC7091 : 16XXX FOR FEDI TXN
      *-----------------------------------------------------------------
      * DCUNANAN   :171203:SC7464 : BYPASS ERROR 4174 FOR CORR TRAN
      *-----------------------------------------------------------------
      * MANIBAN    :181203:SC7454 : when account limit = 0 display
      *                             error msg available limit not enough
      *            :191203:SC7522 : dont allow advance(yoube) when
      *                           : next due date <= txn date
      *-----------------------------------------------------------------
      * CPCHEN     :261203:SC7091 : ADD NEW TXN FOR YOUBE BACKDATE ADV
      *                             19050 / 19055 / 19060 / 19062
      *-----------------------------------------------------------------
      * DCUNANAN   :020104:ST0115 : PUT CHANGES FOR YOUBE ENQ
      *-----------------------------------------------------------------
      * R SORIANO  :020104:SC7928 : SET SUBS-START-DATE TO 1ST ADVANCE
      *-----------------------------------------------------------------
      * DCUNANAN   :050104:SC7931 : PUT NEW VALIDATION IF ACCT LIMIT = 0 
      *                           : THEN THE ACCT HAS A TEMP PAYMENT THE
      *                           : SYSTEM SHOULD ALLOW THE TXN
      *-----------------------------------------------------------------
      * A-SAM      :050104:SC7982 : TXN-DT < LAST-ACCT-TYPE-CHANGE NOT <=
      *------------------------------------------------------------------
      * DCUNANAN   :060104:SC7942 : ALLOW ADVANCE TRAN IF TXN DATE <= 
      *                           : BOIS-NEXT-DUE DATE FOR YOUBE ACCT
      *------------------------------------------------------------------
      * MANIBAN    :070104:SC8042 : allow advance if yoube is w/
      *                             temporary receivable
      *------------------------------------------------------------------
      * EMMY       :090104:SC8034 : FIX 13640 TXN AMOUNT                      
      *------------------------------------------------------------------
      * LISA MA    :100104:SC8085 : FIX VIRTUAL ACCT BULK POSTING
      *------------------------------------------------------------------
      * JOEL BAJO  :130104:SC6175 : REVISE MATURITY DT & TERM CALC LOGIC
      *            :140104:SC8085 : MOVE UTVTACCA TO LINKAGE SECTION
      *            :150104:SC6175 : ADDITIONAL CODE FOR BACKDATED ADV
      *-----------------------------------------------------------------
      * CPCHEN     :160104:SC7995 : WEBLOGIC & IVR TXN, 6X45 -> 4X45
      *-----------------------------------------------------------------
      * DCUNANAN   :160104:SC8215 : ADD NEW FIELD IN BOIS 
      *                           : BOIS-LST-FIN-POST-DT
      *-----------------------------------------------------------------
      * MANIBAN     :160104:SC8200 : include borm-record-area/bois-record
      *                              in UTCIEA linkage area
      * ----------------------------------------------------------------
      * J MADAMBA   :190104:SC8289 : fix error 108 problem for 16055 txn fr fedi
      * ----------------------------------------------------------------
      * MANIBAN     :210104:SC8380 : fix stretch term when advance
      * ----------------------------------------------------------------
      * B. TULAYAN  :210104:SC8286 : UPDATE BORV-STATUS UPON CORR 13540 TXN
      *-----------------------------------------------------------------
      * MANIBAN     :210104:SC8287 : display correct int rate and pref
      *                              expiry date - 19050 & 19150 txn
      *-----------------------------------------------------------------
      * EMMY       :210104:SC8285 : BYPASS CHARGING REV FEE IF BACKDATED      
      *------------------------------------------------------------------
      * EMMY       :220104:SC8349 : FIX NEXT DUE DATE FOR BKDT ADV            
      *------------------------------------------------------------------
      * CPCHEN     :240104:SC7091 : WEBLOGIC & IVR TXN, 6X45 -> 1X45
      *-----------------------------------------------------------------
      * MANIBAN    :240104:SC8398 : correct loan term error - yoube
      *            :040204        : same
      *-----------------------------------------------------------------
      * DCUNANAN   :280104:SC8583 : FIX YENQ ATM SEQ NO
      *-----------------------------------------------------------------
      * J MADAMBA  :280104:SC8289 : recode changes 
      *-----------------------------------------------------------------
      * C.SANTILLAN:050404:SC8776 : FIX ATM VA-CGL-B TYPE,JNRST-TRANSFER-BRNCH
      *-----------------------------------------------------------------
      * J MADAMBA  :040204:SC8827 : FIX GLIF OF 19155 (NO 24146)
      *-----------------------------------------------------------------
      * J ESCANER  :100204:SC8568 : FOR CTA ACCT MAT DT = ADVANCE DT
      *                           :   ON ADVANCE ACCT CHANGED TO MATURED
      *-----------------------------------------------------------------
      * MANIBAN    :110204:SC8983 : no need to recalculate loan term
      *                             for yoube
      *-----------------------------------------------------------------
      * MANIBAN    :110204:SC8881 : ir fix 8881
      *-----------------------------------------------------------------
      * J MADAMBA  :120204:SC8991 : fix 132 error for corection 16155 from 19055
      *                           : original txn iniated from ATM 
      *                           : for this error, they system make use of 6045/6145
      *                           : trn code for the depoit side
      *-----------------------------------------------------------------
      * J MADAMBA  :130204:SC8991 : backout changes for SC8991
      *-----------------------------------------------------------------
      * R SORIANO  :190204:SC9188 : UPDATE SUBS-ADVANCE-DATE UPON DRAWDOWN
      *-----------------------------------------------------------------
      * C.SANTILLAN:190204:SC9150 : BYPASS 4174 WHEN YOUBE REPOST
      *-----------------------------------------------------------------
      * R SORIANO  :200204:SC9222 : UPDATE SUBS-START-DATE UPON DRAWDOWN
      *-----------------------------------------------------------------
      * V. DAnO JR :200204:SC9192 : BYPASS SOME ERROR DURING REPOST-TXN 
      *-----------------------------------------------------------------
      * JOEL BAJO  :200204:SC9161 : CHANGED FORMULA FOR CAR LOAN SUBSIDY
      * R SORIANO  :              : INTEREST CALCULATION
      *-----------------------------------------------------------------
      * DCUNANAN   :260204:SC9373 : FIX ATM SEQ IN YENQ
      *-----------------------------------------------------------------
      * EMMY       :280204:SC9392 : ATM TXN CORRECTION THRU BANCSLINK         
      *------------------------------------------------------------------
      * JEREMY LAU :060304:SC9409 : FIX UT0800 SUP LOOPING
      *------------------------------------------------------------------
      * PENNY HUANG:110304:SC9608 : ADD UTVTACCA-CALL-PARAM  TO UT0800 LINKAGE
      *------------------------------------------------------------------
      * DCUNANAN   :170304:SC9726 : CALCULATION OF NEXT DUE DATE
      *------------------------------------------------------------------
      * C.SANTILLAN:220304:SC9610 : OVER THE COUNTER BACKDATED CORRECTION,
      *                           : ADD 24143 INT TXN CODE, SUSP ACCT 
      *-----------------------------------------------------------------
      * JKB ALDAY  :240304:SC9719 : BYPASS AVAILABLE LIMIT VALIDATION ON
      *                           : YOUBE ACCTS UPON BACKDATE CORR FOR
      *                           : ADVANCE TXN
      *-----------------------------------------------------------------
      * B. TULAYAN :060404:SC9916 : UPDATE BOIS-STRT-GRACE-PERIOD DURING
      *                           : FIRST ADVANCE.
      *------------------------------------------------------------------
      * JOEL BAJO  :140404:SC9895 : CORRECTION TO SC9161 - CALL "UT0X75"
      *-----------------------------------------------------------------
      * EMMY       :150404:SC9999 : BYPASS LOGIC IF YOUBE                
      *-----------------------------------------------------------------
      * CBCORRAL   :280404:S10062 : VALIDATE NON-LINKED MORT COMBI FOR 
      *                           : ALL ADVANCE TXN
      *            :290404:SC9737 : FIX ADV CORRECTION FOR LOAN SO TXN
      *-----------------------------------------------------------------
      * EMMY       :040504:S10075 : FIX LAST FIN DATE FOR BACKDATED CORR  
      *-----------------------------------------------------------------
      * JESCANER   :130504:SC9389 : ALLOW REPAYMENT FOR CTA ACCT
      *                           :  WHERE MAT DT = ADV DATE
      *-----------------------------------------------------------------
      * CBCORRAL   :170504:S10139 : APPLY VALIDATION FOR THRESHOLD IN  
      *                           : ADV AND ADV CORRECTION   
      *-----------------------------------------------------------------
      * JESCANER   :190504:SC7653 : REMOVE THE MODULE THAT CREATES
      *                           :  "R" TYPE IN BUCV FOR YOUBE ACCTS 
      *-----------------------------------------------------------------
      * DCUNANAN   :090604:S10250 : FIX NEXT DUE DATE IF PREF INT = 0
      *-----------------------------------------------------------------
      * DCUNANAN   :110604:S10314 : USE STRT-AREA-POST-DT FOR BORV 26
      *-----------------------------------------------------------------
      * BERVE SON  :160604:S10260 : ALLOW ONLY 11055 FOR UPFRONT LOANS. 
      *-----------------------------------------------------------------
      * JESCANER   :160604:S10207 : VALIDATE TOTAL ADVANCE AMT AGAINST
      *                           : THRESHOLD AMT FOR MORTGAGE ACCT
      *                           : WHEN DOING ADVANCE TRANSACTION
      *-----------------------------------------------------------------
      * NATHAN     :240604:S10329 : ADD DISCOUNT PROMO-CODE FOR YOUBE
      *-----------------------------------------------------------------
      * B. TULAYAN :160604:S10293 : POPULATE TIB ACCT IND UPON 1ST ADV.
      *-----------------------------------------------------------------
      * BERVE SON  :270704:S10490 : FIX CORRECTION FOR NEGO RATE IND = 2
      *-----------------------------------------------------------------
      * CBCORRAL   :030804:S10516 : CATER OD LIMIT RECOMP FOR MULT ADV  
      *-----------------------------------------------------------------
      * BERVE SON  :050804:S10560 : TEMP FIX. DO NOT VALIDATE AO1P FOR YOUBE
      *-----------------------------------------------------------------    
      * F GONZALES :120804:ST0170 : OFFSET LOAN ACCOUNT IND = "2"
      *-----------------------------------------------------------------
      * DCUNANAN   :130804:S10578 : USE PROMO CODE TO OVRD GL FOR YOUBE 
      *-----------------------------------------------------------------
      * B. TULAYAN :070904:S10467 : INCLUDE REPAY FREQ IN CALLING UT0312
      *----------------------------------------------------------------
      *HAROLD HUANG:200904:S10745 : 1.REMOVE ATM CARD STATUS  
      *                           : 2.ADD APPROVE DATE CHECK(FOR ATM TRANSFER)
      *----------------------------------------------------------------
      *HAROLD HUANG:201011:S10833 : FIX NON-NOMINATE TRANSFER LIMIT CHECK
      *----------------------------------------------------------------
      * BERVE SON  :121004:S10467 : ADD VALIDATIONS FOR SITUATIONS THAT  
      *                           : MIGHT HAPPEN BECASE OF REPAY FREQ > 1
      *----------------------------------------------------------------  
      * M LOGATOC  :080704:NR0001 : INITIALIZE DBIO-CALL-SAVE-REFER AND
      *            :      :       : DBIO-CALL-REFER-AREA FOR NORMALIZATION
      * RICKY TONG :220704:       : CHANGE X(65) TO X(102) ACCORDING TO FT0000
      *-----------------------------------------------------------------
      * BERVE SON  :251104:S10978 : FIX RESTORE OF LST FIN DATE DURING
      *                           : CORRECTION.
      *----------------------------------------------------------------
      * NATHAN     :310704:S10614 : ADD VISA DEBIT FUNCTION
      *-----------------------------------------------------------------
      * RICKY TONG :171204:NN0001 : RETROFIT S10978,S10614
      *-----------------------------------------------------------------
      * DCUNANAN   :200105:S10526 : PASS STRT-AREA-BATCH-TANDEM TO UT0081
      * RICKY TONG :210105:NN0005 : RETROFIT S10526
      *-----------------------------------------------------------------
      * BERVE SON  :010205:NQ0079 : PROBLEM IN RESTORING LAST FIN. DATE 
      *                           : DURING CORRECTION OF ADVANCE.       
      *-----------------------------------------------------------------
      * CHINYI HSU :040305:S11246 : MODIFY ERROR CODE 3314 TO 4514
      *-----------------------------------------------------------------
      * JESCANER   :310305:S11202 : FIX INCORRECT LST UNPAID DUE DATE
      *                           : WHEN ACCT EXCUTES ANOTHER DRAWDOWN
      *                           : AFTER ADVANCE REPAYMENT
      *-----------------------------------------------------------------
      * JESCANER   :010405:S11050 : FIX PROBLEM OF LST UNPAIN DUE DATE
      *                           : DURING CORRECTION OF ADVANCE TXN  
      *                           : KEEP ORIGINAL REPAY DAY OF THE ACCT
      *                           : IN BORV TYPE 54
      *-----------------------------------------------------------------
      * JANE HUANG :040805:S11218 : YOUBE TEMPORARILY DO NOT ALLOW WITHDRAW TXN
      *-----------------------------------------------------------------
      * CHINYI HSU :210405:S11377 : ALLOW BANCSLINK TXN AND ADV CORRECTION
      *-----------------------------------------------------------------
      * CHINYI HSU :250405:S11395 : YOUBE TEMPORARILY STOP ALLOW BANCSLINK
      *                             TO DO ADVANCE TXN
      *-----------------------------------------------------------------
      * HAROLD     :200505:S11422 : FIX VALIDATION TO CALL UT0011 
      *-----------------------------------------------------------------
      * DCUNANAN   :260505:S11455 : YOUBE INSTALLMENT
      *-----------------------------------------------------------------
      * CHINYI HSU :100605:S11439 : ALLOW BRANCH 622 BACKDATED INSERT TXN
      *-------------------------------------------------------------------
      * CHINYI HSU :170605:S11413 : AFTER SET YOUBE TEMPORARILY STOP ALLOW
      *                             STORE REQUEST AMOUNT
      *-----------------------------------------------------------------
      * DCUNANAN   :130705:S11550 : MOVE ZERO TO FIRST ADV DATE FOR YOUBE
      *-----------------------------------------------------------------
      * DCUNANAN   :210705:S11632 : EXCLUDE YOUBE IN MOVING BORM-APP-AMT
      *                           : TO BORM-ADV-VAL
      *-----------------------------------------------------------------
      * CHINYI HSU :110805:S11701 : ALLOW YOUBE TEMPORARILY CAN DO INSTALLMENT
      *-------------------------------------------------------------------
      * JANE HUANG :240805:S11711 : DISABLED VISA DEBIT DO NOT ALLOW WITHDRAW
      *-----------------------------------------------------------------
      * HAROLD     :250805:S11610 : SET ATM CASH WD ON OVERSEAS 20050905
      *-----------------------------------------------------------------
      * CHINYI HSU :130905:S11797 : ALLOW TO WITHDRAW TEMP-RECEIVABLE
      *                             EVEN A/C WAS STOPPED
      *-----------------------------------------------------------------
      * Tsui-huan, Kao :260905:S11808 : fixed M1100-CALC-REPAYMENT,
      *                                 adding call function CALL "UT0290" 
      *-----------------------------------------------------------------
      * JANE HUANG:061005:S11854 : ADD NEW VALUE OF STOP_TRAN_IND
      *----------------------------------------------------------------
      * MAGGIE LIN:201005:S11826 : SUSPECT ACCOUNT
      *----------------------------------------------------------------
      * CHINYI HSU:050106:S12026 : REINFORCE INSTALLMENT OF YOUBE
      *----------------------------------------------------------------
      * CLARE HUANG:270206:NR2001: 1.REPLACE FIELD NAME BORV BY BOCT
      *            :      :      : 2.REPLACE CALLING DBIO BY CALLING UTBOCT
      *                             *****  RETFOFIT FOR S12193 ****
      *-----------------------------------------------------------------
      * CHINYI HSU:140206:S12046 : WHEN YOUBE TEMPORARILY STOP NOT ALLOW
      *                            DO TODAY ADVANCE TRANSACTION
      *-----------------------------------------------------------------
      * CHINYI HSU:030306:S12145 : FIX WHEN ACCOUNT-LIMIT=0 AND ADVANCE
      *                            TEMPORARY CREDIT DONOT CORRECTION
      *----------------------------------------------------------------
      * CLARE HUANG:210306:NR2001: END OF NR2001 **** S12193 *****
      *---------------------------------------------------------------- 
      * A-SAM      :060606:S12329: CORRECTION DON'T CHECK THRESHOLD-AMT
      *----------------------------------------------------------------
      * CHINYI HSU :220606:S12243 : REPOSTING USE UT9002CA-IMG0-TIME
      *-----------------------------------------------------------------
      * C.H.LIN    :150805:S12536 : WHEN BORP-COMML
      *            :      :       : PROMO-TELLER DO NOT CHECK AO1P
      *-----------------------------------------------------------------
      * CHINYI HSU :300806:S12487 : MOVE DATE TO YENQ-SYSTEM-DATE
      *-----------------------------------------------------------------
      * Tsui-huan, Kao :08092006:S12589 : fixed Z000-CH-PROC-DT,
      *                                   PROC  LEAP YEAR
      *-----------------------------------------------------------------
      * CHINYI HSU :190906:S12518 : ADVANCE STOP ADDING BLDVAA RECORD
      *-----------------------------------------------------------------
      * CHINYI HSU :161106:S12694 : WHEN REPOST USE IMG0-DATE
      *-----------------------------------------------------------------
      * CANDICE C  :231106:S12709 : CAN NOT WITHDRAW WHEN MATURITY FOR YB
      *-----------------------------------------------------------------
      * A-SAM      :240107:NR2003 : PERFORMANCE TUNING FOR READING BOCT
      *                            *****  RETFOFIT FOR S12672 ****
      *-----------------------------------------------------------------
      * CANDICE C  :030307:S12770 : WRITE VIR AC OF 36 TYPE FOR 11057/16057
      *                           : ADD 11063/11163/16063/16163
      *-----------------------------------------------------------------
      * A-SAM      :140307:S15173 : RETURN CALL PROCEDURE CHECK ERROR
      *----------------------------------------------------------------
      * JENNIFER   :170507:S15296 : ADD VIP CODE FOR FEE TRANSACTION/EVENT
      *----------------------------------------------------------------
      * KUGAR LIN  :210507:S15266 : ADD BENEFIT CODE
      *----------------------------------------------------------------
      * CHINYI HSU :020807:S15449 : REVERSAL AND BAL = 0 ,DONOT MOVE 0
      *                             TO RATE-EXP-DATE
      *-----------------------------------------------------------------
      * NATHAN     :240807:S15507 : FIX RECALC OD-LIMIT AMT BUG.
      *-----------------------------------------------------------------
      * A-SAM      :090707:S15238 : INIT BORM-ADV-TOM-RATE
      *----------------------------------------------------------------
      * NATHAN     :251207:S15265 : FIX VIRTUAL-ACCT WRITE GLIF BUG
      *-----------------------------------------------------------------
      * NATHAN     :130208:S15727 : ADD PROCESS ABOUT BANK-RATE
      *-----------------------------------------------------------------
      * RITA HUANG :130308:S15787 : FIX ADV CORR TXN
      *-----------------------------------------------------------------
      * T.S. KAO   :220408:S15903 : check: borm-adv-date - borm-oldest-bdate-date
      *                                    shoud be  <= 3
      *-----------------------------------------------------------------
      * TERA LIN   :062408:S16000 : ADD FIELD 12007-BANK-RATE,SUB-PROJ
      *----------------------------------------------------------------
      * NATHAN     :050808:S16087 : FIX YOUBE ADV BUG ABOUT NEXT-DUE-DATE
      *-----------------------------------------------------------------
      * AGNES LIN  :070808:S16064 : FOR 17046 BOIS-EFR-CHNG-IND = '1'
      *----------------------------------------------------------------
      * RITA HUANG :250908:S16101 : ADD PROCESS USAGE LOAN
      *-----------------------------------------------------------------
      * AGNES LIN  :021008:S15871: SUB-TYPE = F HAS NEW FUNCTION FOR CONFER
      *---------------------------------------------------------------------
      * T.S. KAO   :080508:S16081 : 1.bug: txn-11155 when repay-freq = 98
      *                             2.UPfront loan for inter branch
      *-----------------------------------------------------------------
      * AGNES LIN  :051208:S16275 : ADVANCE RECALC RATE EFR-CHNG-IND='1'
      *---------------------------------------------------------------------
      * RIO YEN    :130309:S16324 : WRITE RENB WHEN BORP-RENEW
      *---------------------------------------------------------------------
      * AGNES LIN  :170409:S16466 : FOR CAPPED/COLLAR FUNC
      *---------------------------------------------------------------------
      * A-SAM      :220509:S16534 : CORRECTION TRAN CHECK BAD-DEBT-IND
      *---------------------------------------------------------------------
      * A-SAM      :100709:S16579 : SME-B2B PROD DON'T CHECK PROMO-ID
      *---------------------------------------------------------------------
      * RITA HUANG :100709:S16564 : FOREIGN LABORER LOAN
      *-----------------------------------------------------------------
      * SCOTT LEE  :130509:S15848 : CHANGE THE VIP TYPE FROM 99 TO XX
      *-----------------------------------------------------------------
      * RITA HUANG :070909:S16668 : YOUTH LOAN
      *-----------------------------------------------------------------
      * TH, KAO    :231109:S16782 : NO NEED EXE F000-POST-COSH FOR BDI & FTP
      *------------------------------------------------------------------
      * RITA HUANG :210410:S16899 : FOREIGN LABORER LOAN
      *-----------------------------------------------------------------
      * CPCHEN     :090710:S16967 : REMOVE CHECK FOR RENB-CR-AMT
      *-----------------------------------------------------------------
      * RITA HUANG :011010:S16976 : FOREIGN LABORER LOAN
      *-----------------------------------------------------------------
      * A-SAM      :250311:S16871 : FIX FOE WBS
      *------------------------------------------------------------------
      * TH KAO     :220711:S17218: ALBPS PROJECT
      *---------------------------------------------------------------
      * A-SAM      :160812:S17497: ADV FOR PRODUCT GROUP 12 ~ 16
      *---------------------------------------------------------------
      * CPCHEN     :051212:S17580 : FIX CALL UT0014
      *-----------------------------------------------------------------
      * CPCHEN     :290514:S17946 : FIX THE SAME AS S11797 FOR
      *                             SUB-TYPE="E"
      *-----------------------------------------------------------------
      * CPCHEN     :100614:S17755 : NEW PROD : I-LOAN
      *------------------------------------------------------------------
      * CPCHEN     :150714:S17787 : I-LOAN VALIDATE FREEZE STATUS
      *------------------------------------------------------------------
      * NAMRATA W  :110814:B17951 : DISABLE UNUSED VENPARAM
      *-----------------------------------------------------------------
      * CPCHEN     :201114:B18091 : FIX CALL "UTHIST"
      *-----------------------------------------------------------------
      * CPCHEN     :160615:S18106 : ILOAN ADVANCE
      *------------------------------------------------------------------
      * KTH        :310715:S18344 : CAR LOAN FIX FINE RATE
      *---------------------------------------------------------------------
      * CPCHEN     :110815:S18318 : BKDT CAN NOT BE EARLIER THAN
      *                             CONVERSION DATE (RATE UP TO 15%)
      *------------------------------------------------------------------
      * JOESON SU  :200116:S18391 : ADD STRT-DIB-TXN
      *-----------------------------------------------------------------
      * JOESON SU  :080316:S18475 : FIX WS-FTR-UNS-CHK-DATE CHECK
      *----------------------------------------------------------------
      * JACKIE Y.  :300917:S18816 : REVERSE MORTGAGE LOAN CHECK
      *----------------------------------------------------------------
      * JACKIE Y.  :261217:S18869 : ENHANCE REVERSE MORTGAGE LOAN
      *------------------------------------------------------------------
      * A-SAM      :051019:S19269 : ADD PROD FOR PB
      *------------------------------------------------------------------
      * REDHSU     :101219:S19314 : RE USE FILED BORM-ADD-ADV-DATE
      *---------------------------------------------------------------------
      * JACKIE Y.  :250520:S19435 : CHECK FOR BAILOUT PROD.
      *---------------------------------------------------------------------
      * JACKIE Y.  :072221:S19705 : CHECK FOR RICHART
      *------------------------------------------------------------------
      * MICKY      :081821:S19747 : FIX FOR RICHART TXN
      *------------------------------------------------------------------
      * JACKIE Y.  :091421:S19765 : FIX FOR RICHART CHANNEL
      *------------------------------------------------------------------
      * JACKIE Y.  :101421:S19779 : FIX FOR LST-UNPD-DUE-DTE
      *------------------------------------------------------------------
      * MICKY      :052622:S19952 : FIX FOR IB TXN
      *------------------------------------------------------------------
      * GILL CHEN  :150223:B19902 : FS-AP003 FEE MASK AND STRTAREA EXPANSION
      *------------------------------------------------------------------
      * JOYCE HONG :220523:B19901 : FS-AP002 SET NEW FIELDS OF CS0000CA
      *------------------------------------------------------------------
      * RICKY      :210423:T20184 : UPDATE ATM-SEQ-NO TYPE
      *------------------------------------------------------------------
      * RICKY      :240425:S20771 : ADD PROD FOR FBOND 7421-XXXX
      *------------------------------------------------------------------
004280 IDENTIFICATION DIVISION.
004290 PROGRAM-ID. BR0024.
004300*
004310 AUTHOR. A. M. ALMASRI.
004320* DESC. LOANS ADVANCE MODULE .
004330*
004340 INSTALLATION. FINANCIAL NETWORK SERVICES PTY LTD.
004350*
004360 DATE-WRITTEN. NOV. 3, 1993.
004370 DATE-COMPILED. XXXXXXXXXX.
004380/
004390*
004400 ENVIRONMENT DIVISION.
004410*
004420 CONFIGURATION SECTION.
004430*
004440 SOURCE-COMPUTER. NCR-CRITERION.
004450 OBJECT-COMPUTER. NCR-CRITERION.
004460*
004470 SPECIAL-NAMES.
004480*    SWITCH-1 ON STATUS IS ATM-ONLY-REFRESH
004490*    SWITCH-2 OFF STATUS IS NO-REFRESH.
004500*    SYMBOLIC CHARACTERS ARE HEXADECIMAL.
004510*
004520 INPUT-OUTPUT SECTION.
004530 FILE-CONTROL.
004540*
004550 DATA DIVISION.
004560*
004570 FILE SECTION.
004580*
004590/
004600*
004610 WORKING-STORAGE SECTION.
S12589 01  WA-LEAP-REM                      PIC 9.
S12589     88  WA-LEAP-YEAR                 VALUE 0.
S12589 01  WA-LEAP-REM1                     PIC 9(3) VALUE 0.
S12589 01  WA-NEXT-DATE                     VALUE ZEROS.
S12589     03  WA-NEXT-DDMMCCYY.
S12589         05 WA-NEXT-DD                   PIC 99.
S12589         05 WA-NEXT-MM                   PIC 99.
S12589         05 WA-NEXT-CCYY                 PIC 9(4).
S12589         05 WA-NEXT-CCYY-R REDEFINES WA-NEXT-CCYY.
S12589            10 WA-NEXT-CC                PIC 9(2).
S12589            10 WA-NEXT-YY                PIC 9(2).
SC8991*01  WA-BACKDATE-DATE                 PIC 9(8).
SC6854 01  WA-820.
SC6854     05 WA-GL-820-AMT                 PIC S9(14)V999
SC6854         SIGN IS TRAILING SEPARATE.
SC7931 01  WA-YOUBE-WOKING-VAR.
SC7931     05 WA-TEMP-BORM-LOAN-BAL         PIC S9(14)V999.
S10139 01  WA-DEP-NO-W                      PIC 9(17) VALUE ZEROES.
S10139 01  WA-DEP-NO-X                      VALUE ZEROES.
S10139     05  FILLER                       PIC 9.
S10139     05  WA-DEP-NO                    PIC 9(16).
S10139 01  WA-OD-LIMIT                      PIC S9(14)V999 COMP.
S10139 01  WA-ADV-VAL                       PIC S9(14)V999 COMP.
S16466 01  WA-NEW-RATE-FOUND                PIC X VALUE "Y".
S16466 01  WA-NEW-RATE-NOT-FOUND            PIC X VALUE "N".
S16466 01  WA-IN-PROGRESS                   PIC X VALUE "P".
S16466 01  WA-CAFM-TYPE                     PIC X.
S16466  88 CAP-IN-FORCE                     VALUE "1" "3".
S16466  88 FLOOR-IN-FORCE                   VALUE "2" "3".
S16466  88 NO-CAP-OR-COLLARS                VALUE "0".
S16466  88 FIXED-IN-FORCE                   VALUE "4".
S16466  88 CAP-COLLARS-ALLOWED              VALUE "5".
S16466  88 CAP-COLLARS-FLEXIBLE             VALUE "6".
S16466 01  WA-SEARCH-RATE-DATE              PIC S9(9) BINARY.
S16466 01  WA-FOUND-IND                     PIC X.
S16466  88 FOUND-NEW-RATE                   VALUE "Y".
S16466  88 NEW-RATE-NOT-FOUND               VALUE "N".
S16466  88 NEW-RATE-IN-PROGRESS             VALUE "P".
S16466 01  WA-TEMP-KEY.
S16466     03  WA-TEMP-SOC                  PIC 9(3).
S16466     03  WA-TEMP-ACC                  PIC 9(16).
S18816 01  WA-MULTI-ADV-AMT                 PIC S9(14).
S10139 01  INOD-RECORD-AREA.
S10139     COPY INODMAST IN LIBRYINV.
TB0236 01  WA-CARD-DATE                     PIC 9(8).
TB0236 01  WA-APPL-DATE                     PIC 9(8).
SC0941****START-FAD
       01  WS-CCYY-MM-DD.
           05  WS-CC                        PIC 9(2).
           05  WS-YY                        PIC 9(2).
           05  WS-MM                        PIC 9(2).
           05  WS-DD                        PIC 9(2).
       01  WS-CCYY-MM-DD2.
           05  WS-CCYY2                     PIC 9(4).
           05  WS-MM2                       PIC 9(2).
           05  WS-DD2                       PIC 9(2).
       01  WS-DDMMCCYY3.
           05  WS-DD3                       PIC 9(2).
           05  WS-MM3                       PIC 9(2).
           05  WS-CCYY3                     PIC 9(4).
       01  WS-ERR-SW                        PIC X(1).
004810     88  WS-ERR-Y                     VALUE "Y".
004820     88  WS-ERR-N                     VALUE "N".
SC0941****END-FAD
SC7100 01  WA-MONTH-DAYS                PIC 99.  
SC7100     88 WA-MONTH-31  VALUE 01 03 05 07 08 10 12.  
TB0159 01  WA-TODAYS-DATE              PIC 9(8).
TB0236*01  DIARY-REC.
TB0236*    COPY DIARYKEY IN LIBRYMIS.
TB0236*    03  DIARY-DATA                      PIC X(1800).
TB0236*    COPY DIARYREC IN LIBRYMIS.
004620 01  UT9000-CALL-AREA.
004630     COPY UT9000CA IN LIBRYMIS.
004640 01  UT0290CA-CALL-AREA.                                                  2
004650     COPY UT0290CA IN LIBRYMIS.                                           2
004660*
004670*01  LS-EI0085CA.                                         TB0212
004680*    COPY EI0085CA IN LIBRYATM.                           TB0212

TB0212 01  LS-MI0095CA.                          
TB0212     COPY MI0095CA IN LIBRYATM.           
004690*
004700 01  LS-RFSH-AREA.
004710     COPY PASARFSH IN LIBRYMIS.                                           2
004720*    
004730     COPY UTSALRCA IN LIBRYMIS.                                          
004740*
004750     COPY UT4001CA IN LIBRYMIS.
004760*
TB0221 01  COSC-REC.
TB0221     COPY COSCMAST    IN LIBRYBOR.
TB0221 01  COSR-REC.
TB0221     COPY COSRMAST    IN LIBRYBOR.
TB0221 01  COSH-REC.
TB0221     COPY COSHMAST    IN LIBRYBOR.
TB0221 01  PRJP-REC.
TB0221     COPY PRJPMAST    IN LIBRYBOR
TB0221     REPLACING ==(PRJP)== BY ==PRJP==.
S10293 01  UTAO1PCA-CALL-PARAM.
S10293     COPY UTAO1PCA    IN LIBRYMIS.
TB0196 01  WA-SUBS-AREA.
TB0196     COPY SUBSMAST    IN LIBRYBOR
TB0196     REPLACING ==(SUBS)== BY ==SUBS==.
TB0069 01  WA-BLDV-AREA-NI.
TB0069     COPY BLDVNI IN LIBRYBOR.
TB0069**
S16466 01  WA-BLDV-AREA-WW.
S16466     COPY BLDVWW IN LIBRYBOR.
S16466/
SC6924 01  WA-BLDV-AREA-NN.
SC6924     COPY BLDVNN IN LIBRYBOR.
TB0260 01  UT0011CA-CALL-AREA.
TB0260     COPY UT0011CA IN LIBRYMIS.
004770     COPY BR0023CA IN LIBRYBOR.
004780*
S11439 01  WA-BACKDATE-DAYS            PIC 9(3).
004790 01  WA-TODAY-BIN-DATE           PIC S9(9) BINARY.
SC6175 01  WA-SAVE-MATURITY-DATE       PIC S9(9) BINARY.
004800 01  WA-TEXT-AVAIL-FLAG          PIC X(5).
004810     88  WA-TEXT-AVAIL           VALUE "TRUE".
004820     88  WA-NO-TEXT-AVAIL        VALUE "FALSE".
SC0183 01  WA-COSH-KEY.
SC0183     03  WA-COSH-SOC-NO          PIC 9(3).
SC0183     03  WA-COSH-ACCT-NO         PIC 9(16).
SC0183     03  WA-COSH-EFF-DATE        PIC S9(9) BINARY.
SC4393 01  WA-ADVANCE-DATE.                             
SC4393     05  WA-ADVANCE-DD           PIC 9(2).        
SC4393     05  WA-ADVANCE-MM           PIC 9(2).        
SC4393         88  WA-30-DAY-MONTH VALUES 04 06 09 11.
SC4393     05  WA-ADVANCE-CCYY         PIC 9(4).        
SC4393 01  WA-ADV-TRM-DATE-BIN         PIC S9(9) BINARY.
SC4393 01  WA-COUNT-LOAN-TERM          PIC S9(5) COMP.  
SC4522 01  WA-FEDI-BP-POST-FLAG                PIC 9 VALUE 0.
SC4522     88 FEDI-NO-GL                       VALUE 0.
SC4522     88 FEDI-FROM-TO-GL                  VALUE 1.
SC5378 01  WA-FEDI-FEE-FLAG                    PIC X VALUE "N".
SC5378     88 FEDI-NO-FEE                      VALUE "N".
SC5378     88 FEDI-FEE                         VALUE "Y".
SC5378 01  WA-SAVE-FEDI-TO-AMT                 PIC S9(14)V999.
SC6309 01  WA-TEMP-RECEIVABLE                  PIC S9(14)V999.
S15727 01  WS-COMM-AREA.
S15727     03 WS-COMM-RATE1                    PIC S99V9999.
S15727     03 WS-COMM-RATE2                    PIC S99V9999.
S15727     03 WS-COMM-RATE3                    PIC S99V9999.
S15727     03 WS-BANK-RATE                     PIC S99V9999.
SC6067                                                           
NR2001*SC6067 01  WA-SAVE-BORV                        PIC X(65).        
NR2001 01  WA-SAVE-BOCT.
NR2001     COPY BOCTSIZE IN LIBRYBOR
NR2001          REPLACING ==(BOCT)== BY ==BOCT==.
SC6067 01  WA-FEE-FOUND-FLAG                   PIC X VALUE "N".  
SC6067 01  WA-TRAN-NO-MORE-FLAG                PIC X VALUE "N".  
SC6067     88  WA-TRAN-NO-MORE                 VALUE "Y".        
S16324 01  WS-READ-RNEW-FILE                   PIC X VALUE SPACES.
S16324 01  WS-STOP-RENB-FLAG                   PIC X VALUE SPACES.
S16324 01  WS-CREDIT-CARD-FLAG                 PIC X VALUE SPACES.
NR2001*SC6067 01  WA-BORV-KEY.
NR2001*SC6067     05 WA-BORV-SOC-NO                   PIC 9(03).        
NR2001*SC6067     05 WA-BORV-ACT-NO                   PIC 9(16).        
NR2001*SC6067 01  WA-BORV-TRN-DATE                    PIC S9(9) BINARY. 
NR2001 01  WA-BOCT-KEY.                                          
NR2001     05 WA-BOCT-SOC-NO                   PIC 9(03).        
NR2001     05 WA-BOCT-ACT-NO                   PIC 9(16).        
NR2001 01  WA-BOCT-TRN-DATE                    PIC S9(9) BINARY. 
TB0069*---start
       01  DBIO-AREA.
           03  DBIO-01-AREA.
               05  DBIO-01-SYSTEM              PIC X(3).
               05  FILLER                      PIC X(5).
               05  DBIO-01-KEY.
                   07  DBIO-01-SOC-NO          PIC 999.
                   07  DBIO-01-ACCT-NO         PIC 9(16).
               05  DBIO-01-RETURN-STATUS       PIC X(4).
TB0069*---end
004830*     DEFINE ALL YOUR DBIO FUNCTIONS HERE
004840     COPY DBIOCALL IN LIBRYMIS.
004850/
004860 01  W-PROGRAM-NAME                      PIC X(6) VALUE "BR0024".
NR2001*004870 01  BORV-RECORD-AREA-2                  PIC X(65).
NR2001*004880 01  BORV-RECORD-AREA-8                  PIC X(65).
NR2001*004890 01  BORV-RECORD-AREA-9                  PIC X(65).
NR2001 01  BOCT-RECORD-AREA-2.
NR2001     COPY BOCTSIZE IN LIBRYBOR
NR2001          REPLACING ==(BOCT)== BY ==BOCT==.
NR2001 01  BOCT-RECORD-AREA-8.
NR2001     COPY BOCTSIZE IN LIBRYBOR
NR2001          REPLACING ==(BOCT)== BY ==BOCT==.
NR2001 01  BOCT-RECORD-AREA-9.
NR2001     COPY BOCTSIZE IN LIBRYBOR
NR2001          REPLACING ==(BOCT)== BY ==BOCT==.
TB0020**--
       01  WA-TEMP-TOTAL-LOAN-AMT              PIC S9(14)V999 COMP.
       01  WA-TEMP-LMT-AMT                     PIC S9(14)V999 COMP.
       01  WA-TEMP-EXP-DATE                    PIC S9(9) BINARY.
SC2192 01  WA-BORM-STAT                        PIC 99 VALUE ZEROES.
TB0020**--
TB0082*
TB0082*==================================
TB0082* START OF VARIABLES FOR FSLON0042 
TB0082*==================================
TB0082*
       01  WA-ADVANCE-VARIABLE          VALUE ZEROES.
           05  WA-MAX-DATE              PIC S9(9) BINARY.
           05  WA-MAXI-DATE             PIC S9(9) BINARY.
           05  WA-LAST-DTE-ACCT-EFF     PIC S9(9) BINARY.
           05  WA-POST-DATE             PIC S9(9) BINARY.
           05  WA-END-FST-ADV           PIC S9(9) BINARY.
           05  WA-ACFR-FAC-NO           PIC 9(16).
           05  WA-ACFR-REF-CODE         PIC 9(09).
SC4819     05  WA-PENALTY-DATE          PIC 9(09) BINARY.
      *
       01 DATEADD-MONTHEND.
          05  FILLER                   PIC 9(03) VALUE 31.
          05  FILLER                   PIC 9(03) VALUE 28.
          05  FILLER                   PIC 9(03) VALUE 31.
          05  FILLER                   PIC 9(03) VALUE 30.
          05  FILLER                   PIC 9(03) VALUE 31.
          05  FILLER                   PIC 9(03) VALUE 30.
          05  FILLER                   PIC 9(03) VALUE 31.
          05  FILLER                   PIC 9(03) VALUE 31.
          05  FILLER                   PIC 9(03) VALUE 30.
          05  FILLER                   PIC 9(03) VALUE 31.
          05  FILLER                   PIC 9(03) VALUE 30.
          05  FILLER                   PIC 9(03) VALUE 31.

       01 DATEADD-MONTHEND-ARRAY REDEFINES DATEADD-MONTHEND
                                      OCCURS 12 PIC 9(03).

       01 DATEADD-VARS.
          05 DATEADD-IN-DATE.
             10 DATEADD-IN-CCYY         PIC 9(04).
             10 DATEADD-IN-MM           PIC 9(02).
             10 DATEADD-IN-DD           PIC 9(02).
SC5885**  05 DATEADD-NO-MO              PIC 9(02).
SC5885    05 DATEADD-NO-MO              PIC 9(03).
          05 WS-TEMP                    PIC 9(03).
          05 WS-LEAP-REM                PIC 9(03).
          05 DATEADD-OUT-DATE.
             10 DATEADD-OUT-CCYY        PIC 9(4).
             10 DATEADD-OUT-MM          PIC 9(2).
             10 DATEADD-OUT-DD          PIC 9(2).
TB0082*
TB0082*================================
TB0082* END OF VARIABLES FOR FSLON0042
TB0082*================================
TB0082*
004900/
004910 01  WA-WORK-AREA.
004920     03  WA-CS0000RA-STATUS              PIC 99 VALUE 0.
004930     03  WA-CS0090RA-STATUS              PIC 99 VALUE 0.
004940     03  WA-TXN-AMT                      PIC S9(14)V999 COMP.
004950     03  WA-CALL-TELR-NO                 PIC 9(6).
004960     03  WA-CALL-TERM-NO                 PIC 9(4).
004970     03  WS-SAVE-DISC-CURRENCY           PIC XXX VALUE SPACES.
004980     03  WA-ADV-COUNT                    PIC 99 VALUE 0.
004990     03  WA-TEMP-YRS                     PIC 99.
005000     03  WA-TEMP-MTHS                    PIC 99.
TB0221     03  WA-TEMP-EFFECT-PRD              PIC 999.
TB0221     03  WA-TEMP-EFFECT-PRD-YR           PIC 99.
TB0221     03  WA-TEMP-EFFECT-PRD-MM           PIC 99.
TB0221     03  WA-BEFORE-BORM-ADV-VAL          PIC S9(14)V999 COMP.
SC9737     03  WA-AFTER-BORM-CORR              PIC S9(14)V999 COMP.
TB0221     03  WA-BEFORE-BORN-STAT             PIC 99.
TB0221     03  WA-TEMP-SEQ-NUM                 PIC 9(4).
S19705     03  WA-PERV-DATE                    PIC 9(8).
S19705     03  WS-PERV-BIN-DT                  PIC S9(9) BINARY.
S17755     03  WA-B4-DUE-IND                   PIC X.
S17755     03  WA-B4-LST-UNPD-DUE-DTE          PIC S9(9) BINARY.
S17755     03  WA-B4-NEXT-DUE-DATE             PIC S9(9) BINARY.
S17755     03  WA-TEMP-CCYYMMDD                PIC 9(8).
S17755     03  WA-TEMP-CCYYMMDD-R    REDEFINES WA-TEMP-CCYYMMDD.
S17755         05 WA-TEMP-CCYY                 PIC 9(4).
S17755         05 WA-TEMP-MM                   PIC 99.
S17755         05 WA-TEMP-DD                   PIC 99.
S17755     03  WA-33-MSG-AREA.
S17755         05 WA-33-MSG-TEXT               PIC X(6).
S17755         05 WA-33-MSG-AMT                PIC -9(7).9(5).
S17755     03  WA-BETWEEN-MONTH                PIC S9(5) COMP.
005010*    03  WA-LOAN-REFRESH-FLAG            PIC X    VALUE SPACE.
005020     03  WA-STORE-TRN-NO                 PIC 9(6) VALUE 0.
TB0237     03  WA-STORE-DUMMY-AMT              PIC S9(14)V999 COMP.
TB0237     03  WA-STORE-CURR-AMT               PIC S9(14)V999 COMP.
TB0237     03  WA-STORE-BASE-CURR-AMT          PIC S9(14)v999 COMP.
005030     03  WA-WORK-DATE1                   PIC S9(9) BINARY.
S17497     03  WA-RETURN-DATE                  PIC S9(9) BINARY.
S17497     03  WA-TERM-NO                      PIC 9(4).
NR2001*TB0237     03  WA-STORE-BORV-TRN-CODE          PIC 9(6) VALUE 0.
NR2001     03  WA-STORE-BOCT-TRN-CODE          PIC 9(6) VALUE 0.
005040     03  WA-03-TRAN-DATE                 PIC S9(9) BINARY.                2
005050     03  WA-TIER-METHOD                  PIC 99.
005060     03  WA-TIER-METH REDEFINES WA-TIER-METHOD.
005070         05  WA-TIER-METH-1              PIC 9.
005080         05  WA-TIER-METH-2              PIC 9.
005090     03  WA-TIER-LEVEL                   PIC 9(4).
005100     03  WA-TIER-SUB                     PIC 9(4).
005110     03  WA-TRN-DATE                     PIC 9(8).
005120     03  WA-TRN-DATE-R REDEFINES WA-TRN-DATE.
005130         05  WA-TRN-DD                   PIC 99.
005140         05  WA-TRN-MM                   PIC 99.
005150         05  WA-TRN-CCYY.
005160             07  WA-TRN-CC               PIC 99.
005170             07  WA-TRN-YY               PIC 99.
005180         05  WA-TRN-CCYY-R REDEFINES WA-TRN-CCYY
005190                                         PIC 9(4).
005200     03  WA-STORE-TXN-DT                 PIC S9(9) BINARY.
005210     03  WA-DUMMY-TRN-NO                 PIC 9(6).
005220     03  WA-DUMMY-TRN-NO-R  REDEFINES WA-DUMMY-TRN-NO.
005230         05  FILLER                      PIC 9.
005240         05  WA-DUMMY-FST-ONE            PIC 9.
005250         05  FILLER                      PIC X(2).
005260         05  WA-DUMMY-LST-TWO            PIC 99.
S16466     03  WA-INT-RATE                     PIC S99V9999.
S16466*005270     03  WA-INT-RATE-A                   PIC 99V9999.
S16466     03  WA-INT-RATE-A                   PIC S99V9999.
ST0170     03  WA-DEP-INT-RATE                 PIC 99V9999.
005280*
005290     03  WA-DUMMY-AMT                    PIC S9(14)V999 VALUE 0.
S16101     03  WS-USAGE-AMT                    PIC S9(14)V999 VALUE 0.
005300     03  WA-CURR-PREV-ADV                PIC S9(14)V999 VALUE 0.         
005310     03  WA-TOTAL-APP-AMT                PIC S9(14)V999 VALUE 0.         
005320     03  WA-PERC-CASH-ADV                PIC 999V9(5)   VALUE 0.         
005330     03  WA-SAVE-TRF-AMT                 PIC S9(14)V999 VALUE 0.         
005340     03  WA-OWNER-ACCT-FLAG              PIC X VALUE SPACE.              
005350     03  WA-SAVE-36-JRNL-NO              PIC S9(7) COMP.                 
005360     03  WA-BORM-CUST-NO                 PIC 9(16).                      
S19435     03  WK-INVM-CUST-NO                 PIC 9(16).
S19435     03  WK-PROD-TYPE                    PIC 9(8).
S19435         88 WK-BAILOUT                   VALUE 73020105
S19435                                               73040105.
005370     03  WA-TRF-CUST-NO                  PIC 9(16).                      
005380     03  WA-50PC-ADV                     PIC S9(14)V999 VALUE 0.
005390     03  WA-TRN-MATCH-FOUND              PIC X.
005400     03  WA-EFFE-RESIDUAL-IND            PIC X.
005410     03  WA-DUMMY-TRN-NO-1               PIC 9(6).
005420     03  WA-DUMMY-TRN-NO-1-R  REDEFINES WA-DUMMY-TRN-NO-1.
005430         05  WA-DUMMY-TRN-NO-11          PIC 9.
005440         05  WA-DUMMY-TRN-NO-21          PIC 9.
005450         05  WA-DUMMY-TRN-NO-31          PIC 9.
005460         05  WA-DUMMY-TRN-NO-41          PIC 9.
005470         05  WA-DUMMY-TRN-NO-51          PIC 9.
005480         05  WA-DUMMY-TRN-NO-61          PIC 9.
005490     03  WA-DUMMY-TRN-NO-2               PIC 9(6).
005500     03  WA-DUMMY-TRN-NO-2-R  REDEFINES WA-DUMMY-TRN-NO-2.
005510         05  WA-DUMMY-TRN-NO-12          PIC 9.
005520         05  WA-DUMMY-TRN-NO-22          PIC 9.
005530         05  WA-DUMMY-TRN-NO-32          PIC 9.
005540         05  WA-DUMMY-TRN-NO-42          PIC 9.
005550         05  WA-DUMMY-TRN-NO-52          PIC 9.
005560         05  WA-DUMMY-TRN-NO-62          PIC 9.
005570     03  WA-DUMMY-CHQ-NO.
005580         05  WA-DUMMY-CHQ-7              PIC 9(7).
005590         05  WA-DUMMY-CHQ-LAST           PIC 9.
005600     03  WA-TXN-STATUS.
005610         05  WA-NPB-STAT                 PIC 9.
005620         05  WA-BKD-STAT                 PIC 9.
005630     03  WA-TXN-STAT REDEFINES WA-TXN-STATUS
005640                                         PIC 99.
005650     03  WA-PPP-INITIAL-ADVANCE          PIC 9.
005660     03  WA-DMY                          PIC S9(9) BINARY.
TB0069     03  WA-TEMP-INT-RATE                PIC S999V9999 COMP.
TB0069     03  WA-TEMP-RT-INCR                 PIC S99V9(5) COMP.
TB0069     03  WA-TEMP-NI-FLAG                 PIC X.
TB0084     03  WA-BEG-MONTH                    PIC S9(9) BINARY.
TB0084     03  WA-BUCKET-DUE                   PIC S9(14)V999 COMP.
TB0159     03  WA-BPI-INT-DAYS                 PIC 9(4)     VALUE 0.
TB0159     03  WA-CURR-TERM                    PIC 9(4)   VALUE 0.
TB0159     03  WA-BPI-INT-ACCR                 PIC S9(12)V9(5) COMP
TB0159                                         VALUE 0.
TB0159     03  WA-FIRST                        PIC X.
SC4819     03  WA-CTR-A                        PIC 99.
S11455     03  WA-CTR-B                        PIC 99.
ST0115     03  WA-BEFORE-BORM-LOAN-BAL         PIC S9(14)V999 VALUE 0.
S10207     03  WA-TOTAL-ADV-AMT                PIC S9(14)V999 VALUE 0.
S15848     03  WA-CSCP-IND                     PIC 99.
S10745** FOR INSERT CLMT -- ACCT OPEN DATE > 20040601, DEFAULT NOT USE
S10745**                    NON NOMINATE TRANSFER TRANSACTION.
S11610**                 -- ACCT OPEN DATE > 20050905, DEFAULT NOT USE
S11610**                    CASH WITHDRAWAL ON OVERSEAS BANK ATM
S10745     03  WS-FTR-UNS-CHK-DATE             PIC S9(9) BINARY
S10745                                          VALUE 38138.
S11610     03  WS-OVRS-WD-CHK-DATE             PIC S9(9) BINARY
S11610                                          VALUE 38599.
TB0084     
TB0084     COPY BADDEBT IN LIBRYBOR.
ST0115     COPY UTYENQCA IN LIBRYBOR.
005670*
005680 01  WA-30DL-UPDATE-FLAG                 PIC X VALUE "Y".                
KEY008 01  WA-30DL-FACTOR                      PIC 999   VALUE 0.              
005700 01  WA-30DL-INT                         PIC S9(14)V999 COMP.            
005710 01  WA-30DL-INT-RATE                    PIC S9(4)V9(5)  VALUE 0.        
005720 01  WA-30DL-INT-AMT                     PIC S9(14)V999  VALUE 0.        
005730 01  WA-30DL-ACCRUED-INT                 PIC S9(14)V999  VALUE 0.        
005740 01  WA-30DL-TOT-AMT                     PIC S9(14)V999  VALUE 0.        
005750 01  WA-30DL-CAPT                        PIC S9(14)V999 COMP.            
005760 01  WA-30DL-REPAY                       PIC S9(14)V999 COMP.            
005770 01  WA-30DL-ADV-AMT                     PIC S9(14)V999 COMP.            
005780 01  WA-30DL-REMAIN                      PIC 99.                         
005790 01  WA-30DL-NO-PAYS                     PIC 99  VALUE 0.                
005800 01  WA-30DL-NO-DAYS                     PIC 9999 VALUE 0.               
005810 01  WA-30DL-SUK-FLAG                    PIC X  VALUE "N".               
005820 01  WA-30DL-SAVE-TRN-NO                 PIC 9(5).                       
S10978 01  WA-LST-FIN-DATE                     PIC S9(9) BINARY.
005830*
005840 01  WA-INVM-RECORD-AREA.
005850     COPY INVMMAST IN LIBRYINV.
005860/
ST0170 01  UT0200-CALL-AREA.
ST0170     COPY UT0200CA IN LIBRYINV.
ST0170   03  WA-ACCT-PARM                      PIC X(1810)
ST0170                                         VALUE SPACES.
ST0170     COPY UT0200RT IN LIBRYINV.
ST0170/
ST0170 01  DEPP-RECORD-AREA.
ST0170     COPY DEPPARM IN LIBRYINV.
005870 01  WA-DUP-COUNT                        PIC 99 COMP VALUE 0.
005880 01  WA-DELAY-2SECS.
005890     03  FILLER                          PIC XXX VALUE LOW-VALUES.
005900     03  FILLER                          PIC X VALUE X"02".
005910     03  FILLER                          PIC XXX VALUE LOW-VALUES.
005920 01  WA-CUSV-KEY.
005930   03  WA-CUSV-SOC-NO                    PIC 999.
005940   03  WA-CUSV-ACCT-NO                   PIC 9(16).
005950   03  FILLER                            PIC X(12).
005960 01  WA-BORM-KEY REDEFINES WA-CUSV-KEY.
005970     03  WA-BORM-SOC-NO                  PIC 999.
005980     03  WA-BORM-ACCT-NO                 PIC 9(16).
005990     03  FILLER                          PIC X(12).
006000/
006010*01  WA-TRAN-NO                          PIC 9(6).
006020*  88 REDRAW-REFUND-TRAN          VALUE  10012 10013
006030*                                        10022 10023
006040*                                        10112 10113
006050*                                        10122 10123
006060*                                        15012 15013
006070*                                        15022 15023
006080*                                        15112 15113
006090*                                        15122 15123.
006100*  88 REDRAW-REFUND-WITH-TRAN     VALUE  10012 10013
006110*                                        10022 10023.
006120*  88 REDRAW-REFUND-CORR-TRAN     VALUE  10112 10113
006130*                                        10122 10123.
006140*  88 BACKDATED-REDRAW-TRAN       VALUE  15012 15013
006150*                                        15022 15023.
006160*  88 BACKDATED-CORR-TRAN         VALUE  15112 15113
006170*                                        15122 15123.

SC9610 01  SUSP-RECORD-AREA.
SC9610     COPY SUSPMAST IN LIBRYMIS.

SC9610 01  WA-SAVE-SUSP-RECORD-AREA            PIC X(64).
SC9610 01  WA-SUSP-SYSTEM                      PIC X(8) VALUE "SUSP".
SC9610 01  WA-SUSP-LOAN-REVERSAL     PIC X(13) VALUE "LOAN REVERSAL".
SC9610 01  WA-SUSP-STATUS                      PIC XXXX.
SC9610 01  WA-SUSP-KEY.
SC9610     03 WA-SUSP-INST                     PIC 999.
SC9610     03 WA-SUSP-BRANCH                   PIC 9999.
SC9610     03 WA-SUSP-TYPE.
SC9610        05  WA-SUSP-TYPE-CURRENCY        PIC XXX.
SC9610        05  WA-SUSP-TYPE-FILLER          PIC X.
SC9610        05  WA-SUSP-TYPE-ID              PIC X(19) VALUE SPACES.
SC9610 01  WA-SUSP-BACKDT-ACCOUNT              PIC 9(16).
SC9610 01  WA-SAVED-BKDATE-TRCODE              PIC 9(6).
 
NR0001*01  ST-CALL-CODE.
NR0001*    03  ST-DBIO-CALL-CODE               PIC 99.
NR0001*    03  FILLER                          PIC X(500).

NR0001 01  ST-CALL-CODE.
NR0001     03  ST-DBIO-CALL-PARAM.
NR0001         05 ST-DBIO-CALL-CODE            PIC 99.
NR0001         05 FILLER                       PIC X(20).
NR0001         05 ST-DBIO-SAVE-REFER           PIC XXXX.
NR0001         05 FILLER REDEFINES ST-DBIO-SAVE-REFER.
NR0001            10 ST-DBIO-SAVE-REFER-X      PIC S9(9) BINARY.
NR0001         05 ST-DBI0-VISA-FLAG            PIC X.
NR0001         05 ST-DBIO-LOCK-FLAG            PIC X.
NR0001         05 ST-DBIO-CUSTOMER-NO          PIC 9(16).
NR0001         05 FILLER                       PIC X(458).

006190 01  WA-TRAN-NO                          PIC 9(6).

006210   88 REDRAW-REFUND-TRAN          VALUE  10066 10166
006220                                         11066 11166
006230                                         15066 15166
006240                                         16066 16166
006250                                         10067 10167
006260                                         11067 11167
006270                                         15067 15167
006280                                         16067 16167
006290                                         10076 10176
006300                                         11076 11176
006310                                         15076 15176
006320                                         16076 16176
006330                                         10077 10177
006340                                         11077 11177
006350                                         15077 15177
006360                                         16077 16177
006370                       16065 16061 16165 16161 16066                     
006380                                   18062 18050 18060.                    

006400   88 REDRAW-REFUND-WITH-TRAN     VALUE  10066 10067
006410                                         10076 10077
006420                                         11066 11067
006430                                   16066 16065 16061                     
006440                                         11076 11077.

006460   88 REDRAW-REFUND-CORR-TRAN     VALUE  10166 10167
006470                                         10176 10177
006480                                         11166 11167
006490                                         16165 16161                     
006500                                         11176 11177.

006520   88 BACKDATED-REDRAW-TRAN       VALUE  15066 15067
006530                                         15076 15077
006540                                         16066 16067
006550                                         16076 16077.

006570   88 BACKDATED-CORR-TRAN         VALUE  15166 15167
006580                                         15176 15177
006590                                         16166 16167
006600                                         16176 16177.
TB0027
TB0027   88 WA-CASH-CREDIT-ADD          VALUE  10060
TB0027                                         11060
TB0027                                         15060
TB0027                                         16060
SC7091                                         19060
SC4803                                         14060.
TB0027
TB0027   88 WA-CASH-CREDIT-LESS         VALUE  10160
TB0027                                         11160
TB0027                                         15160
TB0027                                         16160.

006620 01  WA-DUMMY-AMT2                       PIC S9(14)V999 VALUE 0.
006630 01  WA-HOLD-AMT                         PIC S9(14)V999 VALUE 0.
006640/
006650 01  WA-ACCEPT-DATE-R.
006660     03  WA-ACCEPT-DD-R                  PIC 99.
006670     03  WA-ACCEPT-MM-R                  PIC 99.
006680     03  WA-ACCEPT-CC-R                  PIC 99.
006690     03  WA-ACCEPT-YY-R                  PIC 99.
006700 01  WA-ACCEPT-DATE-U REDEFINES WA-ACCEPT-DATE-R PIC 9(8).
006710 01  WA-STORE-ACT-CORR-AMT               PIC S9(14)V999 COMP
006720                                                    VALUE 0.

006740 01  WA-1ST-BYTE-NAME                    PIC X.

006760 01  WA-DISPLAY-NUMBER1                  PIC 9(18).
006770 01  WA-ORIG-JRNL-NO                     PIC 9(6) COMP.
006780 01  WA-ORIG-TXN-EVT                     PIC 9(6) COMP.
006790 01  WA-ORIG-POST-DATE                   PIC S9(9) BINARY.
006800 01  WA-ORIG-POST-TIME                   PIC S9(9) COMP.
006810 01  WA-ORIG-POST-SEQ                    PIC X(1).
006820 01  WW-LACCT                            PIC 9(16).
006830 01  WA-NCR-WORK-FIELDS.
006840     03  WA-TF-AC-NO                     PIC 9(16).
006850     03  WA-TF-AC-NO-R REDEFINES WA-TF-AC-NO.
006860         05  FILLER                      PIC 9(15).
006870         05  WA-TF-AC-NO-1               PIC 9.

006890 01  WA-SAVE-STRTAREA.                                                    
006900      03  WA-SAVE-ST-AREA-TRN-NO         PIC 9(6).
B19902      03  WA-SAVE-ST-AREA-DATA           PIC X(200).
B19902*006910     03  WA-SAVE-ST-AREA-DATA           PIC X(150).
006920      03  WA-SAVE-ST-AREA-INPUT-MSG      PIC X(982).
S12770      03  WA-SAVE-ST-CORR-TRAN
S12770                     REDEFINES WA-SAVE-ST-AREA-INPUT-MSG.
S12770          05  FILLER                     PIC X(234).
S12770          05  WA-SAVE-TRACE-NO           PIC 9(06).
S12770          05  FILLER                     PIC X(742).
006930 01  WA-SAVE-BORM-AREA                   PIC X(983).
006940 01  WA-TEMP-TXN-DATE                    PIC 9(8).
006950 01  WA-JRNL-CALL-AREA.                                                   
006960     COPY JNRST IN LIBRYMIS.
006970 01  WA-OTHER-SAVE-AREAS.                                                 
006980     COPY UT80010 IN LIBRYMIS.


007010/
007020 01  GL-PASSALONG.
007030     COPY GLPASSWS IN LIBRYGEN.
007040 01  UT0120CA-CALL-AREA.
007050     COPY UT0120CA IN LIBRYMIS.
007060*
007070 01  WA-IN0014-CALL-CODE                 PIC 99.
007080*
007090 01  WA-IN0014-PASSALONG.
007100     COPY UT0014CA IN LIBRYBOR.
007110     03  IN0014-INPUT-MESSAGE.
007120         05  IN0014-INPUT-ACCT-NO        PIC 9(16).
007130         05  IN0014-INPUT-AMOUNT         PIC S9(14)V999
007140                                         SIGN TRAILING SEPARATE.
007150         05  IN0014-INPUT-FREQ           PIC 99.
007160         05  IN0014-INPUT-CODE           PIC X.
007170         05  IN0014-CHARGE-INDICATOR     PIC 9.
007180         05  IN0014-INPUT-CDATE          PIC 9(8).
007190         05  FILLER                      PIC X(8).
007200         05  IN0014-INPUT-RECACC-NO      PIC 9(17).
007210         05  IN0014-INPUT-REC-SYS        PIC X(3).
007220         05  IN0014-INPUT-COMMENTS       PIC X(25).
007230         05  FILLER                      PIC X(25).
007240         05  IN0014-INPUT-ADD-1          PIC X(40).
007250         05  FILLER                      PIC X(10).
007260         05  IN0014-INPUT-NAME           PIC X(32).
007270         05  IN0014-INPUT-INFORCE        PIC XXX.
007280         05  IN0014-INPUT-START-DATE     PIC 9(8).
007290*        05  IN0014-INPUT-BSB            PIC 9(6).                      
007300         05  FILLER                      PIC X(6).                      
007310         05  IN0014-SWEEP-TRANS          PIC X.
007320         05  IN0014-FROM-ACC-CURRENCY    PIC XXX.
007330         05  IN0014-INPUT-SEC-CODE       PIC 9(4).
007340         05  IN0014-INPUT-AMT-CCY       PIC XXX.
007350         05  IN0014-CHANGE-AMOUNT        PIC S9(14)V999
007360                                         TRAILING SEPARATE.
007370         05  IN0014-CHANGE-FREQ          PIC 99.
007380         05  IN0014-CHANGE-CODE          PIC X.
007390         05  IN0014-INPUT-PRIORITY       PIC 99.
007400         05  IN0014-SWEEP-TRANS-NO       PIC 9(6).
007410         05  FILLER                      PIC X(6).
007420         05  IN0014-TO-ACC-COMMENTS      PIC X(25).
007430         05  FILLER                      PIC X(19).
007440         05  IN0014-INSURANCE-TRANS      PIC X.
007450         05  IN0014-CHANGE-END-DATE      PIC 9(8).
007460         05  IN0014-TO-ACC-CURRENCY      PIC XXX.
007470         05  IN0014-INPUT-RECNME         PIC X(40).
007480         05  IN0014-INPUT-ADD-2          PIC X(40).
007490         05  IN0014-INPUT-ADD-3          PIC X(40).
007500         05  FILLER                      PIC X(106).
007510         05  IN0014-FROM-ACC-SYSTEM      PIC XXX.
007520         05  IN0014-INPUT-TDATE          PIC 9(8).
007530         05  IN0014-CHARGE-AMOUNT        PIC S9(14)V999
007540                                     SIGN TRAILING SEPARATE.
SC3310*        05  FILLER                      PIC X(227).
SC3310         05  FILLER                      PIC X(19).
SC3310         05  IN0014-INPUT-RECORD.
SC3310             07 IN0014-INPUT-YYYYMMDD    PIC 9(8).
SC3310             07 IN0014-INPUT-REC-CCYYMMDD PIC 9(8).
SC3310             07 IN0014-INPUT-REC-HHMMSSHS PIC 9(8).
SC3310         05  FILLER                      PIC X(184).
007560         05  IN0014-INPUT-POST-CODE      PIC X(8).
007570*        05  FILLER                      PIC X(167).                    
007580         05  FILLER                      PIC X(90).                     
007590         05  IN0014-INPUT-BSB            PIC X(12).                     
SC3310*        05  FILLER                      PIC X(65).
SC3310         05  FILLER                      PIC X.
SC3310         05  IN0014-COMMON-CHASE-DAYS    PIC 9(2).
SC3310         05  IN0014-INPUT-PYMNT-TYPE     PIC X.
SC3310         05  IN0014-INPUT-PURPOSE        PIC X(5).
SC3310         05  IN0014-PROMO-CODE           PIC XX.
SC3310         05  IN0014-INPUT-CHAN-TYPE      PIC X.
SC3310         05  IN0014-INPUT-RISK-LEVEL     PIC X.
SC3310         05  IN0014-INPUT-BILL-COMP      PIC X(5).
SC3310         05  IN0014-INPUT-TRAN-TYPE      PIC 9(3).
SC3310         05  IN0014-INPUT-BILL-FUNDS-IN-CD.
SC3310             07  IN0014-INPUT-BILL-TO-COM1 PIC X(25).
SC3310             07  IN0014-INPUT-BILL-TO-COM2 PIC X(5).
SC5264         05  IN0014-INPUT-ADV-DATE.
SC5264             07  IN0014-INPUT-ADV-DD     PIC X(2).
SC5264             07  IN0014-INPUT-ADV-MM     PIC X(2).
SC5264             07  IN0014-INPUT-ADV-CCYY   PIC X(4).
SC5264         05  FILLER                      PIC X(6).
SC3310*SC5264  05  FILLER                      PIC X(14).
007610/
007620******************************************************************
007630*
007640*    OUTPUT AREA FOR TRANSACTIONS
007650*
007660******************************************************************
007670   02    IN0014-OUTPUT-MESSAGE.
007680*
007690     03  IN0014-OUTPUT-ERR-MSG-NO        PIC 9(4).
007700     03  IN0014-OUTPUT-MSG-LENGTH        PIC 9(4).
007710     03  IN0014-OUTPUT-MSG               PIC X(983).
007720*
007730     03  IN0014-OUTPUT-MSG-RR  REDEFINES IN0014-OUTPUT-MSG.
007740         05  IN0014-OUTPUT-DATA-SET      PIC X(4).
007750         05  IN0014-OUTPUT-STATUS        PIC X(4).
007760         05  FILLER                      PIC X(975).
007770   02    IN0014-BORM-RECORD-AREA.
007780     03  BORM-DATA-REC-WA                PIC X(983).
SC1371
SC1371*SC3974   02  INVE-RECORD-AREA.
SC1371*SC3974       COPY INVEMAST IN LIBRYINV.
SC1371
007790   02  IN0014-STATUS-LEVEL-1             PIC 99.
007800   02  IN0014-STATUS-LEVEL-2             PIC 99.
007810   02  IN0014-STATUS-LEVEL-3             PIC 99.
007820   02  IN0014-STATUS-LEVEL-4             PIC 99.
007830   02  IN0014-CHQ-CLEAR-DAYS             PIC 9(4).
007840   02  IN0014-NPB-CALL-CODE              PIC XX.
007850   02  FILLER                            PIC X(916).

007870*
007880 01      SEC-KEY-AREA.
007890   03    SEC-SOC-NO                      PIC 999.
007900   03    SEC-KEY-NO                      PIC 9(16).
007910   03    FILLER                          PIC X(12).
007920 01      SEC-SYSTEM                      PIC X(8).
007930 01      SEC-STATUS                      PIC XXXX.

007950 01  UT0060CA-WORK-AREA.
007960   03  LOCATED-FLAG                       PIC X.
007970   03  WK-TELLER-INDEX                    PIC 99.
007980   03  WK-ERROR-INDEX                     PIC 99.
007990   03  WK-ERROR-OVERRIDE                  PIC XX.
008000   03  WK-BATCH-TANDEM                    PIC X.
008010   03  FILLER                             PIC X(42).
008020*
008030/
008040******************************************************************
008050*
008060*    CALL AREAS FOR CHARGES SYSTEM
008070*
008080******************************************************************
008090*
008100* CS0000CA AND CS0000RA WERE RELOCATED TO THE LINKAGE SECTION.
008110* BR0000 NOW CALLS CHARGE SYSTEM FOR ADVANCE CORRECTIONS BEFORE
008120* CALLING BR0024. BR0024 DOES NOT CALL CS0000 BY PERFORMING
008130* B900 PARAGRAPH FOR CORRECTIONS BUT USE INSTEAD THE AREAS PASSED
008140* BY BR0000 FOR APPLYING THE CHARGES IE PERFORM BB00 PARA.
008150*
008160*01  WA-CS0000CA-CALL-AREA.
008170*    COPY CS0000CA IN LIBRYCHG.
008180*
008190*01  WA-CS0000RA-RETURN-AREA.
008200*    COPY CS0000RA IN LIBRYCHG.
008210*
008220 01  WA-CS0007CA-CALL-AREA.
008230     COPY CS0007CA IN LIBRYCHG.
008240*
008250 01  WA-CS0007RA-RETURN-AREA.
008260     COPY CS0007RA IN LIBRYCHG.
008270*
008280 01  WA-CS0090CA-CALL-AREA.
008290     COPY CS0090CA IN LIBRYCHG.
008300*
TB0125
TB0125 01  WA-CS0012CA-CALL-AREA.
TB0125     COPY CS0012CA IN LIBRYCHG.
TB0125*
TB0125 01  WA-CS0012RA-RETURN-AREA.
TB0125     COPY CS0012RA IN LIBRYCHG.
TB0125*
TB0125 01  WS-CSCP-REC.
TB0125     COPY CSCPMAST  IN LIBRYCHG.
TB0125/
TB0125     COPY CSCPALT   IN LIBRYCHG.
008310/
008320 01  WA-EDIT-MASK.
008330     03  WA-INPUT-PARAM-TABLE            PIC X
008340            OCCURS 32 TIMES.
008350/
NQ0079 01  WA-FIN-EDIT-MASK.                        
NQ0079     03  WA-FIN-PARAM-TABLE              PIC X
NQ0079            OCCURS 32 TIMES.                  
NQ0079/                                             
008360 01  PUAREA.
008370     03  FIELD-A                 PIC X(32).
008380     03  FIELD-B                 PIC X(4).
008390 01  WA-1ST-TIME-FLAG                    PIC 9     VALUE 0.

008410*NBG003
008420 01  BIRM-RECORD.
008430     COPY BIRM IN LIBRYBOR.
S16324*
S16324 01  RENB-RECORD-AREA.
S16324     COPY RENBMAST IN LIBRYMIS
S16324          REPLACING ==(RENB)== BY ==RENB==.
S16324     COPY RENBALT  IN LIBRYMIS.
S16324*
S16324 01  BOEX-RECORD-AREA.
S16324     COPY BOEXMAST IN LIBRYBOR.
008440****
008450/
008460* ADD YOUR DATA BASE AREAS HERE.
008470*
008480
008490     COPY UT0020CA IN LIBRYMIS.
008500/
008510     COPY UT0030CA IN LIBRYMIS.
008520/
008530 01  UT0298CA-CALL-AREA.
008540     COPY UT0298CA IN LIBRYMIS.
B17951**comment out unused VENPARAM
B17951*    COPY UT0320CA IN LIBRYMIS.
B17951*    COPY VENPARM IN LIBRYMIS.
008580/
008590*    COPY UT0671CA IN LIBRYMIS.
008600*    COPY FACRMAST IN LIBRYMIS.
008610/
008620*    COPY UT0680CA IN LIBRYMIS.
008630/
008640     COPY UT1999CA IN LIBRYMIS.
008650/
008660     COPY BR0042CA IN LIBRYBOR.

008680*************************************************************
008690*** SPR 760165 - save area for capturing the same teller when
008700*** transactions 1010/1110, 1020/1120 are performed. Thus
008710*** showing the teller that did the correction.
008720*************************************************************

008740 01  WA-SAVE-UPTELLCA-PARAM-1.
008750     03 WA-SAVE-UPTELLCA-TELR            PIC 9(5).
008760     03 WA-SAVE-UPTELLCA-BRCH            PIC 9999.

008780 01  WA-SAVE-UPTELLCA-PARAM-2.
008790     03 WA-SAVE-UPTELLCA-TELLER-BRANCH   PIC S9(9) BINARY.

008810*************************************************************

008830/
008840     COPY UPTELLCA IN LIBRYMIS.
008850 01  UT0310CA-AREA.
008860     COPY UT0310CA IN LIBRYMIS.
008870/
TB0159     COPY DATECODE IN LIBRYMIS
TB0159          REPLACING ==(DATE)== BY ==DATE==.
008880 01  CALL-UT0510-AREA.
008890     COPY UT0510CA IN LIBRYBOR.
008900/
008910 01  UT0450-CALL-AREA.
008920     COPY UT0450CA IN LIBRYMIS.
008930/
008940 01  UT0060CA-AREA.
008950     COPY UT0060CA IN LIBRYMIS.
008960*
TB0020**-- For Multiple Drawdown
       01  FACM-AREA.
           COPY FACMMAST IN LIBRYMIS.
      /
       01  FACD-AREA.
           COPY FACDMAST IN LIBRYMIS.
           COPY FACDALT  IN LIBRYMIS.
TB0020**--
TB0082/
TB0082 01  FACA-AREA.
TB0082     COPY FACAMAST IN LIBRYMIS.
TB0082     COPY FACAALT  IN LIBRYMIS.
TB0082/
008970/
008980 01  ACFR-AREA.
008990     COPY ACFRMAST IN LIBRYMIS.
009000/
009010 01  TPPR-RECORD-AREA.
009020     COPY TPPRMAST IN LIBRYMIS.
009030/
009040     COPY UTTPPRCA IN LIBRYMIS.
009050/
009060 01  WA-GLD-CODE.
009070     COPY GLDCODES IN LIBRYBOR.
009080/
009090 01  WA-BLDV-AREA-AA.
009100     COPY BLDVAA IN LIBRYBOR.
009110/
009120 01  WA-BLDV-AREA-BB.
009130     COPY BLDVBB IN LIBRYBOR.
009140/
009150 01  WA-BLDV-AREA-UU.
009160     COPY BLDVUU IN LIBRYBOR.
009170/
009180 01  CUSM-RECORD-AREA.
009190     COPY CUSMMAST IN LIBRYMIS.
009200/
009210     COPY UT0151CA IN LIBRYMIS.
009220/
009230 01  WA-CUSV-AREA-AA.
009240     COPY CUSVAA IN LIBRYMIS.
009250*
009260 01  WA-CUSV-AREA-A3.
009270     COPY CUSVA3 IN LIBRYMIS.
009280/
009290 01  WA-CUSV-AREA-BB.
009300     COPY CUSVBB IN LIBRYMIS.
009310/
009320 01  WA-CUSV-AREA-B3.
009330     COPY CUSVB3 IN LIBRYMIS.
009340/
009350 01  UT0500-CALL-PARAM.
009360     COPY UT0500CA IN LIBRYMIS.
009370/
009380 01  LINK-AREA.
009390     COPY SYSPCALL IN LIBRYMIS.
009400/
009410 01  MS0010CA-CALL-AREA.
009420     COPY MS0010CA IN LIBRYMIS.
TB0084/
TB0084 01  UT0075CA-CALL-AREA.
TB0084     COPY UT0075CA IN LIBRYBOR.
SC9161/
SC9161 01  UT0X75CA-CALL-AREA.       
SC9161     COPY UT0X75CA IN LIBRYBOR.
009430/
TB0196 01  UTPRJBCA-CALL-AREA.
TB0196     COPY UTPRJBCA IN LIBRYBOR.
TB0196/
009440 01  UT0079-LINKAGE.
009450     COPY UT0079CA IN LIBRYBOR.
009460/
009470* 01  SDCV-RECORD-AREA.
009480*     COPY SDCVVARV IN LIBRYMIS.
009490*
009500 01  SORD-RECORD-AREA.
009510     COPY SORDMAST IN LIBRYMIS REPLACING ==(SORD)==
009520                               BY        ==SORD==.
009530*
009540* 01  W320-SDCV-KEY.
009550*     03  W320-SDCV-SOC-NO                PIC 999.
009560*     03  W320-SDCV-MEMB-NO               PIC 9(16).
009570*     03  FILLER                          PIC X(12).
009580*
009590 01  W320-SORD-KEY.
009600     03  W320-SORD-TO-SYS                 PIC X(3).
009610     03  W320-SORD-TO-INST-NO             PIC 9(3).
009620     03  W320-SORD-TO-ACCT-NO             PIC 9(16).
009630     03  FILLER                           PIC X(9).
009640/
009650     COPY UT8500CA IN LIBRYMIS.
009660*
009670     COPY UT8500FU IN LIBRYMIS.
009680*
009690     COPY DBIOMODCA IN LIBRYMIS.
009700     03  FILLER                           PIC X(478).
009710/
009720     COPY BBLC IN LIBRYBOR.
009730/
009740 01  DBIOMOD-RECORD2.
009750     COPY BINS IN LIBRYBOR.
009760     COPY DBIOORAST IN LIBRYMIS.
009770/
009780     COPY DBIOMODNAME IN LIBRYMIS.
009790/
S12243 01  UT9002CA-CALL-AREA.
S12243     COPY UT9002CA IN LIBRYMIS.
S12243 01  WS-IMG0-TIME                         PIC 9(08).
S12243*
TB0084 01  UTHISTCA-CALL-PARAM.
TB0084     COPY UTHISTCA IN LIBRYBOR.
TB0084/
TB0084 01  UT0094CA-CALL-PARAM.
TB0084     COPY UT0094CA IN LIBRYBOR.
TB0084/
TB0082 01  UT0312CA-CALL-AREA.
TB0082     COPY UT0312CA IN LIBRYBOR.
TB0082/
009800 01  UT0095CA-CALL-PARAM.
009810     COPY UT0095CA IN LIBRYBOR.
009820/
TB0152 01  UTCIEACA-CALL-PARAM.
TB0152     COPY UTCIEACA IN LIBRYCHG.
TB0152/
TB0159 01  BMPT-RECORD-AREA.
TB0159     COPY BMPTPARM IN LIBRYBOR.
TB0159 01  UTCIEPCA-CALL-PARAM.
TB0159     COPY UTCIEPCA IN LIBRYCHG.
TB0159/
TB0159 01 BAFM-RECORD-AREA.
TB0159     COPY BAFMMAST IN LIBRYBOR.
TB0159/
TB0159 01  UT0074CA-CALL-PARAM.
TB0159     COPY UT0074CA IN LIBRYBOR.
TB0159/
ST0049 01  UT0081CA-CALL-PARAM.
ST0049     COPY UT0081CA IN LIBRYBOR.
ST0049/
S11455     COPY UTYBAMCA IN LIBRYBOR.
S11455/                              
S15266 01  UTBFTVCA-CALL-AREA.
S15266     COPY UTBFTVCA  IN LIBRYMIS.
S15848 01  UTVIPCCA-CALL-PARAM.
S15848     COPY UTVIPCCA IN LIBRYMIS.
TB0159 01  YOUBE-WORK-AREA.
TB0159     03  WA-AVAILABLE-LIMIT         PIC S9(14)V999.
TB0159     03  WA-OUTSTANDING-BAL         PIC S9(14)V999.
TB0159     03  ADJ-BALANCE                PIC S9(14)V999.
TB0159     03  TEMP-ADV-AMOUNT            PIC S9(14)V999.
TB0159     03  WA-TEMP-REC-DUE            PIC S9(14)V999.
TB0159     03  WA-MIN-DUE-AMT             PIC S9(14)V999.
TB0159     03  WA-MAX-AMOUNT              PIC 9(10).
TB0159     03  WA-PAYMT-RATIO             PIC 9(3)V9(2).
TB0159     03  WA-FIX-MIN-REPAYMENT       PIC 9(10).
TB0159     03  WA-REV-RECEIVABLE          PIC S9(14)V999.
TB0159     03  RANGE-FOUND-SW             PIC 9.
TB0159         88 RANGE-FOUND             VALUE 1.
TB0159     03  CTR                        PIC 99.
TB0159     03  TEMP-REC-SW                PIC 9.
TB0159         88 TEMP-REC-ON             VALUE 1.
TB0159     03  WA-SAVE-NEXT-DUE-DT        PIC S9(9) BINARY.
TB0159     03  WA-DISP-BINARY-DT          PIC 9(9).
TB0159     03  WA-BAFM-ERROR              PIC 9.
TB0159     03  WA-TOT-FEE-AMT            PIC S9(14)V999.
S10329     03  WA-DIS-FEE-AMT             PIC S9(14)V999.
TB0152 01  BROKERAGE-REFERRAL-WORK-AREA.
TB0152     03  WA-CIEA-KEY.
TB0152         05  WA-CIEA-SOC-NO         PIC 999.
TB0152         05  WA-CIEA-SYSTEM         PIC XXX.
TB0152         05  WA-CIEA-ACCT-NO        PIC 9(16).
TB0152         05  WA-CIEA-TYPE           PIC 999.
TB0190         05  WA-CIEA-SEQNUM         PIC 999.
TB0152     03  WA-EOF-CIEA                PIC X   VALUE "N".
TB0152         88  END-OF-CIEA                    VALUE "Y".
SC2412 01  SUBSIDY-WORK-AREA.
SC2412**   03  WA-REPAY-CUST-RATE         PIC S9(14)V999 COMP.
SC2412**   03  WA-REPAY-BANK-RATE         PIC S9(14)V999 COMP.
SC2412**   03  WA-LOAN-REPAY              PIC S9(14)V999 COMP.
SC9161     03  WA-REPAY-CUST-RATE         PIC S9(11)V9(6) COMP.
SC9161     03  WA-REPAY-BANK-RATE         PIC S9(11)V9(6) COMP.
SC9161     03  WA-LOAN-REPAY              PIC S9(11)V9(6) COMP.
SC2412     03  WA-SUBSIDY-AMT             PIC S9(14)V999 COMP.
SC2412     03  WA-AMT                     PIC S9(14)V999 COMP.
SC2412     03  WA-SAVE-RATE               PIC S99V9999.
SC2412     03  WA-SUBSIDY-RATE            PIC S99V9(5).
SC2412     03  WA-INT-RATE-B              PIC 99V9999.
SC2412     03  WA-WORK-AMT-0              PIC S9(14).
SC2412     03  WA-WORK-AMT-1              PIC S9(14)V9.
SC2412     03  WA-WORK-AMT-2              PIC S9(14)V99.
SC2412     03  WA-WORK-AMT-3              PIC S9(14)V999.
SC2412     03  WA-WORK-AMT                PIC S9(14)V9999.
SC2412     03  WA-DIGIT-6                 PIC S9V9(6) COMP.
SC2412     03  WA-SAVE-BOIS               PIC X(1500).
SC2412     03  WA-SAVE-BORM               PIC X(983).
SC2412     03  WA-REPAY-SCHED             PIC XX.
NR2001*ST0049 01  WA-STORE-BORV-01               PIC X(65) VALUE SPACES.
NR2001 01  WA-STORE-BOCT-01.
NR2001     COPY BOCTSIZE IN LIBRYBOR
NR2001          REPLACING ==(BOCT)== BY ==BOCT==.
TB0273 01  UT0038-CALL-AREA.
TB0273     COPY UT0038CA IN LIBRYMIS.
TB0273/
NR2001*S11050 01  WS-BORV-RECORD-AREA            PIC X(65) VALUE SPACES.
NR2001 01  WS-BOCT-RECORD-AREA.
NR2001     COPY BOCTSIZE IN LIBRYBOR
NR2001          REPLACING ==(BOCT)== BY ==BOCT==.
S11050 01  WS-SAVE-REPAY-DAY              PIC 9(2)  VALUE ZEROES.
S11050 01  WS-OLD-REPAY-DAY               PIC 9(2)  VALUE ZEROES.
S11050 01  WS-REPAY-DAY-FOUND             PIC X     VALUE SPACES.
NR2001 01  UTBOCTCA-CALL-AREA.
NR2001     COPY UTBOCTCA IN LIBRYBOR
NR2001          REPLACING ==(UTBOCTCA)== BY ==UTBOCTCA==.
NR2001 01  WS-BOCT-TRAN-TYPE              PIC 9(2).
009840*
009850* ADD YOUR LINKAGE INTERFACE AREAS HERE.
009860*
009870 LINKAGE SECTION.
009880 01  STARTAREA.
009890     COPY STRTAREA IN LIBRYMIS.
009900     02  WA-INPUT-MESSAGE.
009910     03  WA-INPUT-MSG.
009920         05  WA-INPUT-KEY.
009930             07  WA-INPUT-ACCT-NO        PIC 9(16).
009940         05  WA-INPUT-AMT                PIC S9(14)V999
009950         SIGN IS TRAILING SEPARATE.
009960         05  FILLER                      PIC X(267).
009970         05  WA-ATM-JRNL-NO              PIC 9(6) COMP.
009980         05  WA-ATM-UPDT-FLAG            PIC X.
009990         05  WA-OUTPUT-TXN-DATE          PIC XX.
010000         05  WA-OUTPUT-CLEAR-CODE        PIC X.
010010         05  FILLER                      PIC X(661).
010020         05  WA-INPUT-MSG-CODE           PIC 99.
010030         05  FILLER                      PIC X(10).
010040*** 74I012 BEGIN ***
010050* WSK 26/2/98 - HEL001, HEL007
010060* THE INPUT TXN FORMAT FOR TELEPAC ORIGINATED FINANCIAL TXNS.
010070* COPIED FROM IN0000.COB.
010080* 74I012 RETROFIT
010090     03  FILLER REDEFINES WA-INPUT-MSG.                                  
010100         05  WA-INPUT-KEY-O              PIC X(16).                      
010110         05  WA-INPUT-KEY-R
010120             REDEFINES  WA-INPUT-KEY-O   PIC 9(16).                      
010130         05  REDEFINES  WA-INPUT-KEY-O.                                  
010140           07  FILLER                    PIC XXX.                        
010150           07  WA-INPUT-KEY-BRANCH       PIC 9999.                       
010160           07  FILLER                    PIC X(9).                       
010170         05  WA-INPUT-BAL                PIC S9(14)V999
010180                                         SIGN TRAILING SEPARATE.         
010190         05  WA-INPUT-AMT-1              PIC S9(14)V999                  
010200                                         SIGN TRAILING SEPARATE.         
010210         05  FILLER                      PIC X(220).                     
010220         05  WA-ATM-CARD-NO.                                             
010230           07  WA-VISA-CARD-NO           PIC 9(16).                      
010240           07  FILLER                    PIC XXXX.                       
010250         05  WA-ATM-INT-TRACE-NO         PIC 9(6) COMP.                  
010260         05  WA-ATM-SEQ-NO               PIC 9(6) COMP.                  
010270         05  WA-ATM-TXN-TYPE             PIC XX.
010280         05  WA-ATM-UPDT-FLAG-1          PIC X.
010290         05  WA-ATM-ATM-SEQ-NO           PIC 9(6) COMP.
010300         05  WA-ATM-TXN-TIME             PIC 9(8) COMP.                  
010310         05  FILLER                      PIC X(02).                      
010320         05  WA-INPUT-CLEAR-CODE         PIC XX.                         
010330         05  WA-ATM-TXN-DATE             PIC S9(9) BINARY.               
010340         05  FILLER                      PIC X(651).                     
010350         05  WA-INPUT-MSG-TYPE-X.                                        
010360             10 WA-INPUT-MSG-TYPE        PIC XX.                          
010370         05  FILLER                      PIC X(10).                      
010380     03  IN0002-INPUT-MESSAGE  REDEFINES WA-INPUT-MSG.
010390         05  IN0002-INPUT-KEY.
010400             07  IN0002-INPUT-ACCT-NO    PIC 9(16).
010410         05  IN0002-MSG.
010420             07  IN0002-REASON-NO        PIC 99.
010430             07  IN0002-REASON           PIC X(18).
010440             07  IN0002-JRNL-NO          PIC 9(6).
010450             07  IN0002-CARD-NO          PIC 9(16).
010460         05  IN0002-MSG-R  REDEFINES IN0002-MSG.
010470             07  IN0002-STOP-NO          PIC 99.
010480             07  FILLER                  PIC X(40).
010490         05  FILLER                      PIC X(924).
010500     03  TPATM-INPUT-MESSAGE-1  REDEFINES WA-INPUT-MSG.
010510         05  TPATM-INPUT-KEY-1.
010520             07  TPATM-INPUT-ACCT-NO-1  PIC 9(16).
010530         05  TPATM-BALANCE              PIC S9(14)V999
010540             SIGN IS TRAILING SEPARATE.
010550         05  TPATM-AMOUNT               PIC S9(14)V999
010560             SIGN IS TRAILING SEPARATE.
010570         05  TPATM-CHQ-NO               PIC 9(8).
010580         05  TPATM-TXN-DATE             PIC 9(8).
010590         05  TPATM-BATCH-NO             PIC XX.
010600         05  TPATM-NAMES.
010610             07  TPATM-NAME-1           PIC X(30).
010620             07  TPATM-NAME-1-R  REDEFINES  TPATM-NAME-1.
010630                 09  TPATM-1ST-BYTE     PIC X.
010640                 09  TPATM-NAME-NO      PIC XX.
010650                 09  TPATM-NAME-NO-R  REDEFINES TPATM-NAME-NO.
010660                     11  TPATM-NAME-NO-1  PIC X.
010670                     11  TPATM-NAME-NO-2  PIC X.
010680                 09  FILLER              PIC X(27).
010690             07  TPATM-NAME-2           PIC X(30).
010700         05  TPATM-TERM-AREA.
010710          10 TPATM-TERM-PENALTY-DAYS    PIC 9(4).
010720          10 TPATM-DAYS-R REDEFINES TPATM-TERM-PENALTY-DAYS
010730                                         PIC X(4).
010740          10 TPATM-TERM-PENALTY-RATE    PIC 99V9999.
010750          10 TPATM-RATE-R REDEFINES TPATM-TERM-PENALTY-RATE
010760                                         PIC X(6).
010770          10 TPATM-TERM-PENALTY-EXEMPT  PIC X.
010780          10 FILLER                      PIC X(841).
SC4203     03  WA-ATM-TXN REDEFINES WA-INPUT-MSG.
SC4203         05  FILLER                      PIC X(655).
SC4203         05  WA-RISK-LEVEL               PIC X(3).
SC4203         05  WA-BANCS-ID-TRF-ACCT        PIC 9(3).
SC4203         05  WA-ACCT-NO-TRF-IN           PIC 9(17).
SC4203         05  WA-ATM-TRACE-NO             PIC X(10).
SC4203         05  WA-SETTLEMENT-DATE          PIC 9(8).
SC4203         05  WA-FISC-TXN-CODE            PIC 9(4).
SC4203         05  FILLER                      PIC X(282).
010790     03  TPATM-VISA-AREA REDEFINES WA-INPUT-MSG.
010800             07  FILLER                  PIC X(510).
010810             07  TPATM-PURCH-DATE       PIC 9(8).
010820             07  TPATM-EXPIRY-DATE REDEFINES TPATM-PURCH-DATE
010830                                         PIC 9(8).
010840             07  TPATM-BIN-NO           PIC 9(6).
010850             07  TPATM-RETRIEVAL-REF    PIC X(23).
010860             07  TPATM-MERCH-NAME       PIC X(25).
010870             07  TPATM-MERCH-CITY       PIC X(13).
010880             07  TPATM-MERCH-CTRY-CODE  PIC XX.
010890             07  TPATM-FOREIGN-CURR-AMT PIC S9(14)V999
010900                 SIGN IS TRAILING SEPARATE.
010910             07  TPATM-FOR-0X REDEFINES TPATM-FOREIGN-CURR-AMT.
010920                 09  FILLER                  PIC X(14).
010930                 09  TPATM-FOR-0-DECS       PIC 999.
010940                 09  FILLER                  PIC X.
010950             07  TPATM-FOR-1X REDEFINES TPATM-FOREIGN-CURR-AMT.
010960                 09  FILLER                  PIC X(15).
010970                 09  TPATM-FOR-1-DECS       PIC 99.
010980                 09  FILLER                  PIC X.
010990             07  TPATM-FOR-2X REDEFINES TPATM-FOREIGN-CURR-AMT.
011000                 09  FILLER                  PIC X(16).
011010                 09  TPATM-FOR-2-DECS       PIC 9.
011020                 09  FILLER                  PIC X.
011030* ATM DETAILS
011040             07  TPATM-FOREIGN-CURCODE       PIC X(03).                 
011050             07  FILLER                      PIC X(52).                 
011060             07  TPATM-CARD-NO              PIC 9(16).
011070             07  TPATM-TPAC-POST-TIME       PIC 9(8).
011080             07  TPATM-TPAC-R-POST-TIME REDEFINES
011090                      TPATM-TPAC-POST-TIME  PIC X(8).
011100             07  FILLER                      PIC X(298).
011110     03  TPVISA-INPUT-MESSAGE  REDEFINES WA-INPUT-MSG.
011120         05  TPVISA-INPUT-KEY.
011130             07  TPVISA-INPUT-ACCT-NO    PIC 9(16).
011140         05  TPVISA-BALANCE              PIC S9(14)V999
011150             SIGN IS TRAILING SEPARATE.
011160         05  TPVISA-AMOUNT               PIC S9(14)V999
011170             SIGN IS TRAILING SEPARATE.
011180         05  TPVISA-CLEAR-CODE           PIC XX.
011190         05  TPVISA-TXN-DATE             PIC 9(8).
011200         05  TPVISA-BATCH-NO             PIC XX.
011210         05  TPVISA-DEFER-DAYS           PIC 99.
011220         05  TPVISA-DESC-AREA            PIC X(74).
011230         05  FILLER  REDEFINES  TPVISA-DESC-AREA.
011240             07  TPVISA-BANK-NUMBER      PIC X(4).
011250             07  TPVISA-REGION-ID        PIC X(4).
011260             07  TPVISA-ITEMS            PIC 9(3).
011270             07  FILLER                  PIC X(63).
011280         05  TPVISA-TRF-AREA.
011290             07 TPVISA-TRF-VOUCHER-NO    PIC 9(8).
011300             07 FILLER                   PIC X.
011310         05  TPVISA-DR-CR-AREA REDEFINES TPVISA-TRF-AREA.
011320             07 FILLER                   PIC X.
011330             07 TPVISA-DR-CR-VOUCHER-NO  PIC 9(8).
011340         05  FILLER                      PIC X(833).
011350***  DEFINE MULTI-CURRENCY FIELDS.
011360     03  TPVISA-INPUT-MESSAGE1 REDEFINES WA-INPUT-MSG.
011370         05  FILLER                      PIC X(150).
011380         05  TPVISA-ACCT-CURR-CD         PIC XXX.
011390         05  TPVISA-CURR-AMT             PIC S9(14)V999
011400                                         TRAILING SEPARATE.
011410         05  TPVISA-CURR-AMT-CURR-CD     PIC XXX.
011420         05  TPVISA-BASE-CURR-AMT        PIC S9(14)V999
011430                                         TRAILING SEPARATE.
011440         05  TPVISA-COMMISSION           PIC S9(14)V999
011450                                         TRAILING SEPARATE.
011460         05  TPVISA-CHANGE               PIC S9(14)V999
011470                                         TRAILING SEPARATE.
011480         05  TPVISA-RATE-TYPE            PIC 99.
011490         05  TPVISA-CURR-VERSION         PIC X(4).
011500         05  TPVISA-CORR-JRNL-NO         PIC 9(6).
011510         05  WA-INPUT-LIMIT-NO           PIC 9(17).
011520         05  FILLER                      PIC X(725).
011530*** 74I012 END ***
011540*
011550******************  ADVANCE  TYPE  TRANSACTIONS  *****************
011560******************************************************************
011570     03  WA-ADV-INPUT-MSG REDEFINES WA-INPUT-MSG.
011580         05  WA-ADV-ACCT-NO                PIC 9(16).
011590         05  WA-ADV-AMOUNT                 PIC S9(14)V999
011600                                           TRAILING SEPARATE.
011610         05  WA-ADV-MORTGAGE-NO            PIC X.
011620         05  WA-ADV-SUB-LEDG-CODE          PIC 99.
011630         05  WA-ADV-PROMO                  PIC XX.
011640         05  WA-ADV-TXN-DATE               PIC 9(8).
011650         05  WA-ADV-CHQ-NO                 PIC 9(8).
011660         05  WA-ADV-NAMES.
011670             07  WA-ADV-NAME-1             PIC X(30).
011680             07  WA-ADV-NAME-1-R REDEFINES WA-ADV-NAME-1.               
011690                 09  WA-ADV-1ST-BYTE       PIC X.                       
011700                 09  WA-ADV-VENDOR-NO      PIC X(10).                   
011710                 09  FILLER                PIC X(19).                   
011720             07  WA-ADV-NAME-2             PIC X(30).
011730         05  WA-DEP-ACCT-TRF REDEFINES WA-ADV-NAMES.                     
011740             07  FILLER                    PIC X(9).
011750             07  WA-DEP-ACCT-NO            PIC 9(16).
011760             07  FILLER                    PIC X(35).
011770         05  WA-ADV-LOC-CORR REDEFINES WA-ADV-NAMES.
011780             07  WA-CORR-LOC-ACCT          PIC 9(16).
011790             07  FILLER                    PIC X(44).
011800         05  WA-ACT-FEE                    PIC S9(14)V999
011810                                               TRAILING SEPARATE.
011820         05  WA-AVAIL-AMT                  PIC S9(14)V999
011830                                               TRAILING SEPARATE.
S11455         05  FILLER                        PIC X(614).
S11455         05  WA-ADV-AMORT-TERM             PIC 9(2).  
S11455         05  WA-ADV-AMORT-FLAG             PIC X(1).  
S11455         05  WA-ADV-AMORT-JRNL-NO          PIC 9(6).  
S11455         05  FILLER                        PIC X(208).
S11455*        05  FILLER                       PIC X(831). 
011850     03  WA-CORR-TRAN REDEFINES WA-INPUT-MSG.
011860         05  FILLER                        PIC X(234).
011870         05  WA-TRACE-NO                   PIC 9(06).
011880         05  FILLER                        PIC X(742).
011890     03  WA-GL-AREA REDEFINES  WA-INPUT-MSG.
011900         COPY INPUTMSL IN LIBRYGEN.                                       
011910     03  WA-INIT-AREA REDEFINES WA-INPUT-MSG.
011920         05  START-QUE-AREA              PIC X(6).
011930         05  FILLER                      PIC X(976).

011950     03  WA-TRF-ACCT-AREA REDEFINES WA-INPUT-MSG.
011960         05  FILLER                      PIC X(347).
011970         05  WA-TRF-ACCT-SYS             PIC XXX.
011980         05  WA-TRF-ACCT                 PIC 9(16).
011990         05  WA-TRF-ACCT-ALPHA REDEFINES WA-TRF-ACCT
012000                                         PIC X(16).
012010         05  FILLER                      PIC X(616).
012020     03  TRF-AREA  REDEFINES WA-INPUT-MSG.                                
012030         05  W800-FROM-ACCT              PIC 9(16).
012040         05  W800-BAL                    PIC S9(14)V999
012050                                         TRAILING SEPARATE.
012060         05  W800-TRF-AMOUNT             PIC S9(14)V999
012070                                         TRAILING SEPARATE.
012080         05  W800-TRF-AMOUNT-R REDEFINES W800-TRF-AMOUNT
012090                                         PIC X(18).
012100         05  FILLER                      PIC XX.
012110         05  W800-TRF-DATE               PIC 9(8).
012120         05  W800-PROMO-NO               PIC XX.
012130         05  W800-TO-ACCT                PIC 9(16).
012140         05  FILLER                      PIC XX.
012150         05  W800-CHQ-DAYS               PIC XX.
012160         05  W800-DEF-INT-DAYS           PIC 99.
012170         05  W800-DEB-DEF-INT-DAYS       PIC 99.
012180         05  FILLER                      PIC X(894).
012190     03  TRF-AREA1  REDEFINES  WA-INPUT-MSG.                              
012200         05  FILLER                      PIC X(150).
012210         05  W800-ACCT-CURR-CD           PIC XXX.
012220         05  W800-CURR-AMT               PIC S9(14)V999
012230                                         TRAILING SEPARATE.
012240         05  W800-CURR-AMT-CURR-CD       PIC XXX.
012250         05  W800-BASE-CURR-AMT          PIC S9(14)V999
012260                                         TRAILING SEPARATE.
012270         05  W800-COMMISSION             PIC S9(14)V999
012280                                         TRAILING SEPARATE.
012290         05  W800-CHANGE                 PIC S9(14)V999
012300                                         TRAILING SEPARATE.
012310         05  W800-RATE-TYPE              PIC 99.
012320         05  W800-CURR-VERSION           PIC X(4).
012330         05  W800-CORR-JRNL-NO           PIC 9(6).
012340         05  FILLER                      PIC X(742).
TB0276     03  WA-ATM-WDL-TXN REDEFINES WA-INPUT-MSG.
TB0276         05  FILLER                      PIC X(655).
TB0276         05  WA-WDL-RISK-LEVEL           PIC X(3).
TB0276         05  WA-WDL-BANCS-ID-TRF-ACCT    PIC 9(3).
TB0276         05  WA-WDL-ACCT-NO-TRF-IN       PIC 9(17).
TB0276         05  WA-WDL-ATM-TRACE-NO         PIC X(10).           
SC6500         05  FILLER REDEFINES WA-WDL-ATM-TRACE-NO.
SC6500             07 WA-WDL-ATM-3             PIC X(3).
SC6500             07 WA-WDL-ATM-7             PIC X(7).
SC7014         05  FILLER REDEFINES WA-WDL-ATM-TRACE-NO.
SC7014            07  FILLER                   PIC X(3).
T20184*SC7014            07  WA-WDL-ATM-TRACE-NO-9    PIC 9(7).
T20184            07  WA-WDL-ATM-TRACE-NO-9    PIC X(7).
TB0276         05  WA-WDL-SETTLEMENT-DATE      PIC 9(8).
TB0276         05  WA-WDL-FISC-TXN-CODE        PIC 9(4).
TB0276         05  WA-WDL-RUN-METHOD           PIC X(2).
TB0276         05  FILLER                      PIC X(280).
SC6500     03  WA-ATM-TFR-TXN REDEFINES WA-INPUT-MSG.
SC6500         05  FILLER                      PIC X(655).
SC6500         05  WA-TRF-FROM-BANK-ID         PIC X(3).
SC6500         05  WA-TRF-TO-BANK-ID           PIC X(3).
SC6500         05  WA-TRF-RISK-LEVEL           PIC X(3).
SC6500         05  WA-TRF-ATM-TRACE-NO         PIC X(10).
SC6500         05  FILLER REDEFINES WA-TRF-ATM-TRACE-NO.
SC6500             07 WA-TFR-ATM-3             PIC X(3).
SC6500             07 WA-TFR-ATM-7             PIC X(7).
SC7014         05  FILLER REDEFINES WA-TRF-ATM-TRACE-NO.
SC7014            07  FILLER                   PIC X(3).
T20184*SC7014            07  WA-TRF-ATM-TRACE-NO-9    PIC 9(7).
T20184            07  WA-TRF-ATM-TRACE-NO-9    PIC X(7).
SC6500         05  WA-TRF-SETTLEMENT-DATE      PIC 9(8).
SC6500         05  WA-TRF-FISC-TXN-CODE        PIC 9(4).
SC6500         05  WA-TRF-RUN-METHOD           PIC X(2).
SC6500         05  FILLER                      PIC X(294).
TB0273*****FEDI 11055 11155
TB0273     03  WA-FEDI-AREA   REDEFINES WA-INPUT-MSG.
TB0273         05  FILLER                      PIC X(655).
TB0273         05  WA2-FEDI-RISK-TYPE          PIC X(03).
TB0273         05  WA2-FEDI-RUN-METHOD         PIC X(02).
TB0273         05  WA2-FEDI-FEDI-STAN.
TB0273             07 WA2-FEDI-STAN-DATE       PIC 9(8).
TB0273             07 WA2-FEDI-STAN-USERID     PIC X(12).
TB0273             07 WA2-FEDI-STAN-SEQNO      PIC 9(11).
TB0273         05  WA2-FEDI-VAL-FLG            PIC X.
TB0273         05  WA2-FEDI-VAL-FIELD1         PIC X(30).
TB0273         05  WA2-FEDI-VAL-FIELD2         PIC X(30).
TB0273         05  WA2-FEDI-NET-FEE-RECEIVB    PIC 9(6).
TB0273         05  WA2-FEDI-NET-FEE-RECEIVD    PIC 9(6).
TB0273         05  WA2-FEDI-FEE-CHRG-TYPE      PIC X.
SC4522         05  FILLER                      PIC X(4).
SC4522         05  BP-GL-TXN-FLAG              PIC X.
SC4522         05  BP-GL-SYSTEM                PIC X(3).
SC4522         05  BP-GL-ORIG-ACCT             PIC X(16).
SC4522         05  FILLER REDEFINES BP-GL-ORIG-ACCT.
SC4522             07 BP-ENT-CODE              PIC 9(5).
SC4522                88 ENT-CODE              VALUES 69999.
SC4522             07 FILLER                   PIC X(11).
SC5378         05  FEDI-TO-TXN-AMT             PIC S9(14)V999.
SC5378         05  FILLER                      PIC X(176).
SC4522*        05  FILLER                      PIC X(217).
S12770*BANCSLINK FOR 11057/16057
S12770     03  WA-TRF-TO-GL-AREA   REDEFINES WA-INPUT-MSG.
S12770         05  FILLER                      PIC X(808).
S12770         05  VIR-AC-FOR-REORG-PROD       PIC X(16).
S12770         05  FILLER                      PIC X(158).
S12770
012350*
012360* THIS AREA IS NOT USED, BUT IF A TRANSFER TRANSACTION (TYPE '36')
012370* IS IMPLEMENTED, THEN THIS IS THE APPROPRIATE FIELD TO USE.
012380*
S12770     03  WA-INPUT-DISCH-MSG REDEFINES WA-INPUT-MSG.
S12770         05  WA-INPUT-DISCH-ACCT              PIC 9(16).
S12770         05  WA-INPUT-DISCH-TRAN-130X0.
S12770             07  WA-INPUT-DISCH-AMOUNT        PIC S9(14)V999
S12770                                               TRAILING SEPARATE.
S12770             07  WA-INPUT-SUB-LEDG-CODE       PIC 99.
S12770             07  WA-INPUT-CHQ-CLEAR-CODE      PIC XX.
S12770             07  FILLER                       PIC X(6).
S12770         05  WA-INPUT-ENQUIRY-TRAN-13000
S12770                 REDEFINES WA-INPUT-DISCH-TRAN-130X0.
S12770             07  FILLER                       PIC X(18).
S12770             07  WA-INPUT-QUOTE-EXPIRY-DATE   PIC 9(8).
S12770             07  WA-INPUT-SAVE-QUOTE-FLAG     PIC X.
S12770             07  WA-INPUT-LOC-CODE            PIC X.
S12770         05  WA-INPUT-ALL-TRANS.
S12770             07  WA-INPUT-WAIVE-PENALTY-FLAG  PIC X.
S12770             07  WA-INPUT-INT-REBATE-PERC     PIC 9(3).
S12770             07  WA-INPUT-DISCH-DATE          PIC 9(8).
S12770             07  WA-INPUT-PROMO-CODE          PIC XX.
S12770             07  FILLER                       PIC X(6).
S12770         05  WA-DEP-TRF-ACCT-NO                PIC X(16).
S12770         05  FILLER                            PIC X.
S12770         05  WA-INPUT-JRNL-NO                  PIC 9(7).
S12770         05  WA-INPUT-REASON.
S12770             07  WA-INPUT-REASON-CD            PIC XX.
S12770         05  WA-INPUT-INT-BUCKET               PIC S9(14)V99.
S12770         05  WA-INPUT-LOAN-BAL                 PIC S9(14)V99.
S12770         05  FILLER                            PIC X(860).
012390     03  WA-TRANSFER-NARRATION-AREA REDEFINES WA-INPUT-MSG.
012400         05  FILLER                      PIC X(350).
012410         05  WA-TRANSFER-ACCOUNT-AREA    PIC X(16).
012420         05  FILLER                      PIC X(616).
012430*
012440/
012450     02  WA-OUTPUT-MESSAGE.
012460     03  WA-OUTPUT-ERR-MSG-NO            PIC 9999.
012470     03  WA-OUTPUT-MSG-LENGTH            PIC 9999.
012480     03  WA-OUTPUT-MSG                   PIC X(983).
012490     03  WA-ADV-OUTPUT-MSG REDEFINES WA-OUTPUT-MSG.
012500         05  WA-ADV-OUTPUT-MSG-KEY       PIC 9(16).
012510         05  WA-ADV-OP-MSG.
012520             07  WA-ADV-OUTPUT-NAME1     PIC X(30).
012530             07  WA-ADV-OUTPUT-NAME2     PIC X(30).
012540*NR0001      07  WA-ADV-OUTPUT-TRAN      PIC X(65).
NR2001*NR0001             07  WA-ADV-OUTPUT-TRAN      PIC X(102).
NR2001             07  WA-ADV-OUTPUT-TRAN.
NR2001                 COPY BOCTSIZ9 IN LIBRYBOR   
NR2001                      REPLACING ==(BOCT)== BY ==BOCT==.
012550         05  FILLER                      PIC X(18).
012560         05  WA-ADV-OUTPUT-CURR          PIC X(3).
012570         05  WA-ADV-OUTPUT-SW-REF-NO     PIC X(16).
NR2001*NR0001         05  FILLER                      PIC X(768).
NR2001         05  FILLER                      PIC X(686).
012580*NR0001  05  FILLER                      PIC X(805).
012590     03  WA-OUTPUT-MSG-R  REDEFINES WA-OUTPUT-MSG.
012600         05  WA-OUTPUT-DATA-SET          PIC X(4).
012610         05  WA-OUTPUT-STATUS            PIC X(4).
012620         05  FILLER                      PIC X(975).
012630     03  WA-OFFLINE-MSG REDEFINES WA-OUTPUT-MSG.
012640         05  FILLER                      PIC X.
012650         05  WA-OUTPUT-JRNL-NO           PIC 9(6).
012660         05  FILLER                      PIC X(976).
012670     03  WA-OUTPUT-NARRATIVE REDEFINES WA-OUTPUT-MSG.
012680         05  WA-OUTPUT-LIMIT-MSG         PIC X(40).
012690         05  FILLER                      PIC X(943).
012700     03  WA-DIS-OUTPUT-MSG REDEFINES WA-OUTPUT-MSG.
012710         05  WA-DIS-OUTPUT-MSG-KEY       PIC 9(16).
012720         05  WA-DIS-OP-MSG               PIC X(60).
012730         05  WA-DIS-OP-MSG-R REDEFINES WA-DIS-OP-MSG.
012740             07  WA-DIS-OUTPUT-NAME-1    PIC X(30).
012750             07  FILLER                  PIC X(30).
012760         05  FILLER                      PIC X(83).
012770         05  WA-DIS-OP-MSG-CURR          PIC XXX.
012780         05  FILLER                      PIC X(821).
012790*    03  BR0024-DAY-REFRESH-AREA REDEFINES WA-OUTPUT-MSG.
012800*        05  FILLER                      PIC X(7).
012810*        05  BR0024-DAY-FINTRN-FLAG      PIC XX.
012820*        05  BR0024-DAY-NO-OF-ACCTS      PIC 99.
012830*        05  BR0024-DAY-DATA OCCURS 9.
012840*            07  BR0024-DAY-ACCT-NO      PIC 9(17).
012850*            07  BR0024-DAY-CUR-BAL      PIC S9(14)V999
012860*                                        TRAILING SEPARATE.
012870*            07  BR0024-DAY-AVAIL-BAL    PIC S9(14)V999
012880*                                        TRAILING SEPARATE.
012890*            07  BR0024-DAY-PBOOK-BAL    PIC S9(14)V999
012900*                                        TRAILING SEPARATE.
012910*            07  BR0024-DAY-ACCT-STAT    PIC 9(4).
012920*        05  FILLER                      PIC X(297).
012930     03  WA-DB-ERR-OUTPUT REDEFINES WA-OUTPUT-MSG.
012940         05  WA-DBERR-DATA-SET           PIC X(4).
012950         05  WA-DB-ERROR                 PIC X(4).
012960         05  FILLER                      PIC X(975).
012970     03  WA-OUTPUT-DISCH REDEFINES WA-OUTPUT-MSG.
012980         05  WA-DISC-CUSTOMER-NO         PIC X(16).
012990         05  FILLER                      PIC X(65).
013000         05  WA-DISCH-CURR               PIC XXX.
013010         05  FILLER                      PIC X(899).
013020/
013030     02  BORM-RECORD-AREA.
013040     COPY BORMMAST IN LIBRYBOR.
013050/
013060     COPY STRTREST IN LIBRYMIS.
013070/
013080 01  WA-SOC-PARAMS.
013090     COPY INSPARM  IN LIBRYMIS.
013100*
013110/
013120 01  BORP-RECORD-AREA.
013130     COPY BORPARM IN LIBRYBOR.
013140/
013150*ST0170 01  DEPP-RECORD-AREA.
013160*ST0170     COPY DEPPARM IN LIBRYINV.
013170/
NR2001*013180 01  BORV-RECORD-AREA.
NR2001*013190     COPY BORVVARV IN LIBRYBOR.
NR2001 01  BOCT-RECORD-AREA.
NR2001     COPY BOCTVARV IN LIBRYBOR
NR2001          REPLACING ==(BOCT)== BY ==BOCT==.
013200/
013210 01  WA-INT-ST-BIN                      PIC S9(9) BINARY.
013220*
013230 01  WA-COMMISSION-PASSALONG.
013240     03  WA-BAL-BEFORE-COMMISSION        PIC S9(14)V999
013250                                         TRAILING SEPARATE.
013260     03  WA-COMMISSION-AMOUNT            PIC S9(14)V999
013270                                         TRAILING SEPARATE.
013280     03  WA-COMM-CORR-AMOUNT             PIC S9(14)V999
013290                                         TRAILING SEPARATE.
013300     03  WA-BORM-INS-PREMIUM             PIC S9(14)V999 COMP.
013310     03  WA-BORM-LOAN-BAL-EX-PPP         PIC S9(14)V999 COMP.
013320     03  WA-PPP-PREM-TXN-CODE            PIC 9(6).
013330     03  WA-PPP-EDIT-MASK-1-2.
013340         05  WA-PPP-EDIT-MASK-1          PIC X(34).
013350         05  WA-PPP-EDIT-MASK-2          PIC X(20).
013360     03  WA-PPP-LEDGER-CODE              PIC 99.
013370     03  WA-PPP-PREM-SUB-LEDG            PIC 99.
013380*
013390 01      WA-PASSALONG.
013400     COPY PASALONG IN LIBRYMIS.
TB0084 
TB0084 01  WA-ADJ-PASSALONG.
TB0084     COPY PASSBUCK IN LIBRYBOR.
013410*
013420 01  WA-CS0000CA-CALL-AREA.
013430     COPY CS0000CA IN LIBRYCHG.
013440*
013450 01  WA-CS0000RA-RETURN-AREA.
013460     COPY CS0000RA IN LIBRYCHG.
013470/
013480     COPY UT0270CA IN LIBRYMIS.
013490*
013500*

013520*
013530 01  W300-ERROR-AREA                     PIC X(60).
013540*
013550 01      CHECK-RESPONSE-AREA.
013560         COPY CHECKRES IN LIBRYMIS.
013570/
013580 01  MULTI-OVERRIDE-AREA.
013590     COPY MULTIOVR IN LIBRYMIS.
013600*
013610     COPY PBOOKCA IN LIBRYMIS
013620          REPLACING ==(PBOOKCA)== BY ==PBOOKCA==.
SC7181 01 UTVTACCA-CALL-PARAM.
SC7181    COPY UTVTACCA IN LIBRYINV.

013640     COPY BR0024CA IN LIBRYBOR.
TB0027/
TB0027 01  BOIS-RECORD.
TB0027     COPY BOISMAST IN LIBRYBOR.

013660 PROCEDURE DIVISION USING STARTAREA
013670                          WA-SOC-PARAMS
013680                          BORP-RECORD-AREA
NR2001*013690                          BORV-RECORD-AREA
NR2001                          BOCT-RECORD-AREA
013700                          WA-INT-ST-BIN
013710                          WA-COMMISSION-PASSALONG
013720                          WA-PASSALONG
013730                          WA-CS0000CA-CALL-AREA
013740                          WA-CS0000RA-RETURN-AREA
013750                          UT0270CA-AREA
013760                          W300-ERROR-AREA
013770                          CHECK-RESPONSE-AREA
013780                          MULTI-OVERRIDE-AREA
013790                          PBOOKCA-LINE-AREA
SC8085                          UTVTACCA-CALL-PARAM
TB0027                          BR0024CA-AREA
TB0027                          BOIS-RECORD.
013800*                         BR0024CA-AREA.                           ***TB0027
013810  A000-MAIN-LOGIC.
SC8991*    IF STRT-AREA-TRN-NO = 19055 OR 19155
SC8991*       MOVE WA-ADV-TXN-DATE  TO WA-BACKDATE-DATE
SC8991*    END-IF.
013830     MOVE 0                      TO WA-MSG-ERR-FLAG.
013840     INITIALIZE BR0024CA-AREA.
013850     IF WA-1ST-TIME-FLAG         =  0
013860        MOVE 1 TO WA-1ST-TIME-FLAG
013870        MOVE 1 TO UT1999CA-CALL-CODE
013880        CALL "UT1999" USING

013900             UT1999CA-CALL-AREA
013910        MOVE UT1999CA-DD TO WA-ACCEPT-DD-R
013920        MOVE UT1999CA-MM TO WA-ACCEPT-MM-R
013930        MOVE UT1999CA-CC TO WA-ACCEPT-CC-R
013940        MOVE UT1999CA-YY TO WA-ACCEPT-YY-R
013950        MOVE WA-ACCEPT-DATE-R TO UT0030-DATE-DDMMCCYY
013960        PERFORM X200-UT0030-PARA THRU X209-EXIT
013970        MOVE UT0030-BINARY-DATE TO WA-DMY
013980                                   WA-TODAY-BIN-DATE                      
TB0084        PERFORM A200-GET-BEG-OF-MONTH THRU A209-EXIT.
013990     MOVE STRT-AREA-PROCESS-BITS  TO FIELD-B.
014000     CALL "UT0022" USING PUAREA.
014010     MOVE FIELD-A                TO WA-EDIT-MASK.
014020     MOVE 0                      TO IN0014-STATUS-LEVEL-1
014030                                    IN0014-STATUS-LEVEL-2
014040                                    IN0014-STATUS-LEVEL-3
014050                                    IN0014-STATUS-LEVEL-4.
S18816     MOVE 0                      TO WA-MULTI-ADV-AMT.
014060     MOVE 0                      TO WA-ORIG-TXN-EVT
S15727                                    WS-COMM-RATE1
S15727                                    WS-COMM-RATE2
S15727                                    WS-COMM-RATE3
S15727                                    WS-BANK-RATE
014070                                    WA-ORIG-JRNL-NO
014080                                    WA-SAVE-36-JRNL-NO                   
014090                                    WA-BORM-CUST-NO                      
S19435                                    WK-INVM-CUST-NO
S19435                                    WK-PROD-TYPE
014100                                    WA-TRF-CUST-NO                       
014110                                    WA-ORIG-POST-DATE
S16101                                    WA-OD-LIMIT
S16101                                    WS-USAGE-AMT
014120                                    WA-ORIG-POST-TIME.
014130     MOVE SPACE                  TO WA-ORIG-POST-SEQ
014140                                    WA-MULT-TXN-SEQ
014150                                    WA-OWNER-ACCT-FLAG                   
014160                                    PBOOKCA-PRINT-TYPE.
NR2001*S11455     INITIALIZE BORV-RECORD-AREA.
NR2001     INITIALIZE BOCT-RECORD-AREA.
014170     MOVE STRT-AREA-BRANCH       TO UPTELLCA-BRCH.
014180     MOVE STRT-AREA-TELL-NO      TO UPTELLCA-TELR.
014190     CALL "UT0031" USING
014200                         UPTELLCA-PARAM-1
014210                         UPTELLCA-PARAM-2.
014220     MOVE 0 TO WA-ADV-COUNT.
TB0221     MOVE BORM-ADV-VAL    TO WA-BEFORE-BORM-ADV-VAL.
TB0221     MOVE BORM-STAT       TO WA-BEFORE-BORN-STAT.
ST0115     MOVE BORM-LOAN-BAL   TO WA-BEFORE-BORM-LOAN-BAL.
S17755     MOVE BOIS-LAST-UNPAID-DUE-DATE TO WA-B4-LST-UNPD-DUE-DTE.
S17755     MOVE BOIS-NEXT-DUE-DATE        TO WA-B4-NEXT-DUE-DATE.
S17755     MOVE BOIS-DUE-DTE-IND          TO WA-B4-DUE-IND.
S19435     MOVE BORM-ACT-TYPE             TO WK-PROD-TYPE(1:4).
S19435     MOVE BORM-CAT                  TO WK-PROD-TYPE(5:4).

014230     PERFORM B000-ONLINE-PROCESS-ADVANCES
014240        THRU B099-EXIT.
TB0196*    IF BOIS-PROJECT-ID NOT = ZEROES
TB0196*       PERFORM Z400-CREATE-PRJB THRU Z499-EXIT
TB0196*       PERFORM Z700-UPDATE-SUBS THRU Z700-EXIT
TB0196*    END-IF.
014250*NBG003
014260     IF BORM-IR-IND = 1
014270        PERFORM Z3000-REWRITE-BIRM.
014280*
S17755     IF  WA-MSG-ERR-FLAG           = 0
S17755       IF  BORP-ILOAN-R
S17755       AND WA-INPUT-PARAM-TABLE(8) = 1
S17755       AND WA-INPUT-PARAM-TABLE(7) = 1
S17755       AND BORM-BAD-DEBT-IND(2:1)  < 2
S17755           PERFORM W170-CORR-BOCT-33 THRU W179-EXIT
S17755       END-IF
S17755     END-IF.

ST0115     IF  BORP-YOUBE                        
ST0115     AND WA-INPUT-PARAM-TABLE(8) NOT = 1   
ST0115     AND WA-MSG-ERR-FLAG = 0               
ST0115         IF WA-INPUT-PARAM-TABLE(7) NOT = 1
ST0115            PERFORM E000-CALL-UTYENQ       
ST0115               THRU E000-EXIT              
ST0115         ELSE                              
ST0115            PERFORM E100-CALL-UTYENQ-CORR  
ST0115               THRU E100-EXIT              
ST0115         END-IF                            
ST0115     END-IF.                               
S11455     IF BORP-YOUBE                           
S11455        PERFORM Z999-YOUBE-FIELD-VERIFICATION
S11455           THRU Z999-EXIT                    
S11455     END-IF.                                 
S10978**
S10978**Restoring old financial date by reading the first financial date
S10978**in BORV.
S11455*    IF NOT BORP-YOUBE
S11455*     AND WA-INPUT-PARAM-TABLE(7) = 1
S11455     IF (NOT BORP-YOUBE AND             
S11455        WA-INPUT-PARAM-TABLE(7) = 1)    
S11455     OR (BORP-YOUBE AND                 
S11455         WA-INPUT-PARAM-TABLE(7) = 1 AND
S11455         WA-INPUT-PARAM-TABLE(8) = 0)   
NR2001*S10978        MOVE SPACES   TO DBIO-CALL-PARAM
NR2001*S10978                         DBIO-CALL-SYS-AREA
NR2001*S10978                         DBIO-CALL-KEY-AREA
NR2001*S10978                         DBIO-CALL-STATUS
NR2001*NN0001                         DBIO-CALL-SAVE-REFER
NR2001*S10978        MOVE ZERO     TO DBIO-CALL-REFER-AREA
NR2001*S10978        MOVE 07       TO DBIO-CALL-FUNC
NR2001*S10978        MOVE "BOR"    TO DBIO-CALL-SYS
NR2001*S10978        MOVE BORM-KEY TO DBIO-CALL-KEY
NR2001*S10978        MOVE 01       TO DBIO-CALL-TXN-TYPE
NR2001*S10978        MOVE "N"      TO WA-TRAN-NO-MORE-FLAG
NR2001*S10978        MOVE 0        TO WA-LST-FIN-DATE
NR2001        INITIALIZE UTBOCTCA-CALL-AREA
NR2001        MOVE BORM-SOC-NO       TO BOCT-INST-NO
NR2001        MOVE BORM-MEMB-CUST-AC TO BOCT-ACCT-NO
NR2001        MOVE 0                 TO BOCT-REC-NO
NR2001        MOVE 999999999         TO BOCT-TRN-DATE
NR2001        MOVE 1                 TO UTBOCTCA-KEY-NO
NR2001        SET  UTBOCTCA-READNEXT TO TRUE
NR2001        MOVE 01                TO WS-BOCT-TRAN-TYPE
NR2001        MOVE "N"               TO WA-TRAN-NO-MORE-FLAG
NR2001        MOVE 0                 TO WA-LST-FIN-DATE
S10978
S10978        PERFORM A300-READ-LATEST-FIN
S10978           THRU A399-EXIT
S10978          UNTIL WA-TRAN-NO-MORE
S10978
S10978        MOVE WA-LST-FIN-DATE    TO BORM-LST-FIN-DATE
S10978     END-IF.
ST0115*                                          
014290 A090-EXIT.
014300 A100-EXIT-PARA.
014310     EXIT PROGRAM.
TB0084/
TB0084 A200-GET-BEG-OF-MONTH.
           MOVE WA-ACCEPT-DATE-R TO UT0030-DATE-DDMMCCYY
           MOVE 01 TO UT0030-DATE-DD
           PERFORM X200-UT0030-PARA THRU X209-EXIT
           MOVE UT0030-BINARY-DATE TO WA-BEG-MONTH.
TB0084 A209-EXIT.
TB0084     EXIT.
S10978/
NR2001*S10978 A300-READ-LATEST-FIN.
NR2001*S10978     CALL "DBIO" USING
NR2001*S10978                 DBIO-CALL-PARAM
NR2001*S10978                 DBIO-CALL-SYS-AREA
NR2001*S10978                 DBIO-CALL-KEY-AREA
NR2001*S10978                 DBIO-CALL-STATUS
NR2001*S10978                 BORV-RECORD-AREA
NR2001*S10978                 DBIO-CALL-REFER-AREA
NR2001*S10978                 DBIO-CALL-TXN-TYPE.
NR2001*S10978
NR2001*S10978     IF DBIO-CALL-STATUS NOT = "****"
NR2001*S10978      OR DBIO-CALL-SAVE-REFER = "END."
NR2001*S10978        MOVE "Y" TO WA-TRAN-NO-MORE-FLAG
NR2001*S10978        GO TO A399-EXIT
NR2001*S10978     END-IF.
NR2001*S10978
NR2001*S10978     IF BORV-01-CODE NOT = 01
NR2001*NQ0079      OR BORV-01-TRN-CODE = 10732
NR2001*S10978        GO TO A399-EXIT
NR2001*S10978     END-IF.
NR2001*S10978
NR2001*S11455*    IF BORV-01-STATUS > 20
NR2001*S11455     IF BORV-01-STATUS NOT < 20 
NR2001*S10978        GO TO A399-EXIT
NR2001*S10978     END-IF.
NR2001*S10978
NR2001*NQ0079     MOVE BORV-01-TRN-CODE TO LINK-IN-TXCODE.         
NR2001*NQ0079     PERFORM M1600-LOAD-ED2 THRU M1699-EXIT.          
NR2001*NQ0079                                                      
NR2001*NQ0079     IF WA-MSG-ERR-FLAG = 1                           
NR2001*NQ0079        MOVE "Y" TO WA-TRAN-NO-MORE-FLAG              
NR2001*NQ0079        GO TO A399-EXIT.                              
NR2001*NQ0079                                                      
NR2001*NQ0079     MOVE LINK-EDIT-TABLE (31:4)  TO FIELD-B.         
NR2001*NQ0079     CALL "UT0022" USING PUAREA.                      
NR2001*NQ0079     MOVE FIELD-A                 TO WA-FIN-EDIT-MASK.
NR2001*NQ0079                                                      
NR2001*NQ0079     IF WA-FIN-PARAM-TABLE (7) = 1                    
NR2001*NQ0079        GO TO A399-EXIT                               
NR2001*NQ0079     END-IF.                                          
NR2001*NQ0079                                                      
NR2001*S10978     MOVE BORV-01-TRN-DATE TO WA-LST-FIN-DATE.
NR2001*NQ0079     MOVE "Y" TO WA-TRAN-NO-MORE-FLAG.
NR2001*S10978
NR2001*S10978 A399-EXIT.
NR2001*S10978     EXIT.
NR2001 A300-READ-LATEST-FIN.
NR2001     MOVE BOCT-INST-NO        TO UTBOCTCA-INST-NO.
NR2001     MOVE BOCT-ACCT-NO        TO UTBOCTCA-ACCT-NO.
NR2001     MOVE BOCT-REC-NO         TO UTBOCTCA-REC-NO.
NR2001     MOVE BOCT-TRN-DATE       TO UTBOCTCA-CALL-DATE.
NR2001     MOVE 1                   TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT   TO TRUE.
NR2001     CALL "UTBOCT"         USING UTBOCTCA-CALL-AREA
NR2001                                 BOCT-RECORD-AREA.
NR2001
NR2001     IF NOT UTBOCTCA-OK
NR2001        MOVE "Y" TO WA-TRAN-NO-MORE-FLAG
NR2001        GO TO A399-EXIT
NR2001     END-IF.
NR2001
NR2001     IF BOCT-TRAN-TYPE NOT = WS-BOCT-TRAN-TYPE
NR2001        GO TO A399-EXIT
NR2001     END-IF.
NR2001
NR2001     IF BOCT-TRAN-TYPE NOT = 01
NR2001      OR BOCT-TRN-CODE = 10732
NR2001        GO TO A399-EXIT
NR2001     END-IF.
NR2001
NR2001     IF BOCT-STAT NOT < 20 
NR2001        GO TO A399-EXIT
NR2001     END-IF.
NR2001
NR2001     MOVE BOCT-TRN-CODE TO LINK-IN-TXCODE.         
NR2001     PERFORM M1600-LOAD-ED2 THRU M1699-EXIT.          
NR2001                                                      
NR2001     IF WA-MSG-ERR-FLAG = 1                           
NR2001        MOVE "Y" TO WA-TRAN-NO-MORE-FLAG              
NR2001        GO TO A399-EXIT.                              
NR2001                                                      
NR2001     MOVE LINK-EDIT-TABLE (31:4)  TO FIELD-B.         
NR2001     CALL "UT0022" USING PUAREA.                      
NR2001     MOVE FIELD-A                 TO WA-FIN-EDIT-MASK.
NR2001                                                      
NR2001     IF WA-FIN-PARAM-TABLE (7) = 1                    
NR2001        GO TO A399-EXIT                               
NR2001     END-IF.                                          
NR2001                                                      
NR2001     MOVE BOCT-TRN-DATE TO WA-LST-FIN-DATE.
NR2001     MOVE "Y"           TO WA-TRAN-NO-MORE-FLAG.
NR2001
NR2001 A399-EXIT.
NR2001     EXIT.
014320/
014330 B000-ONLINE-PROCESS-ADVANCES.
014340******************************************************************
014350******************************************************************
014360***     THIS PERFORMS THE FOLLWING FUNCTIONS-
014370***     FOR ADVANCE TRANSACTIONS
014380***     1. VALIDATES LEDGER AND SUB-LEDGER CDES.
014390***     2. ADD AMOUNT TO BRM-APP-AMT.
014400***     3. SETS BORR-STATUS ACCORDINGLY BY COMPARING
014410***        APP-AMT TO ADV-AMT.
014420***     4. SENDS ERROR-MSG IF APP-AMT < ADV-VAL.
014430***     5. ADD TRX TO BORM MASTER.
014440***     6. SETS APPROVAL DATE TO TRANSACTION DATE.
014450***     7. IF  BORR-TYPE = 1 I.E PROPOSED DWELLING(TO BE ERECTED)
014460***            IT SETS INTEREST-START-DATE = (APP-DATE + 4 MNTHS)
014470***        IF  BORR-TYPE NOT = 1 I.E EXISTING DWELLING
014480***            INTEREST-START-DATE = (APP-DATE + 1 MONTH).
014490***     FOR RE-DRAW REFUND TRANSACTIONS
014500***     1. VALIDATES LEDGER AND SUB-LEDGER CDES.
014510***     3. SETS BORR-STATUS ACCORDINGLY BY COMPARING
014520***        TRAN-AMT TO AVAILABLE AMOUNT TO RE-DRAW.
014530***     4. SENDS ERROR-MSG IF TRAN-AMT > AVAILABLE-AMT
014540***     5. ADD TRX TO BORM MASTER.
014550***     6. SETS CURRENT DATE TO TRANSACTION DATE.
014560******************************************************************
014570******************************************************************
TB0082*
SC4522     MOVE 0 TO WA-FEDI-BP-POST-FLAG.
SC7091*    IF (STRT-AREA-TRN-NO = 11045 OR 11145 OR 11055 OR 11155)
SC7091     IF (STRT-AREA-TRN-NO = 11045 OR 11145 OR 11055 OR 11155
SC7091                         OR 16045 OR 16145 OR 16055 OR 16155)
SC4522     AND BP-GL-TXN-FLAG = "Y"
SC4522     AND BP-GL-SYSTEM = "GEN"
SC4522     AND ENT-CODE
SC4522         MOVE 1 TO WA-FEDI-BP-POST-FLAG
SC4522     END-IF.
SC5378     PERFORM H200-VERIFY-FEDI-FEE-TXN THRU H299-EXIT.
SC2192    MOVE BORM-STAT                TO WA-BORM-STAT.

S16534    IF  WA-INPUT-PARAM-TABLE(5) = 1
S16534    AND WA-INPUT-PARAM-TABLE(7) = 1
S16534    AND BORM-BAD-DEBT-IND NOT = '00'
S16534        MOVE 1    TO WA-MSG-ERR-FLAG
S16534        MOVE 4708 TO WA-OUTPUT-ERR-MSG-NO
S16534        GO TO B099-EXIT
S16534    END-IF.

TB0082    IF SOC-SITE-TIB
TB0082       IF WA-INPUT-PARAM-TABLE(5) = 1 AND
TB0082          WA-INPUT-PARAM-TABLE(7) = 0
TB0082          PERFORM VALIDATE-ADVANCES
TB0082             THRU VALIDATE-ADVANCES-EXIT
TB0082          IF WA-OUTPUT-ERR-MSG-NO <> 0
TB0082             GO TO B099-EXIT
TB0082          END-IF
TB0082       END-IF
TB0082    END-IF.
TB0082*
S16081**  UPFRONT LOAN (BORM-REPAY-FREQ = "98") ==> advanced only once
S16081      IF STRT-AREA-TRN-NO = 11055
S16081         AND  (BORM-CAPN-METHOD = "X" OR
S16081              (BORM-CAPN-METHOD = " " AND
S16081               BORP-CAPN-METHOD = "X"))
S16081         AND BORM-LOAN-BAL > 0
S16081            MOVE 1    TO WA-MSG-ERR-FLAG
S16081            MOVE 3488 TO WA-OUTPUT-ERR-MSG-NO
S16081         GO TO B099-EXIT
S16081      END-IF.
S16081*
S12770    IF STRT-AREA-TRN-NO = 11063 OR 11163 OR 16063 OR 16163
S12770       IF BORP-CONSMR AND BORP-REORG-CREDIT-PROD
S12770          NEXT SENTENCE
S12770       ELSE
S12770          MOVE 1    TO WA-MSG-ERR-FLAG
S12770          MOVE 312  TO WA-OUTPUT-ERR-MSG-NO
S12770          GO TO B099-EXIT
S12770       END-IF
S12770    END-IF.
SC4617    EVALUATE BORP-LOAN-CLASS
SC4617***----BORP-CONSMR OR BORP-CONSMR-MORT-COMBI
SC4617       WHEN "1" THRU "2"
SC4617           IF  BOIS-CREDIT-INVSGTR   = SPACE  OR
SC4617               BOIS-APPROVAL-OFFICER = SPACE  OR
SC4617               BOIS-EXEC-SUPERVISOR  = SPACE  OR
SC4617               BOIS-PROMO-TELLER     = SPACE  OR
SC4617               BOIS-SRCT-CODE        = 0
S16579            IF NOT BORP-COMML-LN
SC4617               MOVE 1    TO WA-MSG-ERR-FLAG
SC4617               MOVE 4173 TO WA-OUTPUT-ERR-MSG-NO
SC4617               GO TO B099-EXIT
S16579            END-IF
SC4617           END-IF
SC4617***----BORP-YOUBE
SC4617       WHEN "3"
S12145*SC7931           COMPUTE WA-TEMP-BORM-LOAN-BAL = BORM-LOAN-BAL * -1
S12145*SC7454           IF BOIS-ACCOUNT-LIMIT = 0
S12145*SC7931           AND BORM-LOAN-BAL NOT < 0
S12145*SC9192           AND NOT STRT-REPOST-TXN
S12145*SC9719           AND NOT (WA-INPUT-PARAM-TABLE(8) = 1
S12145*SC9719           AND WA-INPUT-PARAM-TABLE(7) = 1)
S12145*S11455           AND (WA-ADV-AMORT-FLAG NOT = "A" AND
S12145*S11455                WA-ADV-AMORT-FLAG NOT = "F" AND
S12145*S11455                WA-ADV-AMORT-FLAG NOT = "R")
S12145*SC7454              MOVE 1    TO WA-MSG-ERR-FLAG
S12145*SC7454              MOVE 4763 TO WA-OUTPUT-ERR-MSG-NO
S12145*SC7454              GO TO B099-EXIT
S12145*SC7454           END-IF
S12145*SC7931           IF  BORM-LOAN-BAL < 0
S12145*SC7931           AND BOIS-ACCOUNT-LIMIT = 0
S12145*SC7931           AND WA-ADV-AMOUNT > WA-TEMP-BORM-LOAN-BAL
S12145*SC9192           AND NOT STRT-REPOST-TXN
S12145*SC9719           AND NOT (WA-INPUT-PARAM-TABLE(8) = 1
S12145*SC9719           AND WA-INPUT-PARAM-TABLE(7) = 1)
S12145*S11455           AND (WA-ADV-AMORT-FLAG NOT = "A" AND
S12145*S11455                WA-ADV-AMORT-FLAG NOT = "F" AND
S12145*S11455                WA-ADV-AMORT-FLAG NOT = "R")
S12145*SC7931              MOVE 1    TO WA-MSG-ERR-FLAG
S12145*SC7931              MOVE 4763 TO WA-OUTPUT-ERR-MSG-NO
S12145*SC7931              GO TO B099-EXIT
S12145*SC7931           END-IF
SC4617           IF  BOIS-EXEC-SUPERVISOR  = SPACE  OR
SC4617               BOIS-PROMO-TELLER     = SPACE  OR
SC4617               BOIS-SRCT-CODE        = 0      OR
SC4617*SC7454        BOIS-ACCOUNT-LIMIT    = 0      OR
SC4617               BOIS-CONTRACT-LIMIT   = 0      OR
SC4617               BOIS-CONTRACT-RATE    = 0      OR
SC4617               BOIS-HIGH-INT-RATE    = 0 
SC4617               MOVE 1    TO WA-MSG-ERR-FLAG
SC4617               MOVE 4173 TO WA-OUTPUT-ERR-MSG-NO
SC4617               GO TO B099-EXIT
SC4617           END-IF
SC4617       END-EVALUATE.
ST0049***** WRITE BORV-26 FOR YOUBE BKDT CORR.
ST0049     IF   BORP-YOUBE
S10075     AND  WA-INPUT-PARAM-TABLE(7) = 0    
NR2001*ST0049          MOVE BORV-01-DETAIL          TO WA-STORE-BORV-01
NR2001*ST0049          INITIALIZE                   BORV-01-DETAIL
NR2001*ST0049          MOVE 26                      TO BORV-26-CODE
NR2001*ST0049          MOVE 0                       TO BORV-26-STATUS
NR2001*S10314*         MOVE WA-TODAY-BIN-DATE       TO BORV-26-POST-DATE
NR2001*S10314          MOVE STRT-AREA-POST-DT       TO BORV-26-POST-DATE
NR2001*ST0049          MOVE STRT-AREA-JRNL-NO       TO BORV-26-JRNL-NO
NR2001*ST0049          MOVE BOIS-PREV-DUE-DATE      TO BORV-26-PREV-DUE-DATE
NR2001*ST0049          MOVE BOIS-NEXT-DUE-DATE      TO BORV-26-NEXT-DUE-DATE
NR2001*ST0049          MOVE BOIS-YET-COLLECT-INT TO BORV-26-YET-COLLECT-INT
NR2001*ST0049          MOVE BORM-INT-ADJUSTMENT  TO BORV-26-INT-ADJUSTMENT
NR2001*ST0049          IF   WA-TODAY-BIN-DATE   >   BOIS-PREV-DUE-DATE
NR2001*ST0049               MOVE BORM-INT-ACCR      TO BORV-26-HIGH-INT-ACCR
NR2001*ST0049*              ADD  BORM-INT-ADJUSTMENT TO BORV-26-HIGH-INT-ACCR
NR2001*ST0049*SC5557        ADD  BORM-INT-ADJUSTMENT TO BORV-26-INT-ADJUSTMENT
NR2001*ST0049               MOVE 0                   TO BORV-26-INT-ACCR
NR2001*ST0049          ELSE
NR2001*ST0049               MOVE 0                  TO BORV-26-HIGH-INT-ACCR
NR2001*ST0049                                          BORV-26-INT-ADJUSTMENT
NR2001*ST0049               MOVE BORM-INT-ACCR      TO BORV-26-INT-ACCR
NR2001*ST0049          END-IF
NR2001*ST0049          MOVE BOIS-LAST-UNPAID-INT-DT TO BORV-26-LST-UNPD-INT-DT
NR2001*ST0049          MOVE BOIS-ACCOUNT-LIMIT      TO BORV-26-ACCT-LIMIT
NR2001*SC6571*         PERFORM W500-ADD-TXN         THRU W599-EXIT
NR2001*ST0049          IF   WA-INPUT-PARAM-TABLE(8) = 1
NR2001*ST0049              MOVE WA-ADV-TXN-DATE    TO UT0030-DATE-DDMMCCYY
NR2001*ST0049              MOVE 1                      TO UT0030-FUNCTION
NR2001*ST0049              CALL "UT0030"   USING      UT0030-FUNCTION
NR2001*ST0049                                         UT0030-DATE-AREA
NR2001*ST0049                                         UT0030-BINARY-DATE
NR2001*ST0049              MOVE UT0030-BINARY-DATE TO BORV-26-TRN-DATE 
NR2001*ST0049          ELSE
NR2001*S10314*              MOVE WA-TODAY-BIN-DATE  TO BORV-26-TRN-DATE
NR2001*S10314               MOVE STRT-AREA-POST-DT  TO BORV-26-TRN-DATE
NR2001*ST0049          END-IF
NR2001          MOVE BOCT-RECORD-AREA        TO WA-STORE-BOCT-01
NR2001          INITIALIZE                   BOCT-TRAN-26
NR2001          MOVE 26                      TO BOCT-TRAN-TYPE
NR2001          MOVE 0                       TO BOCT-STAT
NR2001          MOVE STRT-AREA-TRN-NO        TO BOCT-TRN-CODE
NR2001          MOVE BOIS-PREV-DUE-DATE      TO BOCT-26-PREV-DUE-DATE
NR2001          MOVE BOIS-NEXT-DUE-DATE      TO BOCT-26-NEXT-DUE-DATE
NR2001          MOVE BOIS-YET-COLLECT-INT    TO BOCT-26-YET-COLLECT-INT
NR2001          MOVE BORM-INT-ADJUSTMENT     TO BOCT-26-INT-ADJUSTMENT
NR2001          IF   WA-TODAY-BIN-DATE   >   BOIS-PREV-DUE-DATE
NR2001               MOVE BORM-INT-ACCR      TO BOCT-26-HIGH-INT-ACCR
NR2001               MOVE 0                  TO BOCT-26-INT-ACCR
NR2001          ELSE
NR2001               MOVE 0                  TO BOCT-26-HIGH-INT-ACCR
NR2001                                          BOCT-26-INT-ADJUSTMENT
NR2001               MOVE BORM-INT-ACCR      TO BOCT-26-INT-ACCR
NR2001          END-IF
NR2001          MOVE BOIS-LAST-UNPAID-INT-DT TO BOCT-26-LST-UNPD-INT-DT
NR2001          MOVE BOIS-ACCOUNT-LIMIT      TO BOCT-26-ACCT-LIMIT
NR2001          IF   WA-INPUT-PARAM-TABLE(8) = 1
NR2001               MOVE WA-ADV-TXN-DATE    TO UT0030-DATE-DDMMCCYY
NR2001               MOVE 1                  TO UT0030-FUNCTION
NR2001               CALL "UT0030"   USING      UT0030-FUNCTION
NR2001                                          UT0030-DATE-AREA
NR2001                                          UT0030-BINARY-DATE
NR2001               MOVE UT0030-BINARY-DATE TO BOCT-TRN-DATE
NR2001          ELSE
NR2001               MOVE STRT-AREA-POST-DT  TO BOCT-TRN-DATE
NR2001          END-IF
SC6571          PERFORM W500-ADD-TXN         THRU W599-EXIT
ST0049          MOVE WA-STORE-BOCT-01        TO BOCT-RECORD-AREA
ST0049     END-IF.         
S10139     IF BORP-CONSMR-MORT-COMBI
S10139        AND (BOIS-SORD-AUTO-DBT-ACCT-NO <> 0 AND SPACES)
S10139        AND (BOIS-OD-ACCT-NUMBER        <> 0 AND SPACES)
S10139        MOVE ZEROES TO WA-OD-LIMIT
S10139        IF WA-INPUT-PARAM-TABLE(7) = 0
S10207           COMPUTE WA-TOTAL-ADV-AMT = BORM-ADV-VAL +
S10207                                      WA-INPUT-AMT
S10207           IF WA-TOTAL-ADV-AMT < BOIS-THRESHOLD-AMT
S10139*S10207    AND (((BORM-ADV-VAL <> 0) AND
S10139*S10207         (BOIS-THRESHOLD-AMT > BORM-ADV-VAL)) OR
S10139*S10207         ((WA-INPUT-AMT <> 0) AND
S10139*S10207         (BOIS-THRESHOLD-AMT > WA-INPUT-AMT)))
S10139           MOVE 4600 TO   WA-OUTPUT-ERR-MSG-NO
S10139           MOVE 1    TO   WA-MSG-ERR-FLAG
S10139           GO TO B099-EXIT
S10207           END-IF
S10139        END-IF
S15507*S10207        IF WA-INPUT-PARAM-TABLE(7) = 1
S15507*S10207           COMPUTE WA-TOTAL-ADV-AMT = BORM-ADV-VAL
S15507*S10207                                    - WA-INPUT-AMT
S12329*S10207           IF BOIS-THRESHOLD-AMT > WA-TOTAL-ADV-AMT
S12329*S10207              MOVE 4600 TO WA-OUTPUT-ERR-MSG-NO
S12329*S10207              MOVE 1    TO WA-MSG-ERR-FLAG
S12329*S10207              GO TO B099-EXIT
S12329*S10207           END-IF
S15507*S10516           COMPUTE WA-INPUT-AMT = WA-INPUT-AMT * -1
S15507*S10207        END-IF
S15507*S10516        IF BORM-ADV-VAL > 0
S15507*S10516           IF BOIS-THRESHOLD-AMT  >
S15507*S10516              (BORM-LOAN-BAL + WA-INPUT-AMT)
S15507*S10516              COMPUTE WA-OD-LIMIT = BOIS-THRESHOLD-AMT -
S15507*S10516                                    (BORM-LOAN-BAL +
S15507*S10516                                     WA-INPUT-AMT)
S15507*S10516           END-IF
S15507*S10516        END-IF
S15507*S10516        IF WA-INPUT-PARAM-TABLE(7) = 1
S15507*S10516           COMPUTE WA-INPUT-AMT = WA-INPUT-AMT * -1
S15507*S10516        END-IF
S10139*S10516 IF WA-INPUT-PARAM-TABLE(7) = 1
S10139*S10516    AND BORM-ADV-VAL       > 0
S15507*S10516        IF BORM-ADV-VAL           > 0
S15507*S10139           AND BOIS-THRESHOLD-AMT > 0
S15507*S10139           MOVE BOIS-SORD-AUTO-DBT-ACCT-NO TO WA-DEP-NO-W
S15507*S10139           MOVE WA-DEP-NO-W TO WA-DEP-NO-X
S15507*S10139           INITIALIZE INOD-DATA-REC
S15507*S10139           MOVE STRT-AREA-SOC-NO       TO INOD-SOC-NO
S15507*S10139           MOVE WA-DEP-NO              TO INOD-DEP-NO
S15507*S10139           MOVE 0                      TO INOD-OD-NO
S15507*S10139           MOVE INOD-KEY               TO DBIOMOD-KEY
S15507*S10139           MOVE 0                      TO DBIOMOD-KEY-NO
S15507*S10139           MOVE "READ"                 TO DBIOMOD-FUNCTION
S15507*S10139           PERFORM Z800-ACCESS-INOD THRU Z809-EXIT
S15507*S10139           IF DBIOMOD-STAT NOT = "****"
S15507*S10139              MOVE 155 TO   WA-OUTPUT-ERR-MSG-NO
S15507*S10139              MOVE 1   TO   WA-MSG-ERR-FLAG
S15507*S10139              GO TO B099-EXIT
S15507*S10139           END-IF
S10139*S10516    COMPUTE WA-OD-LIMIT = BOIS-THRESHOLD-AMT
S10139*S10516                        - BORM-LOAN-BAL
S10139*S10516    IF WA-OD-LIMIT = INOD-TOTAL-LIMIT
S10139*S10516       MOVE ZEROES TO INOD-TOTAL-LIMIT
S15507*S10516              MOVE WA-OD-LIMIT TO INOD-TOTAL-LIMIT
S15507*S10139              MOVE INOD-KEY  TO DBIOMOD-KEY
S15507*S10139              MOVE 0         TO DBIOMOD-KEY-NO
S15507*S10139              MOVE "REWRITE" TO DBIOMOD-FUNCTION
S15507*S10139              PERFORM Z800-ACCESS-INOD THRU Z809-EXIT
S15507*S10139              IF DBIOMOD-STAT NOT = "****"
S15507*S10139                 MOVE 155 TO   WA-OUTPUT-ERR-MSG-NO
S15507*S10139                 MOVE 1   TO   WA-MSG-ERR-FLAG
S15507*S10139                 GO TO B099-EXIT
S15507*S10139              END-IF
S15507*S10139              INITIALIZE INOD-DATA-REC
S15507*S10139              MOVE STRT-AREA-SOC-NO       TO INOD-SOC-NO
S15507*S10139              MOVE WA-DEP-NO              TO INOD-DEP-NO
S15507*S10139              MOVE BOIS-OD-ACCT-NUMBER    TO INOD-OD-NO
S15507*S10139              MOVE INOD-KEY               TO DBIOMOD-KEY
S15507*S10139              MOVE 0                      TO DBIOMOD-KEY-NO
S15507*S10139              MOVE "READ"                 TO DBIOMOD-FUNCTION
S15507*S10139              PERFORM Z800-ACCESS-INOD THRU Z809-EXIT
S15507*S10139              IF DBIOMOD-STAT NOT = "****"
S15507*S10139                 MOVE 155 TO   WA-OUTPUT-ERR-MSG-NO
S15507*S10139                 MOVE 1   TO   WA-MSG-ERR-FLAG
S15507*S10139                 GO TO B099-EXIT
S15507*S10139              END-IF
S10139*S10516       MOVE ZEROES          TO INOD-LIMIT(1)
S15507*S10516              MOVE WA-OD-LIMIT TO INOD-LIMIT(1)
S15507*S10139              MOVE INOD-KEY  TO DBIOMOD-KEY
S15507*S10139              MOVE 0         TO DBIOMOD-KEY-NO
S15507*S10139              MOVE "REWRITE" TO DBIOMOD-FUNCTION
S15507*S10139              PERFORM Z800-ACCESS-INOD THRU Z809-EXIT
S15507*S10139              IF DBIOMOD-STAT NOT = "****"
S15507*S10139                 MOVE 155 TO   WA-OUTPUT-ERR-MSG-NO
S15507*S10139                 MOVE 1   TO   WA-MSG-ERR-FLAG
S15507*S10139                 GO TO B099-EXIT
S15507*S10139              END-IF
S10139*S10516    END-IF
S15507*S10139         END-IF
S16101       IF  BORP-USAGE-LOAN
S16101           PERFORM B300-USAGE-LOAN-PROCESS THRU B300-EXIT
S16101           IF  WA-MSG-ERR-FLAG = 1
S16101               GO TO B099-EXIT
S16101           END-IF
S16101       END-IF
S10139      END-IF
ST0049***** ************************************************  
SC4617*
SC4022***
SC4022*** This codes were transfered from BR0023.COB
SC4022***
SC4022     IF WA-INPUT-PARAM-TABLE(23) = 0 AND                
SC4022*       WA-INPUT-PARAM-TABLE(29) = 1 AND                            SC3577
SC4022        (STRT-WEBLOGIC-IB-TXN OR STRT-FEP-ATM-TXN OR    
S18391         STRT-DIB-TXN OR
S11826         STRT-BIZTALK-IVR-TXN OR STRT-FEDI-GRP)
S11826*SC4022  STRT-BIZTALK-IVR-TXN)
S18391*SAME AS IB TXN
S19952*S18391        IF STRT-DIB-TXN
S19952*S19765*S18391    MOVE 01        TO UT0011CA-CALL-CODE
S19952*S19765           MOVE 05        TO UT0011CA-CALL-CODE
S19952*S18391        END-IF
SC4022        IF STRT-WEBLOGIC-IB-TXN                        
SC4022           IF BOIS-IB-ACCESS-GRANT = "Y"               
S19952           OR PROD-RICHART
SC4022              MOVE 01     TO UT0011CA-CALL-CODE        
SC4022           ELSE
SC4022              MOVE 1      TO WA-MSG-ERR-FLAG         
SC4022              MOVE 3334   TO WA-OUTPUT-ERR-MSG-NO      
SC4022              GO TO B099-EXIT                          
SC4022           END-IF                                     
SC4022        END-IF                                       
S19952        IF STRT-DIB-TXN
S19952           MOVE 05        TO UT0011CA-CALL-CODE
S19952        END-IF
SC4022        IF STRT-FEP-ATM-TXN                         
SC4022*          IF BORM-ATM-FLAG = 0                      SC4944
SC4022*            OR BORM-ATM-FLAG NOT NUMERIC            SC4944
SC4944*          IF BORM-ATM-FLAG = 1                      SC5701
SC5701*S10745    IF BOIS-ATM-CARD-STATUS = 2
SC4022              MOVE 02     TO UT0011CA-CALL-CODE
SC4022*S10745    ELSE
SC4022*S10745       MOVE 1      TO WA-MSG-ERR-FLAG
SC4022*S10745       MOVE 3332   TO WA-OUTPUT-ERR-MSG-NO
SC4022*S10745       GO TO B099-EXIT
SC4022*S10745    END-IF
S10745*S10833    IF BORM-APPRV-DATE NOT < WS-FTR-UNS-CHK-DATE
S18475*S10833    IF BORM-APPLIC-ISSUE-DATE NOT < WS-FTR-UNS-CHK-DATE
S10745              MOVE "Y"      TO UT0011CA-FTR-UNS-FLAG
S18475*S10745    ELSE
S18475*S10745       MOVE SPACES   TO UT0011CA-FTR-UNS-FLAG
S18475*S10745    END-IF
S11610           IF BORM-APPLIC-ISSUE-DATE NOT < WS-OVRS-WD-CHK-DATE
S11610              MOVE "Y"      TO UT0011CA-OVRS-WD-FLAG
S11610           ELSE
S11610              MOVE SPACES   TO UT0011CA-OVRS-WD-FLAG
S11610           END-IF
SC4022        END-IF                                        
SC4022        IF STRT-BIZTALK-IVR-TXN                       
SC4022           IF ALLOW-BOIS-IVR-ACCESS                  
SC4022              MOVE 03     TO UT0011CA-CALL-CODE      
SC4022           ELSE                                      
SC4022              MOVE 1      TO WA-MSG-ERR-FLAG         
SC4022              MOVE 3333   TO WA-OUTPUT-ERR-MSG-NO    
SC4022              GO TO B099-EXIT                       
SC4022           END-IF                                   
SC4022        END-IF                                          
SC4022**SC7091IF STRT-AREA-TRN-NO = 14045 OR 14145
SC4203**SC7091                   OR 11055 OR 11155
SC5620**SC7091                   OR 14050 OR 14150
SC7091**      IF STRT-AREA-TRN-NO = 19050
SC7091        IF STRT-AREA-TRN-NO = 19050 OR 14050
S11422                           OR 19150 OR 14150
SC4022           MOVE TPATM-BALANCE  TO UT0011CA-TRNAMT       
SC4203**SC7091   IF STRT-AREA-TRN-NO = 14045 OR 14145
SC5620**SC7091                      OR 14050 OR 14150
SC4203              MOVE WA-ACCT-NO-TRF-IN TO UT0011CA-CUST-AC-TO9
SC7091              MOVE WA-BANCS-ID-TRF-ACCT TO UT0011CA-BSB-NO
SC4203**SC7091   ELSE
SC4203**SC7091      MOVE SOC-BANK-NO       TO UT0011CA-BSB-NO
SC4203**SC7091      MOVE W800-TO-ACCT      TO UT0011CA-CUST-AC-TO
SC4203**SC7091   END-IF
SC4022        ELSE                                            
SC4022*          MOVE W800-TRF-AMOUNT   TO UT0011CA-TRNAMT           SC3577
SC3577           MOVE WA-INPUT-AMT      TO UT0011CA-TRNAMT    
SC4203           MOVE SOC-BANK-NO       TO UT0011CA-BSB-NO
SC4203           MOVE W800-TO-ACCT      TO UT0011CA-CUST-AC-TO
SC4022        END-IF                                          
SC4022*       MOVE W800-TRF-AMOUNT TO UT0011CA-TRNAMT                SC4203
S11422        IF STRT-AREA-TRN-NO = 19055 OR 14055
S11422                           OR 19155 OR 14155
S11422          MOVE WA-TRF-ATM-TRACE-NO  TO UT0011CA-ATM-TRACE-NO
S11422          MOVE WA-TRF-FISC-TXN-CODE TO UT0011CA-FISC-TXN-CODE
S11422        ELSE
SC3959          MOVE WA-ATM-TRACE-NO  TO UT0011CA-ATM-TRACE-NO
SC3959          MOVE WA-FISC-TXN-CODE TO UT0011CA-FISC-TXN-CODE
S11422        END-IF
SC4022        MOVE W800-FROM-ACCT  TO UT0011CA-CUST-AC-FRM    
SC4022*       MOVE W800-TO-ACCT    TO UT0011CA-CUST-AC-TO            SC4203
SC4022*       MOVE WA-INPUT-PARAM-TABLE(29) TO UT0011CA-BIT29        SC3577
SC3577        MOVE WA-INPUT-PARAM-TABLE(20) TO UT0011CA-BIT29
SC4022        MOVE WA-INPUT-PARAM-TABLE(05) TO UT0011CA-BIT5  
SC7091**      IF   STRT-AREA-TRN-NO = 19050
SC7091        IF   STRT-AREA-TRN-NO = 19050 OR 14050
SC7091             MOVE '1'                 TO UT0011CA-BIT29
SC7091        END-IF
SC4022*       MOVE LOW-VALUE       TO UT0011CA-BSB-NO                SC4203
SC4022        MOVE "LON"           TO UT0011CA-CUST-AC-TO-SYS 
SC5250***
SC5250***     If transcation is correction, reverse the sign.
SC5250***
SC5250        IF WA-INPUT-PARAM-TABLE(7) = 1
SC5250           COMPUTE UT0011CA-TRNAMT = UT0011CA-TRNAMT * (-1)
SC5250        END-IF
SC5250
SC4022        CALL "UT0011" USING UT0011CA-CALL-AREA         
SC5448                            WA-PASSALONG
SC4022                            STARTAREA                  
SC4022        IF UT0011CA-STATUS NOT = 0                     
SC4022           MOVE 1            TO WA-MSG-ERR-FLAG        
SC4022           MOVE UT0011CA-OUT-ERR-MSG-NO TO            
SC4022                WA-OUTPUT-ERR-MSG-NO                  
SC4022           GO TO B099-EXIT                           
SC4022        END-IF                                      
SC4022     END-IF.                                       
      *---------*
TB0260*    IF STRT-FEP-ATM-TXN AND WA-INPUT-PARAM-TABLE(30) = 1       SC4022
TB0260*       AND WA-INPUT-PARAM-TABLE(23) = 0                        SC4022
TB0260*       AND WA-INPUT-PARAM-TABLE(05) = 1                        SC4022
TB0260*       AND WA-INPUT-PARAM-TABLE(29) NOT = 1                    SC4022
TB0260*       MOVE 02             TO UT0011CA-CALL-CODE               SC4022
TB0260*       MOVE ZEROS          TO UT0011CA-CUST-AC-FRM             SC4022
TB0260*       MOVE WA-INPUT-KEY   TO UT0011CA-CUST-AC-TO              SC4022
TB0260*       MOVE WA-INPUT-AMT   TO UT0011CA-TRNAMT                  SC4022
TB0260*       MOVE WA-INPUT-PARAM-TABLE(29) TO UT0011CA-BIT29         SC4022
TB0260*       MOVE WA-INPUT-PARAM-TABLE(05) TO UT0011CA-BIT5          SC4022
SC1368*       MOVE LOW-VALUE      TO UT0011CA-BSB-NO                  SC4022
SC1368*       MOVE "LON"          TO UT0011CA-CUST-AC-TO-SYS          SC4022
TB0260*       CALL "UT0011" USING UT0011CA-CALL-AREA                  SC4022
TB0260*                           STARTAREA                           SC4022
TB0260*       IF UT0011CA-STATUS NOT = 0                              SC4022
TB0260*          MOVE 1 TO WA-MSG-ERR-FLAG                            SC4022
TB0260*          MOVE UT0011CA-OUT-ERR-MSG-NO   TO                    SC4022
TB0260*               WA-OUTPUT-ERR-MSG-NO                            SC4022
TB0260*          GO TO B099-EXIT                                      SC4022
TB0260*       END-IF                                                  SC4022
TB0260*    END-IF.                                                    SC4022
TB0260*
      *---------*
SC7653*   IF  BORP-YOUBE
SC7653*   AND WA-INPUT-PARAM-TABLE(8) NOT = 1
SC7653*    PERFORM Z500-POST-BUCV-BPI THRU Z599-EXIT.
TB0159    IF BORP-YOUBE
SC0905      MOVE WA-ADV-AMOUNT              TO TEMP-ADV-AMOUNT
SC1590      IF WA-INPUT-PARAM-TABLE(7) = 1
SC1590         MULTIPLY -1 BY TEMP-ADV-AMOUNT
SC1590      END-IF
SC0905      COMPUTE WA-OUTSTANDING-BAL = BORM-LOAN-BAL +
SC0905                                   TEMP-ADV-AMOUNT
TB0159      MOVE BOIS-NEXT-DUE-DATE       TO WA-SAVE-NEXT-DUE-DT
SC0905*     IF BORM-ADV-VAL = 0
SC0905*     OR (BORM-ADV-VAL > 0 AND BOIS-NEXT-DUE-DATE = 0)
SC0905      IF (BORM-ADV-VAL = 0
SC9726      OR  BORM-LOAN-BAL NOT > 0
SC0905      OR (BORM-ADV-VAL > 0 AND BOIS-NEXT-DUE-DATE = 0))
SC0905      AND WA-OUTSTANDING-BAL > 0
SC1590      AND WA-INPUT-PARAM-TABLE(7) NOT = 1
TB0159         MOVE 1 TO BOIS-CYCLE-NO
TB0159         PERFORM W100-SET-DUE-DT THRU W199-EXIT
TB0159         MOVE UT0312CA-NEXT-DUE-DT  TO WA-SAVE-NEXT-DUE-DT
SC1590      ELSE
SC1590         IF  WA-OUTSTANDING-BAL = 0
SC1590         AND WA-INPUT-PARAM-TABLE(7) = 1
SC1590             MOVE 0 TO BOIS-NEXT-DUE-DATE
SC5125             MOVE 0 TO BOIS-LAST-UNPAID-DUE-DATE
SC1590             MOVE 0 TO BOIS-PREV-DUE-DATE
S15449*SC8287                       BOIS-RATE-EXP-DATE
SC1590         END-IF
TB0159      END-IF
TB0159*     IF (BOIS-NEXT-DUE-DATE < WA-TODAY-BIN-DATE) AND
SC7942*     IF (BOIS-NEXT-DUE-DATE <= WA-TODAY-BIN-DATE) AND
SC7942      IF (BOIS-NEXT-DUE-DATE < WA-TODAY-BIN-DATE) AND
SC8042            (BORM-LOAN-BAL > 0)
TB0159*           (BORM-ADV-VAL > 0)
SC0394      AND (BOIS-NEXT-DUE-DATE NOT = 0)
ST0049      AND WA-INPUT-PARAM-TABLE(7) NOT = 1
ST0049      AND WA-INPUT-PARAM-TABLE(8) NOT = 1
TB0159         MOVE 1 TO WA-MSG-ERR-FLAG
TB0159         MOVE 144 TO WA-OUTPUT-ERR-MSG-NO
TB0159         GO TO B099-EXIT
TB0159      END-IF
ST0049      IF WA-INPUT-PARAM-TABLE(8) = 1
ST0049      AND BOIS-NEXT-DUE-DATE NOT = 0
ST0049         MOVE WA-ADV-TXN-DATE TO UT0030-DATE-DDMMCCYY
ST0049         MOVE 1               TO UT0030-FUNCTION
ST0049         CALL "UT0030"     USING UT0030-FUNCTION
ST0049                                 UT0030-DATE-AREA
ST0049                                 UT0030-BINARY-DATE
ST0049*        IF BOIS-NEXT-DUE-DATE < UT0030-BINARY-DATE
SC7942*        IF BOIS-NEXT-DUE-DATE <= UT0030-BINARY-DATE
SC7942         IF BOIS-NEXT-DUE-DATE < UT0030-BINARY-DATE
ST0049            MOVE 1            TO WA-MSG-ERR-FLAG
ST0049            MOVE 144          TO WA-OUTPUT-ERR-MSG-NO
ST0049            GO TO B099-EXIT
ST0049         END-IF
ST0049      END-IF
TB0159      COMPUTE WA-AVAILABLE-LIMIT = BOIS-ACCOUNT-LIMIT -
TB0159                                   BORM-LOAN-BAL      -
S11455                                   BOIS-HOLD-AMT      -
S11455                                   BOIS-UNAMORTIZED-DUE
SC5624***
SC5624*** DO NOT CHECK FOR THE AVAILABLE BALANCE IF CORRECTION/FROM TPS
SC5624***
SC9150*** DO NOT CHECK FOR THE AVAILABLE BALANCE IF YOUBE-REPOST
TB0159         IF WA-ADV-AMOUNT > WA-AVAILABLE-LIMIT
S11455         AND (WA-ADV-AMORT-FLAG NOT = "A" AND
S11455              WA-ADV-AMORT-FLAG NOT = "F" AND
S11455              WA-ADV-AMORT-FLAG NOT = "R")   
SC7464*           IF STRT-ASYNC-TPS AND
SC7464            IF WA-INPUT-PARAM-TABLE(7) = 1
SC9150               OR (STRT-REPOST-TXN AND BORP-YOUBE)
SC5624               CONTINUE
SC5624            ELSE
TB0159               MOVE 1 TO WA-MSG-ERR-FLAG
TB0159*SC4263        MOVE 166 TO WA-OUTPUT-ERR-MSG-NO
SC4263               MOVE 4174 TO WA-OUTPUT-ERR-MSG-NO
TB0159               GO TO B099-EXIT
SC5624           END-IF
TB0159         END-IF
SC0905*     MOVE WA-ADV-AMOUNT              TO TEMP-ADV-AMOUNT
SC0905*     COMPUTE WA-OUTSTANDING-BAL = BORM-LOAN-BAL +
SC0905*                                  TEMP-ADV-AMOUNT
TB0159      MOVE STRT-AREA-POST-DT          TO UT0020-BINARY-DATE
TB0159      PERFORM Z110-CONVERT-BINARY-TO-DATE THRU Z119-EXIT
TB0159      MOVE UT0020-DATE-CCYYMMDD       TO WA-TODAYS-DATE       
TB0159*     MOVE UT0020-DATE-CCYYMMDD       TO BMPT-EFFECTIVE-DATE
TB0159
SC0399*     PERFORM Z100-CALCULATE-MIN-DUE-AMT THRU Z109-EXIT
SC0399*     MOVE WA-MIN-DUE-AMT            TO BOIS-MIN-DUE-AMOUNT
TB0159      SET ADD-TO-BUCKET-ONLY TO TRUE
TB0159*
SC1256      MOVE 0                 TO WA-TOT-FEE-AMT
S10329      MOVE 0                 TO WA-DIS-FEE-AMT
ST0049      IF WA-INPUT-PARAM-TABLE(8) NOT = 1
TB0236         PERFORM D600-YOUBE-STRT-METHOD THRU D699-EXIT
ST0049      END-IF
SC0905      IF WA-OUTSTANDING-BAL > 0
SC1590      OR WA-INPUT-PARAM-TABLE(7) = 1
SC1023       IF NOT (STRT-AREA-TRN-NO = 11055 AND
                      WA-ADV-PROMO = 'XX') AND
SC6395          NOT (WA-INPUT-PARAM-TABLE(7) = 1 AND
SC6395               WA-INPUT-PARAM-TABLE(8) = 1)
SC5099          PERFORM D700-MNGMENT-FEE THRU D799-EXIT
SC5099**move this to D700-MNGMENT-FEE para
TB0159*       IF BOIS-PROMO-CODE = SPACES
TB0159*           INITIALIZE UTCIEPCA-CALL-PARAM
TB0159*           MOVE 02 TO UTCIEPCA-CALL-CODE
TB0159*           MOVE STRT-AREA-SOC-NO TO UTCIEPCA-SOC-NO
TB0159*           MOVE BORP-FEE-TYPE    TO UTCIEPCA-TYPE
TB0159*           CALL "UTCIEP" USING      UTCIEPCA-CALL-PARAM
TB0159*           IF UTCIEPCA-CALL-STATUS NOT = 0
TB0159*              MOVE 188 TO WA-OUTPUT-ERR-MSG-NO
TB0159*              MOVE 1                   TO WA-MSG-ERR-FLAG
TB0159*              GO TO B099-EXIT
TB0159*           END-IF
TB0159*           MOVE UTCIEPCA-STD-AMOUNT TO  WA-TOT-FEE-AMT
TB0159*     ELSE
TB0159*         MOVE WA-INPUT-ACCT-NO TO BAFM-ACCT-NO
TB0159*         MOVE BOIS-PROMO-CODE  TO BAFM-PROMO-CODE
TB0159*         MOVE 0 TO BAFM-FEE-TYPE
TB0159*         PERFORM Z200-BAFM-PROCESSING
TB0159*                 THRU Z399-READ-BAFM-EXIT
SC5099**end
TB0159       END-IF
TB0159      END-IF
SC1600       IF NOT (STRT-AREA-TRN-NO = 11055 AND 
SC1600          WA-ADV-PROMO = 'XX')
ST0079       AND WA-TOT-FEE-AMT NOT = ZEROES
SC8285       AND WA-INPUT-PARAM-TABLE(8) NOT = 1  
S11455       AND WA-ADV-AMORT-FLAG NOT = "A"
S11455       AND WA-ADV-AMORT-FLAG NOT = "F"
S11455       AND WA-ADV-AMORT-FLAG NOT = "R"
TB0159          PERFORM M500-CALL-UT0074 THRU M599-UT0074-EXIT
SC6395       ELSE
SC6395          IF  WA-INPUT-PARAM-TABLE(7) = 1
SC6395              MOVE WA-ADV-TXN-DATE       TO UT0030-DATE-DDMMCCYY
SC6395              MOVE 1                     TO UT0030-FUNCTION
SC6395              CALL "UT0030"           USING UT0030-FUNCTION
SC6395                                            UT0030-DATE-AREA
SC6395                                            UT0030-BINARY-DATE
SC6395              MOVE UT0030-BINARY-DATE    TO WA-STORE-TXN-DT
SC6395              PERFORM M500-CALL-UT0074 THRU M599-UT0074-EXIT
SC6395          END-IF
SC1600       END-IF
SC0905*     END-IF
ST0049      IF WA-INPUT-PARAM-TABLE(8) NOT = 1
S11455      AND WA-ADV-AMORT-FLAG NOT = "S"
TB0159         COMPUTE BOIS-YET-COLLECT-INT = BOIS-INTEREST-DUE +
TB0159                                        BORM-INT-ACCR
TB0159         MOVE WA-TODAY-BIN-DATE    TO BOIS-LAST-UNPAID-INT-DT
SC0883*        PERFORM Z100-CALCULATE-MIN-DUE-AMT THRU Z109-EXIT
SC0883*        MOVE WA-MIN-DUE-AMT            TO BOIS-MIN-DUE-AMOUNT
ST0049      END-IF
TB0159    END-IF.
TB0159*
014580     IF STRT-AREA-LEDG-CODE = 1 OR 4 
TB0084                                OR 8
014590        NEXT SENTENCE
014600     ELSE MOVE 1 TO WA-MSG-ERR-FLAG
014610          MOVE 193 TO WA-OUTPUT-ERR-MSG-NO
014620          GO TO B099-EXIT.
014630** 74I012 BEGIN ***
014640* WSK 27/02/98 HEL001 - IF TP ORIGINATED FINANCIAL TXN THEN
014650* CONTINUE PROCESSING.  THE SUB-LEDG-CODE CHECK IS NOT PERFORMED
014660* AS TP DOES NOT PASS A SLC.  IF THIS PROGRAM DOES NOT POPULATE
014670* THE VARIABLE IT WILL WRITE AS A 0.
014680* 74I012 RETROFIT
014690     IF STRT-AREA-OTHER-OVERRIDE = "7" AND                               
014700        WA-INPUT-PARAM-TABLE(30) = 1
014710          NEXT SENTENCE
014720     ELSE
TB0255        IF STRT-AREA-TRN-NO = 16055
TB0255           MOVE 1 to WA-ADV-SUB-LEDG-CODE
TB0255        END-IF
SC3801        IF STRT-FEP-ATM-TXN AND WA-ADV-SUB-LEDG-CODE = 00
SC3801           MOVE 1 TO WA-ADV-SUB-LEDG-CODE
SC3801        END-IF
014730         IF  WA-ADV-SUB-LEDG-CODE < 1 OR
014740             WA-ADV-SUB-LEDG-CODE > 30
014750             MOVE 1 TO WA-MSG-ERR-FLAG
014760             MOVE 194 TO WA-OUTPUT-ERR-MSG-NO
014770             GO TO B099-EXIT
014780         END-IF
014790     END-IF.
014800*** 74I012 END ***
014810*AXS
014820     IF BORM-LOC-IND = 1
014830        PERFORM Z1000-RETRIEVE-BBLC   THRU Z1099-EXIT
014840         IF WA-MSG-ERR-FLAG = 1
014850           GO TO B099-EXIT
014860         END-IF
014870     ELSE
014880     IF BORM-LOC-IND = 0
014890        MOVE ZEROS                   TO BBLC-LOC-ACCT-NO
014900                                        BBLC-LOC-DT
014910        MOVE SPACES                  TO BBLC-LOC-ID-DOC
014920                                        BBLC-LOC-ID-NO.
014930     IF  BORM-INS-IND = 1
014940       PERFORM Z1100-RETRIEVE-BINS       THRU Z1199-EXIT
014950       IF  WA-MSG-ERR-FLAG = 1
014960           GO TO B099-EXIT
014970       END-IF
014980     ELSE
014990     IF  BORM-INS-IND = 0
SC4624                     OR 2
015000       MOVE "0"                   TO BINS-CODE
015010       MOVE  0                    TO BINS-PREMIUM
015020                                     BINS-CUST-NO.
015030*AXS
015040***AXS
015050** TO CHECK IF THIS TXN. IS A CORRECTION TXN. OR RESULTS IN
015060**  ADVANCED VALUE EQUALS ZERO.
TB0082**--
TB0082** this lines of code is for the first drawdown and for the correction
TB0082** of the first drawdownd.
TB0082**--
015070     IF BORM-ADV-VAL = 0 OR
015080        (WA-INPUT-PARAM-TABLE(7) = 1 AND
TB0082         WA-ADV-AMOUNT = BORM-ADV-VAL)
015090       MOVE 1 TO WA-ADV-COUNT
TB0082     END-IF.
015100**AXS
015110     MOVE STRT-AREA-TRN-NO  TO  WA-TRAN-NO.
015120     IF REDRAW-REFUND-TRAN
015130        IF (BORM-REDRAW-IND = "0" OR  "1")
015140           OR  (BORP-REDRAW-IND = "0"  OR  "1")
015150           NEXT SENTENCE
015160        ELSE
015170           MOVE 3073 TO WA-OUTPUT-ERR-MSG-NO
015180           MOVE 1 TO WA-MSG-ERR-FLAG
015190           GO TO B099-EXIT.
015200     IF ((BORP-CAPN-METHOD NOT = " ")
015210     AND (BORP-CAPN-METHOD IS ALPHABETIC)
015220     AND (WA-INPUT-PARAM-TABLE(7) NOT = 1)
015230     AND (BORP-PRINC-REDUCT-IND = 1))
015240        IF WA-ADV-AMOUNT = BORM-PRINC-REDUCT-EFF OR
015250           WA-ADV-AMOUNT < BORM-PRINC-REDUCT-EFF
015260           MOVE 554  TO WA-OUTPUT-ERR-MSG-NO
015270           MOVE 1 TO WA-MSG-ERR-FLAG
015280           GO TO B099-EXIT.
015290********   TEMPORARY CHECKING OF TRN NO UNTIL PBR IS MODULARISED
015300     IF (STRT-AREA-TRN-NO = 10171 OR 15171)
015310     AND (WA-CORR-LOC-ACCT NOT = 0)
015320         PERFORM M900-VALIDATE-READ-LOC THRU M999-EXIT.
015330     IF WA-MSG-ERR-FLAG = 1
015340         GO TO B099-EXIT.
015350*
SC4944***
SC4944*** NOT USED FOR THIS SYSTEM
SC4944***
015360*    IF (WA-INPUT-PARAM-TABLE(30) = 1                                    
015370*    OR  STRT-AREA-OTHER-OVERRIDE = "7")                                 
015380*    AND (BORM-ATM-FLAG = 1)                                             
015390*       MOVE 9            TO BORM-ATM-FLAG.                              
015400*
015410     PERFORM L100-VALIDATE-INPUT THRU L199-EXIT.
SC0941****START-FAD
           IF  ( STRT-AREA-TRN-NO = 16055 ) AND
               ( WS-ERR-Y )
015500             MOVE 1 TO WA-MSG-ERR-FLAG
015510             MOVE 3360 TO WA-OUTPUT-ERR-MSG-NO
015520             GO TO B099-EXIT
           END-IF.
SC0941****END-FAD
015420     IF SOC-LIMIT-PROCESS-IND = "2"
015430        PERFORM W1000-CHECK-LIMITS THRU W1099-EXIT
015440        IF WA-MSG-ERR-FLAG = 1
015450           GO TO B099-EXIT
015460        END-IF
015470     END-IF.
015480     IF WA-INPUT-PARAM-TABLE(8) = 1
SC8881       IF NOT BORP-YOUBE
015490         IF UT0030-BINARY-DATE < BORM-APPRV-DATE
SC9192           AND NOT STRT-REPOST-TXN
015500             MOVE 1 TO WA-MSG-ERR-FLAG
015510             MOVE 2211 TO WA-OUTPUT-ERR-MSG-NO
015520             GO TO B099-EXIT
SC8881         END-IF
SC8881       END-IF
SC8881       IF BORP-YOUBE
SC8881          IF UT0030-BINARY-DATE < BOIS-CARD-USED-DATE
SC9192           AND NOT STRT-REPOST-TXN
SC8881             MOVE 1 TO WA-MSG-ERR-FLAG
SC8881             MOVE 2211 TO WA-OUTPUT-ERR-MSG-NO
SC8881             GO TO B099-EXIT
SC8881          END-IF

S18318          IF (WA-INPUT-PARAM-TABLE (7) = 0
S18318          AND UT0030-BINARY-DATE       < BOIS-ARRS-FLAG-CHNG-DT)
S18318          OR (WA-INPUT-PARAM-TABLE (7) = 1
S18318          AND UT0030-BINARY-DATE      <= BOIS-ARRS-FLAG-CHNG-DT)
S18318             IF NOT STRT-REPOST-TXN
S18318                MOVE 1 TO WA-MSG-ERR-FLAG
S18318                MOVE 4759 TO WA-OUTPUT-ERR-MSG-NO
S18318                GO TO B099-EXIT
S18318             END-IF
S18318          END-IF
SC8881       END-IF
SC8881     END-IF.

015530     IF  WA-DUMMY-AMT = ZERO
015540         MOVE 1 TO WA-MSG-ERR-FLAG
015550         MOVE 318 TO WA-OUTPUT-ERR-MSG-NO
015560         GO TO B099-EXIT.
015570*
015580*    IF  (BORM-CAPN-METHOD = "B" OR
015590*             (BORM-CAPN-METHOD = " " AND
015600*               BORP-CAPN-METHOD = "B"))
015610*    AND
015620*        BORM-REPAY-FREQ = 98
015630*    AND
015640*        BORP-CAPN-FREQ = 98
015650*    AND
015660*        BORP-ACCRUE-METHOD = "D"
015670     IF  BORP-PARTIAL-ADV-ALLOWED  = "N"
TB0020     AND BOIS-CREDIT-TYPE = "F"
TP0033     AND WA-INPUT-PARAM-TABLE(7) NOT EQUAL 1
015680*        IF WA-ADV-AMOUNT NOT = BORM-APP-AMT                             
015690**TB0020 IF WA-ADV-AMOUNT < BORM-APP-AMT                                 
TB0020         IF BORM-ADV-VAL > 0
015700            MOVE 1 TO WA-MSG-ERR-FLAG
015710            MOVE SPACES TO WA-OUTPUT-MSG                                 
015720            MOVE "PARTIAL ADVANCE NOT ALLOWED" TO                        
015730                 WA-OUTPUT-MSG                                           
015740            MOVE 0899 TO WA-OUTPUT-ERR-MSG-NO                            
015750*SUP004     MOVE 3079 TO WA-OUTPUT-ERR-MSG-NO
015760            GO TO B099-EXIT
015770         END-IF
015780     END-IF.
015790*
015800     IF  BORP-PARTIAL-ADV-ALLOWED  = "N"                                
TB0020     AND BOIS-CREDIT-TYPE = "F"
TP0033     AND WA-INPUT-PARAM-TABLE(7) NOT EQUAL 1
015810**       IF WA-ADV-AMOUNT > BORM-APP-AMT                                
TB0020         IF BORM-ADV-VAL > 0
015820            MOVE 1 TO WA-MSG-ERR-FLAG                                   
015830            MOVE SPACES TO WA-OUTPUT-MSG                                
015840            MOVE "ADVANCE AMOUNT GREATER THAN APPROVED AMT"             
015850                      TO  WA-OUTPUT-MSG                                 
015860            MOVE 0899 TO WA-OUTPUT-ERR-MSG-NO                           
015870            GO TO B099-EXIT                                             
015880         END-IF                                                         
015890     END-IF.                                                            

015910     IF  BORP-PRINC-REDUCT-IND = 1 AND
015920         (BORM-LOAN-BAL  = 0) AND
015930         (BORM-PRINC-REDUCT-EFF > 0)
015940         MOVE 1  TO WA-MSG-ERR-FLAG
015950         MOVE 553  TO WA-OUTPUT-ERR-MSG-NO
015960         GO TO B099-EXIT.
015970     MOVE 0 TO WA-PPP-INITIAL-ADVANCE
015980               WA-BAL-BEFORE-COMMISSION
015990               WA-COMMISSION-AMOUNT.
016000*
016010     PERFORM X700-SP-COND-COMPLY-CHK THRU X799-EXIT.
016020     IF WA-MSG-ERR-FLAG = 1
016030        GO TO B099-EXIT.
016040***  CONDITIONAL CALL FOR "UT0500" ******************************       
016050***  SOC-DISPLAY-NAME WAS INTRODUCED TO SUPRESS NAME FROM               
016060***  ON LINE SCREEN AND RECEIPT PRINTING. HOWEVER,                      
016070***  CHEQUE TYPE AND/OR PASSBOOK TRANSACTION SHOULD CALL                
016080***  "UT0500" TO RETRIEVE NAME PROPERLY.                                
016090***                                                                     
016100*    MOVE BORM-MEMB-CUST-AC TO UT0500CA-CUSM-NO.                        
016110*    PERFORM X400-CALL-UT0500 THRU X499-EXIT.                           
016120*    IF  UT0500RA-CALL-STATUS NOT = 0                                   
016130*        MOVE UT8500CA-FUNC-NORMAL-DISPLAY                              
016140*          TO UT8500CA-CALL-CODE                                        
016150*        MOVE SPACES TO UT8500CA-INPUT-MSG                              
016160*        STRING "BR0024:(M000)  "                                       
016170*               " ERROR READING CUSV "                                  
016180*                 UT0500CA-CUSM-NO " " UT0500RA-CALL-STATUS             
016190*           DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG                   
016200*        CALL "UT8500" USING                                            
016210*                                                                       
016220*            UT8500CA-AREA.                                             
016230*    IF UT0500RA-ERR-MSG-NO > 0                                         
016240*        MOVE 271                TO UT0060CA-CALL-ERROR-CODE            
016250*        PERFORM Y000-OVERRIDABLE-ERROR-CHECK THRU Y090-EXIT            
016260*        IF WA-MSG-ERR-FLAG = 0                                         
016270*          MOVE 271              TO WA-ERR-MSG-NO                       
016280*        ELSE                                                           
016290*          MOVE 271              TO WA-OUTPUT-ERR-MSG-NO                
016300*          MOVE 1                TO WA-MSG-ERR-FLAG                     
016310*          GO TO B099-EXIT.                                             
016320*800058 STARTS*                                                         
016330     IF ( WA-INPUT-PARAM-TABLE(10) = 1) OR                              
016340        ((WA-INPUT-PARAM-TABLE(10) = 0) AND                             
016350         (SOC-DISPLAY-NAME  = "Y"))                                     
016360          MOVE BORM-MEMB-CUST-AC TO UT0500CA-CUSM-NO                    
016370          PERFORM X400-CALL-UT0500 THRU X499-EXIT                       
016380          IF  UT0500RA-CALL-STATUS NOT = 0                              
016390              MOVE UT8500CA-FUNC-NORMAL-DISPLAY                         
016400                TO UT8500CA-CALL-CODE                                   
016410              MOVE SPACES TO UT8500CA-INPUT-MSG                         
016420              STRING "BR0024:(M000)  "                                  
016430                     " ERROR READING CUSV "                             
016440                       UT0500CA-CUSM-NO " " UT0500RA-CALL-STATUS        
016450              DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG                 
016460              CALL "UT8500" USING                                       
016470                    UT8500CA-AREA                                       
016480          END-IF                                                        
016490          IF UT0500RA-ERR-MSG-NO = 121                                  
016500             MOVE 121                 TO WA-OUTPUT-ERR-MSG-NO           
016510             MOVE 1                   TO WA-MSG-ERR-FLAG                
016520             GO TO B099-EXIT                                            
016530          END-IF                                                        
016540          IF  UT0500RA-ERR-MSG-NO > 0                                   
016550              MOVE 271                TO UT0060CA-CALL-ERROR-CODE       
016560              PERFORM Y000-OVERRIDABLE-ERROR-CHECK THRU Y090-EXIT       
016570              IF WA-MSG-ERR-FLAG = 0                                    
016580                MOVE 271              TO WA-ERR-MSG-NO                  
016590              ELSE                                                      
016600                MOVE 271              TO WA-OUTPUT-ERR-MSG-NO           
016610                MOVE 1                TO WA-MSG-ERR-FLAG                
016620                GO TO B099-EXIT                                         
016630              END-IF                                                    
016640          END-IF                                                        
016650     END-IF.                                                            
016660*800058 END*                                                            
016670     IF WA-MSG-ERR-FLAG = 1
016680        GO TO B099-EXIT.
016690*
016700     MOVE 0                      TO WA-BORM-INS-PREMIUM.
016710     MOVE 0                      TO WA-BORM-LOAN-BAL-EX-PPP.
016720*
S16081*016730     IF STRT-AREA-TRN-NO = 13509 OR 13609
S16081     IF STRT-AREA-TRN-NO = 13509 OR 13609 OR 13730 OR 13830
016740        PERFORM M1200-DEB-CRD-COMMISSION THRU M1299-EXIT
016750        IF WA-MSG-ERR-FLAG = 1
016760           GO TO B099-EXIT
016770        ELSE
016780           GO TO B020.
016790     IF NOT (REDRAW-REFUND-TRAN)
016800     IF  BORM-APP-AMT > 0
016810         IF  BORM-APP-AMT > BORM-ADV-VAL
016820             NEXT SENTENCE
016830         ELSE IF  BORM-ADD-LOAN-CDE NOT = 0
016840                  IF  WA-INPUT-PARAM-TABLE (7) NOT = 1
016850                      PERFORM M600-ADD-ADV THRU M699-EXIT
016860                      GO TO B099-EXIT.
016870*  FOR UPFRONT LOANS ADVANCE AMOUNT CAN NOT BE > APPROVAL
016880*  SEND ERROR MESSAGE AND EXIT. NO SUP. OVERIDE ALLOWED.

TB0020**--TIBs Multiple Drawdown

           IF BORP-COMML
S16871     AND NOT BORP-CORPORATION
S19269     AND NOT BORP-PB
S20771     AND NOT BORP-FBOND
              PERFORM W1000-CHECK-LIMITS
                 THRU W1099-EXIT
TB0020***-- coding changed 040703
              INITIALIZE FACM-KEY
              MOVE STRT-AREA-SOC-NO   TO FACM-INST-NO
              MOVE ACFR-FACILITY-NO   TO FACM-FACILITY-NO
              MOVE FACM-KEY           TO DBIO-CALL-KEY-AREA

              PERFORM D800-READ-FACM
                 THRU D899-EXIT

              IF WA-MSG-ERR-FLAG = 1
                 GO TO B099-EXIT
              END-IF

              INITIALIZE FACD-ALT1-KEY
              MOVE STRT-AREA-SOC-NO     TO FACD-ALT1-INST-NO
              MOVE ACFR-FACILITY-NO     TO FACD-ALT1-FACILITY-NO
              MOVE ACFR-FAC-REF-CODE    TO FACD-ALT1-REF-CODE
              MOVE FACD-ALT1-KEY        TO DBIO-CALL-KEY-AREA

              PERFORM D500-READ-FACD
                 THRU D599-EXIT

              IF WA-MSG-ERR-FLAG = 1
                 GO TO B099-EXIT
              END-IF

SC3995** FOR COMML LOAN THE VALIDATION ABOUT TEMPORARY LIMIT
SC3995** IS TRANSFERED TO UT0681
SC3995*       IF WA-TEMP-EXP-DATE > STRT-AREA-POST-DT
SC3995*          COMPUTE WA-TEMP-TOTAL-LOAN-AMT EQUAL
SC3995*                  BORM-APP-AMT + WA-TEMP-LMT-AMT
SC3995*       ELSE
                 MOVE BORM-APP-AMT TO WA-TEMP-TOTAL-LOAN-AMT
SC3995*       END-IF
           ELSE
              MOVE BORM-APP-AMT TO WA-TEMP-TOTAL-LOAN-AMT
           END-IF.

           IF NOT (REDRAW-REFUND-TRAN) AND
              NOT (STRT-AREA-TRN-NO = 11064)
              IF WA-INPUT-PARAM-TABLE(7) = 0 AND
                 WA-INPUT-PARAM-TABLE(4) = 0
                 IF BOIS-CREDIT-TYPE = "F" OR "M"
                    IF BOIS-CREDIT-TYPE = "F" AND
                       BORM-STAT > 05
                       MOVE 3488 TO WA-OUTPUT-ERR-MSG-NO
                       MOVE 1    TO WA-MSG-ERR-FLAG
                       GO TO B099-EXIT
                    END-IF 
                    IF (WA-DUMMY-AMT + BORM-ADV-VAL) >
                       WA-TEMP-TOTAL-LOAN-AMT AND
                       WA-TEMP-EXP-DATE <= STRT-AREA-POST-DT
                       MOVE 3564 TO WA-OUTPUT-ERR-MSG-NO
                       MOVE 1    TO WA-MSG-ERR-FLAG
                       GO TO B099-EXIT
                    END-IF 
                 ELSE
                    IF BOIS-CREDIT-TYPE = "R"
S10614*                IF (WA-DUMMY-AMT + BORM-LOAN-BAL) >
S10614                 IF (WA-DUMMY-AMT + BORM-LOAN-BAL
S10614                                  + BOIS-HOLD-AMT) >
                          WA-TEMP-TOTAL-LOAN-AMT AND
                          WA-TEMP-EXP-DATE <= STRT-AREA-POST-DT
                          MOVE 3564 TO WA-OUTPUT-ERR-MSG-NO
                          MOVE 1    TO WA-MSG-ERR-FLAG
                          GO        TO B099-EXIT
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-IF.
TB0020**--
016890     IF NOT (REDRAW-REFUND-TRAN) AND NOT
016900            (STRT-AREA-TRN-NO = 11064)                                   
TB0020**--
              IF BOIS-CREDIT-TYPE = "R"
S10614*          IF (WA-DUMMY-AMT + BORM-LOAN-BAL) >
S10614           IF (WA-DUMMY-AMT + BORM-LOAN-BAL + BOIS-HOLD-AMT) >
                     WA-TEMP-TOTAL-LOAN-AMT
SC9192              AND NOT STRT-REPOST-TXN
S10075              AND WA-INPUT-PARAM-TABLE(7) = 0 
S11455              AND (WA-ADV-AMORT-FLAG NOT = "A" AND
S11455                   WA-ADV-AMORT-FLAG NOT = "F" AND
S11455                   WA-ADV-AMORT-FLAG NOT = "R")   
                    MOVE 557 TO WA-OUTPUT-ERR-MSG-NO
                    MOVE 1   TO WA-MSG-ERR-FLAG
                    GO TO B099-EXIT
                 END-IF
              ELSE
                 IF BOIS-CREDIT-TYPE = "F" OR "M"
                    IF WA-INPUT-PARAM-TABLE(7) = 0 AND
                       WA-INPUT-PARAM-TABLE(4) = 0
                       IF BOIS-CREDIT-TYPE = "F" AND
                          BORM-STAT > 05
                          MOVE 3488 TO WA-OUTPUT-ERR-MSG-NO
                          MOVE 1    TO WA-MSG-ERR-FLAG
                          GO TO B099-EXIT
                       END-IF
                    END-IF
                    IF (WA-DUMMY-AMT + BORM-ADV-VAL) >
                        WA-TEMP-TOTAL-LOAN-AMT
SC9192                 AND NOT STRT-REPOST-TXN
S11455                 AND (WA-ADV-AMORT-FLAG NOT = "A" AND 
S11455                      WA-ADV-AMORT-FLAG NOT = "F" AND 
S11455                      WA-ADV-AMORT-FLAG NOT = "R")    
                       MOVE 557 TO WA-OUTPUT-ERR-MSG-NO
                       MOVE 1   TO WA-MSG-ERR-FLAG
                       GO TO B099-EXIT
                    END-IF
S18816              IF BOIS-CREDIT-TYPE = "M"
S18816                 AND PROD-SEC-MOR-REVERSE
S18816                 AND WA-INPUT-PARAM-TABLE(7) = 0
S18816                 COMPUTE WA-MULTI-ADV-AMT ROUNDED =
S18816                         BORM-APP-AMT / BOIS-STRETCH-TERM
S18816                 IF (BORM-ADV-VAL  + WA-MULTI-ADV-AMT ) >
S18816                     BORM-APP-AMT
S18816                     COMPUTE WA-MULTI-ADV-AMT ROUNDED =
S18816                     BORM-APP-AMT  - BORM-ADV-VAL
S18816                 END-IF
S18869                 IF  (BOIS-NEXT-DUE-DATE  =  BOIS-MATURITY-DATE)
S18869                 AND (BORM-APP-AMT        >  BORM-ADV-VAL)
S18869                      COMPUTE WA-MULTI-ADV-AMT ROUNDED =
S18869                              BORM-APP-AMT  -  BORM-ADV-VAL
S18869                 END-IF
S18816                 IF  WA-MULTI-ADV-AMT NOT = WA-DUMMY-AMT
S18816                     EXHIBIT NAMED WA-MULTI-ADV-AMT,
S18816                     WA-DUMMY-AMT
S18816                     MOVE 1883 TO WA-OUTPUT-ERR-MSG-NO
S18816                     MOVE 1    TO WA-MSG-ERR-FLAG
S18816                     GO TO B099-EXIT
S18816                 END-IF
S18816              END-IF
                 END-IF
              END-IF.
S11455                                                          
S11455     IF  BORP-YOUBE                                       
S11455     AND (WA-ADV-AMORT-FLAG = "F" OR                      
S11455          WA-ADV-AMORT-FLAG = "R")                        
S11455     AND WA-INPUT-PARAM-TABLE(7) = 0
S12026*S11455        IF  WA-ADV-AMOUNT NOT = BOIS-UNAMORTIZED-DUE
S12026*S11455        AND WA-ADV-AMORT-FLAG = "F"
S12026*S11455           MOVE 4646 TO WA-OUTPUT-ERR-MSG-NO
S12026*S11455           MOVE 1   TO WA-MSG-ERR-FLAG
S12026*S11455           GO TO B099-EXIT
S12026*S11455        END-IF
S11455        MOVE WA-ADV-TXN-DATE       TO UT0030-DATE-DDMMCCYY
S11455        MOVE 1                     TO UT0030-FUNCTION     
S11455        CALL "UT0030"           USING UT0030-FUNCTION     
S11455                                      UT0030-DATE-AREA    
S11455                                      UT0030-BINARY-DATE  
S11455        IF  WA-INPUT-PARAM-TABLE(8) = 1                   
S11455        AND STRT-AREA-POST-DT > BOIS-NEXT-DUE-DATE        
S11455        AND UT0030-BINARY-DATE NOT = BOIS-NEXT-DUE-DATE   
S11455        AND BOIS-NEXT-DUE-DATE > 0                        
S11455        AND WA-ADV-AMORT-FLAG = "F"                       
S11455           MOVE 126  TO WA-OUTPUT-ERR-MSG-NO              
S11455           MOVE 1   TO WA-MSG-ERR-FLAG                    
S11455           GO TO B099-EXIT                                
S11455        END-IF                                            
S11455        IF  WA-INPUT-PARAM-TABLE(8) = 1                
S11455        AND UT0030-BINARY-DATE NOT = BOIS-NEXT-DUE-DATE
S11455        AND UT0030-BINARY-DATE NOT = BOIS-MATURITY-DATE
S11455        AND WA-ADV-AMORT-FLAG = "R"                    
S11455           MOVE 126  TO WA-OUTPUT-ERR-MSG-NO           
S11455           MOVE 1   TO WA-MSG-ERR-FLAG                 
S11455           GO TO B099-EXIT                             
S11455        END-IF                                         
S11455     END-IF.                                           
S11455                                                       
TB0020**-- Starts Here
      **-- Comment out these lines of codes to give way to the Credit Type
016910*    IF WA-DUMMY-AMT > BORM-APP-AMT OR
016920**   IF (WA-DUMMY-AMT + BORM-ADV-VAL) >
016930*----760416-----START--------------------------------------
016940*       (BORM-APP-AMT + BORM-ADD-LOAN-APP)
016950**       BORM-APP-AMT
016960*----760416-----END----------------------------------------
016970**      MOVE 557 TO WA-OUTPUT-ERR-MSG-NO
016980**      MOVE 1   TO WA-MSG-ERR-FLAG
016990**      GO TO B099-EXIT.
TB0020**-- Ends Here
017000     IF REDRAW-REFUND-TRAN
017010*       IF WA-DUMMY-AMT > BORP-MAX-WDL
017020        IF WA-ADV-AMOUNT > BORP-MAX-WDL
017030           MOVE 3074 TO WA-OUTPUT-ERR-MSG-NO
017040           MOVE 1   TO WA-MSG-ERR-FLAG
017050           GO TO B099-EXIT
017060        ELSE
017070*          IF WA-DUMMY-AMT < BORP-MIN-WDL
017080           IF WA-ADV-AMOUNT < BORP-MIN-WDL
017090              MOVE 3075 TO WA-OUTPUT-ERR-MSG-NO
017100              MOVE 1   TO WA-MSG-ERR-FLAG
017110              GO TO B099-EXIT.
017120     IF REDRAW-REFUND-WITH-TRAN OR BACKDATED-REDRAW-TRAN
017130        MOVE 0 TO WA-HOLD-AMT
NR2001*017140        MOVE 31 TO DBIO-CALL-TXN-TYPE
017150        PERFORM W300-READ-STOP-HOLD-TRAN THRU W399-EXIT
017160*       IF  DBIO-CALL-STATUS = "****"
017170*           MOVE BORV-31-HOLD-VAL TO WA-HOLD-AMT
017180*       END-IF
017190        COMPUTE WA-DUMMY-AMT2 = BORM-THEO-LOAN-BAL
017200                              - BORM-LOAN-BAL
017210                              - BORM-DUE-AMT
017220                              + BORM-UNC-VAL
017230                              - WA-HOLD-AMT
017240        IF WA-DUMMY-AMT2 < WA-DUMMY-AMT
017250           MOVE 3076 TO WA-OUTPUT-ERR-MSG-NO
017260           MOVE 1   TO WA-MSG-ERR-FLAG
017270           GO TO B099-EXIT.
017280***  SUB LEDGER CODE FOR ORIGINAL LOAN MUST BE < 10.
017290***  SEE LEDGER CODE 4.
017300*
KEY008     IF STRT-AREA-TRN-NO NOT = 11064
017320     IF NOT (REDRAW-REFUND-TRAN)
017330*TB0020 ADD WA-DUMMY-AMT TO BORM-ADV-VAL.
TB0020**--
              IF (BORM-ADV-VAL + WA-DUMMY-AMT) >= BORM-APP-AMT
S11632        AND NOT BORP-YOUBE
S17755        AND NOT BORP-ILOAN-R
                 MOVE BORM-APP-AMT TO BORM-ADV-VAL
              ELSE
                 ADD WA-DUMMY-AMT TO BORM-ADV-VAL
              END-IF
           END-IF.
TB0020**--
017340*
017350*    IF  (BORM-CAPN-METHOD = "B" OR
017360*             (BORM-CAPN-METHOD = " " AND
017370*               BORP-CAPN-METHOD = "B"))
017380*    AND
017390*        BORM-REPAY-FREQ = 98
017400*    AND
017410*        BORP-CAPN-FREQ = 98
017420*    AND
017430*        BORP-ACCRUE-METHOD = "D"
017440*        ADD WA-COMM-CORR-AMOUNT TO BORM-ADV-VAL
017450*    END-IF.
017460*
017470     IF NOT (REDRAW-REFUND-TRAN)
017480        IF (WA-INPUT-PARAM-TABLE(7) = 1)
017490        AND (BBLC-LOC-ACCT-NO NOT = 0)
017500        AND (BBLC-LOC-DT = ZEROES)
017510*       AND (BORM-LOC-ACC NOT = 0)
017520*       AND (BORM-LOC-DATE = ZEROES)
017530            ADD WA-DUMMY-AMT TO BORM-APP-AMT.
017540     IF  WA-INPUT-PARAM-TABLE (7) = 1
017550         IF  BORM-ADV-VAL < ZERO
017560           MOVE 2116 TO UT0060CA-CALL-ERROR-CODE
017570           PERFORM Y000-OVERRIDABLE-ERROR-CHECK THRU Y090-EXIT
017580           IF WA-MSG-ERR-FLAG = 0
017590             MOVE 2116 TO WA-ERR-MSG-NO
017600           ELSE
017610             MOVE 2116 TO WA-OUTPUT-ERR-MSG-NO
017620             MOVE 1 TO WA-MSG-ERR-FLAG
017630             GO TO B099-EXIT.
017640     IF (WA-INPUT-PARAM-TABLE(7) = 1)
017650     AND (BBLC-LOC-ACCT-NO NOT = 0)
017660     AND (BBLC-LOC-DT = ZEROES)
017670*    AND (BORM-LOC-ACC NOT = 0)
017680*    AND (BORM-LOC-DATE = ZEROES)
017690         NEXT SENTENCE
017700     ELSE
017710         GO TO B010-CONT.
017720     IF WA-STORE-ACT-CORR-AMT = 0
017730         GO TO B010-ADJ-REP.
017740     IF BORM-REM-REPAYS > 0
017750        MOVE 2                    TO WA-LEDGER-CODE
017760     ELSE
017770        MOVE 1                    TO WA-LEDGER-CODE
017780     END-IF.
017790     ADD WA-STORE-ACT-CORR-AMT TO BORM-EOM-BASIC-BAL
017800                                  BORM-EOY-BASIC-BAL.
017810     MOVE STRT-AREA-PRIORITY-CODE TO WA-PRIORITY-CODE.
017820     MOVE WA-STORE-ACT-CORR-AMT TO WA-AMOUNT-TO-ADD.
017830     MOVE BORM-LOAN-BAL TO CPY-BORM-LOAN-BAL.
017840     MOVE BORM-THEO-LOAN-BAL TO CPY-BORM-THEO-LOAN-BAL.
017850     IF BORP-PRIORITY-CODE-ON
017860        IF WA-PRIORITY-CODE = SPACES
TB0084           IF BORP-PRIORITY-TERM-BY-TERM
TB0084              PERFORM M100-CALL-UT0094 THRU M109-EXIT
TB0084           ELSE
017870              PERFORM M000-CALL-UT0095 THRU M099-EXIT
TB0084           END-IF
017880           IF WA-MSG-ERR-FLAG = 1
017890              GO TO B099-EXIT
017900           END-IF
017910        ELSE
TB0084           PERFORM N400-SEARCH-PRIORITY THRU N409-EXIT
TB0084           IF WA-MSG-ERR-FLAG = 1
TB0084              GO TO B099-EXIT
TB0084           END-IF
017920           PERFORM N000-ADD-TO-LOAN-BAL THRU NADD-EXIT
017930        END-IF
017940     ELSE
017950        PERFORM N100-ADD-TO-LOAN-BAL THRU N199-EXIT
017960     END-IF.
017970*
017980     MOVE CPY-BORM-LOAN-BAL TO BORM-LOAN-BAL.
017990     MOVE CPY-BORM-THEO-LOAN-BAL TO BORM-THEO-LOAN-BAL.
018000     IF WA-INPUT-PARAM-TABLE (7) = 1
SC6388        AND NOT BORP-YOUBE
018010         IF (BORM-LOAN-BAL < 0) OR
SC5617            (BORM-THEO-LOAN-BAL < 0) OR
018030            (BORM-EOM-BASIC-BAL < 0) OR
018040            (BORM-EOY-BASIC-BAL < 0)
018050            MOVE 1 TO WA-MSG-ERR-FLAG
018060            MOVE 117 TO WA-OUTPUT-ERR-MSG-NO
018070            GO TO B099-EXIT
018080         ELSE
018090*           IF (BORM-INS-PREMIUM > 0) AND
018100            IF (BINS-PREMIUM > 0) AND
018110               ((WA-PPP-INITIAL-ADVANCE = 1) OR
018120                (BORM-ADV-VAL = 0))
018130*              IF BORM-LOAN-BAL < BORM-INS-PREMIUM
018140               IF BORM-LOAN-BAL < BINS-PREMIUM
018150                   MOVE 1 TO WA-MSG-ERR-FLAG
018160                   MOVE 117 TO WA-OUTPUT-ERR-MSG-NO
018170                   GO TO B099-EXIT.
018180     IF BORM-IR-IND = 1
018190        PERFORM Z2000-READ-BIRM
018200        IF WA-MSG-ERR-FLAG = 1
018210           GO TO B099-EXIT
018220        END-IF
018230     END-IF.
018240     IF WA-INPUT-PARAM-TABLE(8) = 1
018250*        MOVE WA-STORE-TXN-DT TO BORM-IR-ACTIVITY
018260         IF BORM-IR-IND = 1
018270            MOVE WA-STORE-TXN-DT TO BIRM-IR-ACTIVITY
018280         END-IF
018290     ELSE
018300*        MOVE STRT-AREA-POST-DT TO BORM-IR-ACTIVITY.
018310         IF BORM-IR-IND = 1
018320            MOVE STRT-AREA-POST-DT TO BIRM-IR-ACTIVITY
018330         END-IF
018340     END-IF.
NR2001*018350     MOVE SPACES TO BORV-RECORD-AREA.
NR2001*018360     INITIALIZE BORV-01-DETAIL.
NR2001*018370     MOVE 01 TO BORV-01-CODE.
NR2001*018380     MOVE 0                      TO WA-TXN-STAT.
NR2001*018390     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001*018400*       PERFORM N1500-CALC-INT-DUE-DT THRU N1599-EXIT
NR2001*018410         IF  WA-STORE-TXN-DT   < WA-INT-ST-BIN
NR2001*018420             MOVE 1              TO WA-BKD-STAT
NR2001*018430             MOVE 1              TO BORM-BACK-DT-IND
NR2001*018440         ELSE
NR2001*018450             MOVE 0              TO WA-BKD-STAT
NR2001*018460     ELSE
NR2001*018470         MOVE 0                  TO WA-BKD-STAT.
NR2001*018480     IF WA-INPUT-PARAM-TABLE(6) = 1
NR2001*018490         MOVE 1                  TO WA-NPB-STAT
NR2001*018500     ELSE
NR2001*018510         MOVE 0                  TO WA-NPB-STAT.
NR2001*018520     MOVE WA-TXN-STAT            TO BORV-01-STATUS.
NR2001*018530     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001*018540         MOVE WA-STORE-TXN-DT TO BORV-01-TRN-DATE
NR2001*018550     ELSE
NR2001*018560         MOVE STRT-AREA-POST-DT TO BORV-01-TRN-DATE.
NR2001*018570     MOVE UPTELLCA-TELLER-BRANCH TO BORV-01-TELL-AND-BR
NR2001*018580*    MOVE STRT-AREA-MSG-TIME     TO BORV-01-POST-TIME.                   
NR2001*018590     IF STRT-AREA-OTHER-OVERRIDE = "7"                                   
NR2001*018600        MOVE TPATM-TPAC-POST-TIME  TO BORV-01-POST-TIME                  
NR2001*018610     ELSE                                                                
NR2001*018620        MOVE STRT-AREA-MSG-TIME      TO BORV-01-POST-TIME.               
NR2001*018630     MOVE STRT-AREA-TERM-NO      TO BORV-01-BRTERM.
NR2001*018640     MOVE STRT-AREA-POST-DT TO BORV-01-POST-DATE.
NR2001*018650     MOVE BORM-LOAN-BAL TO BORV-01-BALANCE.
NR2001*018660     MOVE 13520 TO BORV-01-TRN-CODE.
NR2001*018670     MOVE WA-ADV-PROMO    TO BORV-01-PROMO-NO.
NR2001*018680     MOVE 08 TO BORV-01-SUB-LEDG-CODE.
NR2001*TB0244***
NR2001*TB0244*** IF FOR TIB
NR2001*TB0244***
NR2001*TB0244     IF SOC-SITE-TIB
NR2001*TB0244        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
NR2001*TB0244                X000-EXIT
NR2001*TB0244     END-IF.
NR2001*
NR2001*018690     MOVE WA-STORE-ACT-CORR-AMT TO BORV-01-AMOUNT.
NR2001*018700     MOVE ZEROES TO BORV-01-CHQ-DAYS.
NR2001*TB0084     PERFORM N600-GET-ARREARS THRU N609-EXIT
NR2001*018710*--- COMPUTE BORV-01-ARREARS = BORM-LOAN-BAL - BORM-THEO-LOAN-BAL.
NR2001*018720     MOVE STRT-AREA-JRNL-NO TO BORV-01-JRNL-NO.
NR2001     MOVE SPACES TO BOCT-RECORD-AREA.
NR2001     INITIALIZE BOCT-TRAN-01.
NR2001     MOVE 01                       TO BOCT-TRAN-TYPE.
NR2001     MOVE 0                        TO WA-TXN-STAT.
NR2001     MOVE WA-TXN-STAT              TO BOCT-STAT.
NR2001     MOVE 13520                    TO BOCT-TRN-CODE.
NR2001     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001         IF  WA-STORE-TXN-DT   < WA-INT-ST-BIN
NR2001             MOVE 1                TO WA-BKD-STAT
NR2001             MOVE 1                TO BORM-BACK-DT-IND
NR2001         ELSE                      
NR2001             MOVE 0                TO WA-BKD-STAT
NR2001     ELSE                          
NR2001         MOVE 0                    TO WA-BKD-STAT.
NR2001     IF WA-INPUT-PARAM-TABLE(6) = 1
NR2001         MOVE 1                    TO WA-NPB-STAT
NR2001     ELSE                          
NR2001         MOVE 0                    TO WA-NPB-STAT.
NR2001     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001         MOVE WA-STORE-TXN-DT      TO BOCT-TRN-DATE
NR2001     ELSE                          
NR2001         MOVE STRT-AREA-POST-DT    TO BOCT-TRN-DATE.
NR2001     IF STRT-AREA-OTHER-OVERRIDE = "7"                                   
NR2001         MOVE TPATM-TPAC-POST-TIME TO BOCT-01-REPOST-TIME
NR2001     ELSE                                                                
NR2001         MOVE STRT-AREA-MSG-TIME   TO BOCT-01-REPOST-TIME.
NR2001     MOVE BORM-LOAN-BAL            TO BOCT-01-BALANCE.
NR2001     MOVE WA-ADV-PROMO             TO BOCT-01-PROMO-NO.
NR2001     MOVE 08                       TO BOCT-01-SUB-LEDG-CODE.
NR2001***
NR2001*** IF FOR TIB
NR2001***
NR2001     IF SOC-SITE-TIB
NR2001        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
NR2001                X000-EXIT
NR2001     END-IF.
NR2001
NR2001     MOVE WA-STORE-ACT-CORR-AMT    TO BOCT-01-AMOUNT.
NR2001     MOVE ZEROES                   TO BOCT-01-CHQ-DAYS.
NR2001     PERFORM N600-GET-ARREARS THRU N609-EXIT
018730     PERFORM W500-ADD-TXN THRU W599-EXIT.
018740     IF WA-MSG-ERR-FLAG = 1
018750         GO TO B099-EXIT.
018760*
018770 B010-ADJ-REP.
018780*  Do not recalculate dues or int incr if Keymatrix 30 day loan           
018790     IF SOC-MFRC-FLAG = 0                                                
018800        PERFORM M1000-RECALC-DUES-SORD THRU M1099-EXIT.
018810*
018820 B010-CONT.
018830* 
018840*** KEYMATRIX 30 DAY LOANS MAY NOT UPDATE LOAN BAL DEPENDING             
018850*** ON THE SETTING OF THE MFRC FLAG ON INSTITUTION PARAMETER            
018860*** FIRSTLY CALL EDB SYSTEM FOR SCHEDULE OF DATES ETC
018870     IF BORP-REPAY-SCHED = "C"
018880     AND STRT-AREA-TRN-NO NOT = 12522
018890        MOVE SPACES              TO WA-NARR-TEXT
018900        MOVE BORM-DUE-STRT-DATE  TO UTSALRCA-CALL-DATE
018910        MOVE BORM-CUSTOMER-NO    TO UTSALRCA-CUST-ACCT
018920        MOVE 01                  TO UTSALRCA-CALL-CODE
018930        MOVE STRT-AREA-SOC-NO    TO UTSALRCA-INST-NO
018940        MOVE 0                   TO UTSALRCA-STATUS
018950        MOVE 4                   TO UTSALRCA-NUM-DATE
018960        CALL "UTSALR"         USING UTSALRCA-CALL-AREA
018970        IF UTSALRCA-STATUS NOT = 0
018980           MOVE 1                TO WA-MSG-ERR-FLAG
018990           MOVE 1866             TO WA-OUTPUT-ERR-MSG-NO
019000           GO TO B099-EXIT.
019010*
019020     IF  STRT-AREA-TRN-NO = 12422 OR 12522  OR
019030         (WA-INPUT-PARAM-TABLE(28) = 1  AND
019040          BORP-REPAY-SCHED = "C")
019050         MOVE "Y"                TO WA-30DL-UPDATE-FLAG
019060         PERFORM Q000-PROCESS-AUTH-TRAN   THRU Q009-EXIT
019070         IF  WA-MSG-ERR-FLAG = 1
019080             GO TO B099-EXIT
019090         END-IF
019100         IF  WA-30DL-UPDATE-FLAG = "N"
019110             GO TO B099-EXIT.
019120*
019130***  30 day loans Borrow to Pay transaction.
019140*
019150     IF STRT-AREA-TRN-NO = 11064 OR 11164
019160        MOVE "Y"                 TO WA-30DL-UPDATE-FLAG
019170        PERFORM R000-BORROW-TO-PAY   THRU R009-EXIT
019180        IF WA-MSG-ERR-FLAG = 1
019190           GO TO B099-EXIT
019200        ELSE
019210        IF WA-30DL-UPDATE-FLAG = "N"
019220           GO TO B099-EXIT.
KEY008*    
KEY008***  End of Keymatrix 30 day loan checks                                 
019250*
019260*
019270     IF BORP-PRIORITY-CODE-ON
019280     IF ((BORP-CAPN-METHOD NOT = " ")
019290     AND (BORP-CAPN-METHOD IS ALPHABETIC))
019300        IF WA-INPUT-PARAM-TABLE (7) NOT = 1
019310           PERFORM M1300-PROCESS-ADV-UPFRONT-LOAN THRU M1399-EXIT
019320        ELSE
S16081           MOVE BORM-UNEARNED-INT TO WA-COMM-CORR-AMOUNT
019330           MOVE WA-COMM-CORR-AMOUNT TO WA-COMMISSION-AMOUNT
S16081*019340           ADD WA-COMM-CORR-AMOUNT TO BORM-UNEARNED-INT.
S16081          MOVE ZEROS              TO BORM-UNEARNED-INT.
019350* For Keymatrix 30 day loans call the HOLD system to set up               
019360* repayment schedule
019370*
019380     IF BORP-REPAY-SCHED = "C"
019390        IF  WA-INPUT-PARAM-TABLE (7) = 0
019400            PERFORM Q500-LOAD-REPAYMENTS  THRU Q509-EXIT
019410        ELSE
019420            PERFORM Q700-CANCEL-AUTHORITY THRU Q709-EXIT
019430        END-IF
019440        IF  WA-MSG-ERR-FLAG = 1
019450            GO TO B099-EXIT.
019460        
019470     IF WA-MSG-ERR-FLAG = 1
019480        GO TO B099-EXIT.
019490*    IF BORM-REM-REPAYS > 0
019500*       ADD WA-DUMMY-AMT          TO BORM-LOAN-BAL
019510*                                    BORM-THEO-LOAN-BAL
019520*                                    BORM-EOM-BASIC-BAL
019530*                                    BORM-EOY-BASIC-BAL
019540*    ELSE
019550*       ADD WA-DUMMY-AMT          TO BORM-LOAN-BAL
019560*                                    BORM-EOM-BASIC-BAL
019570*                                    BORM-EOY-BASIC-BAL.
019580     IF WA-INPUT-PARAM-TABLE (7) = 1 AND
019590        (BORP-PRINC-REDUCT-IND  = 0)
SC6388        AND NOT BORP-YOUBE
019600         IF (BORM-LOAN-BAL < 0) OR
SC5617            (BORM-THEO-LOAN-BAL < 0) OR
019620            (BORM-EOM-BASIC-BAL < 0) OR
019630            (BORM-EOY-BASIC-BAL < 0)
019640            MOVE 1 TO WA-MSG-ERR-FLAG
019650            MOVE 117 TO WA-OUTPUT-ERR-MSG-NO
019660            GO TO B099-EXIT
019670         ELSE
019680*           IF (BORM-INS-PREMIUM > 0) AND
019690            IF (BINS-PREMIUM > 0) AND
019700               ((WA-PPP-INITIAL-ADVANCE = 1) OR
019710                (BORM-ADV-VAL = 0))
019720*              IF BORM-LOAN-BAL < BORM-INS-PREMIUM
019730               IF BORM-LOAN-BAL < BINS-PREMIUM
019740                   MOVE 1 TO WA-MSG-ERR-FLAG
019750                   MOVE 117 TO WA-OUTPUT-ERR-MSG-NO
019760                   GO TO B099-EXIT.
019770     IF WA-INPUT-PARAM-TABLE(8) = 1
019780*        MOVE WA-STORE-TXN-DT TO BORM-IR-ACTIVITY
019790         IF BORM-IR-IND = 1
019800            MOVE WA-STORE-TXN-DT TO BIRM-IR-ACTIVITY
019810         END-IF
019820     ELSE
019830*        MOVE STRT-AREA-POST-DT TO BORM-IR-ACTIVITY.
019840         IF BORM-IR-IND = 1
019850            MOVE STRT-AREA-POST-DT TO BIRM-IR-ACTIVITY
019860         END-IF
019870     END-IF.
019880     IF NOT (REDRAW-REFUND-TRAN)
019890     IF  (BORM-ADV-VAL = BORM-APP-AMT) OR
019900         (BORM-ADV-VAL > BORM-APP-AMT) OR
019910         (BORM-ADV-VAL = (BORM-APP-AMT - (BORM-APP-AMT * 0.01)))
019920         MOVE 8 TO BORM-STAT
019930     ELSE
019940         IF  BORM-ADV-VAL = ZERO
019950             IF BORM-LOAN-BAL = 0  OR
019960                (BORM-LOAN-BAL + WA-COMMISSION-AMOUNT) = 0 OR
019970                (BORM-LOAN-BAL + WA-COMMISSION-AMOUNT
019980                               + BORM-PRINC-REDUCT-EFF) = 0 OR
019990               (BORM-LOAN-BAL + BORM-PRINC-REDUCT-EFF = 0)

020010             PERFORM M301-SEARCH-OLD-TRAN THRU M309-EXIT
020020*               MOVE 3 TO BORM-STAT
020030             ELSE
020040                PERFORM M301-SEARCH-OLD-TRAN THRU M309-EXIT
020050*               MOVE 6 TO BORM-STAT
020060         ELSE MOVE 7 TO BORM-STAT.
SC3810                                                  
SC3810     IF BORM-STAT < 6                             
SC3810      AND WA-INPUT-PARAM-TABLE(7) = 1             
SC3810      AND BORM-ADV-VAL = 0                        
SC9999      AND NOT BORP-YOUBE    
SC3810*       MOVE ZEROES          TO BOIS-MATURITY-DATE
SC4248        MOVE ZEROES          TO BOIS-LAST-UNPAID-DUE-DATE
SC4248        MOVE ZEROES          TO BOIS-NEXT-DUE-DATE
SC4248        MOVE ZEROES          TO BORM-DUE-AMT
SC6175        IF NOT BOIS-MATURITY-ENTERED  
SC6175           MOVE 0                TO BOIS-MATURITY-DATE  
SC6175        ELSE
SC6175           MOVE 0                TO BORM-LOAN-TRM  
SC6175                                    BORM-REM-REPAYS  
S17755           IF BORP-ILOAN-R
S17755              MOVE BORP-MAX-TERM TO BORM-LOAN-TRM
S17755                                    BORM-REM-REPAYS
S17755                                    BOIS-STRETCH-TERM
S17755           END-IF
SC6175        END-IF  
SC6677** Zero out due strt date/ int strt date and adv-date after correction.
SC6677           MOVE 0                   TO BORM-DUE-STRT-DATE              
SC6677                                       BORM-INT-START-DATE             
SC6677                                       BORM-ADV-DATE                   
SC6677                                       BOIS-FIRST-ADV-DATE             
S10490                                                                 
S10490** For negotiated rate ind = 2. Reset int-rate, rate expiry date,
S10490** and reverse BLDVNI status to "N".                             
S10490        IF BOIS-NEGO-RATE-IND = 2                                
S10490           MOVE 0                   TO BORM-INT-RATE             
S10490                                       BORM-RT-INCR              
S10490                                       BOIS-RATE-EXP-DATE        
S10490           MOVE SPACES              TO BOIS-NEGO-RATE-FLAG       
S10490                                                                 
S10490           PERFORM Z4000-READ-BLDVNI                             
S10490              THRU Z4999-EXIT                                    
S10490                                                                 
S10490           IF WA-MSG-ERR-FLAG = 1                                
S10490              GO TO B099-EXIT                                    
S10490           END-IF                                                
S10490                                                                 
S10490           MOVE "0"     TO BLDV-NI-POSTED-FLAG (1)               
S10490                                                                 
S10490           PERFORM Z5000-BLDVNI-UPDATE                           
S10490              THRU Z5999-EXIT                                    
S10490        END-IF                                                   
SC3810     END-IF.                                      
SC3810                                                  
SC3310*    IF  BORM-REPAY-TYPE = 9
TB0104************************************************************
TB0104***  the next two lines of code were transferred to
TB0104***  x300-format-sord-start
TB0104************************************************************
020080**     IF  BORM-REPAY-IN-AFFECT NOT = "Y"
020090**       IF  BORM-STAT = 8
TB0104************************************************************
TB0104***  end of transferred code
TB0104************************************************************
SC3310*            PERFORM X300-FORMAT-SORD-START THRU X399-EXIT
SC3310*            IF  WA-MSG-ERR-FLAG NOT = 0
SC3310*                GO TO B099-EXIT.
020130**** BUILD UP FIN TRX HERE*****
020140 B020.
TB0236
TB0236     IF BORP-YOUBE
TB0236        IF BOIS-START-METHOD = "00" OR "05"
TB0236           IF BORM-STAT = 8
TB0236              MOVE STRT-AREA-POST-DT TO BORM-INT-START-DATE.
NR2001*020150     MOVE SPACES                 TO BORV-RECORD-AREA.
NR2001*020160     INITIALIZE BORV-01-DETAIL.
NR2001*020170*
NR2001*020180     MOVE 01                     TO BORV-01-CODE.
NR2001*020190     IF  WA-INPUT-PARAM-TABLE(8) = 1
NR2001*020200         MOVE WA-STORE-TXN-DT    TO BORV-01-TRN-DATE
NR2001*020210     ELSE
NR2001*020220         MOVE STRT-AREA-POST-DT    TO BORV-01-TRN-DATE.
NR2001*020230     MOVE UPTELLCA-TELLER-BRANCH    TO BORV-01-TELL-AND-BR.
NR2001*020240*    MOVE STRT-AREA-MSG-TIME  TO BORV-01-POST-TIME.                      
NR2001*020250     IF STRT-AREA-OTHER-OVERRIDE = "7"                                   
NR2001*020260        MOVE TPATM-TPAC-POST-TIME  TO BORV-01-POST-TIME                  
NR2001*020270     ELSE                                                                
NR2001*020280        MOVE STRT-AREA-MSG-TIME      TO BORV-01-POST-TIME.               
NR2001*020290     MOVE STRT-AREA-TERM-NO   TO BORV-01-BRTERM.
NR2001*020300     MOVE STRT-AREA-TRN-NO    TO BORV-01-TRN-CODE.
NR2001*020310     MOVE STRT-AREA-POST-DT   TO BORV-01-POST-DATE.
NR2001*020320     MOVE STRT-AREA-JRNL-NO   TO BORV-01-JRNL-NO.
NR2001*020330*    MOVE BORM-LOAN-BAL TO BORV-01-BALANCE.
NR2001*020340*
NR2001*020350     IF  (BORM-CAPN-METHOD = "B" OR
NR2001*020360              (BORM-CAPN-METHOD = " " AND
NR2001*020370                BORP-CAPN-METHOD = "B"))
NR2001*020380     AND
NR2001*020390         BORM-REPAY-FREQ = 98
NR2001*020400     AND
NR2001*020410         BORP-CAPN-FREQ = 98
NR2001*020420     AND
NR2001*020430         BORP-ACCRUE-METHOD = "D"
NR2001*020440*
NR2001*020450         COMPUTE BORV-01-AMOUNT =
NR2001*020460                 WA-DUMMY-AMT - WA-COMMISSION-AMOUNT
NR2001*020470     ELSE
NR2001*020480         MOVE WA-DUMMY-AMT TO BORV-01-AMOUNT.
NR2001*020490*
NR2001*020500*        SUBTRACT WA-COMMISSION-AMOUNT FROM WA-DUMMY-AMT
NR2001*020510*    END-IF.
NR2001*020520*
NR2001*020530*    MOVE WA-DUMMY-AMT TO BORV-01-AMOUNT.
NR2001*TB0084     PERFORM N600-GET-ARREARS THRU N609-EXIT
NR2001*020540*--- COMPUTE BORV-01-ARREARS = BORM-LOAN-BAL - BORM-THEO-LOAN-BAL.
NR2001*020550     IF REDRAW-REFUND-TRAN
NR2001*020560           COMPUTE BORV-01-ARREARS =  BORM-LOAN-BAL
NR2001*020570                                     + WA-DUMMY-AMT
NR2001*020580                                     - BORM-THEO-LOAN-BAL.
NR2001*020590*&&&*      ADD WA-DUMMY-AMT   TO BORM-LOAN-BAL.
NR2001*020600*&&&*      THE LINE OF CODE ABOVE HAS BEEN MOVED TO AFTER CHARGES
NR2001*020610*&&&*      HAVE BEEN DETERMINED, AS THE ORIGINAL BALANCE
NR2001*020620*&&&*      HAS TO BE PRESENTED TO THE CHARGE MODULES TOGETHER
NR2001*020630*&&&*      WITH THE TXN AMOUNT.
NR2001*020640     MOVE WA-ADV-PROMO    TO BORV-01-PROMO-NO.
NR2001*020650     IF STRT-AREA-TRN-NO = 13509 OR 13609
NR2001*020660        MOVE 07      TO BORV-01-SUB-LEDG-CODE
NR2001*020670     ELSE
NR2001*020680         IF BORM-STAT = 7
NR2001*020690            MOVE 01                TO BORV-01-SUB-LEDG-CODE
NR2001*020700         ELSE
NR2001*020710            MOVE 03                TO BORV-01-SUB-LEDG-CODE.
NR2001*TB0244***
NR2001*TB0244*** IF FOR TIB
NR2001*TB0244***
NR2001*TB0244     IF SOC-SITE-TIB
NR2001*TB0244        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
NR2001*TB0244                X000-EXIT
NR2001*TB0244     END-IF.
NR2001*020720     IF  WA-INPUT-PARAM-TABLE(10) = 1
NR2001*020730         MOVE WA-ADV-CHQ-NO TO BORV-01-CHQ-DAYS
NR2001*020740     ELSE MOVE ZEROS TO BORV-01-CHQ-DAYS.
NR2001*020750     IF (BBLC-LOC-ACCT-NO NOT = 0)
NR2001*020760     AND (BBLC-LOC-DT = ZEROES)
NR2001*020770*    IF (BORM-LOC-ACC NOT = 0)
NR2001*020780*    AND (BORM-LOC-DATE = ZEROES)
NR2001*020790         NEXT SENTENCE
NR2001*020800     ELSE
NR2001*020810         IF ((BORM-STAT = 8) AND (BORM-SEC-LESD-CDE = "N")
NR2001*020820         AND (BORP-CAPN-METHOD NOT ALPHABETIC))
NR2001*020830             PERFORM M300-MOVE-SECADD-TO-MAILADD THRU M399-EXIT.
NR2001*020840     IF  WA-MSG-ERR-FLAG = 1
NR2001*020850         GO TO B099-EXIT.
NR2001*020860     IF NOT (REDRAW-REFUND-TRAN)
NR2001*020870        MOVE BORV-01-TRN-DATE TO BORM-ADV-DATE.
NR2001*KEY008* Keymatrix Dues start date set as salary date prior to this             
NR2001*020890     IF BORP-REPAY-SCHED = "C"
NR2001*TB0159     OR BORP-YOUBE
NR2001*020900        NEXT SENTENCE
NR2001*020910     ELSE
NR2001*020920        PERFORM W100-SET-DUE-DT THRU W199-EXIT.
NR2001*020930     IF  WA-MSG-ERR-FLAG = 1
NR2001*020940         GO TO B099-EXIT.
NR2001*020950     MOVE 0                      TO WA-TXN-STAT.
NR2001*020960     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001*020970*        PERFORM N1500-CALC-INT-DUE-DT THRU N1599-EXIT
NR2001*020980         IF  WA-STORE-TXN-DT   < WA-INT-ST-BIN
NR2001*020990             MOVE 1              TO WA-BKD-STAT
NR2001*021000             MOVE 1              TO BORM-BACK-DT-IND
NR2001*021010         ELSE
NR2001*021020             MOVE 0              TO WA-BKD-STAT
NR2001*021030     ELSE
NR2001*021040         MOVE 0                  TO WA-BKD-STAT.
NR2001*021050     IF WA-INPUT-PARAM-TABLE(6) = 1
NR2001*021060         MOVE 1                  TO WA-NPB-STAT
NR2001*021070     ELSE
NR2001*021080         MOVE 0                  TO WA-NPB-STAT.
NR2001*021090************************************************************
NR2001*021100* PETER HAN: CHARGE SYSTEM CALL INSERTION (1) STARTS HERE
NR2001*021110************************************************************
NR2001*021120*** CHECK IF CHARGES MAY APPLY HERE AND IF SO, CALL CS0000**
NR2001*021130 B050.
NR2001*021140*
NR2001*021150*&&&*IF WA-INPUT-PARAM-TABLE (7) = 0
NR2001*021160         PERFORM B900-CHECK-IF-TO-APPLY-CHARGES THRU B999-EXIT
NR2001*021170         IF WA-MSG-ERR-FLAG = 1
NR2001*021180             GO TO B099-EXIT.
NR2001*021190*
NR2001*021200     IF  CS0000RA-CHR-CNT = 0
NR2001*021210         GO TO B070.
NR2001*021220*
NR2001*021230     ADD CS0000RA-TOT-HOW-APPLY-3 TO BORV-01-BALANCE
NR2001*021240                                     BORV-01-AMOUNT
NR2001*021250                                     WA-DUMMY-AMT.
NR2001*021260* ????NO WA-DUMMY-BAL ????           WA-DUMMY-BAL.
NR2001*021270*
NR2001*021280     CONTINUE.
NR2001*021290 B070.
NR2001*021300************************************************************
NR2001*021310*  INSERTION (1) ENDS HERE
NR2001*021320*************************************************************
NR2001*021330***************************************************************
NR2001*021340*&&&*    CHANGE THE UPDATE OF LOAN & THEO-LOAN BALANCES AS
NR2001*021350*&&&*    FOLLOWS:- (AS CLOSE AS THAT INTENDED BY SPR620124)
NR2001*021360*&&&*    IF THERE ARE REMAINING REPAYMENTS THEN BASE THE UPDATE
NR2001*021370*&&&*    OF BALANCES ON THE LEDGER CODE ELSE
NR2001*021380*&&&*    UPDATE THE LOAN BAL ONLY.
NR2001*021390***************************************************************
NR2001*021400     IF NOT (REDRAW-REFUND-TRAN)
NR2001*021410       IF  BORM-REM-REPAYS > 0
NR2001*021420         IF STRT-AREA-LEDG-CODE NOT = 0
NR2001*021430            MOVE STRT-AREA-LEDG-CODE TO WA-LEDGER-CODE
NR2001*021440         ELSE
NR2001*021450            MOVE 2 TO WA-LEDGER-CODE
NR2001*021460         END-IF
NR2001*021470         ADD WA-DUMMY-AMT TO BORM-EOM-BASIC-BAL
NR2001*021480                             BORM-EOY-BASIC-BAL
NR2001*021490       ELSE
NR2001*021500         MOVE 1 TO WA-LEDGER-CODE
NR2001*021510         ADD WA-DUMMY-AMT TO BORM-EOM-BASIC-BAL
NR2001*021520                             BORM-EOY-BASIC-BAL
NR2001*021530       END-IF
NR2001*021540     ELSE
NR2001*021550         MOVE 1 TO WA-LEDGER-CODE
NR2001*021560     END-IF.
NR2001*021570     MOVE STRT-AREA-PRIORITY-CODE TO WA-PRIORITY-CODE.
NR2001*021580     MOVE WA-DUMMY-AMT TO WA-AMOUNT-TO-ADD.
NR2001*021590     MOVE BORM-LOAN-BAL TO CPY-BORM-LOAN-BAL.
NR2001*021600     MOVE BORM-THEO-LOAN-BAL TO CPY-BORM-THEO-LOAN-BAL.
NR2001*021610*
NR2001*021620     IF BORP-PRIORITY-CODE-ON
NR2001*021630        IF WA-PRIORITY-CODE = SPACES
NR2001*TB0084           IF BORP-PRIORITY-TERM-BY-TERM
NR2001*TB0084              PERFORM M100-CALL-UT0094 THRU M109-EXIT
NR2001*TB0084           ELSE
NR2001*021640              PERFORM M000-CALL-UT0095 THRU M099-EXIT
NR2001*TB0084           END-IF
NR2001*021650           IF WA-MSG-ERR-FLAG = 1
NR2001*021660              GO TO B099-EXIT
NR2001*021670           END-IF
NR2001*021680        ELSE
NR2001*ST0049          IF BORP-YOUBE AND
NR2001*ST0049             WA-INPUT-PARAM-TABLE(8) = 1
NR2001*ST0049           CONTINUE
NR2001*ST0049          ELSE
NR2001*TB0084           PERFORM N400-SEARCH-PRIORITY THRU N409-EXIT
NR2001*TB0084           IF WA-MSG-ERR-FLAG = 1
NR2001*TB0084              GO TO B099-EXIT
NR2001*TB0084           END-IF
NR2001*021690           PERFORM N000-ADD-TO-LOAN-BAL THRU NADD-EXIT
NR2001*ST0049          END-IF
NR2001*021700        END-IF
NR2001*021710     ELSE
NR2001*021720        PERFORM N100-ADD-TO-LOAN-BAL THRU N199-EXIT
NR2001*021730     END-IF.
NR2001*021740*
NR2001*ST0049*    MOVE CPY-BORM-LOAN-BAL TO BORM-LOAN-BAL.
NR2001*ST0049*    MOVE CPY-BORM-THEO-LOAN-BAL TO BORM-THEO-LOAN-BAL.
NR2001*ST0049     IF BORP-YOUBE AND
NR2001*ST0049        WA-INPUT-PARAM-TABLE(8) = 1
NR2001*ST0049        CONTINUE
NR2001*ST0049     ELSE
NR2001*ST0049        MOVE CPY-BORM-LOAN-BAL TO BORM-LOAN-BAL
NR2001*ST0049        MOVE CPY-BORM-THEO-LOAN-BAL TO BORM-THEO-LOAN-BAL
NR2001*ST0049     END-IF.
NR2001*
NR2001*TB0084     IF NOT REDRAW-REFUND-TRAN
NR2001*TB0159     AND NOT BORP-YOUBE
NR2001*TB0084        PERFORM M1100-CALC-REPAYMENT THRU M1109-EXIT 
NR2001*TB0084        IF WA-MSG-ERR-FLAG <> ZEROS
NR2001*TB0084           GO TO B099-EXIT.
NR2001*
NR2001*SC6924     IF  BORM-REPAY-SCHED = 'N'
NR2001*SC6924     AND WA-BEFORE-BORN-STAT     < 07
NR2001*SC6924     AND WA-INPUT-PARAM-TABLE(7) = 0
NR2001*SC6924         PERFORM D900-READ-BLDVNN THRU D909-EXIT
NR2001*SC6924         IF WA-MSG-ERR-FLAG NOT = 0
NR2001*SC6924            GO TO B099-EXIT
NR2001*SC6924         END-IF
NR2001*SC6924     END-IF.
NR2001*SC3310* MOVE FROM B010-CONTINUE PARAGRAPH
NR2001*SC3310     IF  BORM-REPAY-TYPE = 9
NR2001*SC3310             PERFORM X300-FORMAT-SORD-START THRU X399-EXIT
NR2001*SC3310             IF  WA-MSG-ERR-FLAG NOT = 0
NR2001*SC3310                 GO TO B099-EXIT.
NR2001*SC3310* END OF MOVE FROM B010-CONTINUE PARAGRAPH
NR2001*
NR2001*021780     MOVE BORM-LOAN-BAL          TO BORV-01-BALANCE.
NR2001*S11455     IF  BORP-YOUBE                                
NR2001*S11455     AND (WA-ADV-AMORT-FLAG = "A" OR               
NR2001*S11455          WA-ADV-AMORT-FLAG = "F" OR               
NR2001*S11455          WA-ADV-AMORT-FLAG = "R")                 
NR2001*S11455     AND WA-INPUT-PARAM-TABLE(8) = 1               
NR2001*S11455         ADD BORV-01-AMOUNT      TO BORV-01-BALANCE
NR2001*S11455     END-IF.                                       
NR2001*S10075*    MOVE WA-TXN-STAT            TO BORV-01-STATUS.              
NR2001*S10075     IF  BORP-YOUBE                                              
NR2001*S10075     AND WA-INPUT-PARAM-TABLE(7) = 1                             
NR2001*S10075         MOVE 20                 TO BORV-01-STATUS               
NR2001*S10075     ELSE                                                        
NR2001*S10075         MOVE WA-TXN-STAT        TO BORV-01-STATUS               
NR2001*S10075     END-IF.                                                     
NR2001     MOVE SPACES                   TO BOCT-RECORD-AREA.
NR2001     INITIALIZE BOCT-TRAN-01.
NR2001*
NR2001     MOVE 01                       TO BOCT-TRAN-TYPE.
NR2001     IF  WA-INPUT-PARAM-TABLE(8) = 1
NR2001         MOVE WA-STORE-TXN-DT      TO BOCT-TRN-DATE
NR2001     ELSE
NR2001         MOVE STRT-AREA-POST-DT    TO BOCT-TRN-DATE.
NR2001     IF STRT-AREA-OTHER-OVERRIDE = "7"                                   
NR2001        MOVE TPATM-TPAC-POST-TIME  TO BOCT-01-REPOST-TIME
NR2001     ELSE                                                                
NR2001        MOVE STRT-AREA-MSG-TIME    TO BOCT-01-REPOST-TIME.
NR2001     MOVE STRT-AREA-TRN-NO         TO BOCT-TRN-CODE.
NR2001     MOVE STRT-AREA-POST-DT        TO BOCT-POST-DATE.
NR2001     MOVE STRT-AREA-JRNL-NO        TO BOCT-JRNL-NO.
NR2001*
NR2001     IF  (BORM-CAPN-METHOD = "B" OR
NR2001              (BORM-CAPN-METHOD = " " AND
NR2001                BORP-CAPN-METHOD = "B"))
NR2001     AND
NR2001         BORM-REPAY-FREQ = 98
NR2001     AND
NR2001         BORP-CAPN-FREQ = 98
NR2001     AND
NR2001         BORP-ACCRUE-METHOD = "D"
NR2001*
NR2001         COMPUTE BOCT-01-AMOUNT =
NR2001                 WA-DUMMY-AMT - WA-COMMISSION-AMOUNT
NR2001     ELSE
NR2001         MOVE WA-DUMMY-AMT TO BOCT-01-AMOUNT.
NR2001     PERFORM N600-GET-ARREARS THRU N609-EXIT
NR2001     IF REDRAW-REFUND-TRAN
NR2001           COMPUTE BOCT-01-ARREARS =  BORM-LOAN-BAL
NR2001                                     + WA-DUMMY-AMT
NR2001                                     - BORM-THEO-LOAN-BAL.
NR2001*&&&*      ADD WA-DUMMY-AMT   TO BORM-LOAN-BAL.
NR2001*&&&*      THE LINE OF CODE ABOVE HAS BEEN MOVED TO AFTER CHARGES
NR2001*&&&*      HAVE BEEN DETERMINED, AS THE ORIGINAL BALANCE
NR2001*&&&*      HAS TO BE PRESENTED TO THE CHARGE MODULES TOGETHER
NR2001*&&&*      WITH THE TXN AMOUNT.
NR2001     MOVE WA-ADV-PROMO    TO BOCT-01-PROMO-NO.
S16081*NR2001     IF STRT-AREA-TRN-NO = 13509 OR 13609
S16081     IF STRT-AREA-TRN-NO = 13509 OR 13609 OR 13730 OR 13830
NR2001        MOVE 07      TO BOCT-01-SUB-LEDG-CODE
NR2001     ELSE
NR2001         IF BORM-STAT = 7
NR2001            MOVE 01                TO BOCT-01-SUB-LEDG-CODE
NR2001         ELSE
NR2001            MOVE 03                TO BOCT-01-SUB-LEDG-CODE.
NR2001***
NR2001*** IF FOR TIB
NR2001***
NR2001     IF SOC-SITE-TIB
NR2001        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
NR2001                X000-EXIT
NR2001     END-IF.
NR2001     IF  WA-INPUT-PARAM-TABLE(10) = 1
NR2001         MOVE WA-ADV-CHQ-NO TO BOCT-01-CHQ-DAYS
NR2001     ELSE MOVE ZEROS TO BOCT-01-CHQ-DAYS.
NR2001     IF (BBLC-LOC-ACCT-NO NOT = 0)
NR2001     AND (BBLC-LOC-DT = ZEROES)
NR2001         NEXT SENTENCE
NR2001     ELSE
NR2001         IF ((BORM-STAT = 8) AND (BORM-SEC-LESD-CDE = "N")
NR2001         AND (BORP-CAPN-METHOD NOT ALPHABETIC))
NR2001             PERFORM M300-MOVE-SECADD-TO-MAILADD THRU M399-EXIT.
NR2001     IF  WA-MSG-ERR-FLAG = 1
NR2001         GO TO B099-EXIT.
NR2001     IF NOT (REDRAW-REFUND-TRAN)
S15787     AND WA-INPUT-PARAM-TABLE(7) = 0
NR2001        MOVE BOCT-TRN-DATE TO BORM-ADV-DATE.
NR2001* Keymatrix Dues start date set as salary date prior to this             
NR2001     IF BORP-REPAY-SCHED = "C"
NR2001     OR BORP-YOUBE
NR2001        NEXT SENTENCE
NR2001     ELSE
NR2001        PERFORM W100-SET-DUE-DT THRU W199-EXIT.
NR2001     IF  WA-MSG-ERR-FLAG = 1
NR2001         GO TO B099-EXIT.
NR2001     MOVE 0                      TO WA-TXN-STAT.
NR2001     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001         IF  WA-STORE-TXN-DT   < WA-INT-ST-BIN
NR2001             MOVE 1              TO WA-BKD-STAT
NR2001             MOVE 1              TO BORM-BACK-DT-IND
NR2001         ELSE
NR2001             MOVE 0              TO WA-BKD-STAT
NR2001     ELSE
NR2001         MOVE 0                  TO WA-BKD-STAT.
NR2001     IF WA-INPUT-PARAM-TABLE(6) = 1
NR2001         MOVE 1                  TO WA-NPB-STAT
NR2001     ELSE
NR2001         MOVE 0                  TO WA-NPB-STAT.
NR2001************************************************************
NR2001* PETER HAN: CHARGE SYSTEM CALL INSERTION (1) STARTS HERE
NR2001************************************************************
NR2001*** CHECK IF CHARGES MAY APPLY HERE AND IF SO, CALL CS0000**
NR2001 B050.
NR2001*
NR2001         PERFORM B900-CHECK-IF-TO-APPLY-CHARGES THRU B999-EXIT
NR2001         IF WA-MSG-ERR-FLAG = 1
NR2001             GO TO B099-EXIT.
NR2001*
NR2001     IF  CS0000RA-CHR-CNT = 0
NR2001         GO TO B070.
NR2001*
NR2001     ADD CS0000RA-TOT-HOW-APPLY-3 TO BOCT-01-BALANCE
NR2001                                     BOCT-01-AMOUNT
NR2001                                     WA-DUMMY-AMT.
NR2001*
NR2001     CONTINUE.
NR2001 B070.
NR2001************************************************************
NR2001*  INSERTION (1) ENDS HERE
NR2001*************************************************************
NR2001***************************************************************
NR2001*&&&*    CHANGE THE UPDATE OF LOAN & THEO-LOAN BALANCES AS
NR2001*&&&*    FOLLOWS:- (AS CLOSE AS THAT INTENDED BY SPR620124)
NR2001*&&&*    IF THERE ARE REMAINING REPAYMENTS THEN BASE THE UPDATE
NR2001*&&&*    OF BALANCES ON THE LEDGER CODE ELSE
NR2001*&&&*    UPDATE THE LOAN BAL ONLY.
NR2001***************************************************************
NR2001     IF NOT (REDRAW-REFUND-TRAN)
NR2001       IF  BORM-REM-REPAYS > 0
NR2001         IF STRT-AREA-LEDG-CODE NOT = 0
NR2001            MOVE STRT-AREA-LEDG-CODE TO WA-LEDGER-CODE
NR2001         ELSE
NR2001            MOVE 2 TO WA-LEDGER-CODE
NR2001         END-IF
NR2001         ADD WA-DUMMY-AMT TO BORM-EOM-BASIC-BAL
NR2001                             BORM-EOY-BASIC-BAL
NR2001       ELSE
NR2001         MOVE 1 TO WA-LEDGER-CODE
NR2001         ADD WA-DUMMY-AMT TO BORM-EOM-BASIC-BAL
NR2001                             BORM-EOY-BASIC-BAL
NR2001       END-IF
NR2001     ELSE
NR2001         MOVE 1 TO WA-LEDGER-CODE
NR2001     END-IF.
NR2001     MOVE STRT-AREA-PRIORITY-CODE TO WA-PRIORITY-CODE.
NR2001     MOVE WA-DUMMY-AMT TO WA-AMOUNT-TO-ADD.
NR2001     MOVE BORM-LOAN-BAL TO CPY-BORM-LOAN-BAL.
NR2001     MOVE BORM-THEO-LOAN-BAL TO CPY-BORM-THEO-LOAN-BAL.
NR2001*
NR2001     IF BORP-PRIORITY-CODE-ON
NR2001        IF WA-PRIORITY-CODE = SPACES
NR2001           IF BORP-PRIORITY-TERM-BY-TERM
NR2001              PERFORM M100-CALL-UT0094 THRU M109-EXIT
NR2001           ELSE
NR2001              PERFORM M000-CALL-UT0095 THRU M099-EXIT
NR2001           END-IF
NR2001           IF WA-MSG-ERR-FLAG = 1
NR2001              GO TO B099-EXIT
NR2001           END-IF
NR2001        ELSE
NR2001          IF BORP-YOUBE AND
NR2001             WA-INPUT-PARAM-TABLE(8) = 1
NR2001           CONTINUE
NR2001          ELSE
NR2001           PERFORM N400-SEARCH-PRIORITY THRU N409-EXIT
NR2001           IF WA-MSG-ERR-FLAG = 1
NR2001              GO TO B099-EXIT
NR2001           END-IF
NR2001           PERFORM N000-ADD-TO-LOAN-BAL THRU NADD-EXIT
NR2001          END-IF
NR2001        END-IF
NR2001     ELSE
NR2001        PERFORM N100-ADD-TO-LOAN-BAL THRU N199-EXIT
NR2001     END-IF.
NR2001*
NR2001     IF BORP-YOUBE AND
NR2001        WA-INPUT-PARAM-TABLE(8) = 1
NR2001        CONTINUE
NR2001     ELSE
NR2001        MOVE CPY-BORM-LOAN-BAL TO BORM-LOAN-BAL
NR2001        MOVE CPY-BORM-THEO-LOAN-BAL TO BORM-THEO-LOAN-BAL
NR2001     END-IF.
NR2001
NR2001     IF NOT REDRAW-REFUND-TRAN
NR2001     AND NOT BORP-YOUBE
NR2001        PERFORM M1100-CALC-REPAYMENT THRU M1109-EXIT 
NR2001        IF WA-MSG-ERR-FLAG <> ZEROS
NR2001           GO TO B099-EXIT.
NR2001
NR2001     IF  BORM-REPAY-SCHED = 'N'
NR2001     AND WA-BEFORE-BORN-STAT     < 07
NR2001     AND WA-INPUT-PARAM-TABLE(7) = 0
NR2001         PERFORM D900-READ-BLDVNN THRU D909-EXIT
NR2001         IF WA-MSG-ERR-FLAG NOT = 0
NR2001            GO TO B099-EXIT
NR2001         END-IF
NR2001     END-IF.

S17755     IF  BORP-ILOAN-R
S17755     AND WA-BEFORE-BORN-STAT     < 07
S17755     AND BOIS-NEGO-RATE-IND      = "2"
S17755     AND WA-INPUT-PARAM-TABLE(7) = 0
S17755         PERFORM E200-RECONSTRUCT-BLDVNI THRU E200-EXIT
S17755         IF WA-MSG-ERR-FLAG  NOT = 0
S17755            GO TO B099-EXIT
S17755         END-IF
S17755     END-IF.
NR2001* MOVE FROM B010-CONTINUE PARAGRAPH
NR2001     IF  BORM-REPAY-TYPE = 9
S17580     AND BOIS-SORD-AUTO-DBT-ACCT-NO > 0
NR2001             PERFORM X300-FORMAT-SORD-START THRU X399-EXIT
NR2001             IF  WA-MSG-ERR-FLAG NOT = 0
NR2001                 GO TO B099-EXIT.
NR2001* END OF MOVE FROM B010-CONTINUE PARAGRAPH
NR2001
NR2001     MOVE BORM-LOAN-BAL          TO BOCT-01-BALANCE.
NR2001     IF  BORP-YOUBE                                
NR2001     AND (WA-ADV-AMORT-FLAG = "A" OR               
NR2001          WA-ADV-AMORT-FLAG = "F" OR               
NR2001          WA-ADV-AMORT-FLAG = "R")                 
NR2001     AND WA-INPUT-PARAM-TABLE(8) = 1               
NR2001         ADD BOCT-01-AMOUNT      TO BOCT-01-BALANCE
NR2001     END-IF.
NR2001     IF  BORP-YOUBE                                              
NR2001     AND WA-INPUT-PARAM-TABLE(7) = 1                             
NR2001         MOVE 20                 TO BOCT-STAT
NR2001     ELSE                                                        
NR2001         MOVE WA-TXN-STAT        TO BOCT-STAT
NR2001     END-IF.
021800     PERFORM W500-ADD-TXN THRU W599-EXIT.
021810     IF WA-MSG-ERR-FLAG = 1
021820        GO TO B099-EXIT.
S11050** CREATE BORV TO SAVE REPAY DAY
S11050     IF WA-INPUT-PARAM-TABLE(5) = 1
S11050        AND WA-INPUT-PARAM-TABLE(7) = 0
S11050        AND WA-BEFORE-BORN-STAT < 6
NR2001*S11050        MOVE  BORV-RECORD-AREA   TO WS-BORV-RECORD-AREA
NR2001*S11050        MOVE  SPACES             TO BORV-RECORD-AREA
NR2001*S11050        MOVE  54                 TO BORV-54-TRAN-TYPE
NR2001*S11050        MOVE  00                 TO BORV-54-TRAN-STATUS
NR2001*S11050        IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001*S11050           MOVE WA-STORE-TXN-DT   TO BORV-54-TRAN-DATE
NR2001*S11050        ELSE
NR2001*S11050           MOVE STRT-AREA-POST-DT TO BORV-54-TRAN-DATE
NR2001*S11050        END-IF
NR2001*S11050        MOVE  STRT-AREA-BRANCH   TO BORV-54-BRANCH
NR2001*S11050        MOVE  STRT-AREA-TERM-NO  TO BORV-54-BRANCH-TERM
NR2001*S11050        MOVE  STRT-AREA-TELL-NO  TO BORV-54-TELLER
NR2001*S11050        MOVE  STRT-AREA-TRN-NO   TO BORV-54-TRAN-CODE
NR2001*S11050        MOVE  STRT-AREA-POST-DT  TO BORV-54-POST-DATE
NR2001*S11050        MOVE  STRT-AREA-JRNL-NO  TO BORV-54-JRNL-NO
NR2001*S11050        MOVE  SPACES             TO BORV-54-DESC
NR2001*S11050        MOVE  WS-SAVE-REPAY-DAY  TO BORV-54-PREV-STATUS
NR2001*S11050        MOVE  BORM-REPAY-DAY     TO BORV-54-NEW-STATUS
NR2001*S11050        PERFORM W500-ADD-TXN THRU W599-EXIT
NR2001*S11050        IF WA-MSG-ERR-FLAG = 1
NR2001*S11050           GO TO B099-EXIT
NR2001*S11050        END-IF
NR2001*S11050        MOVE WS-BORV-RECORD-AREA TO BORV-RECORD-AREA
NR2001        MOVE  BOCT-RECORD-AREA    TO WS-BOCT-RECORD-AREA
NR2001        MOVE  SPACES              TO BOCT-RECORD-AREA
NR2001        INITIALIZE BOCT-TRAN-54   
NR2001        MOVE  54                  TO BOCT-TRAN-TYPE
NR2001        MOVE  0                   TO BOCT-STAT
NR2001        IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001           MOVE WA-STORE-TXN-DT   TO BOCT-TRN-DATE
NR2001        ELSE
NR2001           MOVE STRT-AREA-POST-DT TO BOCT-TRN-DATE
NR2001        END-IF
NR2001        MOVE  STRT-AREA-TRN-NO    TO BOCT-TRN-CODE
NR2001        MOVE  SPACES              TO BOCT-54-DESC
NR2001        MOVE  WS-SAVE-REPAY-DAY   TO BOCT-54-PREV-STATUS
NR2001        MOVE  BORM-REPAY-DAY      TO BOCT-54-NEW-STATUS
S17755        MOVE  WA-B4-DUE-IND       TO BOCT-54-PREV-DUE-IND
S17755        MOVE  BOIS-DUE-DTE-IND    TO BOCT-54-NEW-DUE-IND
NR2001        PERFORM W500-ADD-TXN THRU W599-EXIT
NR2001        IF WA-MSG-ERR-FLAG = 1
NR2001           GO TO B099-EXIT
NR2001        END-IF
NR2001        MOVE WS-BOCT-RECORD-AREA TO BOCT-RECORD-AREA
S11050     END-IF.
S11050
S17755     IF  BORP-ILOAN-R
S17755     AND WA-INPUT-PARAM-TABLE(7)      = 0
S17755     AND WA-INPUT-PARAM-TABLE(8)      = 1
S17755     AND BOIS-PREV-DUE-DATE           > 0
S17755     AND BOIS-ARREARS-CTR             = 0
S17755     AND STRT-AREA-POST-DT           >= BOIS-PREV-DUE-DATE
S17755     AND WA-STORE-TXN-DT              < BOIS-PREV-DUE-DATE
S17755         COMPUTE WA-BPI-INT-ACCR ROUNDED = WA-ADV-AMOUNT
S17755               * ( BOIS-PREV-DUE-DATE - WA-STORE-TXN-DT )
S17755               * ( BORM-STORE-RATE / 100 ) / BORP-INT-DAYS-YR
S17755
S17755         INITIALIZE BOCT-TRAN-33
S17755         MOVE 33                     TO BOCT-TRAN-TYPE
S17755         MOVE ZERO                   TO BOCT-STAT
S17755         MOVE STRT-AREA-POST-DT      TO BOCT-TRN-DATE
S17755         MOVE 10732                  TO BOCT-TRN-CODE
S17755         MOVE "INTADJ"               TO WA-33-MSG-TEXT
S17755         MOVE WA-BPI-INT-ACCR        TO WA-33-MSG-AMT
S17755         MOVE WA-33-MSG-AREA         TO BOCT-33-FREE-MSG
S17755         MOVE WA-STORE-TXN-DT        TO BOCT-33-AMEND-DATE
S17755         PERFORM W500-ADD-TXN THRU W599-EXIT
S17755     END-IF.

S11455     IF  WA-ADV-AMORT-FLAG = "S"                         
S11455     AND BORP-YOUBE                                      
NR2001*S11455        COMPUTE BORV-01-AMOUNT = BORV-01-AMOUNT * -1     
NR2001*S11455        MOVE WA-BEFORE-BORM-LOAN-BAL TO BORV-01-BALANCE  
NR2001*S11455        MOVE 13529                   TO BORV-01-TRN-CODE 
NR2001        COMPUTE BOCT-01-AMOUNT = BOCT-01-AMOUNT * -1     
NR2001        MOVE WA-BEFORE-BORM-LOAN-BAL TO BOCT-01-BALANCE  
NR2001        MOVE 13529                   TO BOCT-TRN-CODE 
S11455        PERFORM W500-ADD-TXN THRU W599-EXIT              
S11455        IF WA-MSG-ERR-FLAG = 1                           
S11455           GO TO B099-EXIT                               
S11455        END-IF                                           
S11455        MOVE ZERO TO WA-CTR-A                            
S11455        PERFORM VARYING WA-CTR-A FROM 1 BY 1             
S11455          UNTIL WA-CTR-A > 15                            
S11455             IF BR0024CA-TXN-CODE(WA-CTR-A) = 0          
NR2001*S11455                MOVE BORV-01-TRN-CODE TO                 
NR2001*S11455                     BR0024CA-TXN-CODE(WA-CTR-A)         
NR2001*S11455                MOVE BORV-01-AMOUNT   TO                 
NR2001*S11455                     BR0024CA-AMOUNT(WA-CTR-A)           
NR2001*S11455                MOVE BORV-01-BALANCE  TO                 
NR2001                MOVE BOCT-TRN-CODE TO                 
NR2001                     BR0024CA-TXN-CODE(WA-CTR-A)         
NR2001                MOVE BOCT-01-AMOUNT   TO                 
NR2001                     BR0024CA-AMOUNT(WA-CTR-A)           
NR2001                MOVE BOCT-01-BALANCE  TO                 
S11455                     BR0024CA-BALANCE(WA-CTR-A)          
S11455                MOVE 15            TO WA-CTR-A           
S11455             END-IF                                      
S11455        END-PERFORM                                      
S11455     END-IF.                                             
ST0049     IF BORP-YOUBE AND
S11455        WA-INPUT-PARAM-TABLE(8) = 1 AND
S11455        WA-ADV-AMORT-FLAG NOT = "S"    
S11455*       WA-INPUT-PARAM-TABLE(8) = 1
SC9610          IF ST-LOAN-BACKDATED-CORR-YES
SC9610             MOVE WA-SAVE-ST-AREA-TRN-NO TO UT0081CA-ORIG-TRCODE
SC9610          ELSE
SC9610             MOVE 0 TO UT0081CA-ORIG-TRCODE
SC9610          END-IF
ST0049          MOVE STRT-AREA-TRN-NO      TO UT0081CA-TRN-CODE
ST0049          IF WA-INPUT-PARAM-TABLE(7) = 1
ST0049             MOVE W800-CORR-JRNL-NO  TO UT0081CA-CORR-JRNL-NO
ST0049             MOVE STRT-AREA-JRNL-NO  TO UT0081CA-JRNL-NO
ST0049          ELSE
ST0049             MOVE STRT-AREA-JRNL-NO  TO UT0081CA-JRNL-NO
ST0049             MOVE 0                  TO UT0081CA-CORR-JRNL-NO
ST0049          END-IF
ST0049          MOVE WA-ADV-TXN-DATE       TO UT0030-DATE-DDMMCCYY
ST0049          MOVE 1                     TO UT0030-FUNCTION
ST0049          CALL "UT0030"           USING UT0030-FUNCTION
ST0049                                        UT0030-DATE-AREA
ST0049                                        UT0030-BINARY-DATE
ST0049          MOVE UT0030-BINARY-DATE    TO UT0081CA-TXN-DATE
ST0049          MOVE WA-ADV-AMOUNT         TO UT0081CA-TXN-AMOUNT
ST0049          MOVE STRT-AREA-BRANCH      TO UPTELLCA-BRCH
ST0049          MOVE STRT-AREA-TELL-NO     TO UPTELLCA-TELR
ST0049          CALL "UT0031"           USING UPTELLCA-PARAM-1
ST0049                                         UPTELLCA-PARAM-2
ST0049          MOVE UPTELLCA-TELLER-BRANCH TO UT0081CA-TELL-AND-BR
ST0049          MOVE STRT-AREA-MSG-TIME     TO UT0081CA-POST-TIME
ST0049          MOVE STRT-AREA-TERM-NO      TO UT0081CA-BRTERM
S10526          MOVE STRT-AREA-BATCH-TANDEM TO UT0081CA-BATCH-TANDEM
S11493*
S11439          MOVE 1                      TO UT0030-FUNCTION
S11439          MOVE WA-ADV-TXN-DATE        TO UT0030-DATE-DDMMCCYY
S11439          CALL "UT0030" USING UT0030-FUNCTION
S11439                              UT0030-DATE-AREA
S11439                              UT0030-BINARY-DATE
S11439          COMPUTE WA-BACKDATE-DAYS = WA-TODAY-BIN-DATE -
S11439                                     UT0030-BINARY-DATE
S11439          IF BORP-YOUBE AND STRT-BANCSLINK
S11439             AND WA-BACKDATE-DAYS <= BORP-BACKDATE-LIMIT-DAYS
S11439             AND STRT-AREA-BRANCH = "0622"
S11439             AND STRT-AREA-TRN-NO = 16057
S11439             MOVE "G" TO UT0081CA-BATCH-TANDEM
S11439          END-IF
S11455          IF WA-ADV-AMORT-FLAG = "A"                            
S11455          OR WA-ADV-AMORT-FLAG = "F"                            
S11455          OR WA-ADV-AMORT-FLAG = "R"                            
S11455             MOVE "G"                 TO UT0081CA-BATCH-TANDEM  
S11455             INITIALIZE UTYBAMCA-AREA                           
S11455             MOVE BORM-SOC-NO         TO UTYBAMCA-INST-NO       
S11455             MOVE BORM-MEMB-CUST-AC   TO UTYBAMCA-ACCT-NO       
S11455             MOVE WA-ADV-AMORT-JRNL-NO TO UTYBAMCA-AMORT-JRNL-NO
S11455             MOVE 02                  TO UTYBAMCA-CALL-CODE     
S11455             PERFORM Z910-CALL-UTYBAM                           
S11455                THRU Z910-EXIT                                  
S11455             IF WA-MSG-ERR-FLAG = 1                             
S11455                GO TO B099-EXIT                                 
S11455             END-IF                                             
S11455             IF UTYBAMCA-AMORT-TERM = 0                         
S11455                MOVE WA-TOT-FEE-AMT      TO UT0081CA-FEE-AMOUNT 
S11455             ELSE                                               
S11455                MOVE ZEROES              TO UT0081CA-FEE-AMOUNT 
S11455             END-IF                                             
S11455          ELSE                                                  
SC8285             MOVE WA-TOT-FEE-AMT      TO UT0081CA-FEE-AMOUNT    
S11455          END-IF                                                
ST0115          IF WA-INPUT-PARAM-TABLE(7) NOT = 1 
ST0115             PERFORM E000-CALL-UTYENQ        
ST0115                THRU E000-EXIT               
ST0115          ELSE                               
ST0115             PERFORM E100-CALL-UTYENQ-CORR   
ST0115                THRU E100-EXIT               
ST0115          END-IF                             
ST0049          CALL "UT0081"            USING UT0081CA-CALL-PARAM
ST0049                                         BORM-RECORD-AREA
ST0049                                         BOIS-RECORD
ST0049                                         BORP-RECORD-AREA
ST0049                                         BR0023CA-AREA
ST0049                                         BR0024CA-AREA
SC6571          IF UT0081CA-RET-STATUS NOT = ZEROES              
SC6571              MOVE UT8500CA-FUNC-NORMAL-DISPLAY            
SC6571                            TO UT8500CA-CALL-CODE          
SC6571              MOVE SPACES TO UT8500CA-INPUT-MSG            
SC6571              STRING "BR0024:(B000) ERROR UT0081, "        
SC6571                     ", RETURN CODE=" UT0081CA-RET-STATUS  
SC6571                     DELIMITED BY SIZE INTO                
SC6571                                  UT8500CA-INPUT-MSG       
SC6571              CALL "UT8500" USING  UT8500CA-AREA           
SC6571              IF UT0081CA-ERROR-MSG-NO NOT = ZERO          
SC6571                 MOVE UT0081CA-ERROR-MSG-NO TO             
SC6571                      WA-OUTPUT-ERR-MSG-NO                 
SC6571              END-IF                                       
SC6571              MOVE 1 TO ST-STATUS-LEVEL-1                  
SC6571                        WA-MSG-ERR-FLAG                    
SC6571              PERFORM W200-FMT-SEND-PARA THRU W299-EXIT    
SC7197          ELSE                                                  
SC7197              MOVE ZERO TO WA-CTR-A                             
SC7197              PERFORM VARYING WA-CTR-A FROM 1 BY 1              
SC7197                UNTIL WA-CTR-A > 15                             
SC7197                 IF UT0081CA-BUCKET-TXN-CODE(WA-CTR-A) NOT = 0
SC7197                    MOVE UT0081CA-BUCKET-TXN-CODE(WA-CTR-A) TO     
SC7197                                     BR0024CA-TXN-CODE(WA-CTR-A)
S11455*                END-IF                                       
SC7197                    ADD  UT0081CA-BUCKET-DUE(WA-CTR-A) TO        
SC7197                                     BR0024CA-AMOUNT(WA-CTR-A)
SC7197                    MOVE UT0081CA-BUCKET-BAL(WA-CTR-A) TO          
SC7197                                     BR0024CA-BALANCE(WA-CTR-A) 
S11455                 END-IF
SC7197              END-PERFORM                                       
SC6571          END-IF                                           
ST0049     END-IF.
S11455     IF  (WA-ADV-AMORT-FLAG = "S" OR                        
S11455          WA-ADV-AMORT-FLAG = "A" OR                        
S11455          WA-ADV-AMORT-FLAG = "F" OR                        
S11455          WA-ADV-AMORT-FLAG = "R")                          
S11455     AND BORP-YOUBE                                         
S11455        IF  WA-ADV-AMORT-FLAG = "S"                         
S11455        AND BOIS-AMORTIZED-IND NOT = "1"                    
S12026        AND BOIS-AMORTIZED-IND NOT = "2"
S11455        AND WA-INPUT-PARAM-TABLE(7) = 0                     
S11455            MOVE 1                   TO WA-MSG-ERR-FLAG     
S11455            MOVE 4647                TO WA-OUTPUT-ERR-MSG-NO
S11455            GO TO B099-EXIT                                 
S11455        END-IF                                              
S11455        PERFORM Z900-YOUBE-AMORTIZATION                     
S11455           THRU Z900-EXIT                                   
S11455        IF WA-MSG-ERR-FLAG = 1                              
S11455           GO TO B099-EXIT                                  
S11455        END-IF                                              
S11455        MOVE ZERO TO WA-CTR-A                               
S11455        PERFORM VARYING WA-CTR-A FROM 1 BY 1                
S11455          UNTIL WA-CTR-A > 15                               
S11455          IF UTYBAMCA-BUCKET-TXN-CODE(WA-CTR-A) NOT = ZEROES
S11455             MOVE ZERO TO WA-CTR-B                          
S11455             PERFORM VARYING WA-CTR-B FROM 1 BY 1           
S11455               UNTIL WA-CTR-B > 15                          
S11455               IF BR0024CA-TXN-CODE(WA-CTR-B) = 0           
S11455                  MOVE UTYBAMCA-BUCKET-TXN-CODE(WA-CTR-A) TO
S11455                       BR0024CA-TXN-CODE(WA-CTR-B)          
S11455                  MOVE UTYBAMCA-BUCKET-DUE(WA-CTR-A) TO     
S11455                       BR0024CA-AMOUNT(WA-CTR-B)            
S11455                  MOVE UTYBAMCA-BUCKET-BAL(WA-CTR-A) TO     
S11455                       BR0024CA-BALANCE(WA-CTR-B)           
S11455                  MOVE 15            TO WA-CTR-B            
S11455               END-IF                                       
S11455             END-PERFORM                                    
S11455          ELSE                                              
S11455             MOVE 15                 TO WA-CTR-A            
S11455          END-IF                                            
S11455        END-PERFORM                                         
S11455     END-IF.                                                
NR2001*021830     MOVE BORV-RECORD-AREA  TO BORV-RECORD-AREA-2.
NR2001*021840     IF ((BORP-CAPN-METHOD NOT = " ")
NR2001*021850     AND (BORP-CAPN-METHOD IS ALPHABETIC))
NR2001*021860         PERFORM M1400-ADD-COMM-TRAN-BORV THRU M1499-EXIT.
NR2001     MOVE BOCT-RECORD-AREA  TO BOCT-RECORD-AREA-2.
NR2001     IF ((BORP-CAPN-METHOD NOT = " ")
NR2001     AND (BORP-CAPN-METHOD IS ALPHABETIC))
NR2001         PERFORM M1400-ADD-COMM-TRAN-BOCT THRU M1499-EXIT.
TB0276
S12770     IF  (STRT-AREA-TRN-NO = 11057 OR 16057 OR 11157 OR 16157)
S12770     AND STRT-BANCSLINK
S12770     AND BORP-CONSMR AND BORP-REORG-CREDIT-PROD
S12770         INITIALIZE BOCT-TRAN-20
S12770         MOVE SPACES    TO BOCT-20-CHQ-PAYEE
S12770         MOVE "VIR"                 TO BOCT-20-RISK-LEVEL
S12770         MOVE VIR-AC-FOR-REORG-PROD TO BOCT-20-ACCT-NO-TRF-IN
S12770         IF NOT BOCT-20-CHQ-PAYEE = SPACES
S12770            MOVE 'TRUE'               TO WA-TEXT-AVAIL-FLAG
S12770            PERFORM M250-WRITE-NARRATIVE-TXN THRU M259-EXIT
S12770            IF  WA-MSG-ERR-FLAG = 1
S12770                GO TO B099-EXIT
S12770            END-IF
S12770         END-IF
S12770     END-IF.
S12770
TB0276     IF WA-INPUT-PARAM-TABLE(30) = 1
TB0276    AND WA-INPUT-PARAM-TABLE(23) = 0
SC7014*          IF WA-INPUT-PARAM-TABLE(05) = 1
SC7014*             MOVE SPACES    TO BORV-20-CHQ-PAYEE
SC7014*             INITIALIZE BORV-ATM-SEQ-NO
SC7014*                        BORV-ATM-DETAILS
SC7014*             MOVE ST-CYCLE            TO BORV-ATM-SEQ-NUM1
SC7014*             MOVE ST-MSGNO            TO BORV-ATM-SEQ-NUM2
SC7014*             MOVE BORV-01-TELL-AND-BR TO BORV-ATM-HOME-BRANCH
SC7014*             MOVE STRT-AREA-BRANCH    TO BORV-ATM-BRCH
SC7014*             MOVE WA-WDL-BANCS-ID-TRF-ACCT TO BORV-FRACCT-BANK-ID
SC7014*             IF WA-WDL-BANCS-ID-TRF-ACCT = 812
SC7014*                MOVE UPTELLCA-TELLER-BRANCH TO BORV-FR-BRANCH-NO
SC7014*                                               BORV-TO-BRANCH-NO
SC7014*             ELSE
SC7014*                MOVE ZEROES         TO BORV-FR-BRANCH-NO
SC7014*                                       BORV-TO-BRANCH-NO
SC7014*             END-IF
SC7014*             MOVE WA-WDL-FISC-TXN-CODE TO BORV-FEP-CODE
SC7014*          END-IF
SC7014*          IF NOT BORV-20-CHQ-PAYEE = SPACES
SC7014*             MOVE 'TRUE'               TO WA-TEXT-AVAIL-FLAG
SC7014*             PERFORM M250-WRITE-NARRATIVE-TXN THRU M259-EXIT
SC7014*             IF  WA-MSG-ERR-FLAG = 1
SC7014*                 GO TO B099-EXIT
SC7014*             END-IF
SC7014*          END-IF
NR2001*TB0276           MOVE SPACES             TO BORV-20-CHQ-PAYEE
NR2001*SC7014*          MOVE STRT-AREA-BATCH-TANDEM TO BORV-20-CHANNEL-TYPE
NR2001*TB0276           IF WA-INPUT-PARAM-TABLE(05) = 1
NR2001*SC6500              IF WA-INPUT-PARAM-TABLE (20) = 1 AND
NR2001*SC6500**SC7091         STRT-AREA-TRN-NO NOT = 14050 AND
NR2001*SC6500**SC7091                          NOT = 14150
NR2001*SC7091**SC7091         STRT-AREA-TRN-NO NOT = 19050 AND
NR2001*SC7091**SC7091                          NOT = 19150
NR2001*SC7091               ( STRT-AREA-TRN-NO NOT = 14050 AND 14150
NR2001*SC7091                                    AND 19050 AND 19150 )
NR2001*SC6500              MOVE WA-TRF-RISK-LEVEL
NR2001*SC6500                TO BORV-20-RISK-LEVEL
NR2001*SC6500              MOVE WA-TFR-ATM-3 TO
NR2001*SC6500                   BORV-20-ATM-3
NR2001*SC6500              MOVE WA-TFR-ATM-7 TO
NR2001*SC6500                   BORV-20-ATM-7
NR2001*SC7014              IF WA-TRF-ATM-TRACE-NO = SPACES
NR2001*SC7014              OR WA-TRF-ATM-TRACE-NO-9 = 0
NR2001*SC7014                 MOVE ST-CYCLE TO BORV-ATM-SEQ-NUM1
NR2001*SC7014                 MOVE ST-MSGNO TO BORV-ATM-SEQ-NUM2
NR2001*SC7014              END-IF
NR2001*SC6500              IF STRT-AREA-TRN-NO  = 14045 OR 14145
NR2001*SC6500                 MOVE W800-FROM-ACCT TO
NR2001*SC6500                      BORV-20-ACCT-NO-TRF-IN
NR2001*SC6500              ELSE
NR2001*SC6500                 MOVE W800-TO-ACCT TO
NR2001*SC6500                      BORV-20-ACCT-NO-TRF-IN
NR2001*SC6500              END-IF
NR2001*SC7014              MOVE WA-TRF-SETTLEMENT-DATE
NR2001*SC7014                TO BORV-20-SETTLEMENT-DATE
NR2001*SC6500              MOVE WA-TRF-FISC-TXN-CODE
NR2001*SC6500                TO BORV-20-FISC-TXN-CODE
NR2001*SC6500              MOVE WA-TRF-RUN-METHOD
NR2001*SC6500                TO BORV-20-RUN-METHOD
NR2001*SC6500              ELSE
NR2001*TB0276              MOVE WA-WDL-RISK-LEVEL
NR2001*TB0276                TO BORV-20-RISK-LEVEL
NR2001*TB0276              IF NOT WA-WDL-BANCS-ID-TRF-ACCT = 0
NR2001*TB0276                 MOVE WA-WDL-BANCS-ID-TRF-ACCT
NR2001*TB0276                   TO BORV-20-BANCS-ID-TRF-ACCT
NR2001*TB0276              END-IF
NR2001*TB0276              IF NOT WA-WDL-ACCT-NO-TRF-IN = 0
NR2001*TB0276                 MOVE WA-WDL-ACCT-NO-TRF-IN
NR2001*TB0276                   TO BORV-20-ACCT-NO-TRF-IN
NR2001*TB0276              END-IF
NR2001*TB0276*             MOVE WA-WDL-ATM-TRACE-NO                     SC6500
NR2001*TB0276*               TO BORV-20-ATM-TRACE-NO                    SC6500
NR2001*SC6500                MOVE WA-WDL-ATM-3 TO
NR2001*SC6500                     BORV-20-ATM-3
NR2001*SC6500                MOVE WA-WDL-ATM-7 TO
NR2001*SC6500                     BORV-20-ATM-7
NR2001*SC7014                IF WA-WDL-ATM-TRACE-NO = SPACES
NR2001*SC7014                OR WA-WDL-ATM-TRACE-NO-9 = 0
NR2001*SC7014                   MOVE ST-CYCLE TO BORV-ATM-SEQ-NUM1
NR2001*SC7014                   MOVE ST-MSGNO TO BORV-ATM-SEQ-NUM2
NR2001*SC7014                END-IF
NR2001*SC7014              MOVE WA-WDL-SETTLEMENT-DATE
NR2001*SC7014                TO BORV-20-SETTLEMENT-DATE
NR2001*TB0276              MOVE WA-WDL-FISC-TXN-CODE
NR2001*TB0276                TO BORV-20-FISC-TXN-CODE
NR2001*TB0276              MOVE WA-WDL-RUN-METHOD
NR2001*TB0276                TO BORV-20-RUN-METHOD
NR2001*SC6500              END-IF
NR2001*TB0276           END-IF
NR2001*TB0276           IF NOT BORV-20-CHQ-PAYEE = SPACES
NR2001*TB0276              MOVE 'TRUE'               TO WA-TEXT-AVAIL-FLAG
S17755           MOVE STRT-AREA-TRN-NO   TO BOCT-TRN-CODE
NR2001           INITIALIZE BOCT-TRAN-20
NR2001           MOVE SPACES             TO BOCT-20-CHQ-PAYEE
NR2001           IF WA-INPUT-PARAM-TABLE(05) = 1
NR2001              IF WA-INPUT-PARAM-TABLE (20) = 1 AND
NR2001               ( STRT-AREA-TRN-NO NOT = 14050 AND 14150
NR2001                                    AND 19050 AND 19150 )
NR2001              MOVE WA-TRF-RISK-LEVEL
NR2001                TO BOCT-20-RISK-LEVEL
NR2001              MOVE WA-TFR-ATM-3 TO
NR2001                   BOCT-20-ATM-3
NR2001              MOVE WA-TFR-ATM-7 TO
NR2001                   BOCT-20-ATM-7
NR2001              IF WA-TRF-ATM-TRACE-NO = SPACES
T20184*NR2001              OR WA-TRF-ATM-TRACE-NO-9 = 0
T20184              OR WA-TRF-ATM-TRACE-NO-9 = '0000000'
T20184              OR WA-TRF-ATM-TRACE-NO-9 = SPACES
NR2001                 MOVE ST-CYCLE TO BOCT-20-ATM-SEQ-NUM1
NR2001                 MOVE ST-MSGNO TO BOCT-20-ATM-SEQ-NUM2
NR2001              END-IF
NR2001              IF STRT-AREA-TRN-NO  = 14045 OR 14145
NR2001                 MOVE W800-FROM-ACCT TO
NR2001                      BOCT-20-ACCT-NO-TRF-IN
NR2001              ELSE
NR2001                 MOVE W800-TO-ACCT TO
NR2001                      BOCT-20-ACCT-NO-TRF-IN
NR2001              END-IF
NR2001              MOVE WA-TRF-SETTLEMENT-DATE
NR2001                TO BOCT-20-SETTLEMENT-DATE
NR2001              MOVE WA-TRF-FISC-TXN-CODE
NR2001                TO BOCT-20-FISC-TXN-CODE
NR2001              MOVE WA-TRF-RUN-METHOD
NR2001                TO BOCT-20-RUN-METHOD
NR2001              ELSE
NR2001              MOVE WA-WDL-RISK-LEVEL
NR2001                TO BOCT-20-RISK-LEVEL
NR2001              IF NOT WA-WDL-BANCS-ID-TRF-ACCT = 0
NR2001                 MOVE WA-WDL-BANCS-ID-TRF-ACCT
NR2001                   TO BOCT-20-BANCS-ID-TRF-ACCT
NR2001              END-IF
NR2001              IF NOT WA-WDL-ACCT-NO-TRF-IN = 0
NR2001                 MOVE WA-WDL-ACCT-NO-TRF-IN
NR2001                   TO BOCT-20-ACCT-NO-TRF-IN
NR2001              END-IF
NR2001                MOVE WA-WDL-ATM-3 TO
NR2001                     BOCT-20-ATM-3
NR2001                MOVE WA-WDL-ATM-7 TO
NR2001                     BOCT-20-ATM-7
NR2001                IF WA-WDL-ATM-TRACE-NO = SPACES
T20184*NR2001                OR WA-WDL-ATM-TRACE-NO-9 = 0
T20184                OR WA-WDL-ATM-TRACE-NO-9 = '0000000'
T20184                OR WA-WDL-ATM-TRACE-NO-9 = SPACES
NR2001                   MOVE ST-CYCLE TO BOCT-20-ATM-SEQ-NUM1
NR2001                   MOVE ST-MSGNO TO BOCT-20-ATM-SEQ-NUM2
NR2001                END-IF
NR2001              MOVE WA-WDL-SETTLEMENT-DATE
NR2001                TO BOCT-20-SETTLEMENT-DATE
NR2001              MOVE WA-WDL-FISC-TXN-CODE
NR2001                TO BOCT-20-FISC-TXN-CODE
NR2001              MOVE WA-WDL-RUN-METHOD
NR2001                TO BOCT-20-RUN-METHOD
NR2001              END-IF
NR2001           END-IF
NR2001           IF NOT BOCT-20-CHQ-PAYEE = SPACES
NR2001              MOVE 'TRUE'               TO WA-TEXT-AVAIL-FLAG
TB0276              PERFORM M250-WRITE-NARRATIVE-TXN THRU M259-EXIT
TB0276              IF  WA-MSG-ERR-FLAG = 1
TB0276                  GO TO B099-EXIT
TB0276              END-IF
TB0276           END-IF
TB0276           PERFORM PERFORM M200-GENERIC-NARRATIVE-PARA
TB0276              THRU M209-EXIT
TB0276           IF  WA-MSG-ERR-FLAG = 1
TB0276               GO TO B099-EXIT
TB0276           END-IF
TB0276     END-IF.
TB0276
021870     MOVE STRT-AREA-TRN-NO TO LINK-IN-TXCODE.
021880     PERFORM M1600-LOAD-ED2 THRU M1699-EXIT.
021890*
021900* FOR A NARRATIVE TRANSACTION, ALSO WRITE AN BORV 20 RECORD
021910*
021920     MOVE "FALSE" TO WA-TEXT-AVAIL-FLAG.
021930     IF WA-INPUT-PARAM-TABLE(30) NOT = 1                                 
021940        IF (LINK-NARR-TXN-TYPE = 20) OR
021950           (WA-NARR-TEXT NOT = SPACES) OR
021960           ((WA-DUMMY-LST-TWO >= 80) AND (WA-DUMMY-LST-TWO <= 89))
021970            PERFORM M200-GENERIC-NARRATIVE-PARA THRU M209-EXIT
021980        END-IF
021990     END-IF.                                                             
022000*
022010* FOR A TRANSFER TRANSACTION (WHERE A TYPE '20' WASN'T WRITTEN),
022020* WRITE AN BORV 36 RECORD.
022030*
022040*    IF (LINK-NARR-TXN-TYPE = 36) AND
022050*       WA-NO-TEXT-AVAIL
TB0082**--
S11455*    IF STRT-AREA-TRN-NO = 11057 OR 16057                  
S11455     IF STRT-AREA-TRN-NO = 11057 OR 16057 OR 11069 OR 16069
SC4522     OR FEDI-FROM-TO-GL
TB0082        MOVE WA-DEP-ACCT-NO TO WA-TRANSFER-ACCOUNT-AREA
TB0082     END-IF.
TB0082**--
022060     IF (LINK-NARR-TXN-TYPE = 36)
022070         PERFORM M1700-WRITE-TYPE-36 THRU M1799-EXIT
022080     END-IF.
022090*
022100     IF WA-MSG-ERR-FLAG = 1
022110        GO TO B099-EXIT.
022120*
S16081*022130     IF STRT-AREA-TRN-NO = 13509 OR 13609
S16081     IF STRT-AREA-TRN-NO = 13509 OR 13609 OR 13730 OR 13830
022140        GO TO B050-BYPASS-PPP.
022150     IF  (WA-INPUT-PARAM-TABLE (5) = 1)
022160     AND ((WA-PPP-INITIAL-ADVANCE = 1) OR (BORM-ADV-VAL = 0))
022170     AND (WA-PPP-INITIAL-ADVANCE = 1)
022180         NEXT SENTENCE
022190     ELSE
022200         GO TO B050-BYPASS-PPP.
NR2001*022210     MOVE BORV-RECORD-AREA TO BORV-RECORD-AREA-8.
NR2001*022220     MOVE BORV-RECORD-AREA-2 TO BORV-RECORD-AREA.
NR2001     MOVE BOCT-RECORD-AREA TO BOCT-RECORD-AREA-8.
NR2001     MOVE BOCT-RECORD-AREA-2 TO BOCT-RECORD-AREA.
022230     MOVE BORM-TERM-BASIS TO UT0510CA-TERM-BASIS.
022240     MOVE 02 TO UT0510CA-CALL-CODE.
022250     MOVE STRT-AREA-SOC-NO TO UT0510CA-INST-NO.
022260     CALL "UT0510" USING

022280             CALL-UT0510-AREA.
022290     IF UT0510RA-ERR-MSG-NO NOT = ZERO
022300         MOVE UT0510RA-ERR-MSG-NO TO WA-OUTPUT-ERR-MSG-NO
022310         MOVE 1 TO WA-MSG-ERR-FLAG
022320         GO TO B099-EXIT.
022330     IF WA-INPUT-PARAM-TABLE (7) = 1
022340         ADD 1 TO UT0510RA-PREM-TXN-CODE.
022350     MOVE UT0510RA-PREM-TXN-CODE TO LINK-IN-TXCODE.
022360     PERFORM M1600-LOAD-ED2 THRU M1699-EXIT.
022370     IF WA-MSG-ERR-FLAG = 1
022380        GO TO B099-EXIT.
022390     MOVE LINK-IN-TXCODE  TO WA-PPP-PREM-TXN-CODE.
022400     MOVE UT0510RA-PREM-SUB-LEDG TO WA-PPP-PREM-SUB-LEDG.
022410     MOVE LINK-EDIT-TABLE TO WA-PPP-EDIT-MASK-1-2.
022420     MOVE LINK-BOR-CODE   TO WA-PPP-LEDGER-CODE.
022430     IF  WA-INPUT-PARAM-TABLE(7) = 1
022440         MOVE BORM-LOAN-BAL      TO WA-BORM-LOAN-BAL-EX-PPP
022450         MOVE STRT-AREA-LEDG-CODE    TO  WA-LEDGER-CODE
022460         MOVE LINK-PRIORITY-CODE TO WA-PRIORITY-CODE
022470*        MOVE BORM-INS-PREMIUM       TO  WA-AMOUNT-TO-ADD
022480         MOVE BINS-PREMIUM       TO  WA-AMOUNT-TO-ADD
022490         MULTIPLY -1 BY WA-AMOUNT-TO-ADD
022500         MOVE BORM-LOAN-BAL          TO  CPY-BORM-LOAN-BAL
022510         MOVE BORM-THEO-LOAN-BAL     TO  CPY-BORM-THEO-LOAN-BAL
022520         IF BORP-PRIORITY-CODE-ON
022530            IF WA-PRIORITY-CODE = SPACES
TB0084               IF BORP-PRIORITY-TERM-BY-TERM
TB0084                  PERFORM M100-CALL-UT0094 THRU M109-EXIT
TB0084               ELSE
022540                  PERFORM M000-CALL-UT0095 THRU M099-EXIT
TB0084               END-IF
022550               IF WA-MSG-ERR-FLAG = 1
022560                  GO TO B099-EXIT
022570               END-IF
022580            ELSE
TB0084               PERFORM N400-SEARCH-PRIORITY THRU N409-EXIT
TB0084               IF WA-MSG-ERR-FLAG = 1
TB0084                  GO TO B099-EXIT
TB0084               END-IF
022590               PERFORM N000-ADD-TO-LOAN-BAL THRU NADD-EXIT
022600            END-IF
022610         ELSE
022620            PERFORM N100-ADD-TO-LOAN-BAL THRU N199-EXIT
022630         END-IF
022640         MOVE CPY-BORM-LOAN-BAL      TO  BORM-LOAN-BAL
022650         MOVE CPY-BORM-THEO-LOAN-BAL TO  BORM-THEO-LOAN-BAL
022660*        MULTIPLY BORM-INS-PREMIUM BY -1
022670         MULTIPLY BINS-PREMIUM BY -1
NR2001*022680                  GIVING WA-BORM-INS-PREMIUM BORV-01-AMOUNT
NR2001                  GIVING WA-BORM-INS-PREMIUM BOCT-01-AMOUNT
022690         IF BORM-LOAN-BAL = 0
022700             PERFORM M301-SEARCH-OLD-TRAN THRU M309-EXIT
022710         ELSE
022720             MOVE 6 TO BORM-STAT
022730         END-IF
022740     ELSE
022750*        MOVE BORM-INS-PREMIUM   TO WA-BORM-INS-PREMIUM
022760         MOVE BINS-PREMIUM       TO WA-BORM-INS-PREMIUM
NR2001*022770                                    BORV-01-AMOUNT
NR2001                                    BOCT-01-AMOUNT
022780         MOVE BORM-LOAN-BAL      TO WA-BORM-LOAN-BAL-EX-PPP
022790*        MOVE BORM-INS-PREMIUM       TO  WA-AMOUNT-TO-ADD
022800         MOVE BINS-PREMIUM       TO  WA-AMOUNT-TO-ADD
022810         MOVE STRT-AREA-LEDG-CODE    TO  WA-LEDGER-CODE
022820         MOVE STRT-AREA-PRIORITY-CODE TO WA-PRIORITY-CODE
022830         MOVE BORM-LOAN-BAL          TO  CPY-BORM-LOAN-BAL
022840         MOVE BORM-THEO-LOAN-BAL     TO  CPY-BORM-THEO-LOAN-BAL
022850         IF BORP-PRIORITY-CODE-ON
022860            IF WA-PRIORITY-CODE = SPACES
TB0084               IF BORP-PRIORITY-TERM-BY-TERM
TB0084                  PERFORM M100-CALL-UT0094 THRU M109-EXIT
TB0084               ELSE
022870                  PERFORM M000-CALL-UT0095 THRU M099-EXIT
TB0084               END-IF
022880               IF WA-MSG-ERR-FLAG = 1
022890                  GO TO B099-EXIT
022900               END-IF
022910            ELSE
TB0084               PERFORM N400-SEARCH-PRIORITY THRU N409-EXIT
TB0084               IF WA-MSG-ERR-FLAG = 1
TB0084                  GO TO B099-EXIT
TB0084               END-IF
022920               PERFORM N000-ADD-TO-LOAN-BAL THRU NADD-EXIT
022930            END-IF
022940         ELSE
022950            PERFORM N100-ADD-TO-LOAN-BAL THRU N199-EXIT
022960         END-IF
022970         MOVE CPY-BORM-LOAN-BAL      TO  BORM-LOAN-BAL
022980         MOVE CPY-BORM-THEO-LOAN-BAL TO  BORM-THEO-LOAN-BAL
022990     END-IF.
023000     IF  WA-INPUT-PARAM-TABLE(6) = 1
NR2001*023010         ADD BORV-01-AMOUNT      TO BORM-NPB-VAL
NR2001*023020         ADD 1                   TO BORM-NO-NPB.
NR2001*023030     MOVE UT0510RA-PREM-TXN-CODE TO BORV-01-TRN-CODE.
NR2001*023040*    MOVE BORM-INS-PREMIUM TO WA-BORM-INS-PREMIUM
NR2001*023050     MOVE BINS-PREMIUM TO WA-BORM-INS-PREMIUM
NR2001*023060                              BORV-01-AMOUNT.
NR2001         ADD BOCT-01-AMOUNT      TO BORM-NPB-VAL
NR2001         ADD 1                   TO BORM-NO-NPB.
NR2001     MOVE UT0510RA-PREM-TXN-CODE TO BOCT-TRN-CODE.
NR2001     MOVE BINS-PREMIUM TO WA-BORM-INS-PREMIUM
NR2001                              BOCT-01-AMOUNT.
023070     MOVE STRT-AREA-LEDG-CODE    TO  WA-LEDGER-CODE.
023080     MOVE STRT-AREA-PRIORITY-CODE TO WA-PRIORITY-CODE.
023090*    MOVE BORM-INS-PREMIUM       TO  WA-AMOUNT-TO-ADD.
023100     MOVE BINS-PREMIUM       TO  WA-AMOUNT-TO-ADD.
023110     MOVE BORM-LOAN-BAL          TO  CPY-BORM-LOAN-BAL.
023120     MOVE BORM-THEO-LOAN-BAL     TO  CPY-BORM-THEO-LOAN-BAL.
023130*
023140     IF BORP-PRIORITY-CODE-ON
023150        IF WA-PRIORITY-CODE = SPACES
TB0084           IF BORP-PRIORITY-TERM-BY-TERM
TB0084              PERFORM M100-CALL-UT0094 THRU M109-EXIT
TB0084           ELSE
023160              PERFORM M000-CALL-UT0095 THRU M099-EXIT
TB0084           END-IF
023170           IF WA-MSG-ERR-FLAG = 1
023180              GO TO B099-EXIT
023190           END-IF
023200        ELSE
TB0084           PERFORM N400-SEARCH-PRIORITY THRU N409-EXIT
TB0084           IF WA-MSG-ERR-FLAG = 1
TB0084              GO TO B099-EXIT
TB0084           END-IF
023210           PERFORM N000-ADD-TO-LOAN-BAL THRU NADD-EXIT
023220        END-IF
023230     ELSE
023240        PERFORM N100-ADD-TO-LOAN-BAL THRU N199-EXIT
023250     END-IF.
023260*
023270     MOVE CPY-BORM-LOAN-BAL      TO  BORM-LOAN-BAL.
023280     MOVE CPY-BORM-THEO-LOAN-BAL TO  BORM-THEO-LOAN-BAL.
NR2001*023290     MOVE BORM-LOAN-BAL    TO BORV-01-BALANCE.
NR2001*023300     MOVE WA-ADV-PROMO    TO BORV-01-PROMO-NO.
NR2001*023310     MOVE UT0510RA-PREM-SUB-LEDG TO BORV-01-SUB-LEDG-CODE.
NR2001     MOVE BORM-LOAN-BAL    TO BOCT-01-BALANCE.
NR2001     MOVE WA-ADV-PROMO    TO BOCT-01-PROMO-NO.
NR2001     MOVE UT0510RA-PREM-SUB-LEDG TO BOCT-01-SUB-LEDG-CODE.
TB0244***
TB0244*** IF FOR TIB
TB0244***
TB0244     IF SOC-SITE-TIB
TB0244        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
TB0244                X000-EXIT
TB0244     END-IF.
023320     PERFORM W500-ADD-TXN THRU W599-EXIT.
023330     IF  WA-MSG-ERR-FLAG = 1
023340         GO TO B099-EXIT.
NR2001*023350     MOVE BORV-RECORD-AREA TO BORV-RECORD-AREA-9.
NR2001*023360     MOVE BORV-RECORD-AREA-8 TO BORV-RECORD-AREA.
NR2001     MOVE BOCT-RECORD-AREA   TO BOCT-RECORD-AREA-9.
NR2001     MOVE BOCT-RECORD-AREA-8 TO BOCT-RECORD-AREA.
023370 B050-BYPASS-PPP.

023390*** 74I012 BEGIN ***
023400*** RETROFIT FROM HEL007A
023410***--------------------------------------------------------------
023420*** IF ATM TXN WRITE BORV TYPE 02.
023430***--------------------------------------------------------------
023440     IF STRT-AREA-OTHER-OVERRIDE = "7"
SC7014     AND NOT SOC-SITE-TIB
023450        IF STRT-AREA-TRN-NO NOT = 18064
NR2001*023460           INITIALIZE              BORV-02-DETAIL
NR2001*023470           MOVE 02                 TO BORV-02-CODE
NR2001*023480           MOVE TPATM-TXN-DATE   TO UT0030-DATE-DDMMCCYY
NR2001*023490           MOVE 1                  TO UT0030-FUNCTION
NR2001*023500           CALL "UT0030"   USING      UT0030-FUNCTION
NR2001*023510                                      UT0030-DATE-AREA
NR2001*023520                                      UT0030-BINARY-DATE
NR2001*023530           MOVE UT0030-BINARY-DATE TO BORV-02-TRN-DATE
NR2001*023540           MOVE TPATM-PURCH-DATE   TO UT0030-DATE-DDMMCCYY
NR2001*023550           MOVE 1                  TO UT0030-FUNCTION
NR2001*023560           CALL "UT0030" USING UT0030-FUNCTION UT0030-DATE-AREA
NR2001*023570                               UT0030-BINARY-DATE
NR2001*023580           MOVE UT0030-BINARY-DATE TO BORV-02-PURCHASE-DATE
NR2001*023590           MOVE TPATM-MERCH-NAME    TO BORV-02-MERCHANT-NAME
NR2001*023600           MOVE TPATM-MERCH-CITY    TO BORV-02-MERCH-CITY
NR2001*023610           PERFORM T001-VALIDATE-FOREIGN-TXN THRU T099-EXIT
NR2001*023620           MOVE WA-ATM-CARD-NO    TO BORV-02-CARD-NO
NR2001           INITIALIZE BOCT-TRAN-02
NR2001           MOVE 02                  TO BOCT-TRAN-TYPE
NR2001           MOVE 0                   TO BOCT-STAT
NR2001           MOVE STRT-AREA-TRN-NO    TO BOCT-TRN-CODE
NR2001           MOVE TPATM-TXN-DATE      TO UT0030-DATE-DDMMCCYY
NR2001           MOVE 1                   TO UT0030-FUNCTION
NR2001           CALL "UT0030"   USING       UT0030-FUNCTION
NR2001                                       UT0030-DATE-AREA
NR2001                                       UT0030-BINARY-DATE
NR2001           MOVE UT0030-BINARY-DATE  TO BOCT-TRN-DATE
NR2001           MOVE TPATM-PURCH-DATE    TO UT0030-DATE-DDMMCCYY
NR2001           MOVE 1                   TO UT0030-FUNCTION
NR2001           CALL "UT0030" USING UT0030-FUNCTION UT0030-DATE-AREA
NR2001                               UT0030-BINARY-DATE
NR2001           MOVE UT0030-BINARY-DATE  TO BOCT-02-PURCHASE-DATE
NR2001           MOVE TPATM-MERCH-NAME    TO BOCT-02-MERCHANT-NAME
NR2001           MOVE TPATM-MERCH-CITY    TO BOCT-02-MERCH-CITY
NR2001           PERFORM T001-VALIDATE-FOREIGN-TXN THRU T099-EXIT
NR2001           MOVE WA-ATM-CARD-NO      TO BOCT-02-CARD-NO
023630           PERFORM W500-ADD-TXN    THRU W599-EXIT
023640     END-IF.
023650***--------------------------------------------------------------
023660*** IF VISA TXN WRITE BORV TYPE 02 AND 03 FOR
023670*** VISA TXN 16065-OFF SYSTEM NPB PURCHASE
023680***      TXN 16061-OFF SYSTEM NPB ADVANCE.
023690***      TXN 16066-CREDIT CHARGEBACK
023700***      TXN 16161-CORRECTION NPB VISA ADVANCE
023710***      TXN 16165-CORRECTION NPB VISA PURCHASE
023720***--------------------------------------------------------------
023730     IF STRT-AREA-TRN-NO = 16065 OR 16061 OR 16066
023740                                 OR 16161 OR 16165
NR2001*023750           INITIALIZE              BORV-02-DETAIL
NR2001*023760           MOVE 02                 TO BORV-02-CODE
NR2001*023770           MOVE WA-ADV-TXN-DATE    TO UT0030-DATE-DDMMCCYY              
NR2001*023780           MOVE 1                  TO UT0030-FUNCTION
NR2001*023790           CALL "UT0030"   USING      UT0030-FUNCTION
NR2001*023800                                      UT0030-DATE-AREA
NR2001*023810                                      UT0030-BINARY-DATE
NR2001*023820           MOVE UT0030-BINARY-DATE TO BORV-02-TRN-DATE
NR2001*023830                                      WA-03-TRAN-DATE
NR2001*023840           MOVE TPATM-PURCH-DATE   TO UT0030-DATE-DDMMCCYY
NR2001*023850           MOVE 1                  TO UT0030-FUNCTION
NR2001*023860           CALL "UT0030" USING UT0030-FUNCTION UT0030-DATE-AREA
NR2001*023870                               UT0030-BINARY-DATE
NR2001*023880           MOVE UT0030-BINARY-DATE TO BORV-02-PURCHASE-DATE
NR2001*023890           MOVE TPATM-MERCH-NAME   TO BORV-02-MERCHANT-NAME
NR2001*023900           MOVE TPATM-MERCH-CITY   TO BORV-02-MERCH-CITY
NR2001*023910           MOVE WA-VISA-CARD-NO    TO BORV-02-CARD-NO
NR2001           INITIALIZE BOCT-TRAN-02
NR2001           MOVE 02                 TO BOCT-TRAN-TYPE
NR2001           MOVE 0                  TO BOCT-STAT
NR2001           MOVE STRT-AREA-TRN-NO   TO BOCT-TRN-CODE
NR2001           MOVE WA-ADV-TXN-DATE    TO UT0030-DATE-DDMMCCYY              
NR2001           MOVE 1                  TO UT0030-FUNCTION
NR2001           CALL "UT0030"   USING      UT0030-FUNCTION
NR2001                                      UT0030-DATE-AREA
NR2001                                      UT0030-BINARY-DATE
NR2001           MOVE UT0030-BINARY-DATE TO BOCT-TRN-DATE
NR2001                                      WA-03-TRAN-DATE
NR2001           MOVE TPATM-PURCH-DATE   TO UT0030-DATE-DDMMCCYY
NR2001           MOVE 1                  TO UT0030-FUNCTION
NR2001           CALL "UT0030" USING UT0030-FUNCTION UT0030-DATE-AREA
NR2001                               UT0030-BINARY-DATE
NR2001           MOVE UT0030-BINARY-DATE TO BOCT-02-PURCHASE-DATE
NR2001           MOVE TPATM-MERCH-NAME   TO BOCT-02-MERCHANT-NAME
NR2001           MOVE TPATM-MERCH-CITY   TO BOCT-02-MERCH-CITY
NR2001           MOVE WA-VISA-CARD-NO    TO BOCT-02-CARD-NO
023920           PERFORM W500-ADD-TXN    THRU W599-EXIT
NR2001*023930*** SET UP BORV TXN TYPE 03
NR2001*023940           INITIALIZE                  BORV-03-DETAIL
NR2001*023950           MOVE 03                  TO BORV-03-CODE
NR2001*023960           MOVE WA-03-TRAN-DATE     TO BORV-03-TRN-DATE
NR2001*023970           MOVE TPATM-MERCH-CITY    TO BORV-03-MERCH-CITY
NR2001*023980           MOVE TPATM-RETRIEVAL-REF TO BORV-03-RETRIEVAL-REF
NR2001*023990           MOVE TPATM-MERCH-CTRY-CODE TO
NR2001*024000                                       BORV-03-MERCH-COUNTRY-CODE
NR2001*024010           PERFORM T001-VALIDATE-FOREIGN-TXN THRU T099-EXIT
NR2001*024020           IF (TPATM-FOREIGN-CURR-AMT NOT = 0)
NR2001*024030               MOVE TPATM-FOREIGN-CURR-AMT TO
NR2001*024040                                       BORV-03-FOREIGN-CURR-AMT
NR2001*024050               MOVE TPATM-FOREIGN-CURCODE   TO
NR2001*024060                                       BORV-03-FOREIGN-CURR-CD
NR2001*024070           ELSE
NR2001*024080               MOVE 0      TO BORV-03-FOREIGN-CURR-AMT
NR2001*024090               MOVE SPACES TO BORV-03-FOREIGN-CURR-CD
NR2001*024100           END-IF
NR2001*** SET UP BOCT TXN TYPE 03
NR2001           INITIALIZE BOCT-TRAN-03
NR2001           MOVE 03                    TO BOCT-TRAN-TYPE
NR2001           MOVE 0                     TO BOCT-STAT
NR2001           MOVE WA-03-TRAN-DATE       TO BOCT-TRN-DATE
NR2001           MOVE STRT-AREA-TRN-NO      TO BOCT-TRN-CODE
NR2001           MOVE TPATM-MERCH-CITY      TO BOCT-03-MERCH-CITY
NR2001           MOVE TPATM-RETRIEVAL-REF   TO BOCT-03-RETRIEVAL-REF
NR2001           MOVE TPATM-MERCH-CTRY-CODE TO
NR2001                                       BOCT-03-MERCH-COUNTRY-CODE
NR2001           PERFORM T001-VALIDATE-FOREIGN-TXN THRU T099-EXIT
NR2001           IF (TPATM-FOREIGN-CURR-AMT NOT = 0)
NR2001               MOVE TPATM-FOREIGN-CURR-AMT TO
NR2001                                       BOCT-03-FOREIGN-CURR-AMT
NR2001               MOVE TPATM-FOREIGN-CURCODE   TO
NR2001                                       BOCT-03-FOREIGN-CURR-CD
NR2001           ELSE
NR2001               MOVE 0      TO BOCT-03-FOREIGN-CURR-AMT
NR2001               MOVE SPACES TO BOCT-03-FOREIGN-CURR-CD
NR2001           END-IF
024110           PERFORM W500-ADD-TXN    THRU W599-EXIT
024120     END-IF.
024130*** 74I012 END ***
024140*
024150     IF BORM-RESIDUAL-IND NOT = "9"
024160        MOVE BORM-RESIDUAL-IND TO WA-EFFE-RESIDUAL-IND
024170     ELSE
024180        MOVE BORP-RESIDUAL-IND TO WA-EFFE-RESIDUAL-IND.
024190     IF WA-EFFE-RESIDUAL-IND = "1"
024200        IF BORM-STAT > 5
024210           MOVE BORM-LOAN-BAL  TO BORM-RESIDUAL-BAL
024220        ELSE
024230        IF BORM-STAT = 3  OR = 5
024240           MOVE BORM-APP-AMT   TO BORM-RESIDUAL-BAL.

024260     IF  WA-INPUT-PARAM-TABLE(6) = 1
024270             ADD WA-DUMMY-AMT   TO BORM-NPB-VAL
024280             ADD 1               TO BORM-NO-NPB
024290*
024300        IF  (BORM-CAPN-METHOD = "B" OR
024310              (BORM-CAPN-METHOD = " " AND
024320                BORP-CAPN-METHOD = "B"))
024330        AND
024340             BORM-REPAY-FREQ = 98
024350        AND
024360             BORP-CAPN-FREQ = 98
024370        AND
024380             BORP-ACCRUE-METHOD = "D"
024390             ADD WA-COMM-CORR-AMOUNT TO BORM-NPB-VAL
024400        END-IF
024410     END-IF.
024420*
024430     IF  WA-INPUT-PARAM-TABLE(8) = 1
S10075       IF  BORP-YOUBE                      
S10075       AND WA-INPUT-PARAM-TABLE(7) = 1     
S10075           NEXT SENTENCE                   
S10075       ELSE                                
024440         IF  BORM-LST-FIN-DATE < WA-STORE-TXN-DT
024450             MOVE WA-STORE-TXN-DT TO BORM-LST-FIN-DATE
024460         END-IF
S15903*024470         IF BORM-OLDEST-BDATE-DATE = 0
S15903*024480         OR WA-STORE-TXN-DT < BORM-OLDEST-BDATE-DATE
S15903*024490             MOVE WA-STORE-TXN-DT TO BORM-OLDEST-BDATE-DATE
S15903*024500         END-IF
S10075       END-IF    
024510     ELSE
024520         MOVE STRT-AREA-POST-DT TO BORM-LST-FIN-DATE.
SC8215     MOVE STRT-AREA-POST-DT          TO BOIS-LST-FIN-POST-DT.
024530     INITIALIZE BLDV-AA-DATA-REC-R
024540     INITIALIZE BLDV-AA-GROUP-DATA-R
024550     MOVE "AA" TO BLDV-AA-TYPE BLDV-AA-TRAN-TYPE
024560                               DBIO-CALL-TXN-TYPE-AREA.
024570     MOVE BORM-ADV-VAL TO BLDV-AA-FIRST-LOAN-ADV.
024580     MOVE WA-DUMMY-AMT TO BLDV-AA-FIRST-AMT-ADV.
024590     IF NOT (REDRAW-REFUND-TRAN)
024600        SUBTRACT BORM-ADV-VAL FROM BORM-APP-AMT
024610              GIVING BLDV-AA-FIRST-LOAN-UND.
024620     MOVE BORM-APPRV-DATE TO BLDV-AA-FIRST-APRV-DATE.
024630     MOVE BORM-ADV-DATE TO BLDV-AA-FIRST-ADV-DATE.
024640     MOVE BORM-DUE-STRT-DATE TO BLDV-AA-DUES-START-DATE.
024650     MOVE BORM-INT-START-DATE TO BLDV-AA-INT-START-DATE.
024660     PERFORM M500-CREAT-AMEND-BLDV THRU M599-EXIT.
024670     IF  WA-MSG-ERR-FLAG = 1
024680         GO TO B099-EXIT.
024690*    MOVE "Y"                    TO WA-LOAN-REFRESH-FLAG.

024710* LOAN ADVANCE TO A DEPOSIT ACCOUNT SPR NO. 740003

KEY008* Keymatrix 30 day loans if original txn was 12422 or 12522 or 110  
KEY008* or 11164 then transfer has already been done.
SC5378*
SC5378* IF FEDI TRANSFER TXN (1045, 11045, 11055) HAS FEE, FEE NEED TO BE
SC5378* TAKEN OUT FROM THE TO ACCOUNT.
SC5378     IF FEDI-FEE AND WA-INPUT-PARAM-TABLE(29) = 1
SC5378        MOVE WA-SAVE-FEDI-TO-AMT TO WA-ADV-AMOUNT
SC5378                                    WA-DUMMY-AMT
SC5378                                    WA-INPUT-AMT
SC5378                                    W800-CURR-AMT
SC5378                                    W800-BASE-CURR-AMT
SC5378     END-IF.
SC5378*
024760     IF BORP-REPAY-SCHED = "C" AND
024770       (WA-30DL-SAVE-TRN-NO = 12422 OR 12522 OR 11064 OR 11164)
024780        NEXT SENTENCE
024790     ELSE                                                               
SC5557      IF WA-INPUT-PARAM-TABLE(7) = 1
SC7186      AND WA-DUMMY-LST-TWO       = 55
SC5557********THIS ROUTINE WILL ELIMINATE 98904 TXN UPON CORRECTION OF
SC5557********UPFRONT LOAN ADVANCE. WE MUST CREDIT THE INTEREST FIRST.
SC5557        PERFORM B120-CREDIT-COMMISSION-FIRST THRU B129-EXIT
SC5557        IF WA-MSG-ERR-FLAG = 1
SC5557           GO TO B099-EXIT
SC5557        END-IF
SC5557      END-IF
024800*    IF STRT-AREA-TRN-NO = 11055 OR 16055 OR 11155 OR 16155
TB0267     IF STRT-AREA-TRN-NO = 11055 OR 16055 OR 11155 OR 16155
TB0267*                          OR 14150 OR 14055 OR 14155            SC6028
SC7091                           OR 14055 OR 14155
SC7091                           OR 19055 OR 19155
S11455                           OR 11068 OR 11168
S11455                           OR 16068 OR 16168
S12770                           OR 11063 OR 16063
S12770                           OR 11163 OR 16163
SC9610                           OR ST-LOAN-BACKDATED-CORR-YES
SC9610         IF ST-LOAN-BACKDATED-CORR-YES
SC9610            PERFORM C650-GET-SUSP-FOR-GEN THRU C659-EXIT
SC9610         END-IF
024810         PERFORM H100-ADV-BY-TRANSFER THRU H199-EXIT
024820*        IF WA-MSG-ERR-FLAG = 1
024830*           GO TO B099-EXIT.
TB0237         IF WA-MSG-ERR-FLAG = 1
024830            GO TO B099-EXIT
               END-IF
TB0237         IF  (BORM-CAPN-METHOD = "X" OR
020360              (BORM-CAPN-METHOD = " " AND
020370                BORP-CAPN-METHOD = "X"))
SC5557               IF WA-INPUT-PARAM-TABLE(7) = 1
SC5557*****************CORRECTION OF INTEREST FOR UPFRONT LOAN WAS DONE UPSTAIR...
S16081                  PERFORM F900-DELETE-COSH-RECORD THRU F999-EXIT
SC5557                  GO TO B099-EXIT
SC5557               END-IF
                     MOVE STRT-AREA-TRN-NO   To WA-STORE-TRN-NO
                     MOVE WA-DUMMY-AMT       TO WA-STORE-DUMMY-AMT
                     MOVE W800-CURR-AMT     TO WA-STORE-CURR-AMT
                     MOVE W800-BASE-CURR-AMT To WA-STORE-BASE-CURR-AMT
NR2001*                     IF WA-STORE-BORV-TRN-CODE = 13509
S16081*NR2001               IF WA-STORE-BOCT-TRN-CODE = 13509
S16081               IF WA-STORE-BOCT-TRN-CODE = 13730
SC0745                 IF WA-INPUT-PARAM-TABLE(7) NOT = 1
                        MOVE 1083            TO STRT-AREA-TRN-NO
                       ELSE
                        MOVE 1183            TO STRT-AREA-TRN-NO
SC3457*                 MULTIPLY WA-DUMMY-AMT BY -1 GIVING WA-DUMMY-AMT
SC3457                  MULTIPLY WA-COMMISSION-AMOUNT BY -1 GIVING
SC3457                                            WA-COMMISSION-AMOUNT
SC0745                 END-IF
                       MOVE WA-COMMISSION-AMOUNT  TO WA-DUMMY-AMT
                                            W800-BASE-CURR-AMT
                                            W800-CURR-AMT
SC0745                 PERFORM H100-ADV-BY-TRANSFER THRU H199-EXIT
                     END-IF
SC0745*              PERFORM H100-ADV-BY-TRANSFER THRU H199-EXIT
                      MOVE WA-STORE-TRN-NO     TO STRT-AREA-TRN-NO
                     MOVE WA-STORE-DUMMY-AMT    TO WA-DUMMY-AMT
                      MOVE WA-STORE-CURR-AMT      TO W800-CURR-AMT
                     MOVE WA-STORE-BASE-CURR-AMT   To W800-BASE-CURR-AMT
TB0237         END-IF
024820         IF WA-MSG-ERR-FLAG = 1
024830            GO TO B099-EXIT.
024840* END OF PROCESSING FOR TRN NO 11055
024850*
024860*    WE CAPTURE REFRESH BALANCE DETAILS HERE AFTER UPDATE OF
024870*    MASTER STATIC DETAILS.
024880*
024890     IF BORM-SYS = "BOR"
024900        MOVE 1 TO MI0095CA-CALL-CODE
024910        MOVE 1 TO MI0095CA-FUNC
024920        PERFORM U000-CALL-MI0095 THRU U099-EXIT
024930     END-IF.
024940*
024950     PERFORM M700-SEND-INFO THRU M799-EXIT.
TB0027     IF  WA-CASH-CREDIT-ADD
TB0027     OR  WA-CASH-CREDIT-LESS
TB0027         ADD WA-DUMMY-AMT   TO   BOIS-ACCUM-TOD-CASH-CR
TB0027     END-IF.
TB0152***
TB0152*** BROKERAGE/REFERRAL COMMISSION PROCESSING
TB0152***
TB0152    MOVE BORM-SOC-NO       TO UTCIEACA-SOC-NO
TB0152                              WA-CIEA-SOC-NO.
TB0152    MOVE BORM-SYS          TO UTCIEACA-SYSTEM
TB0152                              WA-CIEA-SYSTEM.
TB0152    MOVE BORM-MEMB-CUST-AC TO UTCIEACA-ACCT-NO
TB0152                              WA-CIEA-ACCT-NO.
TB0152    MOVE ZEROES            TO UTCIEACA-TYPE
TB0190                              UTCIEACA-SEQNUM
TB0190                              WA-CIEA-SEQNUM.
TB0152    SET  UTCIEACA-READNEXT TO TRUE.
TB0190    MOVE "N"               TO WA-EOF-CIEA.
TB0190    MOVE ZEROES            TO WA-MSG-ERR-FLAG.
TB0152    PERFORM B100-PROCESS-CIEA THRU B199-EXIT
TB0152      UNTIL UTCIEACA-SOC-NO  NOT = WA-CIEA-SOC-NO  OR
TB0152            UTCIEACA-SYSTEM  NOT = WA-CIEA-SYSTEM  OR
TB0152            UTCIEACA-ACCT-NO NOT = WA-CIEA-ACCT-NO OR
TB0190            UTCIEACA-SEQNUM  NOT = WA-CIEA-SEQNUM  OR
TB0152            END-OF-CIEA OR WA-MSG-ERR-FLAG = 1.
TB0152
TB0152    IF WA-MSG-ERR-FLAG = 1
TB0152       GO TO B099-EXIT.
024960*
S18344*S15727    IF ( BORP-FINE-METH          =    14
S18344    IF ( PROD-CAR-SME
S15727    AND  BOIS-CARLN-SUB-PROJ     =    "N"
S15727    AND  BORM-INT-RATE           =    0
S15727    AND (BOIS-NEGO-RATE-IND      =    "0" OR "2")
S15727    AND  WA-BEFORE-BORN-STAT     <    6  )
S15727         PERFORM X500-GET-RATE   THRU X509-EXIT
S15727         IF ( WA-MSG-ERR-FLAG    =    1  )
S15727              GO                 TO   B099-EXIT
S15727         END-IF
S15727         COMPUTE WS-BANK-RATE    =    WA-INT-RATE-A
S15727                                 -    WS-COMM-RATE1
S15727                                 -    WS-COMM-RATE2
S15727                                 -    WS-COMM-RATE3
S15727         MOVE WS-BANK-RATE       TO   BOIS-BANK-RATE
S15727    END-IF.
S15727*
TB0196     IF BOIS-PROJECT-ID NOT = ZEROES
TB0196        PERFORM Z400-CREATE-PRJB THRU Z499-EXIT
TB0196        PERFORM Z700-UPDATE-SUBS THRU Z700-EXIT
TB0196     END-IF.
S17497     IF WA-BEFORE-BORN-STAT < 6
S17497     AND (PROD-MORTGAGE-POLICY-CHG
S17497      OR  PROD-MORTGAGE-POLICY-14
S17497      OR  PROD-MORTGAGE-POLICY-15
S17497      OR  PROD-MORTGAGE-POLICY-YUN)
S17497           MOVE 240            TO WA-TERM-NO
S17497           PERFORM Z720-GET-MAT-DATE THRU Z720-EXIT
S17497           MOVE WA-RETURN-DATE TO BORM-GRACE-EXP-DT
S17497        END-IF

SC2412     IF BOIS-CARLN-SUB-PROJ = "Y"
SC3294          AND WA-BEFORE-BORN-STAT < 6
SC2412        MOVE STRT-AREA-SOC-NO  TO SUBS-SOC-NO
SC2412        MOVE BORM-MEMB-CUST-AC TO SUBS-ACCT-NO
SC2412        SET  READ-CMD          TO TRUE
SC2412        PERFORM Z710-ACCESS-SUBS THRU Z710-EXIT
SC2412        IF DBIOMOD-STAT NOT = "****"
SC2412           MOVE UT8500CA-FUNC-NORMAL-DISPLAY
SC2412                       TO UT8500CA-CALL-CODE
SC2412           MOVE SPACES TO UT8500CA-INPUT-MSG
SC2412           STRING "BR0024:(B000) ERROR READING SUBS "
SC2412                  SUBS-ACCT-NO " " DBIOMOD-STAT
SC2412              DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
SC2412              CALL "UT8500" USING UT8500CA-AREA
SC2412           GO TO B099-EXIT
SC2412        END-IF
SC3294*       IF SUBS-INT-SUBS-AMOUNT = 0
SC2412           IF SUBS-SUBSIDY-RATE > 0
SC2412              MOVE ZEROES         TO WA-SUBSIDY-AMT
SC2412              PERFORM B200-CALC-CARLN-SUBSIDY THRU B299-EXIT
SC2412              MOVE WA-SUBSIDY-AMT TO SUBS-INT-SUBS-AMOUNT
SC9188              MOVE BORM-ADV-DATE  TO SUBS-ADVANCE-DATE
SC9222              MOVE BORM-ADV-DATE  TO SUBS-START-DATE
SC2412              SET  REWRITE-CMD    TO TRUE
SC2412              PERFORM Z710-ACCESS-SUBS THRU Z710-EXIT
SC2412              IF DBIOMOD-STAT NOT = "****"
SC2412                 MOVE UT8500CA-FUNC-NORMAL-DISPLAY
SC2412                             TO UT8500CA-CALL-CODE
SC2412                 MOVE SPACES TO UT8500CA-INPUT-MSG
SC2412                 STRING "BR0024:(B000) ERROR WRITING SUBS "
SC2412                        SUBS-ACCT-NO " " DBIOMOD-STAT
SC2412                    DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
SC2412                    CALL "UT8500" USING UT8500CA-AREA
SC2412                 GO TO B099-EXIT
SC2412              END-IF
SC3294*          END-IF
SC2412        END-IF
SC2412     END-IF.

SC8568     IF NOT BORP-YOUBE
SC8568        IF WA-INPUT-PARAM-TABLE(7) = 0                            
SC8568           IF BORM-DUE-STRT-DATE = BOIS-MATURITY-DATE             
SC8568              AND BORM-LST-FIN-DATE = BOIS-MATURITY-DATE          
SC8568              AND BORM-ADV-DATE = BOIS-MATURITY-DATE              
SC8568              AND STRT-AREA-POST-DT = BOIS-MATURITY-DATE          
SC8568              MOVE 50           TO BORM-STAT                      
SC8568              MOVE BOIS-MATURITY-DATE                             
SC8568                                TO BOIS-NPL-STRT-INT-CALC-DATE    
SC8568                                   BOIS-NPL-STRT-PEN-CALC-DATE    
SC8568           END-IF                                                 
SC8568        ELSE                                                      
SC8568           IF BORM-LST-FIN-DATE = BOIS-MATURITY-DATE              
SC8568              AND STRT-AREA-POST-DT = BOIS-MATURITY-DATE          
SC8568              AND BORM-DUE-STRT-DATE = 0                          
SC8568              AND BORM-ADV-DATE = 0                               
SC8568              MOVE 0            TO BOIS-NPL-STRT-INT-CALC-DATE    
SC8568                                   BOIS-NPL-STRT-PEN-CALC-DATE    
SC8568           END-IF                                                 
SC8568        END-IF
SC8568     END-IF.                                                   

S16324     IF  WA-INPUT-PARAM-TABLE(7) = 1
S16324     AND BORP-RENEW
S16324** READ RENB
S16324         MOVE BORM-CUSTOMER-NO TO RENB-CUST-NO
S16324         MOVE '002'            TO RENB-PROD-TYP
S16324         MOVE BORM-MEMB-CUST-AC(03:14) TO RENB-ACCT-NO
S16324         MOVE RENB-KEY         TO DBIOMOD-KEY
S16324         MOVE 0                TO DBIOMOD-KEY-NO
S16324         MOVE "READ"           TO DBIOMOD-FUNCTION
S16324*
S16324         PERFORM M1110-MAINTAIN-RENB THRU M1119-EXIT
S16324*
S16324         IF  DBIOMOD-STAT      = "****"
S16324         AND RENB-SEP-IND      = '3'
S16324             MOVE RENB-KEY     TO DBIOMOD-KEY
S16324             MOVE 0            TO DBIOMOD-KEY-NO
S16324             MOVE "DELETE"     TO DBIOMOD-FUNCTION
S16324             PERFORM M1110-MAINTAIN-RENB THRU M1119-EXIT
S16324         ELSE
S16324             MOVE 1            TO WA-MSG-ERR-FLAG
S16324             MOVE 5315         TO WA-OUTPUT-ERR-MSG-NO
S16324             GO                TO B099-EXIT
S16324         END-IF
S16324         IF BOIS-PREV-ACCT-NUM1(01:15) = '000000000000000'
S16324            CONTINUE
S16324         ELSE
S16324** READ BOEX
S16324           MOVE BORM-SOC-NO    TO BOEX-INST-NO
S16324           MOVE BORM-MEMB-CUST-AC
S16324                               TO BOEX-ACCT-NO
S16324           MOVE BOEX-KEY       TO DBIOMOD-KEY
S16324           MOVE 0              TO DBIOMOD-KEY-NO
S16324           MOVE "READ"         TO DBIOMOD-FUNCTION
S16324           PERFORM M1120-MAINTAIN-BOEX THRU M1129-EXIT
S16324           IF   DBIOMOD-STAT      = "****"
S16324             MOVE BOEX-KEY     TO DBIOMOD-KEY
S16324             MOVE 0            TO DBIOMOD-KEY-NO
S16324             MOVE "DELETE"     TO DBIOMOD-FUNCTION
S16324             PERFORM M1120-MAINTAIN-BOEX THRU M1129-EXIT
S16324           ELSE
S16324             MOVE 1            TO WA-MSG-ERR-FLAG
S16324             MOVE 5315         TO WA-OUTPUT-ERR-MSG-NO
S16324             GO                TO B099-EXIT
S16324           END-IF
S16324         END-IF
S16324     END-IF.

SC0183     IF  WA-INPUT-PARAM-TABLE(7) = 1
SC0183     AND NOT BORP-YOUBE
SC0430         IF BOIS-COST-FUND-TYPE NOT = 0
SC0430            OR (BOIS-COST-FUND-TYPE = 0
SC0430            AND BOIS-PROJECT-ID NUMERIC
SC0430            AND BOIS-PROJECT-ID > 0)
SC0183            PERFORM F900-DELETE-COSH-RECORD THRU F999-EXIT
SC0183            GO TO B099-EXIT
SC0183          END-IF.

BHOY
SC8666     IF NOT BORP-YOUBE AND WA-INPUT-PARAM-TABLE(7) = 0
SC0430         IF BOIS-COST-FUND-TYPE NOT = 0
SC0430            OR (BOIS-COST-FUND-TYPE = 0
SC0430            AND BOIS-PROJECT-ID NUMERIC
SC0430            AND BOIS-PROJECT-ID > 0)
TB0221            IF ( WA-BEFORE-BORM-ADV-VAL = 0 AND
TB0221               WA-BEFORE-BORN-STAT < 6 )
TB0221               PERFORM F000-POST-COSH-RECORD THRU F099-EXIT
SC8666            END-IF
TB0221        END-IF
TB0221     END-IF.
BHOY
S10293*****NEED TO ACCESS AO1P TO CHECK PROFIT CENTER AND TAG TIB IND.
S10293     IF WA-INPUT-PARAM-TABLE(7) = 0
S10560      AND NOT BORP-YOUBE
S10293        IF WA-BEFORE-BORN-STAT < 6
S10293           IF BOIS-PROMO-TELLER <> SPACES
S12536              AND NOT BORP-COMML
S10293              PERFORM K100-ACCESS-AO1P THRU K199-EXIT
S10293           END-IF
S10293        END-IF
S10293     END-IF.

SC9389     IF BORP-GUARANTEE
SC9389        IF WA-INPUT-PARAM-TABLE(7) = 1
SC9389           IF BORM-LOAN-BAL = 0
SC9389              MOVE 50 TO BORM-STAT
SC9389              MOVE 1  TO BORM-REM-REPAYS
SC9389              MOVE 0  TO BOIS-LAST-TERM-PAID
SC9389           END-IF
SC9389        ELSE
SC9389           IF WA-BEFORE-BORM-ADV-VAL = 0
SC9389           AND BORM-STAT = 50
SC9389              MOVE 0 TO BORM-REM-REPAYS
SC9389              MOVE 1 TO BOIS-LAST-TERM-PAID
SC9389           END-IF
SC9389        END-IF
SC9389     END-IF.
S15903*
S15903     IF (STRT-AREA-TRN-NO = 11055 OR 11057 OR 11060 OR
S15903                            16055 OR 16057 OR 16060)
S19269*S15903 AND (BORM-ACT-TYPE (1:1)    = '6')
S19269        AND ((BORM-ACT-TYPE (1:1)    = '6')
S20771        OR   (BORM-ACT-TYPE (1:4)    = '7421')
S19269        OR   (BORM-ACT-TYPE (1:2)    = '78'))
S15903          INITIALIZE  UT0310CA-AREA
S15903          IF BORM-OLDEST-BDATE-DATE  > BORM-ADV-DATE
S15903             MOVE 1  TO WA-MSG-ERR-FLAG
S15903             MOVE 3693  TO WA-OUTPUT-ERR-MSG-NO
S15903             GO TO B099-EXIT
S15903          END-IF
S15903          MOVE BORM-OLDEST-BDATE-DATE  TO UT0020-BINARY-DATE
S15903          MOVE 2                  TO UT0020-FUNCTION
S15903          CALL "UT0020"           USING UT0020-FUNCTION
S15903                                  UT0020-DATE-AREA
S15903                                  UT0020-BINARY-DATE
S15903          MOVE UT0020-DATE-CCYYMMDD
S15903                            TO UT0310CA-CALENDAR-IN-CCYYMMDD
S15903*
S15903          MOVE BORM-ADV-DATE  TO UT0020-BINARY-DATE
S15903          MOVE 2              TO UT0020-FUNCTION
S15903          CALL "UT0020"       USING UT0020-FUNCTION
S15903                                 UT0020-DATE-AREA
S15903                                 UT0020-BINARY-DATE
S15903          MOVE UT0020-DATE-CCYYMMDD
S15903                           TO UT0310CA-CALENDAR-OUT-CCYYMMDD
S15903          MOVE 00                  TO UT0310CA-CALENDAR-CODE
S15903          MOVE 03                  TO UT0310CA-CALL-FUNC
S15903          MOVE STRT-AREA-SOC-NO TO UT0310CA-SOC-NO
S15903          CALL "UT0310" USING UT0310CA-AREA
S15903          IF UT0310CA-CALL-STATUS NOT = 0
S15903             MOVE 1  TO WA-MSG-ERR-FLAG
S15903             MOVE 155 TO WA-OUTPUT-ERR-MSG-NO
S15903             MOVE SPACES   TO UT8500CA-INPUT-MSG
S15903             SET  UT8500CA-NORMAL-DISPLAY TO TRUE
S15903             STRING "BR0024:(B000) ERROR CALLING UT0310"
S15903               ", STATUS="  UT0310CA-CALL-STATUS
S15903            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
S15903            CALL "UT8500" USING UT8500CA-AREA
S15903            GO TO B099-EXIT
S15903          END-IF
S15903          IF  UT0310CA-WORK-DAYS > 3
S15903              MOVE 1  TO WA-MSG-ERR-FLAG
S15903              MOVE 3693  TO WA-OUTPUT-ERR-MSG-NO
S15903             GO TO B099-EXIT
S15903          END-IF
S15903      END-IF.
S15903*
024970 B099-EXIT.
024980     EXIT.

SC5557 B120-CREDIT-COMMISSION-FIRST.
            IF (BORM-CAPN-METHOD = "X" OR
               (BORM-CAPN-METHOD = " " AND  BORP-CAPN-METHOD = "X"))
NR2001*               AND WA-STORE-BORV-TRN-CODE = 13509
S16081*NR2001         AND WA-STORE-BOCT-TRN-CODE = 13509
S16081         AND WA-STORE-BOCT-TRN-CODE = 13730
               MOVE STRT-AREA-TRN-NO   TO WA-STORE-TRN-NO
               MOVE WA-DUMMY-AMT       TO WA-STORE-DUMMY-AMT
               MOVE W800-CURR-AMT      TO WA-STORE-CURR-AMT
               MOVE W800-BASE-CURR-AMT TO WA-STORE-BASE-CURR-AMT
NR2001*               EXHIBIT NAMED WA-STORE-BORV-TRN-CODE
NR2001         EXHIBIT NAMED WA-STORE-BOCT-TRN-CODE
               MOVE 1183            TO STRT-AREA-TRN-NO
S16081*               MULTIPLY WA-COMMISSION-AMOUNT BY -1 GIVING
S16081*                                  WA-COMMISSION-AMOUNT
               MOVE WA-COMMISSION-AMOUNT  TO WA-DUMMY-AMT
                                          W800-BASE-CURR-AMT
                                          W800-CURR-AMT
               PERFORM H100-ADV-BY-TRANSFER THRU H199-EXIT
               MOVE WA-STORE-TRN-NO        TO STRT-AREA-TRN-NO
               MOVE WA-STORE-DUMMY-AMT     TO WA-DUMMY-AMT
               MOVE WA-STORE-CURR-AMT      TO W800-CURR-AMT
               MOVE WA-STORE-BASE-CURR-AMT TO W800-BASE-CURR-AMT
            END-IF.
SC5557 B129-EXIT.
SC5557      EXIT.
TB0152*
TB0152 B100-PROCESS-CIEA.
TB0152
TB0152     PERFORM B110-READNEXT-CIEA THRU B119-EXIT.
TB0152
TB0152     IF END-OF-CIEA
TB0152        GO TO B199-EXIT.
TB0152
TB0152     IF UTCIEACA-SOC-NO  NOT = WA-CIEA-SOC-NO  OR
TB0152        UTCIEACA-SYSTEM  NOT = WA-CIEA-SYSTEM  OR
TB0152        UTCIEACA-ACCT-NO NOT = WA-CIEA-ACCT-NO OR
TB0190        UTCIEACA-SEQNUM  NOT = WA-CIEA-SEQNUM
TB0152        GO TO B199-EXIT.
TB0152
TB0152     MOVE UTCIEACA-KEY TO WA-CIEA-KEY.
S15727*
S15727     INITIALIZE UTCIEPCA-CALL-PARAM.
S15727     MOVE 2                    TO UTCIEPCA-CALL-CODE.
S15727     MOVE UTCIEACA-SOC-NO      TO UTCIEPCA-SOC-NO.
S15727     MOVE UTCIEACA-TYPE        TO UTCIEPCA-TYPE.
S15727*
S15727     CALL "UTCIEP"             USING UTCIEPCA-CALL-PARAM.
S15727*
S15727     IF ( UTCIEPCA-CALL-STATUS NOT = 0 )
S15727          MOVE 1               TO WA-MSG-ERR-FLAG
S15727          MOVE 155             TO WA-OUTPUT-ERR-MSG-NO
S15727          GO                   TO B199-EXIT
S15727     END-IF.
TB0152
TB0152     MOVE 08            TO UTCIEACA-CALL-CODE.
TB0152     MOVE WA-ADV-AMOUNT TO UTCIEACA-PASSED-AMOUNT.
TB0152     IF WA-INPUT-PARAM-TABLE(7) = 1
TB0152        MULTIPLY UTCIEACA-PASSED-AMOUNT BY -1
TB0152          GIVING UTCIEACA-PASSED-AMOUNT.
TB0152     CALL "UTCIEA" USING UTCIEACA-CALL-PARAM
SC8200                         BORM-RECORD-AREA
SC8200                         BOIS-RECORD.
TB0152     IF UTCIEACA-CALL-STATUS NOT = ZEROES
TB0152        IF UTCIEACA-CALL-MSG-NO NOT = 188
TB0152           MOVE 1                    TO WA-MSG-ERR-FLAG
TB0152           MOVE UTCIEACA-CALL-MSG-NO TO WA-OUTPUT-ERR-MSG-NO
TB0152           GO TO B199-EXIT.
TB0152     IF UTCIEACA-CALL-MSG-NO > ZEROES
TB0152        IF UTCIEACA-CALL-MSG-NO NOT = 188
TB0152           MOVE UTCIEACA-CALL-MSG-NO TO UT0060CA-CALL-ERROR-CODE
TB0152           PERFORM Y000-OVERRIDABLE-ERROR-CHECK THRU Y090-EXIT
TB0152           IF WA-MSG-ERR-FLAG = 0
TB0152              MOVE UTCIEACA-CALL-MSG-NO TO WA-ERR-MSG-NO
TB0152           ELSE
TB0152              MOVE 1                    TO WA-MSG-ERR-FLAG
TB0152              MOVE UTCIEACA-CALL-MSG-NO TO WA-OUTPUT-ERR-MSG-NO
TB0152              GO TO B199-EXIT.
S15727*
S15727     IF ( UTCIEPCA-BROKERAGE-FEE )
S15727          MOVE UTCIEACA-RATE(1) TO WS-COMM-RATE1
S15727          MOVE UTCIEACA-RATE(2) TO WS-COMM-RATE2
S15727          MOVE UTCIEACA-RATE(3) TO WS-COMM-RATE3
S15727     END-IF.
TB0152
TB0152 B199-EXIT.
TB0152      EXIT.
TB0152
TB0152 B110-READNEXT-CIEA.
TB0152
TB0152     SET UTCIEACA-READNEXT TO TRUE.
TB0152     CALL "UTCIEA" USING UTCIEACA-CALL-PARAM
SC8200                         BORM-RECORD-AREA
SC8200                         BOIS-RECORD.
TB0152     IF UTCIEACA-CALL-STATUS NOT = ZEROES
TB0152        SET END-OF-CIEA TO TRUE
TB0152        GO TO B119-EXIT.
TB0152
TB0152 B119-EXIT.
TB0152      EXIT.
024990/
SC2412 B200-CALC-CARLN-SUBSIDY.
SC2412
SC2412* Sample computation as per func specs (FSLON0035.doc p.14)
SC2412*   S = application amount = 360,000
SC2412*   Terms are 36 months
SC2412*   Subsidy Rate is 11% (Account Rate = 0%, and Bank Rate = 11%)
SC2412*   A = S / 36 = 10,000 the loan account due amount
SC2412*   B = simulation due amt if charge by full bank rate is 11,786
SC2412*   C = 1 - (A / B) = 0.151536 to round up or down into 6 decimals
SC2412*   D = C * A = 1515 round into one dollar
SC2412*   E = D * (S / A) = 1515 * 36 = 54540
SC2412*   so the receivable subsidy amount = $54,540
SC2412*
SC2412* Counterpart variables used:
SC2412*   WA-INT-RATE-A    = account/customer rate
SC2412*   BR0001-BANK-RATE = bank rate
SC2412*   BORM-REM-REPAYS  = loan term
SC2412*   S = BORM-APPLIC-AMOUNT; application amount
SC2412*   A = WA-REPAY-CUST-RATE; repay amt per acct rate
SC2412*   B = WA-REPAY-BANK-RATE; repay amt per bank rate
SC2412*   C = WA-DIGIT-6
SC2412*   D = WA-AMT
SC2412*   E = WA-SUBSIDY-AMT
SC9161**----------------------------------------------------------------
SC9161** ~~ NEW FORMULA ~~                                              
SC9161**  EXAMPLE:                                                      
SC9161**    TERM IS 60 MONTHS                                           
SC9161**    S = APPLICATION AMOUNT = 400,000                            
SC9161**    A = LOAN ACCOUNT DUE AMOUNT = 7548                          
SC9161**    B = SIMULATION DUE AMOUNT = 7594                            
SC9161**    C = 1 - (A / B) = 1-(7548/7594) = 0.006057                  
SC9161**    D = C * 10,000 = 60.5741 = 61                               
SC9161**    E = D * (S / 10,000)                                        
SC9161**      = 61 * (400,000 / 10,000)                                 
SC9161**      = 2,440  <-- THE RECEIVABLE SUBSIDY AMOUNT                
SC9161** NOTE:                                                          
SC9161**    * 10,000 IS A FIXED VALUE TO BE USED IN THE COMPUTATIONS    
SC9161**----------------------------------------------------------------
SC2412
SC2412     MOVE WA-INT-RATE-A     TO WA-SAVE-RATE.
SC2412     MOVE BORM-RECORD-AREA  TO WA-SAVE-BORM.
SC2412     MOVE BOIS-RECORD       TO WA-SAVE-BOIS.
SC2412
SC2412     IF BORM-REPAY-SCHED = SPACES
SC2412        MOVE BORP-REPAY-SCHED TO WA-REPAY-SCHED
SC2412     ELSE
SC2412        MOVE BORM-REPAY-SCHED TO WA-REPAY-SCHED.
SC2412
SC2412* get customer rate
SC2412     IF BORM-INT-RATE = 0
SC3294       AND (BOIS-NEGO-RATE-IND = "0"
SC3294          OR  (BOIS-NEGO-RATE-IND = "2"
SC3294               AND BOIS-NEGO-RATE-FLAG = "2"))
SC2412        IF BORP-BASM-BASE-ID = SPACES
SC2412        OR BORP-BASM-RATE-ID = SPACES
SC2412           MOVE 0 TO WA-INT-RATE-A
SC2412        ELSE
SC2412           PERFORM B210-SEARCH-RATE-TABLE THRU B219-EXIT
SC2412           IF WA-MSG-ERR-FLAG = 1
SC2412              GO TO B299-EXIT
SC2412           END-IF
SC2412        END-IF
SC2412     ELSE
SC2412        MOVE BORM-INT-RATE TO WA-INT-RATE-A
SC2412     END-IF.
SC2412     ADD BORM-RT-INCR      TO WA-INT-RATE-A.
SC2412
SC3294     IF WA-INT-RATE-A NOT < BOIS-BANK-RATE
SC3294        MOVE 0 TO SUBS-SUBSIDY-RATE
SC3294                  SUBS-INT-SUBS-AMOUNT
SC3294        GO TO B299-EXIT.
SC3294     SUBTRACT WA-INT-RATE-A FROM BOIS-BANK-RATE
SC3294        GIVING SUBS-SUBSIDY-RATE.

SC2412* simulate due amount using customer rate
SC4238* and set BORM-STAT = 1 when simulating
SC2412     MOVE WA-SAVE-BORM  TO BORM-RECORD-AREA.
SC2412     MOVE WA-SAVE-BOIS  TO BOIS-RECORD.
SC2412     MOVE 0             TO WA-LOAN-REPAY.
SC4238     MOVE 1             TO BORM-STAT.
S16000     IF   BORP-COMML
S16000          MOVE 0        TO BOIS-GRACE-PERIOD
S16000     END-IF.
SC2412**   PERFORM B220-CALL-UT0075 THRU B229-EXIT.      **SC9161
SC9161     PERFORM B220-CALL-UT0X75 THRU B229-EXIT.
SC2412     MOVE WA-LOAN-REPAY TO WA-REPAY-CUST-RATE.
SC2412     MOVE WA-SAVE-BORM  TO BORM-RECORD-AREA.
SC2412     MOVE WA-SAVE-BOIS  TO BOIS-RECORD.
SC2412     IF WA-MSG-ERR-FLAG = 1
SC2412        GO TO B299-EXIT.
SC4238**
SC2412**   COMPUTE WA-REPAY-CUST-RATE = BORM-APPLIC-AMOUNT
SC2412**                              / BORM-LOAN-TRM.
SC2412
SC2412* simulate due amount using bank rate
SC4238* and set BORM-STAT = 1 when simulating
SC4238     MOVE BOIS-BANK-RATE TO WA-INT-RATE-A.
SC2412     MOVE 0              TO WA-LOAN-REPAY.
SC4238     MOVE 1              TO BORM-STAT.
S16000     IF   BORP-COMML
S16000          MOVE 0        TO BOIS-GRACE-PERIOD
S16000     END-IF.
SC2412**   PERFORM B220-CALL-UT0075 THRU B229-EXIT.      **SC9161
SC9161     PERFORM B220-CALL-UT0X75 THRU B229-EXIT.
SC2412     MOVE WA-LOAN-REPAY  TO WA-REPAY-BANK-RATE.
SC2412     MOVE WA-SAVE-RATE   TO WA-INT-RATE-A.
SC2412     MOVE WA-SAVE-BORM   TO BORM-RECORD-AREA.
SC2412     MOVE WA-SAVE-BOIS   TO BOIS-RECORD.
SC2412     IF WA-MSG-ERR-FLAG = 1
SC2412        GO TO B299-EXIT.
SC2412
SC2412* compute subsidy amount
SC2412     COMPUTE WA-DIGIT-6 ROUNDED = 1 - (WA-REPAY-CUST-RATE
SC2412                                / WA-REPAY-BANK-RATE).
SC2412**   COMPUTE WA-AMT = WA-DIGIT-6 * WA-REPAY-CUST-RATE.     **SC9161
SC9161     COMPUTE WA-AMT = WA-DIGIT-6 * 10000.
SC2412     MOVE WA-AMT TO WA-WORK-AMT.
SC2412     PERFORM B230-ROUND-AMT THRU B239-EXIT.
SC2412     MOVE WA-WORK-AMT TO WA-AMT.
SC9161     COMPUTE WA-SUBSIDY-AMT = WA-AMT                       
SC9161                            * (BORM-APPLIC-AMOUNT / 10000).
SC4238**   COMPUTE WA-SUBSIDY-AMT = WA-AMT * BORM-LOAN-TRM.      **SC9161
SC2412**   COMPUTE WA-SUBSIDY-AMT = WA-AMT
SC2412**                          * BORM-APPLIC-AMOUNT
SC2412**                          / WA-REPAY-CUST-RATE.
SC2412     MOVE WA-SUBSIDY-AMT TO WA-WORK-AMT.
SC2412     PERFORM B230-ROUND-AMT THRU B239-EXIT.
SC2412     MOVE WA-WORK-AMT TO WA-SUBSIDY-AMT.
SC2412
SC2412 B299-EXIT.
SC2412     EXIT.
SC2412/
SC2412 B210-SEARCH-RATE-TABLE.
SC2412
SC2412     MOVE BORP-SOC-NO       TO UT0298CA-CALL-SOC-NO
SC2412     MOVE BORP-ACCT-TYPE    TO UT0298CA-CALL-ACCT-TYPE
SC2412     MOVE BORP-INT-CAT      TO UT0298CA-CALL-INT-CAT
SC2412     MOVE BORP-BASM-BASE-ID TO UT0298CA-CALL-BASE-ID
SC2412     MOVE BORP-BASM-RATE-ID TO UT0298CA-CALL-RATE-ID
SC2412     MOVE "BOR"             TO UT0298CA-CALL-SYS
SC2412     IF BORP-TIER-GROUP-ID = SPACES
SC2412         MOVE 2 TO UT0298CA-CALL-CODE
SC2412     ELSE
SC2412         MOVE 3 TO UT0298CA-CALL-CODE
SC2412         MOVE BORP-TIER-GROUP-ID TO UT0298CA-CALL-TIER-ID
SC2412         MOVE SPACES        TO UT0298CA-CALL-TIER-RATE-ID
SC2412         MOVE SPACES        TO UT0298CA-ACCT-TIER-ID
SC2412         MOVE BORM-LOAN-BAL TO UT0298CA-CALL-TIER-MAX-VAL
SC2412     END-IF.
SC2412     MOVE STRT-AREA-POST-DT TO UT0298CA-CALL-TXN-DATE.
SC2412     CALL "UT0298" USING UT0298CA-CALL-AREA.
SC2412     IF UT0298CA-RET-STATUS = 0
SC2412         IF UT0298CA-RET-RATE-AVAILABLE
SC2412             MOVE UT0298CA-RET-EFF-RATE TO WA-INT-RATE-A
SC2412                                           WA-INT-RATE-B
SC2412         ELSE
SC2412             MOVE 1921 TO WA-OUTPUT-ERR-MSG-NO
SC2412             MOVE 1    TO WA-MSG-ERR-FLAG
SC2412     ELSE
SC2412         MOVE 1920 TO WA-OUTPUT-ERR-MSG-NO
SC2412         MOVE 1    TO WA-MSG-ERR-FLAG
SC2412         MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
SC2412         MOVE SPACES TO UT8500CA-INPUT-MSG
SC2412         STRING "UT0001:(B210) - INVALID CALL TO UT0298, "
SC2412                "STATUS:"    UT0298CA-RET-STATUS
SC2412                " FOR BORP:" UT0298CA-CALL-KEY
SC2412                ", ACCT:"    BORM-MEMB-CUST-AC
SC2412             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
SC2412         CALL "UT8500" USING UT8500CA-AREA.
SC2412
SC2412 B219-EXIT.
SC2412     EXIT.
SC2412
SC9161** 20-FEB-2004 -- UT0X75/UT0X78 ARE TEMPORARY FIXES IN PRODUCTION:
SC9161** TIB ISSUED AN URGENT REQUEST TO MODIFY APPROVED FORMULA        
SC9161** FOR SUBSIDY INTEREST COMPUTATION.  DUE TO TIME CONSTRAINT,     
SC9161** IT WAS DEEMED SAFER TO CREATE NEW COPIES OF UT0075 & UT0078    
SC9161** RATHER MODIFY EXISTING UTILITIES                               
SC9161** UT0X75 & UT0X78 MAY BE DELETED LATER WHEN THIS NEW REQUIREMENT 
SC9161** CAN BE HANDLED BY THE ORIGINAL UTILITIES.                      
SC2412 B220-CALL-UT0X75.
SC2412
SC2412     INITIALIZE UT0X75CA-CALL-PARAMETER.
SC2412     MOVE 02                 TO UT0X75CA-CALL-CODE.
SC2412     MOVE STRT-AREA-POST-DT  TO UT0X75CA-SYS-DATE
SC2412                                UT0X75CA-EFF-DATE.
SC2412     MOVE WA-INT-RATE-A      TO UT0X75CA-INT-RATE.
SC2412     MOVE UT0290CA-CURR-DECS TO UT0X75CA-CURR-DECS.
SC2412     MOVE WA-REPAY-SCHED     TO UT0X75CA-REPAY-SCHED.
SC2412     MOVE ZEROES             TO BORM-LOAN-REPAY.
SC2412*SC9895     CALL "UT0075" USING  UT0X75CA-CALL-AREA
SC9895     CALL "UT0X75" USING  UT0X75CA-CALL-AREA
SC2412                          BORM-RECORD-AREA
SC2412                          BOIS-RECORD
SC2412                          BORP-RECORD-AREA
SC2412                          WA-SOC-PARAMS.
SC2412     IF UT0X75CA-RET-STATUS <> ZERO
SC2412        MOVE UT0X75CA-RET-ERROR-MSG TO WA-OUTPUT-ERR-MSG-NO
SC2412        MOVE 1 TO WA-MSG-ERR-FLAG
SC2412        GO TO B229-EXIT.
SC2412
SC2412     MOVE UT0X75CA-REPAY-AMT TO WA-LOAN-REPAY.
SC2412
SC2412 B229-EXIT.
SC2412     EXIT.
SC9161**--
SC2412
SC2412 B230-ROUND-AMT.
SC2412
SC2412     IF BORM-CURRENCY-IND = UT0290CA-CALL-CURRENCY
SC2412        NEXT SENTENCE
SC2412     ELSE
SC2412        MOVE 2                 TO UT0290CA-CALL-CODE
SC2412        MOVE 0                 TO UT0290CA-CALL-STATUS
SC2412        MOVE BORM-CURRENCY-IND TO UT0290CA-CALL-CURRENCY
SC2412        CALL "UT0290" USING UT0290CA-CALL-AREA
SC2412        IF UT0290CA-CALL-STATUS NOT = 0
SC2412           GO TO B239-EXIT.
SC2412
SC2412     EVALUATE UT0290CA-CURR-DECS
SC2412     WHEN 0
SC2412         COMPUTE WA-WORK-AMT-0 ROUNDED = WA-WORK-AMT
SC2412         MOVE WA-WORK-AMT-0 TO WA-WORK-AMT
SC2412     WHEN 2
SC2412         COMPUTE WA-WORK-AMT-1 ROUNDED = WA-WORK-AMT
SC2412         MOVE WA-WORK-AMT-1 TO WA-WORK-AMT
SC2412     WHEN 3
SC2412         COMPUTE WA-WORK-AMT-2 ROUNDED = WA-WORK-AMT
SC2412         MOVE WA-WORK-AMT-2 TO WA-WORK-AMT
SC2412     WHEN OTHER
SC2412         COMPUTE WA-WORK-AMT-3 ROUNDED = WA-WORK-AMT
SC2412         MOVE WA-WORK-AMT-3 TO WA-WORK-AMT
SC2412     END-EVALUATE.
SC2412
SC2412 B239-EXIT.
SC2412     EXIT.
SC2412/
S16101 B300-USAGE-LOAN-PROCESS.
S16101*
S16101     IF  WA-INPUT-PARAM-TABLE(7) = 1
S16101         COMPUTE WS-USAGE-AMT    =  WA-INPUT-AMT * -1
S16101     ELSE
S16101         COMPUTE WS-USAGE-AMT    =  WA-INPUT-AMT
S16101     END-IF.
S16101* GET INOD HEADER
S16101     MOVE BOIS-SORD-AUTO-DBT-ACCT-NO TO WA-DEP-NO-W.
S16101     MOVE WA-DEP-NO-W TO WA-DEP-NO-X.
S16101     INITIALIZE INOD-DATA-REC.
S16101     MOVE STRT-AREA-SOC-NO       TO INOD-SOC-NO.
S16101     MOVE WA-DEP-NO              TO INOD-DEP-NO.
S16101     MOVE 0                      TO INOD-OD-NO.
S16101     MOVE INOD-KEY               TO DBIOMOD-KEY.
S16101     MOVE 0                      TO DBIOMOD-KEY-NO.
S16101     MOVE "READ"                 TO DBIOMOD-FUNCTION.
S16101     PERFORM Z800-ACCESS-INOD THRU Z809-EXIT.
S16101     IF  DBIOMOD-STAT NOT = "****"
S16101         MOVE 155 TO   WA-OUTPUT-ERR-MSG-NO
S16101         MOVE 1   TO   WA-MSG-ERR-FLAG
S16101         GO TO B300-EXIT
S16101     END-IF.
S16101* CHECK OVERDUE-START-DATE
S16101     IF  WA-TODAY-BIN-DATE > INOD-OVERDUE-START-DATE
S16101     AND INOD-OVERDUE-START-DATE > 0
S16101         MOVE 1      TO WA-MSG-ERR-FLAG
S16101         MOVE 3499   TO WA-OUTPUT-ERR-MSG-NO
S16101         GO TO B300-EXIT
S16101     END-IF.
S16101*
S16101     MOVE BOIS-SORD-AUTO-DBT-ACCT-NO TO INVM-MEMB-CUST-AC.
S16101     PERFORM Q600-READ-INVM      THRU Q609-EXIT.
S16101     IF ( WA-MSG-ERR-FLAG        =    1 )
S16101          GO                     TO   B300-EXIT
S16101     END-IF.
S16101*
S16101     COMPUTE  WA-OD-LIMIT        =    INOD-TOTAL-LIMIT
S16101                                 +    INVM-CURR-BAL
S16101                                 -  ( INVM-UNCL-CHQ-VAL
S16101                                 +    INVM-HOLD-VAL     ).
S16101*
S16101     IF ( WA-INPUT-PARAM-TABLE(7) =   0 )
S16101          IF ( WA-OD-LIMIT       <    WS-USAGE-AMT )
S16101               MOVE 4174         TO   WA-OUTPUT-ERR-MSG-NO
S16101               MOVE 1            TO   WA-MSG-ERR-FLAG
S16101               GO                TO   B300-EXIT
S16101          END-IF
S16101     END-IF.
S16101*
S16101* COMPUTE INOD HEADER OD_UTIL_AMT
S16101     COMPUTE INOD-TOTAL-LIMIT = INOD-TOTAL-LIMIT
S16101                              - WS-USAGE-AMT.
S16101     MOVE INOD-KEY  TO DBIOMOD-KEY.
S16101     MOVE 0         TO DBIOMOD-KEY-NO.
S16101     MOVE "REWRITE" TO DBIOMOD-FUNCTION.
S16101     PERFORM Z800-ACCESS-INOD THRU Z809-EXIT.
S16101     IF  DBIOMOD-STAT NOT = "****"
S16101         MOVE 155 TO   WA-OUTPUT-ERR-MSG-NO
S16101         MOVE 1   TO   WA-MSG-ERR-FLAG
S16101         GO TO B300-EXIT
S16101     END-IF.
S16101* GET INOD DETAIL
S16101     INITIALIZE INOD-DATA-REC.
S16101     MOVE STRT-AREA-SOC-NO       TO INOD-SOC-NO.
S16101     MOVE WA-DEP-NO              TO INOD-DEP-NO.
S16101     MOVE BOIS-OD-ACCT-NUMBER    TO INOD-OD-NO.
S16101     MOVE INOD-KEY               TO DBIOMOD-KEY.
S16101     MOVE 0                      TO DBIOMOD-KEY-NO.
S16101     MOVE "READ"                 TO DBIOMOD-FUNCTION.
S16101     PERFORM Z800-ACCESS-INOD THRU Z809-EXIT.
S16101     IF  DBIOMOD-STAT NOT = "****"
S16101         MOVE 155 TO   WA-OUTPUT-ERR-MSG-NO
S16101         MOVE 1   TO   WA-MSG-ERR-FLAG
S16101         GO TO B300-EXIT
S16101     END-IF.
S16101* COMPUTE INOD DETAIL LIMIT_1
S16101     COMPUTE INOD-LIMIT(1) = INOD-LIMIT(1)
S16101                           - WS-USAGE-AMT.
S16101     MOVE INOD-KEY  TO DBIOMOD-KEY.
S16101     MOVE 0         TO DBIOMOD-KEY-NO.
S16101     MOVE "REWRITE" TO DBIOMOD-FUNCTION.
S16101     PERFORM Z800-ACCESS-INOD THRU Z809-EXIT.
S16101     IF  DBIOMOD-STAT NOT = "****"
S16101         MOVE 155 TO   WA-OUTPUT-ERR-MSG-NO
S16101         MOVE 1   TO   WA-MSG-ERR-FLAG
S16101         GO TO B300-EXIT
S16101     END-IF.
S16101 B300-EXIT.
S16101     EXIT.

025000************************************************************
025010* PETER HAN: CHARGE SYSTEM RELATED INSERTION (3) STARTS HERE
025020************************************************************
025030 B900-CHECK-IF-TO-APPLY-CHARGES.
025040*
025050     MOVE 0 TO CS0000RA-CHR-CNT
025060               CS0000RA-TOT-HOW-APPLY-3.
TB0125     PERFORM H300-MERGE-CUST-BASED-FEE THRU H399-EXIT.
TB0125     IF CS0012RA-FEE-MASK = LOW-VALUES
025070*    IF BORP-FEE-MASK = LOW-VALUES
025080         GO TO B999-EXIT.
025090*
025100     IF  (WA-ADV-PROMO = SPACES  OR
025110          WA-ADV-PROMO IS NUMERIC)
025120         IF STRT-AREA-FEE-MASK = LOW-VALUES
025130            GO TO B999-EXIT
025140         ELSE
025150            MOVE STRT-AREA-FEE-MASK TO CS0007CA-TRAN-FEE-MASK
025160            GO TO B910
025170         END-IF
025180     END-IF.
025190*
025200     IF  UT0270CA-EXEMPT-IND = "Y"
025210         GO TO B999-EXIT.
025220*
025230     IF UT0270CA-FEE-MASK = LOW-VALUES
025240        IF STRT-AREA-FEE-MASK = LOW-VALUES
025250           GO TO B999-EXIT
025260        ELSE
025270           MOVE STRT-AREA-FEE-MASK TO CS0007CA-TRAN-FEE-MASK
025280     ELSE
025290        MOVE UT0270CA-FEE-MASK TO CS0007CA-TRAN-FEE-MASK.
025300 B910.
025310*
025320*    MOVE BORP-FEE-MASK  TO CS0007CA-ACCT-FEE-MASK.
TB0125     MOVE CS0012RA-FEE-MASK TO CS0007CA-ACCT-FEE-MASK.
025330     CALL "CS0007" USING
025340                         WA-CS0007CA-CALL-AREA
025350                         WA-CS0007RA-RETURN-AREA.
025360     IF  CS0007RA-RET-STATUS NOT = 0
025370         MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
025380         MOVE SPACES TO UT8500CA-INPUT-MSG
025390         STRING "BR0024:(B910) INVALID RET STATUS CS0007 "
025400         CS0007RA-RET-STATUS
025410             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
025420         CALL "UT8500" USING

025440                             UT8500CA-AREA
025450         MOVE 1            TO WA-MSG-ERR-FLAG
025460         MOVE 810          TO WA-OUTPUT-ERR-MSG-NO
025470         GO TO B999-EXIT.
025480*
025490     MOVE 0                 TO CS0000RA-CHR-CNT.
025500     IF  CS0007RA-LST-FEE = 0
025510         NEXT SENTENCE
025520     ELSE
025530         PERFORM BA00-CHARGE-CALC THRU BA99-EXIT
025540         IF CS0000RA-STATUS NOT = 01 AND 11 AND 12
025550            NEXT SENTENCE
025560         ELSE
025570             IF  CS0000RA-CHR-CNT > 0
025580                 MOVE CS0000RA-ERR-MSG (CS0000RA-CHR-CNT)
025590                   TO WA-OUTPUT-ERR-MSG-NO
025600             ELSE
025610                 MOVE 825 TO WA-OUTPUT-ERR-MSG-NO
025620             END-IF
025630             MOVE 1 TO WA-MSG-ERR-FLAG.
025640 B999-EXIT.
025650     EXIT.
025660/
025670 BA00-CHARGE-CALC.
025680*-----------------
025690*
025700*
025710     MOVE WA-CHG-TR-STATE TO CS0000CA-TR-GEO-AREA.
025720     MOVE WA-CHG-HM-STATE TO CS0000CA-HM-GEO-AREA.

025740     MOVE 02                     TO  CS0000CA-CALL-CODE.
025750     MOVE 0                      TO  CS0000CA-CALL-FUNC.
025760     MOVE CS0007RA-LST-FEE       TO  CS0000CA-LST-FEE.
025770     MOVE STRT-AREA-SOC-NO        TO  CS0000CA-SOC.
025780     MOVE CS0007RA-FEE-MASK      TO  CS0000CA-FEE-MASK.
025790     MOVE "B"                    TO  CS0000CA-SYS.
S15848*S15296     MOVE CUSM-VIP-CODE          TO CS0000CA-VIP-CODE.
S15848     MOVE WA-CSCP-IND            TO CS0000CA-VIP-CODE.
B19901     INITIALIZE                      CS0000CA-RICHART-IND
B19901                                     CS0000CA-PAY-CODE
B19901                                     CS0000CA-SALARY-CO-ID
B19901                                     CS0000CA-CUSTOMER-NO
B19901                                     CS0000CA-ACCT-NO.
025800     MOVE BORP-ACCT-TYPE         TO  CS0000CA-ACTYPE.
025810     MOVE BORP-INT-CAT           TO  CS0000CA-INT-CAT.
025820     MOVE STRT-AREA-TRN-NO        TO  CS0000CA-EVT-NO.
025830     MOVE 0                      TO  CS0000CA-EVT-IND
025840                                     CS0000RA-LST-FEE-PROC
025850                                     CS0000RA-TOT-HOW-APPLY-3.
025860     MOVE BORP-CURRENCY-IND      TO  CS0000CA-BASE-CCY.
025870     MOVE WA-ORIG-TXN-EVT        TO  CS0000CA-ORIG-TXN-EVT.
025880     MOVE WA-ORIG-JRNL-NO        TO  CS0000CA-ORIG-JRNL-NO.
025890     MOVE WA-ORIG-POST-DATE      TO  CS0000CA-ORIG-POST-DATE.
025900     MOVE WA-ORIG-POST-TIME      TO  CS0000CA-ORIG-POST-TIME.
025910     MOVE WA-ORIG-POST-SEQ       TO  CS0000CA-ORIG-POST-SEQ.
025920*
025930     MOVE 0                      TO  WA-CS0000RA-STATUS
025940                                     WA-CS0090RA-STATUS.
025950     MOVE WA-INPUT-AMT           TO  WA-TXN-AMT.
025960*
025970 BA20.
025980*
025990     CALL "CS0000" USING

026010                         STARTAREA
026020                         BORR-PARAMS
026030                         WA-CS0000CA-CALL-AREA
026040                         WA-CS0000RA-RETURN-AREA
026050                         WA-TXN-AMT
026060                         WA-PASSALONG.
026070*
026080*    IF CS0000RA-STATUS = 11
026090*        DISPLAY "BR0024:(BA20) INVALID RET STATUS CS0000 "
026100*                 CS0000RA-STATUS
026110*        MOVE 1                       TO WA-MSG-ERR-FLAG
026120*        GO TO BA99-EXIT.
026130*
026140     IF CS0000RA-STATUS = 0
SC4465        MOVE CS0000RA-GROSS-CHR(1) TO WA-FEE-AMT
026150        NEXT SENTENCE
026160     ELSE
026170        MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
026180        MOVE SPACES TO UT8500CA-INPUT-MSG
026190        STRING "BR0024:(BA20) INVALID RET STATUS CS0000 "
026200                CS0000RA-STATUS
026210            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
026220        CALL "UT8500" USING

026240                            UT8500CA-AREA
026250        MOVE CS0000RA-STATUS          TO WA-CS0000RA-STATUS.
026260*
026270*    IF  CS0000CA-LST-FEE = CS0000RA-LST-FEE-PROC
026280*        GO TO BA99-EXIT
026290*    ELSE
026300*        DISPLAY "BR0024:(BA20) > 30 CHARGES TO BE APPLIED "
026310*        MOVE WA-CHARGE-GT30-ERR-MSG  TO WA-OUTPUT-LIMIT-MSG
026320*        MOVE 119                     TO WA-OUTPUT-MSG-LENGTH
026330*        MOVE 998                     TO WA-OUTPUT-ERR-MSG-NO
026340*        PERFORM E100-FMT-SEND-PARA THRU E199-EXIT
026350*        GO TO BA99-EXIT.
026360*
026370 BA99-EXIT.
026380     EXIT.
026390/
026400 BB00-PROCESS-CHARGE-TXNS.
026410*
026420*YH
026430*************************************************************
026440*                                                           *
026450*    CS0090CA-CALL-CODE = 1 : PRINT MESSAGE,WRITE JOURNAL   *
026460*                       2,4 : NO PRINT MESSAGE, NO WRITE    *
026470*                                JOURNAL                    *
026480*                         3 : NO PRINT MESSAGE              *
026490*                                                           *
026500*************************************************************
026510*
026520*
026530*
026540     MOVE 01                         TO CS0090CA-CALL-CODE.
026550     MOVE 0                          TO CS0090CA-CALL-FUNC.
026560     MOVE "B"                        TO CS0090CA-SYS.
026570     MOVE STRT-AREA-SOC-NO            TO CS0090CA-SOC.
026580     MOVE WA-INPUT-ACCT-NO           TO CS0090CA-ACCT.
026590*
026600     CALL "CS0090" USING

026620                         STARTAREA
026630                         BORR-PARAMS
026640                         WA-CS0090CA-CALL-AREA
026650                         WA-CS0000RA-RETURN-AREA
026660                         WA-PASSALONG
026670                         PBOOKCA-LINE-AREA.
026680*
026690     IF CS0000RA-STATUS = 0
026700        NEXT SENTENCE
026710     ELSE
026720        MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
026730        MOVE SPACES TO UT8500CA-INPUT-MSG
026740        STRING "BR0024:(BB00) INVALID RET STATUS CS0090 "
026750                CS0000RA-STATUS
026760            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
026770        CALL "UT8500" USING

026790                            UT8500CA-AREA
026800        MOVE CS0000RA-STATUS TO WA-CS0090RA-STATUS.
026810 BB99-EXIT.
026820     EXIT.
026830************************************************************
026840* INSERTION (3) ENDS HERE
026850*************************************************************
026860/
TB0125**************************************************************
TB0125* THIS ROUTINE IS CALLED BEFORE CALLS TO CS0007 IN ORDER TO
TB0125* "MERGE" CUST BASED FEE MASK (CSCP), WITH ACCT-PARM-FEE-MASK
TB0125* BY CALLING CS0012.  BY DEFAULT, CS0012RA-FEE-MASK IS SET
TB0125* TO ACCT-PARM-FEE-MASK.  THIS IS TO GET ADDITIONAL FEES BASED
TB0125* ON CUSTOMER TYPE.
TB0125**************************************************************
TB0125 H300-MERGE-CUST-BASED-FEE.
TB0125
TB0125     MOVE BORP-FEE-MASK         TO CS0012RA-FEE-MASK.
TB0125
TB0125     IF CUSM-CUST-ACCT-NO NOT = BORM-CUSTOMER-NO
TB0125        MOVE BORM-CUSTOMER-NO   TO CUSM-CUST-ACCT-NO
TB0125        MOVE BORM-SOC-NO        TO CUSM-SOC-NO
TB0125        MOVE "CUSM    "         TO DBIO-CALL-SYS-AREA
TB0125        MOVE CUSM-KEY           TO DBIO-CALL-KEY-AREA
TB0125        MOVE SPACES             TO DBIO-CALL-STATUS
TB0125        MOVE 71                 TO DBIO-CALL-FUNC
TB0125*
TB0125        CALL "DBIO" USING
TB0125                       DBIO-CALL-PARAM
TB0125                       DBIO-CALL-SYS-AREA
TB0125                       DBIO-CALL-KEY-AREA
TB0125                       DBIO-CALL-STATUS
TB0125                       CUSM-RECORD-AREA
TB0125        IF DBIO-CALL-STATUS NOT = "****"
TB0125           MOVE 00 TO  CUSM-VIP-CODE.
TB0125
TB0125     MOVE "****" TO DBIOMOD-STAT.
TB0125
S15848     MOVE SPACES                     TO UTVIPCCA-CALL-PARAM.
S15848     MOVE CUSM-VIP-CODE              TO UTVIPCCA-CODE.
S15848     MOVE INVM-SOC-NO                TO UTVIPCCA-INST-NO.
S15848     MOVE 02                         TO UTVIPCCA-CALL-CODE.
S15848     CALL "UTVIPC" USING
S15848                                     UTVIPCCA-CALL-PARAM.
S15848     IF UTVIPCCA-CALL-STATUS = 0
S15848        MOVE UTVIPCCA-CSCP-IND  TO WA-CSCP-IND
S15848     ELSE
S15848        MOVE 0                  TO WA-CSCP-IND
S15848     END-IF.
S15266     MOVE BORM-SOC-NO           TO UTBFTVCA-CALL-SOC-NO.
S15266     MOVE BORM-CUSTOMER-NO      TO UTBFTVCA-CALL-CUST-NO.
S15266     MOVE UT1999CA-CCYYMMDD     TO UTBFTVCA-CALL-DATE.
S15266     CALL "UTBFTV" USING UTBFTVCA-CALL-AREA.
S15266     IF UTBFTVCA-BFT-CODE NOT = "00"
S15848*S15266        MOVE UTBFTVCA-CSCP-IND  TO CUSM-VIP-CODE
S15848        MOVE UTBFTVCA-CSCP-IND  TO WA-CSCP-IND
S15266     END-IF.
S15266
TB0125     IF CUSM-SOC-NO NOT = CSCP-KEY-SOC
S15848          OR WA-CSCP-IND NOT = CSCP-VIP-TYPE
S15848*TB0125          OR CUSM-VIP-CODE NOT = CSCP-VIP-TYPE
TB0125        MOVE CUSM-SOC-NO        TO CSCP-KEY-SOC-ALT
S15848        MOVE WA-CSCP-IND      TO CSCP-VIP-TYPE
S15848*TB0125        MOVE CUSM-VIP-CODE      TO CSCP-VIP-TYPE-ALT
TB0125        MOVE 999999999          TO CSCP-EFTV-DTE-ALT
TB0125        MOVE CSCP-KEY-ALT       TO DBIOMOD-KEY
TB0125        MOVE 1                  TO DBIOMOD-KEY-NO
TB0125        SET  READ-CMD           TO TRUE
TB0125
TB0125        INITIALIZE DBIOMOD-RECORD
TB0125        MOVE "CSCP"         TO DBIOMOD-FILE
TB0125                               DBIOMOD-SUFFIX
TB0125        MOVE "DBIO"         TO DBIOMOD-PREFIX
TB0125        MOVE SPACES         TO DBIOMOD-RELEASE-LOCK
TB0125                               DBIOMOD-ACCESS-COMMAND
TB0125                               DBIOMOD-ACCESS-COND
TB0125                               DBIOMOD-STATUS
TB0125
TB0125        CALL DBIOMODNAME USING DBIOMOD-FILE
TB0125                               DBIOMOD-KEY
TB0125                               WS-CSCP-REC
TB0125                               DBIOMOD-FUNCTION
TB0125                               DBIOMOD-KEY-NO
TB0125                               DBIOMOD-RELEASE-LOCK
TB0125                               DBIOMOD-ACCESS-COMMAND
TB0125                               DBIOMOD-ACCESS-COND
TB0125                               DBIOMOD-STATUS.
TB0125
TB0125     IF DBIOMOD-STAT = "****"
TB0125        MOVE BORP-FEE-MASK      TO CS0012CA-ACCT-FEE-MASK
TB0125        MOVE CSCP-FEE-MASK      TO CS0012CA-CUST-FEE-MASK
TB0125        CALL "CS0012" USING WA-CS0012CA-CALL-AREA
TB0125                            WA-CS0012RA-RETURN-AREA.
TB0125
TB0125 H399-EXIT.
TB0125     EXIT.
TB0125
026870 L100-VALIDATE-INPUT.
026880***
026890***  NOTE:- BR0000 VALIDATES PRIOR TO PASSING CONTROL TO BR0024
026900***
026910     IF  WA-INPUT-PARAM-TABLE(8) = 1
026920*        MOVE WA-ADV-TXN-DATE TO UT0030-DATE-DDMMCCYY                    
026930         IF STRT-AREA-OTHER-OVERRIDE = "7"                               
026940            MOVE TPATM-TXN-DATE  TO UT0030-DATE-DDMMCCYY                 
026950         ELSE      
SC0941****START-FAD
                  IF STRT-AREA-TRN-NO = 16055
                   PERFORM Z700-CHK-TXNDT THRU Z709-EXIT
                  END-IF
SC0941****END-FAD                                                      
026960            MOVE WA-ADV-TXN-DATE TO UT0030-DATE-DDMMCCYY                 
026970         END-IF                                                          
026980         PERFORM X200-UT0030-PARA THRU X209-EXIT
S10467                                                   
S10467         IF UT0030-BINARY-DATE < BORM-LST-FIN-DATE 
S10467          AND BORM-LST-FIN-DATE > 0                
S10467          AND (BORM-STAT  = 07 OR 08)              
S19747*S10467   AND NOT BORP-YOUBE
S19747          AND NOT (BORP-YOUBE OR PROD-RICHART)
S10487          AND WA-INPUT-PARAM-TABLE(8) = 1          
S10467            MOVE 1 TO WA-MSG-ERR-FLAG              
S10467            MOVE 4141 TO WA-OUTPUT-ERR-MSG-NO      
S10467            GO TO L199-EXIT                        
S10467         END-IF                                    
S10467                                                   
S10467         IF UT0030-BINARY-DATE < BOIS-PREV-DUE-DATE
S10467          AND BOIS-PREV-DUE-DATE > 0               
S10467          AND (BORM-STAT  = 07 OR 08)              
S10467          AND NOT BORP-YOUBE                       
S10467          AND WA-INPUT-PARAM-TABLE(7) = 0          
S10467          AND WA-INPUT-PARAM-TABLE(8) = 1          
S19747*S17755    IF  BORP-ILOAN-R
S19747*S17755    AND (STRT-AREA-BATCH-TANDEM = "N" OR "V")
S19747           IF  (BORP-ILOAN-R OR PROD-RICHART)
S19747           AND (STRT-AREA-BATCH-TANDEM = "N" OR "V" OR "Y")
S17755               CONTINUE
S17755           ELSE
S10467            MOVE 1 TO WA-MSG-ERR-FLAG              
S10467            MOVE 0127 TO WA-OUTPUT-ERR-MSG-NO      
S10467            GO TO L199-EXIT                        
S17755           END-IF
S10467         END-IF
S10467               
026990         MOVE UT0030-BINARY-DATE     TO WA-STORE-TXN-DT.
027000*** 74I012 BEGIN ***
027010*    IF  STRT-AREA-SIGN = "-"
027020*        MULTIPLY WA-ADV-AMOUNT BY -1 GIVING
027030*                 WA-DUMMY-AMT
027040*    ELSE
027050*        MOVE WA-ADV-AMOUNT      TO WA-DUMMY-AMT.
027060* WSK 2/3/98 HEL007 - IF TP ORIGINATED ADV CORRECTION FIN TXN
027070* THEN MOVE TXN AMT INTO ADV AMT VARIABLE FOR NORMAL ADVANCE PROCE     
027080* 74I012 RETROFIT
027090     IF  STRT-AREA-SIGN = "-"
027100       IF STRT-AREA-OTHER-OVERRIDE = "7"
027110         MOVE TPATM-AMOUNT       TO WA-30DL-ADV-AMT
027120         MULTIPLY WA-ADV-AMOUNT BY -1 GIVING                            
027130                  WA-DUMMY-AMT
027140       ELSE
027150         MULTIPLY WA-ADV-AMOUNT BY -1 GIVING
027160                  WA-DUMMY-AMT
027170       END-IF
027180     ELSE
027190* WSK 2/3/98 HEL007 - IF TP ADV ORIGINATED FIN TXN
027200* THEN MOVE TXN AMT INTO ADV AMT VARIABLE FOR NORMAL ADVANCE PROCE     
027210       IF STRT-AREA-OTHER-OVERRIDE = "7"
027220         MOVE TPATM-AMOUNT       TO WA-DUMMY-AMT                        
027230                                    WA-ADV-AMOUNT
027240       ELSE
027250         MOVE WA-ADV-AMOUNT      TO WA-DUMMY-AMT
027260       END-IF
027270     END-IF.
027280*** 74I012 END ***
027290     MOVE STRT-AREA-TRN-NO TO WA-DUMMY-TRN-NO.
SC9610     IF ST-LOAN-BACKDATED-CORR-YES
SC9610        MOVE WA-DUMMY-TRN-NO TO WA-SAVE-ST-AREA-TRN-NO
SC9610        MOVE "50" TO WA-DUMMY-LST-TWO.
027300 L199-EXIT.
027310     EXIT.
027320/
027330 M000-CALL-UT0095.
027340     INITIALIZE UT0095CA-AREA.
027350     MOVE 03                     TO UT0095CA-CALL-CODE.
027360     MOVE "BOR"                  TO UT0095CA-SYSTEM.
027370     MOVE STRT-AREA-LEDG-CODE    TO UT0095CA-LEDG-CODE.
LB0624*    MOVE STRT-AREA-POST-DT      TO BORV-01-TRN-DATE.
LB0624     IF  WA-INPUT-PARAM-TABLE(8) = 1
NR2001*LB0624         MOVE WA-STORE-TXN-DT    TO BORV-01-TRN-DATE
NR2001*LB0624     ELSE
NR2001*LB0624         MOVE STRT-AREA-POST-DT  TO BORV-01-TRN-DATE
NR2001*LB0624     END-IF.
NR2001*027440     MOVE BORV-01-DETAIL         TO UT0095CA-BORV-RECORD-AREA.
NR2001         MOVE WA-STORE-TXN-DT    TO BOCT-TRN-DATE
NR2001     ELSE
NR2001         MOVE STRT-AREA-POST-DT  TO BOCT-TRN-DATE
NR2001     END-IF.
NR2001     MOVE BOCT-RECORD-AREA       TO UT0095CA-BOCT-RECORD-AREA.
027450     MOVE BORM-RECORD-AREA       TO UT0095CA-BORM-RECORD-AREA.
027460     MOVE BORM-LOAN-BAL          TO UT0095CA-LOAN-BAL.
027470     MOVE BORM-THEO-LOAN-BAL     TO UT0095CA-THEO-LOAN-BAL.
027480     MOVE STRT-AREA-RECOVERY     TO UT0095CA-RECOVERY-FLAG.
027490     CALL "UT0095" USING UT0095CA-CALL-PARAM
027500                         WA-EDIT-MASK                                    
027510                         BORR-PARAMS                                     
027520                         WA-TODAY-BIN-DATE                               
027530                         MULTI-OVERRIDE-AREA.                            
027540     IF UT0095CA-RET-STATUS = ZEROS
027550        MOVE UT0095CA-LOAN-BAL   TO CPY-BORM-LOAN-BAL
027560                                    BORM-LOAN-BAL
027570        MOVE UT0095CA-THEO-LOAN-BAL TO CPY-BORM-THEO-LOAN-BAL
027580                                    BORM-THEO-LOAN-BAL
027590        MOVE UT0095CA-PRINCIPAL-BAL TO
027600                                    BORM-UNPAID-PRINCIPAL-BAL
027610        MOVE UT0095CA-THEO-PRINCIPAL-BAL TO
027620                                    BORM-THEO-UNPAID-PRINCIPAL-BAL
027630        MOVE UT0095CA-INTEREST-BAL TO
027640                                    BORM-CAP-UNPAID-INT
027650        MOVE UT0095CA-THEO-INTEREST-BAL TO
027660                                    BORM-CAP-THEO-UNPAID-INT
027670        MOVE UT0095CA-ARREARS-BAL TO
027680                                    BORM-UNPAID-ARRS-INT-BAL
027690        MOVE UT0095CA-THEO-ARREARS-BAL TO
027700                                    BORM-THEO-UNPAID-ARRS-INT-BAL
027710        MOVE UT0095CA-CHARGES-BAL TO
027720                                    BORM-UNPAID-CHRG-BAL
027730        MOVE UT0095CA-THEO-CHARGES-BAL TO
027740                                    BORM-THEO-UNPAID-CHRG-BAL
027750        MOVE UT0095CA-TOM-BAL TO                                        
027760                                    BORM-UNPAID-TOM-INT                 
027770        MOVE UT0095CA-THEO-TOM-BAL TO                                   
027780                                    BORM-THEO-UNPAID-TOM-INT            
027790     ELSE
027800        MOVE 1 TO WA-MSG-ERR-FLAG
027810        MOVE 2301 TO WA-OUTPUT-ERR-MSG-NO
027820     END-IF.
027830 M099-EXIT.
027840     EXIT.
TB0084/
TB0084 M100-CALL-UT0094.
           INITIALIZE UT0094CA-CALL-PARAM
           MOVE 03                  TO UT0094CA-CALL-CODE.
           MOVE "BOR"               TO UT0094CA-SYSTEM
           MOVE STRT-AREA-JRNL-NO   TO UT0094CA-JRNL-NO
           MOVE STRT-AREA-LEDG-CODE TO UT0094CA-LEDG-CODE
NR2001*           MOVE STRT-AREA-POST-DT   TO BORV-01-TRN-DATE
NR2001*      ***  MOVE BORP-PRIORITY-CODE  TO UT0094CA-PRIORITY-CODE
NR2001*           MOVE STRT-AREA-PRIORITY-CODE  TO UT0094CA-PRIORITY-CODE
NR2001*           MOVE BORV-01-AMOUNT      TO UT0094CA-POST-AMT
NR2001*           CALL "UT0094" USING UT0094CA-CALL-PARAM
NR2001*                               BORM-RECORD-AREA
NR2001*                               BORV-RECORD-AREA
NR2001     MOVE STRT-AREA-POST-DT   TO BOCT-TRN-DATE
NR2001     MOVE STRT-AREA-PRIORITY-CODE  TO UT0094CA-PRIORITY-CODE
NR2001     MOVE BOCT-01-AMOUNT      TO UT0094CA-POST-AMT
NR2001     CALL "UT0094" USING UT0094CA-CALL-PARAM
NR2001                         BORM-RECORD-AREA
NR2001                         BOCT-RECORD-AREA                               
                               BOIS-RECORD
                               BORP-RECORD-AREA.
           INITIALIZE WA-ADJ-PASSALONG
           IF UT0094CA-RET-STATUS = ZEROS
               MOVE BORM-LOAN-BAL        TO CPY-BORM-LOAN-BAL
               MOVE BORM-THEO-LOAN-BAL   TO CPY-BORM-THEO-LOAN-BAL
               MOVE UT0094CA-BUCKETS-AMT TO WA-ADJ-BUCKETS-AMT
               MOVE UT0094CA-BALANCES-AFTER-POST
                                         TO WA-ADJ-BALANCES-AFTER-POST
           ELSE
               MOVE UT8500CA-FUNC-NORMAL-DISPLAY
                           TO UT8500CA-CALL-CODE
               MOVE SPACES TO UT8500CA-INPUT-MSG
               STRING "BR0024:(M100) ERROR UT0094, "
                      ", RETURN CODE=" UT0094CA-RET-STATUS
                   DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
               CALL "UT8500" USING
                                   UT8500CA-AREA
               IF UT0094CA-ERROR-MSG-NO <> ZEROS
                   MOVE UT0094CA-ERROR-MSG-NO TO WA-OUTPUT-ERR-MSG-NO
               ELSE
                   MOVE 2301 TO WA-OUTPUT-ERR-MSG-NO
               END-IF
               MOVE 1 TO ST-STATUS-LEVEL-1
                         WA-MSG-ERR-FLAG
               PERFORM W200-FMT-SEND-PARA THRU W299-EXIT
            END-IF.
TB0084 M109-EXIT.
TB0084     EXIT.
027850/
027860 M200-GENERIC-NARRATIVE-PARA.
027870*** IF THIRD PARTY CHEQUE WITHDRAWL SET UP AND
027880***    POST 20 TYPE TRANSACTION *****
027890*
027900* DETERMINE WHICH METHOD IS TO BE USED FOR THE NARRATION:
027910*    1) USING VALUES PASSED IN SPECIFIC FIELDS FOR SPECIFIC
027920*       TRAN CODES (HARD-CODED).
027930*    2) USING THE AREA PASSED IN THE WA-NARR-TEXT INPUT MESSAGE
027940*    3) USING THE ED2/TXTM PARAMETER METHOD
027950*
027960*
027970     MOVE STRT-AREA-TRN-NO TO LINK-IN-TXCODE.
027980     PERFORM M1600-LOAD-ED2 THRU M1699-EXIT.
027990     IF (WA-DUMMY-LST-TWO >= 80) AND (WA-DUMMY-LST-TWO <= 89)
028000         IF WA-ADV-1ST-BYTE = "#" OR "*"
028010            PERFORM N200-STANDARD-NAME THRU N299-EXIT
028020            IF WA-MSG-ERR-FLAG NOT = 1
NR2001*028030               MOVE SPACES TO BORV-20-CHQ-PAYEE
NR2001*028040               MOVE WA-ADV-NAME-1 TO BORV-20-CHQ-PAYEE
NR2001*028050               MOVE "TRUE" TO WA-TEXT-AVAIL-FLAG
NR2001*028060               PERFORM M250-WRITE-NARRATIVE-TXN
NR2001*028070                                  THRU M259-EXIT
NR2001*028080            END-IF
NR2001*028090         ELSE
NR2001*028100             IF WA-ADV-NAME-1 NOT = SPACES
NR2001*028110                 MOVE SPACES TO BORV-20-CHQ-PAYEE
NR2001*028120                 MOVE WA-ADV-NAME-1 TO BORV-20-CHQ-PAYEE
NR2001*028130                 MOVE "TRUE" TO WA-TEXT-AVAIL-FLAG
NR2001*028140                 PERFORM M250-WRITE-NARRATIVE-TXN
NR2001*028150                                    THRU M259-EXIT
NR2001*028160             END-IF
NR2001*028170         END-IF
NR2001*028180     END-IF.
NR2001*028190*
NR2001*028200     IF LINK-NARR-TXN-TYPE = 20
NR2001*028210        IF LINK-TCNARR-SEQ-NO NOT = 0
NR2001*028220           MOVE 2 TO UT9000-CALL-CODE
NR2001*028230           MOVE " "               TO UT9000-CALL-STATUS
NR2001*028240           MOVE STRT-AREA-SOC-NO  TO UT9000-INST-NO
NR2001*028250           MOVE "TCNARR"          TO UT9000-CALLING-ID
NR2001*028260           MOVE STRT-AREA-TELLER-LANG
NR2001*028270                                  TO UT9000-LANGUAGE-CODE
NR2001*028280           MOVE 1                 TO UT9000-REPORT-NO
NR2001*028290           MOVE LINK-TCNARR-SEQ-NO TO UT9000-SEQUENCE-NO
NR2001*028300           PERFORM U9100-RETRIEVE-TEXT THRU U9199-EXIT
NR2001*028310           IF (UT9000-CALL-STATUS = "0") AND
NR2001*028320              (UT9000RA-LINE1 NOT = SPACES)
NR2001*028330              MOVE UT9000RA-LINE1 TO BORV-20-CHQ-PAYEE
NR2001*028340              MOVE "TRUE" TO WA-TEXT-AVAIL-FLAG
NR2001*028350              PERFORM M250-WRITE-NARRATIVE-TXN
NR2001*028360                                 THRU M259-EXIT
NR2001*028370           END-IF
NR2001*028380        END-IF
NR2001*028390     END-IF.
NR2001*028400*
NR2001*028410     IF WA-NARR-TEXT NOT = SPACES
NR2001*028420        MOVE WA-NARR-TEXT TO BORV-20-CHQ-PAYEE
NR2001*028430        MOVE "TRUE" TO WA-TEXT-AVAIL-FLAG
NR2001*028440        PERFORM M250-WRITE-NARRATIVE-TXN
NR2001*028450                           THRU M259-EXIT
NR2001*028460     END-IF.
NR2001*TB0273**   IF STRT-AREA-TRN-NO = 11055 OR 11155
NR2001*SC7091*    IF (STRT-AREA-TRN-NO = 11055 OR 11155)
NR2001*SC7091     IF (STRT-AREA-TRN-NO = 11055 OR 11155 OR 16055 OR 16155)
NR2001*SC6948     AND (STRT-AREA-BATCH-TANDEM = "F" OR "Q" OR "J")
NR2001*TB0273        MOVE SPACES TO BORV-20-CHQ-PAYEE
NR2001*TB0273        STRING WA2-FEDI-VAL-FLG " "
NR2001*TB0273               WA2-FEDI-VAL-FIELD1 (1:23) " "
NR2001*TB0273               WA2-FEDI-VAL-FIELD2 (1:23)
NR2001*TB0273        DELIMITED BY SIZE INTO BORV-20-CHQ-PAYEE
NR2001*TB0273        IF BORV-20-CHQ-PAYEE NOT = SPACES
NR2001*TB0273           PERFORM M250-WRITE-NARRATIVE-TXN THRU M259-EXIT
NR2001*TB0273        END-IF
NR2001*TB0273
NR2001*TB0273        MOVE SPACES TO BORV-20-CHQ-PAYEE
NR2001*TB0273        STRING WA2-FEDI-RISK-TYPE " " WA2-FEDI-RUN-METHOD " "
NR2001*TB0273               WA2-FEDI-FEDI-STAN " " WA2-FEDI-FEE-CHRG-TYPE
NR2001*TB0273        DELIMITED BY SIZE INTO BORV-20-CHQ-PAYEE
NR2001*TB0273        IF BORV-20-CHQ-PAYEE NOT = SPACES
NR2001*TB0273           PERFORM M250-WRITE-NARRATIVE-TXN THRU M259-EXIT
NR2001*TB0273        END-IF
NR2001*TB0273
NR2001*TB0273        MOVE SPACES TO BORV-20-CHQ-PAYEE
NR2001*TB0273        STRING WA2-FEDI-NET-FEE-RECEIVB " "
NR2001*TB0273               WA2-FEDI-NET-FEE-RECEIVD
NR2001*TB0273        DELIMITED BY SIZE INTO BORV-20-CHQ-PAYEE
NR2001*TB0273        IF BORV-20-CHQ-PAYEE NOT = SPACES
NR2001               MOVE SPACES TO BOCT-20-CHQ-PAYEE
NR2001               MOVE WA-ADV-NAME-1 TO BOCT-20-CHQ-PAYEE
NR2001               MOVE "TRUE" TO WA-TEXT-AVAIL-FLAG
NR2001               PERFORM M250-WRITE-NARRATIVE-TXN
NR2001                                  THRU M259-EXIT
NR2001            END-IF
NR2001         ELSE
NR2001             IF WA-ADV-NAME-1 NOT = SPACES
NR2001                 MOVE SPACES TO BOCT-20-CHQ-PAYEE
NR2001                 MOVE WA-ADV-NAME-1 TO BOCT-20-CHQ-PAYEE
NR2001                 MOVE "TRUE" TO WA-TEXT-AVAIL-FLAG
NR2001                 PERFORM M250-WRITE-NARRATIVE-TXN
NR2001                                    THRU M259-EXIT
NR2001             END-IF
NR2001         END-IF
NR2001     END-IF.
NR2001*
NR2001     IF LINK-NARR-TXN-TYPE = 20
NR2001        IF LINK-TCNARR-SEQ-NO NOT = 0
NR2001           MOVE 2 TO UT9000-CALL-CODE
NR2001           MOVE " "               TO UT9000-CALL-STATUS
NR2001           MOVE STRT-AREA-SOC-NO  TO UT9000-INST-NO
NR2001           MOVE "TCNARR"          TO UT9000-CALLING-ID
NR2001           MOVE STRT-AREA-TELLER-LANG
NR2001                                  TO UT9000-LANGUAGE-CODE
NR2001           MOVE 1                 TO UT9000-REPORT-NO
NR2001           MOVE LINK-TCNARR-SEQ-NO TO UT9000-SEQUENCE-NO
NR2001           PERFORM U9100-RETRIEVE-TEXT THRU U9199-EXIT
NR2001           IF (UT9000-CALL-STATUS = "0") AND
NR2001              (UT9000RA-LINE1 NOT = SPACES)
NR2001              MOVE UT9000RA-LINE1 TO BOCT-20-CHQ-PAYEE
NR2001              MOVE "TRUE" TO WA-TEXT-AVAIL-FLAG
NR2001              PERFORM M250-WRITE-NARRATIVE-TXN
NR2001                                 THRU M259-EXIT
NR2001           END-IF
NR2001        END-IF
NR2001     END-IF.
NR2001*
NR2001     IF WA-NARR-TEXT NOT = SPACES
NR2001        MOVE WA-NARR-TEXT TO BOCT-20-CHQ-PAYEE
NR2001        MOVE "TRUE" TO WA-TEXT-AVAIL-FLAG
NR2001        PERFORM M250-WRITE-NARRATIVE-TXN
NR2001                           THRU M259-EXIT
NR2001     END-IF.
NR2001**   IF STRT-AREA-TRN-NO = 11055 OR 11155
NR2001*    IF (STRT-AREA-TRN-NO = 11055 OR 11155)
NR2001     IF (STRT-AREA-TRN-NO = 11055 OR 11155 OR 16055 OR 16155)
NR2001     AND (STRT-AREA-BATCH-TANDEM = "F" OR "Q" OR "J")
NR2001        MOVE SPACES TO BOCT-20-CHQ-PAYEE
NR2001        STRING WA2-FEDI-VAL-FLG " "
NR2001               WA2-FEDI-VAL-FIELD1 (1:23) " "
NR2001               WA2-FEDI-VAL-FIELD2 (1:23)
NR2001        DELIMITED BY SIZE INTO BOCT-20-CHQ-PAYEE
NR2001        IF BOCT-20-CHQ-PAYEE NOT = SPACES
NR2001           PERFORM M250-WRITE-NARRATIVE-TXN THRU M259-EXIT
NR2001        END-IF
NR2001
NR2001        MOVE SPACES TO BOCT-20-CHQ-PAYEE
NR2001        STRING WA2-FEDI-RISK-TYPE " " WA2-FEDI-RUN-METHOD " "
NR2001               WA2-FEDI-FEDI-STAN " " WA2-FEDI-FEE-CHRG-TYPE
NR2001        DELIMITED BY SIZE INTO BOCT-20-CHQ-PAYEE
NR2001        IF BOCT-20-CHQ-PAYEE NOT = SPACES
NR2001           PERFORM M250-WRITE-NARRATIVE-TXN THRU M259-EXIT
NR2001        END-IF
NR2001
NR2001        MOVE SPACES TO BOCT-20-CHQ-PAYEE
NR2001        STRING WA2-FEDI-NET-FEE-RECEIVB " "
NR2001               WA2-FEDI-NET-FEE-RECEIVD
NR2001        DELIMITED BY SIZE INTO BOCT-20-CHQ-PAYEE
NR2001        IF BOCT-20-CHQ-PAYEE NOT = SPACES
TB0273           PERFORM M250-WRITE-NARRATIVE-TXN  THRU M259-EXIT
TB0273        END-IF.
028470*
028480 M209-EXIT.
028490     EXIT.
028500/
028510 M250-WRITE-NARRATIVE-TXN.
028520*
028530     IF WA-TEXT-AVAIL
NR2001*028540         MOVE 20 TO BORV-20-CODE
NR2001*028550         MOVE 0 TO BORV-20-STATUS
NR2001*028560         IF  WA-INPUT-PARAM-TABLE(8) = 1
NR2001*028570             MOVE WA-STORE-TXN-DT TO BORV-20-POST-DATE
NR2001*028580         ELSE
NR2001*028590             MOVE STRT-AREA-POST-DT TO BORV-20-POST-DATE
NR2001*028600         END-IF
NR2001*028610         MOVE STRT-AREA-JRNL-NO TO BORV-20-JRNL-NO
NR2001         MOVE 20                    TO BOCT-TRAN-TYPE
NR2001         MOVE 0                     TO BOCT-STAT
NR2001         IF  WA-INPUT-PARAM-TABLE(8) = 1
NR2001             MOVE WA-STORE-TXN-DT   TO BOCT-TRN-DATE
NR2001         ELSE
NR2001             MOVE STRT-AREA-POST-DT TO BOCT-TRN-DATE
NR2001         END-IF
028620         PERFORM W500-ADD-TXN THRU W599-EXIT
028630     END-IF.
028640*
028650 M259-EXIT.
028660     EXIT.
028670/
028680 M300-MOVE-SECADD-TO-MAILADD.
028690     GO TO M310.

028710*    PERFORM V120-READ-CUSVB3 THRU V129-EXIT.
028720*    PERFORM M400-CHK-STATUS  THRU M499-EXIT.
028730*    IF WA-MSG-ERR-FLAG = 1
028740*        MOVE UT8500CA-FUNC-NORMAL-DISPLAY
028750*          TO UT8500CA-CALL-CODE
028760*        MOVE SPACES TO UT8500CA-INPUT-MSG
028770*        STRING "BR0024:(M300)  "
028780*               " ACCESS ERROR CUSVB3"
028790*                " /KEY="    DBIO-CALL-KEY-AREA
028800*                " /STATUS=" DBIO-CALL-STATUS
028810*               DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
028820*        CALL "UT8500" USING
028830*
028840*            UT8500CA-AREA
028850*        GO TO M399-EXIT.
028860*    IF DBIO-CALL-SAVE-REFER = "END."
028870*        GO TO M310.
028880*    PERFORM V140-READ-CUSVA3 THRU V149-EXIT.
028890*    PERFORM M400-CHK-STATUS  THRU M499-EXIT.
028900*    IF DBIO-CALL-SAVE-REFER = "END."
028910*        MOVE DBIO-CALL-SAVE-REFER TO DBIO-CALL-STATUS
028920*        MOVE 1 TO WA-MSG-ERR-FLAG.
028930*    IF WA-MSG-ERR-FLAG = 1
028940*        MOVE UT8500CA-FUNC-NORMAL-DISPLAY
028950*          TO UT8500CA-CALL-CODE
028960*        MOVE SPACES TO UT8500CA-INPUT-MSG
028970*        STRING "BR0024:(M300)  "
028980*               " ACCESS ERROR CUSVA3"
028990*                " /KEY="    DBIO-CALL-KEY-AREA
029000*                " /STATUS=" DBIO-CALL-STATUS
029010*               DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
029020*        CALL "UT8500" USING
029030*
029040*            UT8500CA-AREA
029050*        GO TO M399-EXIT.
029060*    MOVE CUSV-B3-ALT-ADD1     TO CUSV-A3-ADD1.
029070*    MOVE CUSV-B3-ALT-ADD2     TO CUSV-A3-ADD2.
029080*    MOVE CUSV-B3-ALT-ADD3     TO CUSV-A3-ADD3.
029090*    MOVE CUSV-B3-ALT-POSTCODE TO CUSV-A3-POSTCODE.
029100*    PERFORM V150-UPDATE-CUSVA3 THRU V159-EXIT.
029110*    PERFORM M400-CHK-STATUS    THRU M499-EXIT.
029120*    IF WA-MSG-ERR-FLAG = 1
029130*        MOVE UT8500CA-FUNC-NORMAL-DISPLAY
029140*          TO UT8500CA-CALL-CODE
029150*        MOVE SPACES TO UT8500CA-INPUT-MSG
029160*        STRING "BR0024:(M300)  "
029170*               " UPDATE ERROR CUSVA3"
029180*                " /KEY="    DBIO-CALL-KEY-AREA
029190*                " /STATUS=" DBIO-CALL-STATUS
029200*               DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
029210*        CALL "UT8500" USING
029220*
029230*            UT8500CA-AREA
029240*        GO TO M399-EXIT.
029250/
029260 M310.
029270     PERFORM V130-READ-CUSVBB THRU V139-EXIT.
029280     PERFORM M400-CHK-STATUS  THRU M499-EXIT.
029290     IF WA-MSG-ERR-FLAG = 1
029300         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
029310           TO UT8500CA-CALL-CODE
029320         MOVE SPACES TO UT8500CA-INPUT-MSG
029330         STRING "BR0024:(M310)  "
029340                " ACCESS ERROR CUSVBB"
029350                 " /KEY="    DBIO-CALL-KEY-AREA
029360                 " /STATUS=" DBIO-CALL-STATUS
029370                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
029380         CALL "UT8500" USING

029400             UT8500CA-AREA
029410         GO TO M399-EXIT.
029420     IF DBIO-CALL-SAVE-REFER = "END."
029430         GO TO M399-EXIT.
029440     PERFORM V100-READ-CUSVAA THRU V109-EXIT.
029450     PERFORM M400-CHK-STATUS  THRU M499-EXIT.
029460     IF DBIO-CALL-SAVE-REFER = "END."
029470         MOVE DBIO-CALL-SAVE-REFER TO DBIO-CALL-STATUS
029480         MOVE 1 TO WA-MSG-ERR-FLAG.
029490     IF  WA-MSG-ERR-FLAG = 1
029500         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
029510           TO UT8500CA-CALL-CODE
029520         MOVE SPACES TO UT8500CA-INPUT-MSG
029530         STRING "BR0024:(M310)  "
029540                ":ACCESS ERROR CUSVAA"
029550                "KEY...." DBIO-CALL-KEY-AREA
029560                "STATUS." DBIO-CALL-STATUS
029570                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
029580         CALL "UT8500" USING

029600             UT8500CA-AREA
029610         GO TO M399-EXIT.
029620     MOVE CUSV-BB-ALT-ADD1     TO CUSV-AA-ADD1.
029630     MOVE CUSV-BB-ALT-ADD2     TO CUSV-AA-ADD2.
029640     MOVE CUSV-BB-ALT-ADD3     TO CUSV-AA-ADD3.
029650     MOVE CUSV-BB-ALT-ADD4     TO CUSV-AA-ADD4.
029660     MOVE CUSV-BB-ALT-POSTCODE TO CUSV-AA-POSTCODE.
029670     PERFORM V160-UPDATE-CUSVAA THRU V169-EXIT.
029680     PERFORM M400-CHK-STATUS  THRU M499-EXIT.
029690     IF WA-MSG-ERR-FLAG = 1
029700         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
029710           TO UT8500CA-CALL-CODE
029720         MOVE SPACES TO UT8500CA-INPUT-MSG
029730         STRING "BR0024:(M310)  "
029740                ": UPDATE ERROR CUSVAA"
029750                 " /KEY="    DBIO-CALL-KEY-AREA
029760                 " /STATUS=" DBIO-CALL-STATUS
029770                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
029780         CALL "UT8500" USING

029800             UT8500CA-AREA
029810         GO TO M399-EXIT.
029820 M399-EXIT.
029830     EXIT.
029840*
029850 M400-CHK-STATUS.
029860     IF  DBIO-CALL-STATUS = "****"
029870         GO TO M499-EXIT.
029880     IF  DBIO-CALL-STATUS = "XEND"
029890         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
029900           TO UT8500CA-CALL-CODE
029910         MOVE SPACES TO UT8500CA-INPUT-MSG
029920         STRING "BR0024:(M400)  "
029930                " CUSV " DBIO-CALL-CODE-A
029940                 " NOT FOUND " DBIO-CALL-KEY-AREA
029950                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
029960         CALL "UT8500" USING

029980             UT8500CA-AREA
029990         MOVE 271 TO WA-OUTPUT-ERR-MSG-NO
030000         MOVE 1 TO WA-MSG-ERR-FLAG
030010         GO TO M499-EXIT.
030020     IF  DBIO-CALL-STATUS = "HELD"
030030         MOVE 112                 TO WA-OUTPUT-ERR-MSG-NO
030040         MOVE 1                  TO WA-MSG-ERR-FLAG
030050         GO TO M499-EXIT.
030060     MOVE UT8500CA-FUNC-NORMAL-DISPLAY
030070       TO UT8500CA-CALL-CODE
030080     MOVE SPACES TO UT8500CA-INPUT-MSG
030090     STRING "BR0024:(M400)  "
030100            " DATA BASE CORRUPT FOR KEY = "
030110             DBIO-CALL-KEY-AREA
030120             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
030130     CALL "UT8500" USING

030150             UT8500CA-AREA.
030160     MOVE DBIO-CALL-STATUS TO WA-DB-ERROR.
030170     MOVE "CUSV" TO WA-DBERR-DATA-SET.
030180     MOVE 155                     TO WA-OUTPUT-ERR-MSG-NO
030190     MOVE 1                      TO WA-MSG-ERR-FLAG.
030200 M499-EXIT.
030210      EXIT.
030220*
030230 M500-CREAT-AMEND-BLDV.
030240     IF  DBIO-CALL-TXN-TYPE-AREA = "AA"
030250         MOVE STRT-AREA-SOC-NO TO BLDV-AA-SOCIETY
030260         MOVE BORM-MEMB-CUST-AC TO BLDV-AA-MEMB-NO
030270         MOVE UPTELLCA-TELLER-BRANCH TO BLDV-AA-TELL-AND-BR
030280         MOVE STRT-AREA-POST-DT TO BLDV-AA-POST-DATE
S12518*030290         PERFORM W800-CREAT-BLDVAA THRU W809-EXIT
030300     ELSE
030310     IF  DBIO-CALL-TXN-TYPE-AREA = "BB"
030320         MOVE STRT-AREA-SOC-NO TO BLDV-BB-SOCIETY
030330         MOVE BORM-MEMB-CUST-AC TO BLDV-BB-MEMB-NO
030340         MOVE UPTELLCA-TELLER-BRANCH TO BLDV-BB-TELL-AND-BR
030350         MOVE STRT-AREA-POST-DT TO BLDV-BB-POST-DATE
030360         PERFORM W810-CREAT-BLDVBB THRU W819-EXIT.
030370 M599-EXIT.
030380     EXIT.
030390/
030400 M600-ADD-ADV.
030410     IF  WA-DUMMY-AMT > BORM-ADD-LOAN-APP
030420         MOVE 135 TO WA-OUTPUT-ERR-MSG-NO
030430         MOVE 1 TO WA-MSG-ERR-FLAG
030440         GO TO M699-EXIT.
030450*
030460***  SUB LEDGER CODE FOR ADDITIONAL LOAN MUST BE > 10.
030470*
030480     ADD WA-DUMMY-AMT TO BORM-ADD-LOAN-ADV.
030490     IF  BORM-ADD-LOAN-ADV > BORM-ADD-LOAN-APP
030500     OR  BORM-ADD-LOAN-ADV < 0
030510         MOVE 135 TO WA-OUTPUT-ERR-MSG-NO
030520         MOVE 1 TO WA-MSG-ERR-FLAG
030530         GO TO M699-EXIT.
030540     IF ((BORP-CAPN-METHOD NOT = " ")
030550     AND (BORP-CAPN-METHOD IS ALPHABETIC))
030560        IF WA-INPUT-PARAM-TABLE (7) NOT = 1
030570           PERFORM M1300-PROCESS-ADV-UPFRONT-LOAN THRU M1399-EXIT
030580        ELSE
030590           ADD WA-COMM-CORR-AMOUNT TO BORM-UNEARNED-INT
030600           MOVE WA-COMM-CORR-AMOUNT TO WA-COMMISSION-AMOUNT.
030610     IF  (BORM-ADD-LOAN-ADV = BORM-ADD-LOAN-APP)
030620         MOVE 5 TO BORM-ADD-LOAN-STAT
030630     ELSE
030640         IF  BORM-ADD-LOAN-ADV = ZERO
030650             MOVE 2 TO BORM-ADD-LOAN-STAT
030660         ELSE MOVE 4 TO BORM-ADD-LOAN-STAT.
030670     IF BORM-REM-REPAYS > 0
030680         IF STRT-AREA-LEDG-CODE NOT = 0
030690            MOVE STRT-AREA-LEDG-CODE TO WA-LEDGER-CODE
030700         ELSE
030710            MOVE 2                   TO WA-LEDGER-CODE
030720         END-IF
030730     ELSE
030740        MOVE 1                    TO WA-LEDGER-CODE
030750     END-IF.
030760     ADD WA-DUMMY-AMT TO BORM-EOM-BASIC-BAL
030770                         BORM-EOY-BASIC-BAL.
030780     MOVE STRT-AREA-PRIORITY-CODE TO WA-PRIORITY-CODE.
030790     MOVE WA-DUMMY-AMT TO WA-AMOUNT-TO-ADD.
030800     MOVE BORM-LOAN-BAL TO CPY-BORM-LOAN-BAL.
030810     MOVE BORM-THEO-LOAN-BAL TO CPY-BORM-THEO-LOAN-BAL.
030820*
030830     IF BORP-PRIORITY-CODE-ON
030840        IF WA-PRIORITY-CODE = SPACES
TB0084           IF BORP-PRIORITY-TERM-BY-TERM
TB0084              PERFORM M100-CALL-UT0094 THRU M109-EXIT
TB0084           ELSE
030850              PERFORM M000-CALL-UT0095 THRU M099-EXIT
TB0084           END-IF
030860           IF WA-MSG-ERR-FLAG = 1
030870              GO TO M699-EXIT
030880           END-IF
030890        ELSE
TB0084           PERFORM N400-SEARCH-PRIORITY THRU N409-EXIT
TB0084           IF WA-MSG-ERR-FLAG = 1
TB0084              GO TO M699-EXIT
TB0084           END-IF
030900           PERFORM N000-ADD-TO-LOAN-BAL THRU NADD-EXIT
030910        END-IF
030920     ELSE
030930        PERFORM N100-ADD-TO-LOAN-BAL THRU N199-EXIT
030940     END-IF.
030950*
030960     MOVE CPY-BORM-LOAN-BAL TO BORM-LOAN-BAL.
030970     MOVE CPY-BORM-THEO-LOAN-BAL TO BORM-THEO-LOAN-BAL.
030980     IF WA-INPUT-PARAM-TABLE(8) = 1
030990*NBG003
031000*        MOVE WA-STORE-TXN-DT TO BORM-IR-ACTIVITY
031010         MOVE WA-STORE-TXN-DT TO BIRM-IR-ACTIVITY
031020     ELSE
031030*NBG003
031040*        MOVE STRT-AREA-POST-DT  TO BORM-IR-ACTIVITY.
031050         MOVE STRT-AREA-POST-DT  TO BIRM-IR-ACTIVITY.
031060     IF  BORM-ADD-LOAN-APP = BORM-ADD-LOAN-ADV
031070         IF  BORM-ADD-DUES = ZEROES
031080             MOVE 1 TO WA-MSG-ERR-FLAG
031090             MOVE 275 TO WA-OUTPUT-ERR-MSG-NO
031100             GO TO M699-EXIT
031110         ELSE
031120             PERFORM W900-SET-ADD-DUES-DTE THRU W909-EXIT
031130             IF  WA-MSG-ERR-FLAG = 1
031140                 GO TO M699-EXIT.
031150*
031160**** BUILD UP FIN TRX HERE   **
NR2001*031170     MOVE SPACES                 TO BORV-RECORD-AREA.
NR2001*031180     INITIALIZE BORV-01-DETAIL.
NR2001*031190     MOVE 01                     TO BORV-01-CODE.
NR2001*031200     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001*031210*        PERFORM N1500-CALC-INT-DUE-DT THRU N1599-EXIT
NR2001*031220         IF  WA-STORE-TXN-DT < WA-INT-ST-BIN
NR2001*031230             MOVE 1              TO WA-BKD-STAT
NR2001*031240             MOVE 1              TO BORM-BACK-DT-IND
NR2001*031250         ELSE
NR2001*031260             MOVE 0              TO WA-BKD-STAT
NR2001*031270     ELSE
NR2001*031280         MOVE 0                  TO WA-BKD-STAT.
NR2001*031290     IF WA-INPUT-PARAM-TABLE(6) = 1
NR2001*031300         MOVE 1                  TO WA-NPB-STAT
NR2001*031310     ELSE
NR2001*031320         MOVE 0                  TO WA-NPB-STAT.
NR2001*031330     MOVE WA-TXN-STAT            TO BORV-01-STATUS.
NR2001*031340     IF  WA-INPUT-PARAM-TABLE(8) = 1
NR2001*031350         MOVE WA-STORE-TXN-DT    TO BORV-01-TRN-DATE
NR2001*031360     ELSE
NR2001*031370         MOVE STRT-AREA-POST-DT    TO BORV-01-TRN-DATE.
NR2001*031380     MOVE UPTELLCA-TELLER-BRANCH    TO BORV-01-TELL-AND-BR.
NR2001*031390     MOVE STRT-AREA-MSG-TIME  TO BORV-01-POST-TIME.
NR2001*031400     MOVE STRT-AREA-TERM-NO   TO BORV-01-BRTERM.
NR2001*031410     MOVE STRT-AREA-TRN-NO    TO BORV-01-TRN-CODE.
NR2001*031420     MOVE STRT-AREA-POST-DT   TO BORV-01-POST-DATE.
NR2001*031430     MOVE STRT-AREA-JRNL-NO   TO BORV-01-JRNL-NO.
NR2001*031440     MOVE BORM-LOAN-BAL TO BORV-01-BALANCE.
NR2001*031450     MOVE WA-DUMMY-AMT TO BORV-01-AMOUNT.
NR2001*TB0084     PERFORM N600-GET-ARREARS THRU N609-EXIT
NR2001*031460*--- COMPUTE BORV-01-ARREARS = BORM-LOAN-BAL - BORM-THEO-LOAN-BAL.
NR2001*031470     MOVE WA-ADV-PROMO        TO BORV-01-PROMO-NO.
NR2001*031480     MOVE WA-ADV-SUB-LEDG-CODE TO BORV-01-SUB-LEDG-CODE.
NR2001*TB0244***
NR2001*TB0244*** IF FOR TIB
NR2001*TB0244***
NR2001*TB0244     IF SOC-SITE-TIB
NR2001*TB0244        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
NR2001*TB0244                X000-EXIT
NR2001*TB0244     END-IF.
NR2001*031490     IF  WA-INPUT-PARAM-TABLE(10) = 1
NR2001*031500         MOVE WA-ADV-CHQ-NO TO BORV-01-CHQ-DAYS
NR2001*031510     ELSE MOVE ZEROS TO BORV-01-CHQ-DAYS.
NR2001*031520     PERFORM W500-ADD-TXN THRU W599-EXIT.
NR2001*031530     IF  WA-MSG-ERR-FLAG = 1
NR2001*031540         GO TO M699-EXIT.
NR2001*031550     MOVE BORV-RECORD-AREA TO BORV-RECORD-AREA-2.
NR2001     MOVE SPACES                 TO BOCT-RECORD-AREA.
NR2001     INITIALIZE BOCT-TRAN-01.
NR2001     MOVE 01                     TO BOCT-TRAN-TYPE.
NR2001     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001*        PERFORM N1500-CALC-INT-DUE-DT THRU N1599-EXIT
NR2001         IF  WA-STORE-TXN-DT < WA-INT-ST-BIN
NR2001             MOVE 1              TO WA-BKD-STAT
NR2001             MOVE 1              TO BORM-BACK-DT-IND
NR2001         ELSE
NR2001             MOVE 0              TO WA-BKD-STAT
NR2001     ELSE
NR2001         MOVE 0                  TO WA-BKD-STAT.
NR2001     IF WA-INPUT-PARAM-TABLE(6) = 1
NR2001         MOVE 1                  TO WA-NPB-STAT
NR2001     ELSE
NR2001         MOVE 0                  TO WA-NPB-STAT.
NR2001     MOVE WA-TXN-STAT            TO BOCT-STAT.
NR2001     IF  WA-INPUT-PARAM-TABLE(8) = 1
NR2001         MOVE WA-STORE-TXN-DT    TO BOCT-TRN-DATE
NR2001     ELSE
NR2001         MOVE STRT-AREA-POST-DT  TO BOCT-TRN-DATE.
NR2001     MOVE STRT-AREA-MSG-TIME     TO BOCT-01-REPOST-TIME.
NR2001     MOVE STRT-AREA-TRN-NO       TO BOCT-TRN-CODE.
NR2001     MOVE BORM-LOAN-BAL          TO BOCT-01-BALANCE.
NR2001     MOVE WA-DUMMY-AMT           TO BOCT-01-AMOUNT.
NR2001     PERFORM N600-GET-ARREARS THRU N609-EXIT
NR2001*--- COMPUTE BORV-01-ARREARS = BORM-LOAN-BAL - BORM-THEO-LOAN-BAL.
NR2001     MOVE WA-ADV-PROMO           TO BOCT-01-PROMO-NO.
NR2001     MOVE WA-ADV-SUB-LEDG-CODE   TO BOCT-01-SUB-LEDG-CODE.
NR2001***
NR2001*** IF FOR TIB
NR2001***
NR2001     IF SOC-SITE-TIB
NR2001        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
NR2001                X000-EXIT
NR2001     END-IF.
NR2001     IF  WA-INPUT-PARAM-TABLE(10) = 1
NR2001         MOVE WA-ADV-CHQ-NO      TO BOCT-01-CHQ-DAYS
NR2001     ELSE MOVE ZEROS             TO BOCT-01-CHQ-DAYS.
NR2001     PERFORM W500-ADD-TXN THRU W599-EXIT.
NR2001     IF  WA-MSG-ERR-FLAG = 1
NR2001         GO TO M699-EXIT.
NR2001     MOVE BOCT-RECORD-AREA       TO BOCT-RECORD-AREA-2.
031560*
031570* FOR A NARRATIVE TRANSACTION, ALSO WRITE AN BORV 20 RECORD
031580*
031590     MOVE "FALSE" TO WA-TEXT-AVAIL-FLAG.
031600     IF WA-INPUT-PARAM-TABLE(30) NOT = 1                                 
031610        IF (LINK-NARR-TXN-TYPE = 20) OR
031620           (WA-NARR-TEXT NOT = SPACES) OR
031630           ((WA-DUMMY-LST-TWO >= 80) AND (WA-DUMMY-LST-TWO <= 89))
031640             PERFORM M200-GENERIC-NARRATIVE-PARA THRU M209-EXIT
031650        END-IF
031660     END-IF.                                                             
031670*
031680* FOR A TRANSFER TRANSACTION (WHERE A TYPE '20' WASN'T WRITTEN),
031690* WRITE AN BORV 36 RECORD.
031700*
031710*    IF (LINK-NARR-TXN-TYPE = 36) AND
031720*       WA-NO-TEXT-AVAIL
031730     IF (LINK-NARR-TXN-TYPE = 36)
031740         PERFORM M1700-WRITE-TYPE-36 THRU M1799-EXIT
031750     END-IF.
031760*
031770     IF  WA-MSG-ERR-FLAG = 1
031780         GO TO M699-EXIT.
NR2001*031790     MOVE BORV-01-TRN-DATE TO BORM-ADD-ADV-DATE.
S19314*NR2001     MOVE BOCT-TRN-DATE TO BORM-ADD-ADV-DATE.
031800     IF  WA-INPUT-PARAM-TABLE(6) = 1
031810             ADD WA-DUMMY-AMT   TO BORM-NPB-VAL
031820             ADD 1               TO BORM-NO-NPB.
031830     IF  WA-INPUT-PARAM-TABLE(8) = 1
S10075       IF  BORP-YOUBE                           
S10075       AND WA-INPUT-PARAM-TABLE(7) = 1          
S10075           NEXT SENTENCE                        
S10075       ELSE                                     
031840         IF  BORM-LST-FIN-DATE < WA-STORE-TXN-DT
031850             MOVE WA-STORE-TXN-DT TO BORM-LST-FIN-DATE
031860         ELSE NEXT SENTENCE
S10075         END-IF
S10075       END-IF  
031870     ELSE
031880         MOVE STRT-AREA-POST-DT TO BORM-LST-FIN-DATE.
SC8215     MOVE STRT-AREA-POST-DT          TO BOIS-LST-FIN-POST-DT.
031890     IF ((BORP-CAPN-METHOD NOT = " ")
031900     AND (BORP-CAPN-METHOD IS ALPHABETIC))
NR2001*031910        PERFORM M1400-ADD-COMM-TRAN-BORV THRU M1499-EXIT.
NR2001        PERFORM M1400-ADD-COMM-TRAN-BOCT THRU M1499-EXIT.
031920     INITIALIZE BLDV-BB-DATA-REC-R
031930     INITIALIZE BLDV-BB-GROUP-DATA-R
031940     MOVE "BB" TO BLDV-BB-TYPE BLDV-BB-TRAN-TYPE
031950                               DBIO-CALL-TXN-TYPE-AREA.
031960     MOVE BORM-ADD-LOAN-ADV TO BLDV-BB-ADDIT-LOAN-ADV.
031970     MOVE WA-DUMMY-AMT TO BLDV-BB-ADDIT-LOAN-APPV.
031980     SUBTRACT BORM-ADD-LOAN-ADV FROM BORM-ADD-LOAN-APP
031990              GIVING BLDV-BB-ADDIT-LOAN-UND.
032000     MOVE BORM-ADD-APPRV-DATE TO BLDV-BB-ADDIT-APRV-DATE.
S19314*032010     MOVE BORM-ADD-ADV-DATE TO BLDV-BB-ADDIT-ADV-DATE.
S19314     MOVE 0                   TO BLDV-BB-ADDIT-ADV-DATE.
032020     MOVE BORM-ADD-DUES-STRT-DATE TO BLDV-BB-DUES-START-DT.
032030     MOVE BORM-INT-START-DATE TO BLDV-BB-INT-START-DT.
032040     PERFORM M500-CREAT-AMEND-BLDV THRU M599-EXIT.
032050     IF  WA-MSG-ERR-FLAG = 1
032060         GO TO M699-EXIT.
032070*    MOVE "Y"                    TO WA-LOAN-REFRESH-FLAG.
032080* LOAN ADVANCE TO A DEPOSIT ACCOUNT SPR NO. 740003

032100*    IF STRT-AREA-TRN-NO = 11055 OR 16055 OR 11155 OR 16155                    TB0267
TB0267     IF STRT-AREA-TRN-NO = 11055 OR 16055 OR 11155 OR 16155
TB0267*                          OR 14150 OR 14055 OR 14155          SC6028
SC7091                           OR 14055 OR 14155
SC7091                           OR 19055 OR 19155
S11455                           OR 11068 OR 11168
S11455                           OR 16068 OR 16168
032110         PERFORM H100-ADV-BY-TRANSFER THRU H199-EXIT
032120         IF WA-MSG-ERR-FLAG = 1
032130             GO TO M699-EXIT.
032140* END OF PROCESSING FOR TRN NO 11055

032160     PERFORM M700-SEND-INFO THRU M799-EXIT.

032180 M699-EXIT.
032190     EXIT.

032210 M700-SEND-INFO.
032220     IF STRT-AREA-OTHER-OVERRIDE = "7"                                   
032230        GO TO M790-SEND.
032240*** SEND INFORMATION TO FORMATTER *****
032250     IF BORM-CURRENCY-IND  = SPACES
032260        NEXT SENTENCE
032270     ELSE
032280        MOVE BORM-CURRENCY-IND TO  WS-SAVE-DISC-CURRENCY.
032290*
032300     MOVE SPACES                 TO WA-OUTPUT-MESSAGE.
032310*****IF  WA-INPUT-PARAM-TABLE(8) = 1
032320     IF  WA-INPUT-PARAM-TABLE(8) = 1 OR
032330         STRT-AREA-OTHER-OVERRIDE = "1" OR "3"
032340         IF SOC-LOANS-TRACKING-OPTION = "Y" AND
032350             WA-INPUT-PARAM-TABLE(22) = 1
032360             GO TO M799-EXIT
032370         END-IF
032380         MOVE STRT-AREA-JRNL-NO TO WA-OUTPUT-JRNL-NO
032390         MOVE 4 TO WA-INPUT-MSG-CODE
032400         MOVE 999 TO WA-OUTPUT-ERR-MSG-NO
032410         MOVE 7  TO  WA-OUTPUT-MSG-LENGTH
032420         PERFORM W200-FMT-SEND-PARA
032430            THRU W299-EXIT
032440         GO TO M799-EXIT.
032450     MOVE WA-INPUT-KEY       TO WA-ADV-OUTPUT-MSG-KEY.
032460     IF STRT-AREA-TRN-NO = 10171
032470         MOVE 0                     TO WA-OUTPUT-ERR-MSG-NO
032480                                       WA-UT0460-MSG-NO-N
032490         GO TO M799-EXIT
032500     END-IF.
032510     IF WA-INPUT-PARAM-TABLE(6) = 1
032520         MOVE UT0500RA-NAME-1       TO WA-ADV-OUTPUT-NAME1
032530         MOVE UT0500RA-NAME-2       TO WA-ADV-OUTPUT-NAME2
NR2001*032540         MOVE BORV-RECORD-AREA-2    TO WA-ADV-OUTPUT-TRAN
NR2001         MOVE BOCT-RECORD-AREA-2    TO WA-ADV-OUTPUT-TRAN
032550         MOVE WS-SAVE-DISC-CURRENCY
032560                                    TO WA-ADV-OUTPUT-CURR
032570         MOVE SPACES                TO WA-ADV-OUTPUT-SW-REF-NO
032580         MOVE 002                   TO WA-OUTPUT-ERR-MSG-NO
032590         SET PBOOKCA-RCPT-PRINT TO TRUE
032600         MOVE 178                   TO WA-OUTPUT-MSG-LENGTH
032610     ELSE
NR2001*032620         MOVE BORV-RECORD-AREA-2    TO WA-ADV-OP-MSG
NR2001         MOVE BOCT-RECORD-AREA-2    TO WA-ADV-OP-MSG
032630         MOVE 001                   TO WA-OUTPUT-ERR-MSG-NO
032640         SET PBOOKCA-PB-PRINT TO TRUE
032650         MOVE WS-SAVE-DISC-CURRENCY TO WA-DISCH-CURR
032660         MOVE 162                   TO WA-OUTPUT-MSG-LENGTH
032670     END-IF.
032680     PERFORM W200-FMT-SEND-PARA
032690        THRU W299-EXIT.
032700*
032710*** MESSAGE FORMATTING FOR CHEQUE WITHDRAWL ****
032720     IF  WA-INPUT-PARAM-TABLE(7) NOT = 1
032730      IF  WA-DUMMY-LST-TWO = 70
032740           MOVE UT0500RA-NAME-1     TO WA-ADV-OUTPUT-NAME1
032750           MOVE UT0500RA-NAME-2     TO WA-ADV-OUTPUT-NAME2
NR2001*032760           MOVE BORV-RECORD-AREA-2  TO WA-ADV-OUTPUT-TRAN
NR2001           MOVE BOCT-RECORD-AREA-2  TO WA-ADV-OUTPUT-TRAN
032770           MOVE 003                 TO WA-OUTPUT-ERR-MSG-NO
032780           SET PBOOKCA-CHQ-PRINT TO TRUE
032790           MOVE 162                 TO WA-OUTPUT-MSG-LENGTH
032800           MOVE WS-SAVE-DISC-CURRENCY
032810                                    TO WA-ADV-OUTPUT-CURR
032820           PERFORM W200-FMT-SEND-PARA THRU W299-EXIT
032830      END-IF
032840     END-IF.
032850*
032860*** MESSAGE FORMATTING FOR THIRD PARTY CHEQUE WITHDRAWL ****
032870*
032880     IF  WA-INPUT-PARAM-TABLE(7) NOT = 1
032890      IF  WA-DUMMY-LST-TWO = 80
032900          AND WA-1ST-BYTE-NAME NOT = "#"                                
032910          MOVE WA-ADV-NAME-1     TO WA-ADV-OUTPUT-NAME1
032920          MOVE WA-ADV-NAME-2     TO WA-ADV-OUTPUT-NAME2
NR2001*032930          MOVE BORV-RECORD-AREA-2
NR2001          MOVE BOCT-RECORD-AREA-2
032940                                 TO WA-ADV-OUTPUT-TRAN
032950          MOVE 003               TO WA-OUTPUT-ERR-MSG-NO
032960          SET PBOOKCA-CHQ-PRINT TO TRUE
032970          MOVE WS-SAVE-DISC-CURRENCY
032980                                 TO WA-ADV-OUTPUT-CURR
032990          MOVE 162               TO WA-OUTPUT-MSG-LENGTH
033000          PERFORM W200-FMT-SEND-PARA THRU W299-EXIT
033010      END-IF
033020     END-IF.
033030     IF  (WA-INPUT-PARAM-TABLE (5) = 1)
033040     AND (WA-BORM-INS-PREMIUM > 0)
NR2001*033050         MOVE BORV-RECORD-AREA-9 TO WA-ADV-OP-MSG
NR2001         MOVE BOCT-RECORD-AREA-9 TO WA-ADV-OP-MSG
033060         MOVE 001                TO WA-OUTPUT-ERR-MSG-NO
033070         SET PBOOKCA-PB-PRINT TO TRUE
033080         MOVE 162                TO WA-OUTPUT-MSG-LENGTH
033090         MOVE WS-SAVE-DISC-CURRENCY TO WA-DISCH-CURR
033100         PERFORM W200-FMT-SEND-PARA THRU W299-EXIT
033110     END-IF.
033120*
033130*************************************************************
033140* PETER HAN: CHARGE SYSTEM CALL INSERTION (2) STARTS HERE
033150*************************************************************
033160*
033170     IF  CS0000RA-CHR-CNT = 0
033180         GO TO M790-SEND.
033190*
033200     PERFORM BB00-PROCESS-CHARGE-TXNS THRU BB99-EXIT.

033220     IF CS0000RA-STATUS = 11 OR 01
033230        MOVE 1 TO WA-MSG-ERR-FLAG
033240        GO TO M799-EXIT.
033250 
033260     IF WA-CS0000RA-STATUS NOT = 0 OR
033270         WA-CS0090RA-STATUS NOT = 0
033280          MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
033290          MOVE SPACES TO UT8500CA-INPUT-MSG
033300          STRING "BR0024:(M700) INVALID RET STATUS CS0000/90 "
033310                   WA-CS0000RA-STATUS " / " WA-CS0090RA-STATUS
033320              DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
033330          CALL "UT8500" USING

033350                              UT8500CA-AREA
033360**        MOVE WA-CHARGE-ERR (TXT-1, TXT-2)
033370**                                     TO WA-OUTPUT-LIMIT-MSG
033380         MOVE SPACES TO WA-OUTPUT-LIMIT-MSG

033400         MOVE 3226 TO WA-OUTPUT-ERR-MSG-NO                              
033410         MOVE 1 TO ST-STATUS-LEVEL-1 WA-MSG-ERR-FLAG                    

033430         PERFORM W200-FMT-SEND-PARA THRU W299-EXIT.
033440*

033460     IF  CS0000CA-LST-FEE = CS0000RA-LST-FEE-PROC
033470         GO TO M790-SEND
033480     ELSE
033490         MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
033500         MOVE SPACES TO UT8500CA-INPUT-MSG
033510         STRING "BR0024:(M700) > 30 CHARGES TO BE APPLIED "
033520             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
033530         CALL "UT8500" USING

033550                             UT8500CA-AREA
033560*        MOVE WA-CHARGE-GT30 (TXT-1, TXT-2)
033570*                                     TO WA-OUTPUT-LIMIT-MSG
033580         MOVE SPACES TO WA-OUTPUT-LIMIT-MSG

033600         MOVE 2117 TO WA-OUTPUT-ERR-MSG-NO                              
033610         MOVE 1 TO ST-STATUS-LEVEL-1 WA-MSG-ERR-FLAG                    
033620         PERFORM W200-FMT-SEND-PARA THRU W299-EXIT.

033640 M790-SEND.
033650**************************************************************
033660* INSERTION (2) ENDS HERE
033670**************************************************************
033680     IF STRT-AREA-OTHER-OVERRIDE = "7"                                   
033690        GO TO M799-EXIT.                                                 
033700     IF  (WA-INPUT-PARAM-TABLE(8) = 1) OR
033710         (STRT-AREA-OTHER-OVERRIDE = "1" OR "3") OR
033720         (STRT-AREA-TRN-NO = 10171)
033730         GO TO M799-EXIT.

033750     IF SOC-MARKETING = "Y"
033760         IF (WA-INPUT-PARAM-TABLE(5) = 1) AND
033770             (WA-INPUT-PARAM-TABLE(7) NOT = 1) AND
033780             (WA-INPUT-PARAM-TABLE(30) NOT = 1)
033790              MOVE 0 TO MS0010CA-STATUS
033800              MOVE 2 TO MS0010CA-CALL-FUNC
033810              CALL "MS0010" USING

033830                                  STARTAREA
033840                                  MS0010CA-CALL-AREA.
033850************* IF MS0010CA-STATUS = 1 OR 2
033860*************     GO TO M750-CHECK-REFRESH-FLAG.
033870*
033880     IF SOC-DISPLAY-NAME = "Y"
033890         MOVE UT0500RA-NAME-1    TO WA-ADV-OUTPUT-NAME1
033900         MOVE UT0500RA-NAME-2    TO WA-ADV-OUTPUT-NAME2
033910     ELSE
033920         MOVE SPACES             TO WA-ADV-OUTPUT-NAME1
033930                                    WA-ADV-OUTPUT-NAME2
033940     END-IF.
033950     MOVE 0                      TO WA-OUTPUT-ERR-MSG-NO
033960                                    WA-UT0460-MSG-NO-N.
033970     PERFORM W200-FMT-SEND-PARA THRU W299-EXIT.
033980 M799-EXIT.
033990     EXIT.
034000*
034010*** SETS RENEWAL DATE IN BORROWERS MASTER DATA SET
034020*
034030 M800-SET-RENEWAL-DATE.
034040     MOVE BORM-ADV-DATE TO UT0020-BINARY-DATE.
034050     MOVE 1 TO UT0020-FUNCTION.
034060     PERFORM X100-UT0020-PARA THRU X109-EXIT.
034070     MOVE UT0020-DATE-DDMMCCYY TO WA-TRN-DATE.
034080     IF BORM-CAT = 84
034090        ADD 1 TO WA-TRN-CCYY-R.
034100     IF BORM-CAT = 52
034110        DIVIDE 12 INTO BORM-LOAN-TRM
034120               GIVING WA-TEMP-YRS REMAINDER WA-TEMP-MTHS
034130               ADD WA-TEMP-YRS TO WA-TRN-CCYY-R
034140               ADD WA-TEMP-MTHS TO WA-TRN-MM
034150               IF WA-TRN-MM > 12
034160                  ADD 1 TO WA-TRN-CCYY-R
034170                  SUBTRACT 12 FROM WA-TRN-MM.
034180     MOVE WA-TRN-DATE TO UT0030-DATE-DDMMCCYY.
034190     PERFORM X200-UT0030-PARA THRU X209-EXIT.
034200     MOVE UT0030-BINARY-DATE TO BORM-RENEWAL-DATE.
034210 M819-EXIT.
034220     EXIT.
034230/
034240 M830-CHECK-DIGIT-PARA.
034250     MOVE WA-ADV-CHQ-NO          TO WA-DUMMY-CHQ-NO.
034260     IF  WA-DUMMY-CHQ-7 = 0
034270         MOVE 327                TO WA-OUTPUT-ERR-MSG-NO
034280         MOVE 1                  TO WA-MSG-ERR-FLAG
034290         GO TO M839-EXIT.
034300     MOVE WA-DUMMY-CHQ-7         TO UT0151CA-ACCT-EX.
034310     MOVE 3                      TO UT0151CA-CALL-FUNC.
034320     MOVE SOC-ACCT-NO-FORMAT     TO UT0151CA-FORMAT.
034330     MOVE SOC-CHK-DGT            TO
034340                                 UT0151CA-CHK-DGT-TYPE.
034350     CALL "UT0151" USING UT0151CA-CALL-AREA.
034360     IF UT0151CA-STATUS = 0
034370        IF UT0151CA-CKD = WA-DUMMY-CHQ-LAST
034380           MOVE WA-DUMMY-CHQ-7   TO WA-ADV-CHQ-NO
034390           GO TO M839-EXIT.
034400     MOVE 269                    TO WA-OUTPUT-ERR-MSG-NO.
034410     MOVE 1                      TO WA-MSG-ERR-FLAG.
034420 M839-EXIT.
034430     EXIT.
034440/
034450 M900-VALIDATE-READ-LOC.
034460     MOVE 1                      TO UT0151CA-CALL-FUNC.
034470     MOVE WA-CORR-LOC-ACCT       TO UT0151CA-ACCT-EX.
034480     MOVE SOC-ACCT-NO-FORMAT     TO UT0151CA-FORMAT.
034490     MOVE SOC-CHK-DGT            TO
034500                                 UT0151CA-CHK-DGT-TYPE.
034510     CALL "UT0151" USING UT0151CA-CALL-AREA.
034520     IF  UT0151CA-STATUS  NOT =  0
034530         MOVE 169 TO WA-OUTPUT-ERR-MSG-NO
034540         MOVE 1 TO WA-MSG-ERR-FLAG
034550         GO TO M999-EXIT.
034560     MOVE UT0151CA-ACCT-IN   TO WA-CORR-LOC-ACCT.
034570*    IF BORM-LOC-ACC NOT = WA-CORR-LOC-ACCT
034580     IF BBLC-LOC-ACCT-NO NOT = WA-CORR-LOC-ACCT
034590         MOVE 699 TO WA-OUTPUT-ERR-MSG-NO
034600         MOVE 1 TO WA-MSG-ERR-FLAG
034610         GO TO M999-EXIT.
034620     MOVE 01 TO DBIO-CALL-FUNC.
034630     MOVE "BOR" TO DBIO-CALL-SYS-AREA.
034640     MOVE STRT-AREA-SOC-NO TO WA-BORM-SOC-NO.
034650     MOVE WA-CORR-LOC-ACCT TO WA-BORM-ACCT-NO.
034660     MOVE WA-BORM-KEY TO DBIO-CALL-KEY-AREA.
034670     CALL "DBIO" USING

034690                       DBIO-CALL-PARAM
034700                       DBIO-CALL-SYS-AREA
034710                       DBIO-CALL-KEY-AREA
034720                       DBIO-CALL-STATUS
034730                       BORM-RECORD-AREA.
034740     IF DBIO-CALL-STATUS = "HELD"
034750         MOVE 112 TO WA-OUTPUT-ERR-MSG-NO
034760         MOVE 1 TO WA-MSG-ERR-FLAG
034770         GO TO M999-EXIT.
034780     IF DBIO-CALL-STATUS NOT = "****"
034790         MOVE 1 TO WA-MSG-ERR-FLAG
034800         MOVE 155 TO WA-OUTPUT-ERR-MSG-NO
034810         MOVE "BORM" TO WA-DBERR-DATA-SET
034820         MOVE DBIO-CALL-STATUS TO WA-DB-ERROR
034830         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
034840           TO UT8500CA-CALL-CODE
034850         MOVE SPACES TO UT8500CA-INPUT-MSG
034860         STRING "BR0024:(M900)  "
034870                " ERROR READING BORM "
034880                 DBIO-CALL-KEY-AREA " " DBIO-CALL-STATUS
034890                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
034900         CALL "UT8500" USING

034920             UT8500CA-AREA.
034930*
034940 M999-EXIT.
034950     EXIT.
034960/
034970 M1000-RECALC-DUES-SORD.
034980********     RECALCULATED INSTALMENT AND POST TO SORD  ********
034990     MOVE 00 TO BR0042CA-CALL-CODE.
035000     MOVE STRT-AREA-SOC-NO TO BR0042CA-SOC-NO.
035010     MOVE BBLC-LOC-ACCT-NO TO BR0042CA-CUST-NO.
035020*    MOVE BORM-LOC-ACC TO BR0042CA-CUST-NO.
035030     MOVE BORM-ACT-TYPE TO BR0042CA-ACCT-TYPE.
035040     COMPUTE BR0042CA-AMT = BORM-LOAN-BAL + WA-DUMMY-AMT.
035050     MOVE BORM-CAT TO BR0042CA-INT-CAT.
035060     MOVE BORM-REM-REPAYS TO BR0042CA-TERM-MONTHS
035070     MOVE WA-STORE-ACT-CORR-AMT TO BR0042CA-ACT-FEE.
035080     CALL "BR0042" USING

035100             BR0042CA-LINKAGE
ST0020             BORM-RECORD-AREA.
035110     IF BR0042CA-CALL-STATUS NOT = 0
035120         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
035130           TO UT8500CA-CALL-CODE
035140         MOVE SPACES TO UT8500CA-INPUT-MSG
035150         STRING "BR0024:(M0100)  "
035160                " DUES NOT RECALCULATED FOR ACCT "
035170                 BORM-KEY
035180                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
035190         CALL "UT8500" USING

035210             UT8500CA-AREA
035220        GO TO M1099-EXIT.
035230     MOVE "LON" TO W320-SORD-TO-SYS.
035240     MOVE STRT-AREA-SOC-NO TO W320-SORD-TO-INST-NO.
035250     MOVE BORM-MEMB-CUST-AC TO W320-SORD-TO-ACCT-NO.
035260     MOVE W320-SORD-KEY TO DBIOMOD-KEY.
035270     MOVE "READ" TO DBIOMOD-FUNCTION.
035280     PERFORM V200-DB-SORD THRU V299-EXIT.
035290     IF DBIOMOD-STAT = "MRNF" OR
035300        DBIOMOD-STAT NOT = "****"
035310         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
035320           TO UT8500CA-CALL-CODE
035330         MOVE SPACES TO UT8500CA-INPUT-MSG
035340         STRING "BR0024:(M1000)  "
035350                " ERROR READING SORD AMOUNT NOT"
035360                 " POSTED " DBIOMOD-STAT
035370                 " KEY "  W320-SORD-KEY
035380                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
035390         CALL "UT8500" USING

035410             UT8500CA-AREA
035420         GO TO M1099-EXIT.
035430     MOVE BR0042CA-REPAY-AMT TO SORD-AMOUNT.
035440     MOVE W320-SORD-KEY TO DBIOMOD-KEY.
035450     MOVE "REWRITE" TO DBIOMOD-FUNCTION.
035460     PERFORM V200-DB-SORD THRU V299-EXIT.
035470     IF DBIOMOD-STAT NOT = "****"
035480         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
035490           TO UT8500CA-CALL-CODE
035500         MOVE SPACES TO UT8500CA-INPUT-MSG
035510         STRING "BR0024:(M1000)  "
035520                " SORD NOT POSTED FOR " W320-SORD-KEY
035530                " STAT " DBIOMOD-STAT
035540                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
035550         CALL "UT8500" USING

035570             UT8500CA-AREA
035580         GO TO M1099-EXIT.
035590     MOVE BR0042CA-REPAY-AMT TO BORM-LOAN-REPAY
035600                              BORM-DUE-AMT.
035610 M1099-EXIT.
035620     EXIT.
TB0084/
TB0084 M1100-CALC-REPAYMENT.


S11808     MOVE 2                 TO UT0290CA-CALL-CODE
S11808     MOVE 0                 TO UT0290CA-CALL-STATUS
S11808     MOVE BORM-CURRENCY-IND TO UT0290CA-CALL-CURRENCY
S11808     CALL "UT0290" USING UT0290CA-CALL-AREA
S11808     IF UT0290CA-CALL-STATUS NOT = 0
S11808         MOVE 0  TO UT0290CA-CURR-DECS.


TB0084     INITIALIZE UT0075CA-CALL-AREA
TB0084     MOVE 02                 TO UT0075CA-CALL-CODE
S11202     IF (WA-BEFORE-BORN-STAT > 6) AND
S11202        (BOIS-PREV-DUE-DATE > 0)  AND
S11202        (BOIS-PREV-DUE-DATE > STRT-AREA-POST-DT)
S11202        MOVE BOIS-PREV-DUE-DATE TO UT0075CA-SYS-DATE
S11202                                   UT0075CA-EFF-DATE
S11202     ELSE
TB0084        IF WA-INPUT-PARAM-TABLE(8) = 1
TB0084           MOVE WA-STORE-TXN-DT   TO UT0075CA-SYS-DATE
TB0084                                     UT0075CA-EFF-DATE
TB0084        ELSE
TB0084           MOVE STRT-AREA-POST-DT TO UT0075CA-SYS-DATE
TB0084                                     UT0075CA-EFF-DATE.
TB0084     MOVE BINS-PREMIUM       TO UT0075CA-INS-PREMIUM
TB0084     PERFORM X500-GET-RATE THRU X509-EXIT
TB0069     IF   WA-MSG-ERR-FLAG = 1
TB0069          GO TO M1109-EXIT.
TB0084     MOVE WA-INT-RATE-A      TO UT0075CA-INT-RATE.
TB0084     MOVE UT0290CA-CURR-DECS TO UT0075CA-CURR-DECS
TB0084     IF BORM-REPAY-SCHED = SPACE
TB0084        MOVE BORP-REPAY-SCHED TO UT0075CA-REPAY-SCHED
TB0084     ELSE
TB0084        MOVE BORM-REPAY-SCHED TO UT0075CA-REPAY-SCHED
TB0084     END-IF
ST0170     IF BOIS-OFFSET-ACCT-IND = "2"
ST0170        MOVE BOIS-SORD-AUTO-DBT-ACCT-NO TO INVM-MEMB-CUST-AC
ST0170        PERFORM Q600-READ-INVM THRU Q609-EXIT
ST0170        IF WA-MSG-ERR-FLAG = 1
ST0170           GO TO M1109-EXIT
ST0170        END-IF
ST0170*** READ DEPP TABLE (KEY=INVM-ACCT-TYPE + INVM-INT-CAT)
ST0170         MOVE INVM-SOC-NO    TO UT0200-CALL-SOC-NO
ST0170         MOVE INVM-ACCT-TYPE TO UT0200-CALL-ACCT-TYPE-A
ST0170         MOVE INVM-INT-CAT   TO UT0200-CALL-INT-CAT-A
ST0170         MOVE 0              TO UT0200-CALL-INDEX
ST0170                                UT0200-CALL-STATUS
ST0170         MOVE 02             TO UT0200-CALL-CODE
ST0170         CALL "UT0200"    USING UT0200-CALL-AREA
ST0170         IF   UT0200-CALL-STATUS NOT = 0
ST0170              DISPLAY "BR0024: (M1100) ERROR IN READ DEPP"
ST0170                      ", KEY =" INVM-ACCT-TYPE " - " INVM-INT-CAT
ST0170                      ", STATUS =" UT0200-CALL-STATUS
ST0170              MOVE 1   TO WA-MSG-ERR-FLAG
ST0170              MOVE 108 TO WA-OUTPUT-ERR-MSG-NO
ST0170              GO       TO M1109-EXIT
ST0170         END-IF
ST0170         MOVE WA-ACCT-PARM TO DEPP-RECORD-AREA
ST0170        IF  INVM-CURR-BAL < ACCT-PARM-MIN-BAL
ST0170        AND INVM-CURR-BAL > 0
ST0170            COMPUTE UT0075CA-DEP-INT-INCR =
ST0170                    INVM-CURR-BAL *
ST0170                    INVM-CR-STORE-RATE /
ST0170                    100 /
ST0170                    ACCT-PARM-CR-INT-DAYS-YR
ST0170        ELSE
ST0170            MOVE INVM-INT-INCR  TO UT0075CA-DEP-INT-INCR
ST0170        END-IF
ST0170*** CHECK CURR-BAL < ACCT-PARM-MIN-BAL RE-CALCULATE DEP-INT-INCR
ST0170        MOVE INVM-CURR-BAL TO UT0075CA-DEP-CURR-AMT
ST0170        MOVE INVM-CR-STORE-RATE TO UT0075CA-DEP-INT-RATE
ST0170     END-IF
S10467     MOVE 0 TO  BOIS-NEXT-DUE-DATE
TB0084     CALL "UT0075" USING UT0075CA-CALL-AREA
TB0084                         BORM-RECORD-AREA
TB0084                         BOIS-RECORD
TB0084                         BORP-RECORD-AREA
TB0084                         WA-SOC-PARAMS
TB0084     IF UT0075CA-RET-STATUS <> ZEROS
TB0084        MOVE UT0075CA-RET-ERROR-MSG TO WA-OUTPUT-ERR-MSG-NO
TB0084        MOVE 1 TO WA-MSG-ERR-FLAG
TB0084        GO TO M1109-EXIT.
TB0084     IF BORM-STAT < 07
TB0084        MOVE 0 TO BORM-LOAN-REPAY
TB0084                  BORM-DUE-AMT
TB0084                  BORM-INT-INCR
TB0084                  BORM-INT-ACCR
TB0084                  BORM-INT-ADJUSTMENT
TB0084                  BORM-ARR-INT-ADJUSTMENT
TB0084                  BORM-ADV-DATE
TB0084        GO TO M1109-EXIT.
TB0084
TB0084*    MOVE UT0075CA-PRINCIPAL-DUE TO BORM-LOAN-REPAY
TB0084*                                   BORM-DUE-AMT.
TB0084*    ADD  UT0075CA-INTEREST-DUE  TO BORM-DUE-AMT.
SC1614     MOVE UT0075CA-REPAY-AMT     TO BORM-DUE-AMT.
ST0170     IF BOIS-OFFSET-ACCT-IND <> '2'
SC1614        COMPUTE BORM-LOAN-REPAY = UT0075CA-REPAY-AMT
SC1614                - UT0075CA-INTEREST-DUE
ST0170     ELSE
ST0170        MOVE ZERO TO BORM-LOAN-REPAY
ST0170     END-IF
TB0084     MOVE UT0075CA-INTEREST-INCR TO BORM-INT-INCR.
TB0069     MOVE UT0075CA-NEXT-DUE-DATE TO BOIS-NEXT-DUE-DATE
TB0161                                 BOIS-LAST-UNPAID-DUE-DATE.
TB0161     MOVE 1                      TO BOIS-CYCLE-NO.
SC1251     IF   BORM-REPAY-SCHED       =  "F"
SC1251     AND  UT0075CA-PRINCIPAL-DUE >  0
SC1251      MOVE UT0075CA-REPAY-AMT    TO BORM-DUE-AMT
SC1251     END-IF.
S17755     IF   BORP-ILOAN-R
S17755     AND  WA-BEFORE-BORN-STAT       >  01
S17755       MOVE WA-B4-LST-UNPD-DUE-DTE  TO BOIS-LAST-UNPAID-DUE-DATE
S17755       MOVE WA-B4-NEXT-DUE-DATE     TO BOIS-NEXT-DUE-DATE
S17755     END-IF.
S18816     IF   PROD-SEC-MOR-REVERSE
S18816     AND  WA-BEFORE-BORN-STAT       >  01
S18816       MOVE WA-B4-LST-UNPD-DUE-DTE  TO BOIS-LAST-UNPAID-DUE-DATE
S18816       MOVE WA-B4-NEXT-DUE-DATE     TO BOIS-NEXT-DUE-DATE
S18816     END-IF.
S19705     IF   PROD-RICHART
S19705     AND  WA-BEFORE-BORN-STAT       >  01
S19779     AND  BOIS-FIRST-ADV-DATE       >  0
S19705       MOVE WA-B4-LST-UNPD-DUE-DTE  TO BOIS-LAST-UNPAID-DUE-DATE
S19705       MOVE WA-B4-NEXT-DUE-DATE     TO BOIS-NEXT-DUE-DATE
S19705     END-IF.
S16324*
S16324     IF   BORP-RENEW
S16324          MOVE SPACE            TO WS-READ-RNEW-FILE
S16324          MOVE SPACE            TO WS-STOP-RENB-FLAG
S16324          MOVE SPACE            TO WS-CREDIT-CARD-FLAG
S16324** READ RENB
S16324       IF BOIS-PREV-ACCT-NUM1(01:15) = '000000000000000'
S16324*** CREDIT CARD
S16324          MOVE 'Y'              TO WS-CREDIT-CARD-FLAG
S16324          MOVE BORM-CUSTOMER-NO TO RENB-KEY1-CUST-NO
S16324          MOVE BOIS-PREV-ACCT-NUM1(14:03)
S16324                                TO RENB-KEY1-ACCT-NO
S16324          MOVE RENB-ALT-KEY-1   TO DBIOMOD-KEY
S16324          MOVE 1                TO DBIOMOD-KEY-NO
S16324          MOVE "READ"           TO DBIOMOD-FUNCTION
S16324          PERFORM M1110-MAINTAIN-RENB THRU M1119-EXIT
S16324          IF  DBIOMOD-STAT      = "****"
S16967**S16324      AND BORM-LOAN-BAL     =  RENB-CR-AMT
S16324              MOVE 'Y'          TO WS-READ-RNEW-FILE
S16324          END-IF
S16324       ELSE
S16324*** NOT CREDIT CARD
S16324          MOVE 'N'              TO WS-CREDIT-CARD-FLAG
S16324          MOVE BORM-CUSTOMER-NO TO RENB-CUST-NO
S16324          MOVE SPACES           TO RENB-PROD-TYP
S16324          MOVE SPACES           TO RENB-ACCT-NO
S16324*
S16324          PERFORM UNTIL WS-READ-RNEW-FILE = 'Y'
S16324                  OR    WS-STOP-RENB-FLAG = 'Y'
S16324             MOVE RENB-KEY      TO DBIOMOD-KEY
S16324             MOVE 0             TO DBIOMOD-KEY-NO
S16324             MOVE "READNEXT"    TO DBIOMOD-FUNCTION
S16324             PERFORM M1110-MAINTAIN-RENB THRU M1119-EXIT
S16324                 IF  BORM-CUSTOMER-NO    = RENB-CUST-NO
S16324                     IF  BORM-LOAN-BAL   = RENB-CR-AMT
S16324                     AND RENB-SEP-IND    = '2'
S16324                         MOVE 'Y' TO WS-READ-RNEW-FILE
S16324                     END-IF
S16324                 ELSE
S16324                      MOVE 'Y'    TO WS-STOP-RENB-FLAG
S16324                 END-IF
S16324          END-PERFORM
S16324** READ BOEX
S16324          MOVE BORM-SOC-NO      TO BOEX-INST-NO
S16324          MOVE BOIS-PREV-ACCT-NUM1
S16324                                TO BOEX-ACCT-NO
S16324          MOVE BOEX-KEY         TO DBIOMOD-KEY
S16324          MOVE 0                TO DBIOMOD-KEY-NO
S16324          MOVE "READ"           TO DBIOMOD-FUNCTION
S16324          PERFORM M1120-MAINTAIN-BOEX THRU M1129-EXIT
S16324          IF   DBIOMOD-STAT NOT = "****"
S16324               MOVE SPACE       TO WS-READ-RNEW-FILE
S16324          END-IF
S16324       END-IF
S16324**UPDATE & WRITE
S16324       IF WS-READ-RNEW-FILE     = 'Y'
S16324          MOVE '3'              TO RENB-SEP-IND
S16324          MOVE RENB-ACCT-NO     TO RENB-ID-NO
S16324          MOVE BORM-MEMB-CUST-AC(03:14)
S16324                                TO RENB-ACCT-NO
S16324          MOVE '002'            TO RENB-PROD-TYP
S16324          MOVE RENB-KEY         TO DBIOMOD-KEY
S16324          MOVE 0                TO DBIOMOD-KEY-NO
S16324          MOVE "WRITE"          TO DBIOMOD-FUNCTION
S16324          PERFORM M1110-MAINTAIN-RENB THRU M1119-EXIT
S16324         IF WS-CREDIT-CARD-FLAG = 'N'
S16324            MOVE BORM-MEMB-CUST-AC
S16324                                TO BOEX-ACCT-NO
S16324            MOVE BOEX-KEY       TO DBIOMOD-KEY
S16324            MOVE 0              TO DBIOMOD-KEY-NO
S16324            MOVE "WRITE"        TO DBIOMOD-FUNCTION
S16324            PERFORM M1120-MAINTAIN-BOEX THRU M1129-EXIT
S16324         END-IF
S16324         IF DBIOMOD-STAT NOT = "****"
S16324            MOVE 5315           TO WA-OUTPUT-ERR-MSG-NO
S16324            MOVE 1              TO WA-MSG-ERR-FLAG
S16324         END-IF
S16324       ELSE
S16324            MOVE 5315           TO WA-OUTPUT-ERR-MSG-NO
S16324            MOVE 1              TO WA-MSG-ERR-FLAG
S16324       END-IF
S16324     END-IF.
S16324*
TB0084     IF WA-INPUT-PARAM-TABLE(8) = 1
S10467        IF BORM-INT-START-DATE = 0
TB0084           MOVE WA-STORE-TXN-DT TO BORM-INT-START-DATE
S10467        END-IF
ST0097** No more value for INT-ADJUSTMENT. Will use INT-ACCRUAL.
TB0084**      COMPUTE BORM-INT-ADJUSTMENT = BORM-INT-ADJUSTMENT
TB0084**                                  + (BORM-INT-INCR
TB0084**             * (STRT-AREA-POST-DT - WA-STORE-TXN-DT))
TB0084*---  If backdating beyond BOM: ARR-INT-ADJUSTMENT should contain
TB0084*---  the interest from backdated date to EOM (negative value as
TB0084*---  adjustment, for BR0501 to adjust the interest from BOM.
TB0084             IF WA-STORE-TXN-DT < WA-BEG-MONTH
TB0084                 COMPUTE BORM-ARR-INT-ADJUSTMENT = BORM-INT-INCR
TB0084                              * (WA-STORE-TXN-DT - WA-BEG-MONTH).
SC1976
SC1976     IF WA-INPUT-PARAM-TABLE(8) = 1
SC1976        IF BOIS-NEXT-DUE-DATE <= STRT-AREA-POST-DT
S18106        AND NOT BORP-ILOAN-R
S19705        AND NOT PROD-RICHART
SC1976           MOVE 3026 TO WA-OUTPUT-ERR-MSG-NO
SC1976           MOVE 1 TO WA-MSG-ERR-FLAG
SC1976        END-IF
SC1976     END-IF.
SC1976
S17755     IF  BORP-ILOAN-R
S17755      IF WA-INPUT-PARAM-TABLE(7) = 1
S17755             GO  TO          M1109-EXIT
S17755      END-IF

S18106      IF (WA-INPUT-PARAM-TABLE(8) = 0
S18106      AND STRT-AREA-POST-DT       > BOIS-MATURITY-DATE)
S18106      OR (WA-INPUT-PARAM-TABLE(8) = 1
S18106      AND STRT-AREA-POST-DT      >= BOIS-MATURITY-DATE)
S18106          MOVE 2866 TO WA-OUTPUT-ERR-MSG-NO
S18106          MOVE 1    TO WA-MSG-ERR-FLAG
S18106          GO TO M1109-EXIT
S18106      END-IF

S17755      IF  BOIS-ARREARS-CTR        = 1
S17755        MOVE 0               TO WA-BPI-INT-DAYS
S17755        PERFORM M1130-CHECK-GRACE-PERIOD THRU M1130-EXIT
S17755        IF   WA-BPI-INT-DAYS <= BORP-AMORT-GRACE-DAYS
S17755             GO  TO          M1109-EXIT
S17755        END-IF
S17755      END-IF
S17755     END-IF.

S19705     IF BOIS-ARREARS-CTR = 1 AND PROD-RICHART
S19705        PERFORM X800-CHECK-DATE  THRU  X800-EXIT
S19705     END-IF.
SC2605     IF BOIS-ARREARS-CTR > 0
S19705*S18816        AND  NOT PROD-SEC-MOR-REVERSE
S19705       IF PROD-SEC-MOR-REVERSE
S19705       OR ( PROD-RICHART AND BOIS-ARREARS-CTR = 1
S19705         AND ( WA-B4-LST-UNPD-DUE-DTE < STRT-AREA-POST-DT
S19705               AND WA-B4-LST-UNPD-DUE-DTE > WS-PERV-BIN-DT))
S19705          NEXT SENTENCE
S19705       ELSE
SC2605         MOVE 1 TO WA-MSG-ERR-FLAG
SC2605         MOVE 2372  TO WA-OUTPUT-ERR-MSG-NO
SC2605     END-IF.
S19705
S19705     IF (BOIS-ARREAR-FLAG = "1" OR "2" OR "3" OR
S19705                            "4" OR "5" OR "6")
S19705        AND  PROD-RICHART
S19705         MOVE 1 TO WA-MSG-ERR-FLAG
S19705         MOVE 1118  TO WA-OUTPUT-ERR-MSG-NO
S19705     END-IF.
TB0084 M1109-EXIT.
TB0084     EXIT.
035630/
S16324 M1110-MAINTAIN-RENB.
S16324
S16324     MOVE "****"          TO DBIOMOD-STAT.
S16324     MOVE "DBIO"          TO DBIOMOD-PREFIX.
S16324     MOVE "RENB"          TO DBIOMOD-FILE
S16324                             DBIOMOD-SUFFIX.
S16324     MOVE SPACES          TO DBIOMOD-RELEASE-LOCK
S16324                             DBIOMOD-ACCESS-COMMAND
S16324                             DBIOMOD-ACCESS-COND
S16324                             DBIOMOD-STATUS.
S16324
S16324     CALL DBIOMODNAME     USING
S16324                             DBIOMOD-FILE
S16324                             DBIOMOD-KEY
S16324                             RENB-RECORD-AREA
S16324                             DBIOMOD-FUNCTION
S16324                             DBIOMOD-KEY-NO
S16324                             DBIOMOD-RELEASE-LOCK
S16324                             DBIOMOD-ACCESS-COMMAND
S16324                             DBIOMOD-ACCESS-COND
S16324                             DBIOMOD-STATUS.
S16324
S16324     IF DBIOMOD-STAT NOT = "****"
S16324        MOVE 5315    TO WA-OUTPUT-ERR-MSG-NO
S16324        MOVE 1       TO WA-MSG-ERR-FLAG
S16324        MOVE 'Y'     TO WS-STOP-RENB-FLAG
S16324     END-IF.
S16324*
S16324 M1119-EXIT.
S16324     EXIT.
S16324*
S16324 M1120-MAINTAIN-BOEX.
S16324
S16324     MOVE "****"          TO DBIOMOD-STAT.
S16324     MOVE "DBIO"          TO DBIOMOD-PREFIX.
S16324     MOVE "BOEX"          TO DBIOMOD-FILE
S16324                             DBIOMOD-SUFFIX.
S16324     MOVE SPACES          TO DBIOMOD-RELEASE-LOCK
S16324                             DBIOMOD-ACCESS-COMMAND
S16324                             DBIOMOD-ACCESS-COND
S16324                             DBIOMOD-STATUS.
S16324
S16324     CALL DBIOMODNAME     USING
S16324                             DBIOMOD-FILE
S16324                             DBIOMOD-KEY
S16324                             BOEX-RECORD-AREA
S16324                             DBIOMOD-FUNCTION
S16324                             DBIOMOD-KEY-NO
S16324                             DBIOMOD-RELEASE-LOCK
S16324                             DBIOMOD-ACCESS-COMMAND
S16324                             DBIOMOD-ACCESS-COND
S16324                             DBIOMOD-STATUS.
S16324*
S16324 M1129-EXIT.
S16324     EXIT.
S16324*
S17755 M1130-CHECK-GRACE-PERIOD.
S17755     IF  STRT-AREA-POST-DT          < BOIS-LAST-UNPAID-DUE-DATE
S17755         GO  TO  M1130-EXIT
S17755     END-IF.
S17755     MOVE BOIS-LAST-UNPAID-DUE-DATE TO UT0020-BINARY-DATE.
S17755     SUBTRACT 1                   FROM UT0020-BINARY-DATE.
S17755     MOVE 2                         TO UT0020-FUNCTION.
S17755     CALL "UT0020"               USING UT0020-FUNCTION
S17755                                       UT0020-DATE-AREA
S17755                                       UT0020-BINARY-DATE.
S17755     MOVE UT0020-DATE-CCYYMMDD  TO UT0310CA-CALENDAR-IN-CCYYMMDD.
S17755
S17755     MOVE STRT-AREA-POST-DT         TO UT0020-BINARY-DATE.
S17755     MOVE 2                         TO UT0020-FUNCTION.
S17755     CALL "UT0020"               USING UT0020-FUNCTION
S17755                                       UT0020-DATE-AREA
S17755                                       UT0020-BINARY-DATE.
S17755     MOVE UT0020-DATE-CCYYMMDD  TO UT0310CA-CALENDAR-OUT-CCYYMMDD.
S17755
S17755     MOVE 00                        TO UT0310CA-CALENDAR-CODE.
S17755     MOVE 03                        TO UT0310CA-CALL-FUNC.
S17755     MOVE STRT-AREA-SOC-NO          TO UT0310CA-SOC-NO.
S17755     CALL "UT0310"               USING UT0310CA-AREA.
S17755     IF UT0310CA-CALL-STATUS         = 0
S17755        MOVE UT0310CA-WORK-DAYS     TO WA-BPI-INT-DAYS
S17755     ELSE
S17755        MOVE 0                      TO WA-BPI-INT-DAYS
S17755        IF  UT0310CA-CALL-STATUS     = 1
S17755          COMPUTE WA-BPI-INT-DAYS    = STRT-AREA-POST-DT
S17755                                     - BOIS-LAST-UNPAID-DUE-DATE
S17755        END-IF
S17755     END-IF.
S17755 M1130-EXIT.
S17755     EXIT.
035640 M1200-DEB-CRD-COMMISSION.
035650     IF ((BORP-CAPN-METHOD NOT = " ")
035660     AND (BORP-CAPN-METHOD IS ALPHABETIC)
035670     AND (BORM-LOAN-BAL > 0))
035680         NEXT SENTENCE
035690      ELSE
035700          MOVE 1 TO WA-MSG-ERR-FLAG
035710          MOVE 246 TO WA-OUTPUT-ERR-MSG-NO
035720          GO TO M1299-EXIT.
035730     IF BORM-REM-REPAYS > 0
035740        IF STRT-AREA-LEDG-CODE NOT = 0
035750           MOVE STRT-AREA-LEDG-CODE TO WA-LEDGER-CODE
035760        ELSE
035770           MOVE 2                   TO WA-LEDGER-CODE
035780        END-IF
035790     ELSE
035800        MOVE 1                   TO WA-LEDGER-CODE
035810     END-IF.
035820     ADD WA-DUMMY-AMT TO BORM-EOM-BASIC-BAL
035830                         BORM-EOY-BASIC-BAL.
035840     MOVE STRT-AREA-PRIORITY-CODE TO WA-PRIORITY-CODE.
035850     MOVE WA-DUMMY-AMT TO WA-AMOUNT-TO-ADD.
035860     MOVE BORM-LOAN-BAL TO CPY-BORM-LOAN-BAL.
035870     MOVE BORM-THEO-LOAN-BAL TO CPY-BORM-THEO-LOAN-BAL.
035880*
035890     IF BORP-PRIORITY-CODE-ON
035900        IF WA-PRIORITY-CODE = SPACES
TB0084           IF BORP-PRIORITY-TERM-BY-TERM
TB0084              PERFORM M100-CALL-UT0094 THRU M109-EXIT
TB0084           ELSE
035910              PERFORM M000-CALL-UT0095 THRU M099-EXIT
TB0084           END-IF
035920           IF WA-MSG-ERR-FLAG = 1
035930              GO TO M1299-EXIT
035940           END-IF
035950        ELSE
TB0084           PERFORM N400-SEARCH-PRIORITY THRU N409-EXIT
TB0084           IF WA-MSG-ERR-FLAG = 1
TB0084              GO TO M1299-EXIT
TB0084           END-IF
035960           PERFORM N000-ADD-TO-LOAN-BAL THRU NADD-EXIT
035970        END-IF
035980     ELSE
035990        PERFORM N100-ADD-TO-LOAN-BAL THRU N199-EXIT
036000     END-IF.
036010*
036020     MOVE CPY-BORM-LOAN-BAL TO BORM-LOAN-BAL.
036030     MOVE CPY-BORM-THEO-LOAN-BAL TO BORM-THEO-LOAN-BAL.
036040     ADD WA-DUMMY-AMT      TO BORM-UNEARNED-INT.
036050     MOVE BORM-LOAN-BAL    TO WA-BAL-BEFORE-COMMISSION.
036060 M1299-EXIT.
036070       EXIT.
036080*
036090 M1300-PROCESS-ADV-UPFRONT-LOAN.
036100     PERFORM X500-GET-RATE THRU X509-EXIT.
036110     IF WA-MSG-ERR-FLAG = 1
036120         GO TO M1399-EXIT.
036130     PERFORM M1500-CALC-COMMISSION THRU M1599-EXIT.
036140*
036150     IF WA-MSG-ERR-FLAG = 1
036160         GO TO M1399-EXIT.
036170*
036180*    IF UT0079CA-RET-STATUS = 0
036190*    ADD  UT0079CA-LI          TO  BORM-UNEARNED-INT.                     
SC0085**-- These lines of codes is not for Term by term so...
SC0085     IF NOT BORP-PRIORITY-TERM-BY-TERM
036200        ADD  UT0079CA-LI             UT0079CA-TOM-ACRU 
036210                                  TO BORM-UNEARNED-INT                     
TB0237        MOVE UT0079CA-LI-INCR     TO BORM-INT-INCR
TB0237        Add UT0079CA-LI           TO BORM-CAP-UNPAID-INT
TB0237                                     BORM-CAP-THEO-UNPAID-INT
036220*    ELSE
036230*       MOVE 0                    TO UT0079CA-LI.
036240*    MOVE UT0079CA-LI             TO WA-COMMISSION-AMOUNT.
036250        MOVE ZEROS                TO WA-COMMISSION-AMOUNT
036260        ADD  UT0079CA-LI             UT0079CA-TOM-ACRU 
036270                                  TO WA-COMMISSION-AMOUNT                
SC0085     ELSE
036300        IF BORP-DISC-RATE-IND = "1"                                         
036310           IF BORP-TOM-RATE-TBL-ID NOT = SPACES                             
036320              PERFORM X530-GET-LASTEST-TOM-RATE THRU X539-EXIT              
036330              IF WA-MSG-ERR-FLAG = 1                                        
036340                 GO TO M1399-EXIT                                           
036350              END-IF                                                        
036360
S15238*036370       MOVE UT0298CA-RET-EFF-RATE TO BORM-ADV-TOM-RATE
036380           END-IF                                                           
036380        END-IF                                                           
SC0085     END-IF.                                                             
036400 M1399-EXIT.
036410       EXIT.
036420/
036430*  ADD THE COMMISSION TRAN IN BORV.
036440*
NR2001*036450 M1400-ADD-COMM-TRAN-BORV.
NR2001 M1400-ADD-COMM-TRAN-BOCT.
036460     MOVE BORM-LOAN-BAL              TO WA-BAL-BEFORE-COMMISSION.
036470*
036480*SPR:760080:ANZ-RTFT:START------------------------------------
036490     IF WA-COMMISSION-AMOUNT = 0
036500         GO TO M1499-EXIT.
036510*SPR:760080:ANZ-RTFT:START------------------------------------
NR2001*036520     IF WA-INPUT-PARAM-TABLE (7) = 1
NR2001*036530        MOVE 13609                  TO BORV-01-TRN-CODE
NR2001*036540     ELSE
NR2001*036550        MOVE 13509                  TO BORV-01-TRN-CODE
NR2001*036560     END-IF.
NR2001*036570     MOVE BORV-01-TRN-CODE TO LINK-IN-TXCODE.
NR2001     INITIALIZE BOCT-TRAN-01.
NR2001     MOVE 01                     TO BOCT-TRAN-TYPE.
NR2001     MOVE 0                      TO BOCT-STAT.
NR2001     MOVE STRT-AREA-POST-DT      TO BOCT-TRN-DATE.
S16081*NR2001     IF WA-INPUT-PARAM-TABLE (7) = 1
S16081*NR2001        MOVE 13609               TO BOCT-TRN-CODE
S16081*NR2001     ELSE
S16081*NR2001        MOVE 13509               TO BOCT-TRN-CODE
S16081*NR2001     END-IF.
S16081*
S16081     IF  (BORM-CAPN-METHOD =  "X"  ) OR
S16081              (BORM-CAPN-METHOD = " " AND
S16081                (BORP-CAPN-METHOD = "X" ))
S16081         IF WA-INPUT-PARAM-TABLE (7) = 1
S16081            MOVE 13830               TO BOCT-TRN-CODE
S16081         ELSE
S16081            MOVE 13730               TO BOCT-TRN-CODE
S16081         END-IF
S16081     ELSE
S16081        IF WA-INPUT-PARAM-TABLE (7) = 1
S16081           MOVE 13609               TO BOCT-TRN-CODE
S16081        ELSE
S16081           MOVE 13509               TO BOCT-TRN-CODE
S16081        END-IF
S16081     END-IF.
S16081*
NR2001     MOVE BOCT-TRN-CODE TO LINK-IN-TXCODE.
036580     PERFORM M1600-LOAD-ED2 THRU M1699-EXIT.
036590     IF WA-MSG-ERR-FLAG = 1
036600        GO TO M1499-EXIT.
036610*    IF  (BORM-CAPN-METHOD = "B" OR
036620*             (BORM-CAPN-METHOD = " " AND
036630*               BORP-CAPN-METHOD = "B"))
TB0237     IF  (BORM-CAPN-METHOD = "B" OR "X" OR "F" ) OR
TB0237              (BORM-CAPN-METHOD = " " AND
TB0237                (BORP-CAPN-METHOD = "B" OR "X" OR "F"))
036640     AND
036650         BORM-REPAY-FREQ = 98
036660     AND
036670         BORP-CAPN-FREQ = 98
036680     AND
036690         BORP-ACCRUE-METHOD = "D"
036700         NEXT SENTENCE
036710     ELSE
036720*
036730       IF BORM-REM-REPAYS > 0
036740        MOVE 2                    TO WA-LEDGER-CODE
036750       ELSE
036760        MOVE 1                    TO WA-LEDGER-CODE
036770       END-IF
036780       ADD WA-COMMISSION-AMOUNT  TO BORM-EOM-BASIC-BAL
036790                                    BORM-EOY-BASIC-BAL
036800       MOVE LINK-PRIORITY-CODE TO WA-PRIORITY-CODE
036810       MOVE WA-COMMISSION-AMOUNT TO WA-AMOUNT-TO-ADD
036820       MOVE BORM-LOAN-BAL    TO CPY-BORM-LOAN-BAL
036830       MOVE BORM-THEO-LOAN-BAL TO CPY-BORM-THEO-LOAN-BAL
036840       IF BORP-PRIORITY-CODE-ON
036850          IF WA-PRIORITY-CODE = SPACES
TB0084             IF BORP-PRIORITY-TERM-BY-TERM
TB0084                PERFORM M100-CALL-UT0094 THRU M109-EXIT
TB0084             ELSE
036860                PERFORM M000-CALL-UT0095 THRU M099-EXIT
TB0084             END-IF
036870             IF WA-MSG-ERR-FLAG = 1
036880                GO TO M1499-EXIT
036890             END-IF
036900          ELSE
TB0084             PERFORM N400-SEARCH-PRIORITY THRU N409-EXIT
TB0084             IF WA-MSG-ERR-FLAG = 1
TB0084                GO TO M1499-EXIT
TB0084             END-IF
036910             PERFORM N000-ADD-TO-LOAN-BAL THRU NADD-EXIT
036920          END-IF
036930       ELSE
036940          PERFORM N100-ADD-TO-LOAN-BAL THRU N199-EXIT
036950       END-IF
036960       MOVE CPY-BORM-LOAN-BAL TO BORM-LOAN-BAL
036970       MOVE CPY-BORM-THEO-LOAN-BAL TO BORM-THEO-LOAN-BAL
036980     END-IF.
NR2001*036990     MOVE 07                        TO BORV-01-SUB-LEDG-CODE.
NR2001     MOVE 07                        TO BOCT-01-SUB-LEDG-CODE.
TB0244***
TB0244*** FOR TIB
TB0244***
TB0244     IF SOC-SITE-TIB
TB0244        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
TB0244                X000-EXIT
TB0244     END-IF.
NR2001*037000     MOVE BORM-LOAN-BAL             TO BORV-01-BALANCE.
NR2001*TB0084     PERFORM N600-GET-ARREARS THRU N609-EXIT
NR2001*037010*--- COMPUTE BORV-01-ARREARS = BORM-LOAN-BAL - BORM-THEO-LOAN-BAL.
NR2001*037020     MOVE WA-COMMISSION-AMOUNT            TO BORV-01-AMOUNT
NR2001*037030     PERFORM W500-ADD-TXN THRU W599-EXIT.
NR2001*SC0838     IF (BORM-CAPN-METHOD = "X" OR
NR2001*SC0838        (BORM-CAPN-METHOD = " " AND
NR2001*SC0838         BORP-CAPN-METHOD = "X"))
NR2001*SC0838           MOVE 13509 TO WA-STORE-BORV-TRN-CODE
NR2001     MOVE BORM-LOAN-BAL             TO BOCT-01-BALANCE.
NR2001     PERFORM N600-GET-ARREARS THRU N609-EXIT
NR2001     MOVE WA-COMMISSION-AMOUNT            TO BOCT-01-AMOUNT
S16081*
S16081     IF (BORM-CAPN-METHOD = "X" OR
S16081        (BORM-CAPN-METHOD = " " AND
S16081        BORP-CAPN-METHOD = "X"))
S16081        AND BOCT-TRN-CODE = 13830
S16081            COMPUTE BOCT-01-AMOUNT = BOCT-01-AMOUNT * -1
S16081     END-IF.
S16081*
NR2001     PERFORM W500-ADD-TXN THRU W599-EXIT.
NR2001     IF (BORM-CAPN-METHOD = "X" OR
NR2001        (BORM-CAPN-METHOD = " " AND
NR2001         BORP-CAPN-METHOD = "X"))
S16081*NR2001           MOVE 13509 TO WA-STORE-BOCT-TRN-CODE
S16081         MOVE 13730 TO WA-STORE-BOCT-TRN-CODE
SC0838     END-IF.
037040 M1499-EXIT.
037050       EXIT.
037060/
037070 M1500-CALC-COMMISSION.
SC2642      IF  (BORM-CAPN-METHOD = "X" OR
SC2642          (BORM-CAPN-METHOD = " " AND
SC2642           BORP-CAPN-METHOD = "X"))
SC2642           GO TO M1500-CONT.
TB0084     IF BORP-PRIORITY-TERM-BY-TERM 
TB0084        INITIALIZE UT0075CA-CALL-PARAMETER
TB0084        MOVE 05 TO UT0075CA-CALL-CODE
TB0084        MOVE STRT-AREA-POST-DT  TO UT0075CA-SYS-DATE
TB0084        IF WA-INPUT-PARAM-TABLE(8) = 1
TB0084           MOVE WA-STORE-TXN-DT   TO UT0075CA-EFF-DATE
TB0084        ELSE
TB0084           MOVE STRT-AREA-POST-DT TO UT0075CA-EFF-DATE
TB0084        END-IF
TB0084        MOVE WA-INT-RATE-A      TO UT0075CA-INT-RATE
TB0084        MOVE BINS-PREMIUM       TO UT0075CA-INS-PREMIUM
TB0084        MOVE UT0290CA-CURR-DECS TO UT0075CA-CURR-DECS
ST0170     IF BOIS-OFFSET-ACCT-IND = "2"
ST0170        MOVE BOIS-SORD-AUTO-DBT-ACCT-NO TO INVM-MEMB-CUST-AC
ST0170        PERFORM Q600-READ-INVM THRU Q609-EXIT
ST0170        IF WA-MSG-ERR-FLAG = 1
ST0170           GO TO M1599-EXIT
ST0170        END-IF
ST0170*** READ DEPP TABLE (KEY=INVM-ACCT-TYPE + INVM-INT-CAT)
ST0170         MOVE INVM-SOC-NO    TO UT0200-CALL-SOC-NO
ST0170         MOVE INVM-ACCT-TYPE TO UT0200-CALL-ACCT-TYPE-A
ST0170         MOVE INVM-INT-CAT   TO UT0200-CALL-INT-CAT-A
ST0170         MOVE 0              TO UT0200-CALL-INDEX
ST0170                                UT0200-CALL-STATUS
ST0170         MOVE 02             TO UT0200-CALL-CODE
ST0170         CALL "UT0200"    USING UT0200-CALL-AREA
ST0170         IF   UT0200-CALL-STATUS NOT = 0
ST0170              DISPLAY "BR0024: (M1500) ERROR IN READ DEPP"
ST0170                      ", KEY =" INVM-ACCT-TYPE " - " INVM-INT-CAT
ST0170                      ", STATUS =" UT0200-CALL-STATUS
ST0170              MOVE 1   TO WA-MSG-ERR-FLAG
ST0170              MOVE 108 TO WA-OUTPUT-ERR-MSG-NO
ST0170              GO       TO M1599-EXIT
ST0170         END-IF
ST0170         MOVE WA-ACCT-PARM TO DEPP-RECORD-AREA
ST0170        IF  INVM-CURR-BAL < ACCT-PARM-MIN-BAL
ST0170        AND INVM-CURR-BAL > 0
ST0170            COMPUTE UT0075CA-DEP-INT-INCR =
ST0170                    INVM-CURR-BAL *
ST0170                    INVM-CR-STORE-RATE /
ST0170                    100 /
ST0170                    ACCT-PARM-CR-INT-DAYS-YR
ST0170        ELSE
ST0170            MOVE INVM-INT-INCR  TO UT0075CA-DEP-INT-INCR
ST0170        END-IF
ST0170*** CHECK CURR-BAL < ACCT-PARM-MIN-BAL RE-CALCULATE DEP-INT-INCR
ST0170        MOVE INVM-CURR-BAL TO UT0075CA-DEP-CURR-AMT
ST0170        MOVE INVM-CR-STORE-RATE TO UT0075CA-DEP-INT-RATE
ST0170     END-IF
TB0084        CALL "UT0075" USING UT0075CA-CALL-AREA
TB0084                            BORM-RECORD-AREA
TB0084                            BOIS-RECORD
TB0084                            BORP-RECORD-AREA
TB0084                            WA-SOC-PARAMS
TB0084        IF UT0075CA-RET-STATUS = ZEROS
TB0084           MOVE UT0075CA-INTEREST-DUE  TO WA-COMMISSION-AMOUNT
TB0084           MOVE UT0075CA-INTEREST-INCR TO BORM-INT-INCR
SC0434           IF  (BORM-CAPN-METHOD = "X" OR
SC0434              (BORM-CAPN-METHOD = " " AND
SC0434               BORP-CAPN-METHOD = "X"))
SC0434            ADD  UT0075CA-INTEREST-DUE
SC0434                                  TO BORM-UNEARNED-INT
SC0434            MOVE UT0075CA-INTEREST-INCR  TO BORM-INT-INCR
SC0434            ADD UT0075CA-INTEREST-DUE    TO BORM-CAP-UNPAID-INT
SC0434                                     BORM-CAP-THEO-UNPAID-INT
SC0434           END-IF
TB0084           IF WA-INPUT-PARAM-TABLE(8) = 1
TB0084              COMPUTE BORM-INT-ADJUSTMENT = BORM-INT-ADJUSTMENT
TB0084                   + (BORM-INT-INCR
TB0084                   * (STRT-AREA-POST-DT - WA-STORE-TXN-DT))
TB0084*--- If backdating beyond BOM: ARR-INT-ADJUSTMENT should contain
TB0084*--- the interest from backdated date to EOM (negative value as
TB0084*--- adjustment, for BR0501 to adjust the interest from BOM.
TB0084              IF WA-STORE-TXN-DT < WA-BEG-MONTH
TB0084                 COMPUTE BORM-ARR-INT-ADJUSTMENT = BORM-INT-INCR
TB0084                            * (WA-STORE-TXN-DT - WA-BEG-MONTH)
TB0084              END-IF
TB0084           END-IF
TB0084        ELSE
TB0084           MOVE 1 TO WA-MSG-ERR-FLAG
TB0084           MOVE UT0075CA-RET-ERROR-MSG TO WA-OUTPUT-ERR-MSG-NO
TB0084        END-IF
TB0084        GO TO M1599-EXIT.
TB0084
037080     IF BORM-CAT = 9999 OR 9998
037090        GO TO M1599-EXIT.
SC2642     IF (BORP-CAPN-METHOD IS ALPHABETIC)OR
               BORM-CAPN-METHOD IS ALPHABETIC
               CONTINUE
           ELSE
               GO TO M1599-EXIT.
SC2642 M1500-CONT.
037100     MOVE ZEROES                 TO UT0079-LINKAGE.
037110     MOVE 00                     TO UT0079CA-RET-STATUS.
037120     MOVE 0                      TO UT0079CA-LI.
037130     MOVE 0                      TO UT0079CA-NXT-WK-DT.
037140     MOVE BORM-ADV-DATE          TO UT0079CA-ADV-DT.
037150     MOVE BORM-BACK-DT-IND       TO UT0079CA-BKD-IND.
037160     MOVE BORM-SOC-NO            TO UT0079CA-BORM-SOC.
037170     MOVE BORM-MEMB-CUST-AC      TO UT0079CA-BORM-ACC.
037180     MOVE BORM-LOAN-TRM          TO UT0079CA-TERM.
037190     MOVE BORM-TERM-BASIS        TO UT0079CA-INTERVAL-IND.
037200     MOVE BORM-REM-REPAYS        TO UT0079CA-REM-REPAYS.
037210     MOVE WA-INT-RATE-A          TO UT0079CA-INT-RATE.
037220     MOVE BORM-APP-AMT           TO UT0079CA-APPR-AMT.
037230     MOVE BORM-ADV-VAL           TO UT0079CA-ADV-AMT.
037240     MOVE 0                      TO UT0079CA-AMOUNT-IND.
037250     SUBTRACT BORM-PRINC-REDUCT-EFF FROM WA-DUMMY-AMT
037260            GIVING   UT0079CA-INT-BASE-AMT.
037270     MOVE 04                     TO UT0079CA-CALL-CODE.
037280     MOVE BORP-ACCRUE-FREQ       TO UT0079CA-ACCRUE-FREQ.
037290     IF BORM-CAPN-METHOD = " "
037300        MOVE BORP-CAPN-METHOD    TO UT0079CA-CAPN-METHOD
037310     ELSE
037320        MOVE BORM-CAPN-METHOD    TO UT0079CA-CAPN-METHOD.
037330*
037340     MOVE BORP-INT-DAYS-YR     TO UT0079CA-BORM-INT-DAYS-YR.
037350     MOVE BORP-CALENDAR-CODE   TO UT0079CA-CALENDAR-CODE.
037360     MOVE BORM-LOAN-REPAY TO UT0079CA-REPAY-AMT.
037370*
037380     MOVE BORP-CAPN-FREQ       TO UT0079CA-CAPN-FREQ.
037390     IF BORM-REPAY-FREQ   NOT = 0
037400           MOVE BORM-REPAY-FREQ TO UT0079CA-REPAY-FREQ
037410     ELSE
037420           MOVE BORP-REPAY-FREQ TO UT0079CA-REPAY-FREQ.
037430     MOVE BORP-ACCRUE-METHOD    TO UT0079CA-ACCRUE-METHOD.
037440     MOVE BORP-COFM-METH        TO UT0079CA-COFM-METH-FLAG.               
037450     MOVE BORM-INT-ACCR         TO UT0079CA-LI-ACCR.                      
037460     MOVE BORM-BPI-ACCR         TO UT0079CA-BPI-ACCR.                     
037470     MOVE BORM-CI-ACCR          TO UT0079CA-CI-ACCR.                      
037480     MOVE BORM-TOM-ACRU-AMT     TO UT0079CA-TOM-ACRU.                     
037490     IF   BORM-TOM-RATE-TBL-ID  = SPACE OR "0"                            
037500          MOVE BORP-TOM-RATE-TBL-ID                                       
037510                                TO UT0079CA-TOM-RATE-TBL-ID               
037520     ELSE                                                                 
037530          MOVE BORM-TOM-RATE-TBL-ID                                       
037540                                TO UT0079CA-TOM-RATE-TBL-ID               
037550     END-IF.                                                              
037560     MOVE BORM-INT-ADJUSTMENT   TO UT0079CA-INT-ADJ-AMT.                  
037570     MOVE BORM-FCC-CLUS         TO UT0079CA-FCC-CLUS.                    
TB0237     COMPUTE UT0079CA-CALC-DAYS =
TB0237                 BOIS-MATURITY-DATE - STRT-AREA-POST-DT.
037580*
037590     CALL "UT0079"   USING

037610             UT0079-LINKAGE.
037620     IF UT0079CA-RET-STATUS NOT = 0
037630*
037640         MOVE 1 TO WA-MSG-ERR-FLAG
037650         MOVE 3080 TO WA-OUTPUT-ERR-MSG-NO
037660*
037670         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
037680           TO UT8500CA-CALL-CODE
037690         MOVE SPACES TO UT8500CA-INPUT-MSG
037700         STRING "BR0024:(M1500)  "
037710                " UT0079 STATUS ERROR "  BORM-KEY
037720                "    " UT0079CA-RET-STATUS
037730                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
037740         CALL "UT8500" USING

037760             UT8500CA-AREA.
SC2642        ADD  UT0079CA-LI          TO BORM-UNEARNED-INT.
SC2642        MOVE UT0079CA-LI-INCR     TO BORM-INT-INCR.
SC2642        MOVE UT0079CA-LI             TO WA-COMMISSION-AMOUNT.
037770 M1599-EXIT.
037780      EXIT.
037790/
037800 M1600-LOAD-ED2.
037810     MOVE 02               TO LINK-IN-CALL-CODE.
037820     MOVE STRT-AREA-SOC-NO TO LINK-IN-SOC-NO.
037830     CALL "UT0250" USING

037850                         LINK-AREA.
037860     IF LINK-OUT-STAT NOT = "****"
037870         MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
037880         MOVE SPACES TO UT8500CA-INPUT-MSG
037890         STRING "BR0024(M1600) ERROR READING ED2PARAM"
037900             " FOR TRAN CODE " STRT-AREA-TRN-NO
037910             " STATUS IS " LINK-OUT-STAT
037920             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
037930         CALL "UT8500" USING

037950                            UT8500CA-AREA
037960         MOVE 155           TO WA-OUTPUT-ERR-MSG-NO
037970         MOVE 1             TO WA-MSG-ERR-FLAG
037980     END-IF.
037990 M1699-EXIT.
038000      EXIT.
038010*
038020 M1700-WRITE-TYPE-36.
038030     IF (WA-TRANSFER-ACCOUNT-AREA NOT = ZERO) AND
038040        (WA-TRANSFER-ACCOUNT-AREA NOT = SPACES)
NR2001*038050         INITIALIZE                       BORV-36-DETAIL
NR2001*038060         MOVE 36                       TO BORV-36-CODE
NR2001*038070         MOVE 04                       TO BORV-36-STATUS
NR2001*038080         MOVE UPTELLCA-TELLER-BRANCH   TO BORV-36-TELL-AND-BR
NR2001*038090         MOVE STRT-AREA-TERM-NO        TO BORV-36-BRTERM
NR2001*038100         IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001*038110            MOVE WA-STORE-TXN-DT       TO BORV-36-POST-DATE
NR2001*038120         ELSE
NR2001*038130            MOVE STRT-AREA-POST-DT     TO BORV-36-POST-DATE
NR2001*038140         END-IF
NR2001*038150         MOVE STRT-AREA-JRNL-NO        TO BORV-36-JRNL-NO
NR2001*038160         MOVE WA-DUMMY-AMT             TO BORV-36-AMOUNT
NR2001*038170         MOVE "T"                      TO BORV-36-DESC
NR2001*038180         MOVE STRT-AREA-TRN-NO         TO BORV-36-TRN-CODE
NR2001*038190         MOVE WA-TRANSFER-ACCOUNT-AREA TO BORV-36-ACCOUNT-NO
NR2001*038200*        MOVE "INV"                    TO BORV-36-SYSTEM                
NR2001*038210         IF WA-NARR-TRF-ACCT-SYS = SPACES                               
NR2001*038220            MOVE "BOR"                 TO BORV-36-SYSTEM                
NR2001*038230         ELSE                                                           
NR2001*038240            MOVE WA-NARR-TRF-ACCT-SYS  TO BORV-36-SYSTEM                
NR2001         INITIALIZE                       BOCT-TRAN-36
NR2001         MOVE 36                       TO BOCT-TRAN-TYPE
NR2001         MOVE 04                       TO BOCT-STAT
NR2001         IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001            MOVE WA-STORE-TXN-DT       TO BOCT-TRN-DATE
NR2001         ELSE
NR2001            MOVE STRT-AREA-POST-DT     TO BOCT-TRN-DATE
NR2001         END-IF
NR2001         MOVE STRT-AREA-TRN-NO         TO BOCT-TRN-CODE
NR2001         MOVE WA-DUMMY-AMT             TO BOCT-36-AMOUNT
NR2001         MOVE "T"                      TO BOCT-36-DESC
NR2001         MOVE WA-TRANSFER-ACCOUNT-AREA TO BOCT-36-ACCOUNT-NO
NR2001         IF WA-NARR-TRF-ACCT-SYS = SPACES                               
NR2001            MOVE "BOR"                 TO BOCT-36-SYSTEM                
NR2001         ELSE                                                           
NR2001            MOVE WA-NARR-TRF-ACCT-SYS  TO BOCT-36-SYSTEM                
038250         END-IF                                                         
038260         PERFORM W500-ADD-TXN THRU W599-EXIT
038270     END-IF.
038280 M1799-EXIT.
038290     EXIT.
038300*
038310/
038320*  CHANGE LOAN BALANCE FOR NO PRIORITATION
038330*
038340 N100-ADD-TO-LOAN-BAL.
038350*
038360     IF ADD-TO-BOTH-BALANCES
038370        ADD WA-AMOUNT-TO-ADD TO CPY-BORM-LOAN-BAL
038380                                CPY-BORM-THEO-LOAN-BAL
038390     ELSE
038400     IF ADD-TO-LOAN-BALANCE-ONLY
038410        ADD WA-AMOUNT-TO-ADD TO CPY-BORM-LOAN-BAL
038420     ELSE
038430     IF ADD-TO-THEORITICAL-ONLY
038440        ADD WA-AMOUNT-TO-ADD TO CPY-BORM-THEO-LOAN-BAL.
038450*
038460 N199-EXIT.
038470     EXIT.                                                                MT001
TB0084/
TB0084 N400-SEARCH-PRIORITY.
           MOVE 0 TO WA-PRIORITY-NO
           INITIALIZE UTHISTCA-CALL-AREA
           MOVE 03               TO UTHISTCA-CALL-CODE
           MOVE WA-PRIORITY-CODE TO UTHISTCA-CALL-PRIO-CD
           PERFORM N500-CALL-PRIORITY-MODULE THRU N509-EXIT
           MOVE UTHISTRA-RET-BUCKET-NO TO WA-PRIORITY-NO

B18091     IF  WA-INPUT-PARAM-TABLE(5) = 1
B18091     AND (ADD-TO-BUCKET-ONLY OR ADD-TO-LOAN-BALANCE-AND-BUCKET)
B18091         SET ADD-TO-BOTH-BALANCES TO TRUE
B18091     END-IF.
B18091**   IF WA-PRIORITY-NO = ZEROS
B18091**       MOVE 1    TO WA-MSG-ERR-FLAG
B18091**       MOVE 4861 TO WA-OUTPUT-ERR-MSG-NO
B18091**       SET UT8500CA-NORMAL-DISPLAY TO TRUE
B18091**       MOVE SPACES TO UT8500CA-INPUT-MSG
B18091**       STRING "BR0024:(N400) ERROR CALLING UTHIST"
B18091**              ", STATUS="    UTHISTRA-RET-STATUS
B18091**              ", CALL CODE=" UTHISTCA-CALL-CODE
B18091**              ", ACCT TYPE=" BORM-ACT-TYPE
B18091**              ", INT CAT="   BORM-CAT
B18091**              ", CODE="      UTHISTCA-CALL-PRIO-CD
B18091**              ", PRIORITY="  UTHISTCA-CALL-PRIO-NO
B18091**           DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
B18091**       CALL "UT8500" USING
B18091**                           UT8500CA-AREA.
TB0084 N409-EXIT.
TB0084     EXIT.
TB0084/
TB0084 N500-CALL-PRIORITY-MODULE.
           MOVE "BOR"             TO UTHISTCA-SYSTEM
           MOVE BORM-SOC-NO       TO UTHISTCA-SOC-NO
           MOVE BORM-ACT-TYPE     TO UTHISTCA-ACCT-TYPE
           MOVE BORM-CAT          TO UTHISTCA-INT-CAT
           MOVE STRT-AREA-POST-DT TO UTHISTCA-EFFECTIVE-DATE
           CALL "UTHIST"
                         USING UTHISTCA-CALL-PARAM.
TB0084 N509-EXIT.
TB0084     EXIT.
TB0084/
TB0084 N600-GET-ARREARS.
TB0084     IF BORP-PRIORITY-TERM-BY-TERM
TB0084        COMPUTE WA-BUCKET-DUE = BOIS-PRINCIPAL-DUE
TB0084                              + BOIS-INTEREST-DUE
TB0084        MOVE BORM-BAD-DEBT-IND TO WA-BAD-DEBT-IND
TB0084        IF WA-BAD-DEBT-NON-PERFORMING
TB0084           ADD BORM-THEO-LOAN-BAL TO WA-BUCKET-DUE
TB0084        END-IF 
TB0084     ELSE
NR2001*TB0084        COMPUTE BORV-01-ARREARS = BORM-LOAN-BAL
NR2001        COMPUTE BOCT-01-ARREARS = BORM-LOAN-BAL
TB0084                                - BORM-THEO-LOAN-BAL 
TB0084     END-IF.
TB0084 N609-EXIT.
TB0084     EXIT.
038480*
038490*----------------------------------------------------------------        
038500*  NLB HAS REQUESTED A RESTRICTION ON THE VALUE OF NON-CHQ ADV           
038510*  THE NON-CHEQUE ADVANCE TXNS WILL BE COMPARED AGAINST A                
038520*  LOAN PRODUCT PARAMETER DEFINED LIMIT.                                 
038530*----------------------------------------------------------------        
038540*
038550 P000-MAX-CASH-ADV-VAL.                                                  
038560*======================                                                  
038570     MOVE BORM-SOC-NO         TO CUSM-SOC-NO.                            
038580     MOVE BORM-MEMB-CUST-AC   TO CUSM-CUST-ACCT-NO.                      
038590     PERFORM P300-READ-CUSM  THRU P399-EXIT.                             
038600     MOVE CUSM-CUSTOMER-NO    TO WA-BORM-CUST-NO.                        
038610                                                                         
038620     MOVE STRT-AREA-SOC-NO    TO CUSM-SOC-NO.                            
038630     MOVE WA-DEP-ACCT-NO      TO CUSM-CUST-ACCT-NO.                      
038640     PERFORM P300-READ-CUSM  THRU P399-EXIT.                             
038650                                                                         
038660     IF  WA-BORM-CUST-NO  NOT = CUSM-CUSTOMER-NO                         
038670         GO TO P099-EXIT                                                 
038680     END-IF.                                                             

038700     MOVE ZERO              TO WA-SAVE-TRF-AMT.                          
NR2001*038710     PERFORM P100-READ-BORV THRU P199-EXIT.                              
NR2001     PERFORM P100-READ-BOCT THRU P199-EXIT.
038720     COMPUTE WA-CURR-PREV-ADV = WA-DUMMY-AMT +                           
038730                                WA-SAVE-TRF-AMT.                         
038740     COMPUTE WA-TOTAL-APP-AMT = BORM-APP-AMT +                           
038750                                BORM-ADD-LOAN-APP.                       
038760     COMPUTE WA-PERC-CASH-ADV = 100 *                                    
038770               (WA-CURR-PREV-ADV / WA-TOTAL-APP-AMT).                    
038780     IF  WA-PERC-CASH-ADV > BORP-MAX-CASH-ADV                            
038790         MOVE 861  TO WA-OUTPUT-ERR-MSG-NO                               
038800         MOVE 1    TO WA-MSG-ERR-FLAG                                    
038810         GO TO P099-EXIT                                                 
038820     END-IF.                                                             
038830 P099-EXIT.                                                              
038840     EXIT.                                                               

038860*----------------------------------------------------------------        
038870*  DBOI-CALL-FUNC = 06                                                   
038880*  TRANSACTION HISTORY READ BACKWARDS NON CODED                          
038890*  FOR READ FIRST BORV-01-CODE = 36 AND READ BORV-01-CODE = 01           
038900*----------------------------------------------------------------        
NR2001*038910 P100-READ-BORV.                                                         
NR2001*038920*===============                                                         
NR2001*038930     MOVE BORM-SOC-NO       TO WA-BORM-SOC-NO.                           
NR2001*038940     MOVE BORM-MEMB-CUST-AC TO WA-BORM-ACCT-NO.                          
NR2001*038950     MOVE 0                 TO DBIO-CALL-REFER-AREA.                     
NR2001*NR0001     MOVE SPACES            TO DBIO-CALL-SAVE-REFER.
NR2001*038960 P110-CONT.                                                              
NR2001*038970     MOVE 06                TO DBIO-CALL-FUNC.                           
NR2001*038980     MOVE "BOR"             TO DBIO-CALL-SYS-AREA.                       
NR2001*038990     MOVE WA-BORM-KEY       TO DBIO-CALL-KEY-AREA.                       
NR2001*039000     MOVE SPACES            TO DBIO-CALL-STATUS.                         
NR2001*039010     CALL "DBIO" USING                                                   
NR2001*039020                            DBIO-CALL-PARAM                              
NR2001*039030                            DBIO-CALL-SYS-AREA                           
NR2001*039040                            DBIO-CALL-KEY-AREA                           
NR2001*039050                            DBIO-CALL-STATUS                             
NR2001*039060                            BORV-RECORD-AREA                             
NR2001*039070                            DBIO-CALL-REFER-AREA.                        
NR2001*039080     IF  DBIO-CALL-STATUS = "XCOT"                                       
NR2001*039090         GO TO P199-EXIT.                                                
NR2001*039100     IF  DBIO-CALL-STATUS NOT = "****"                                   
NR2001*039110         MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE         
NR2001*039120         MOVE SPACES TO UT8500CA-INPUT-MSG                               
NR2001*039130         STRING "BR0024 : (P100) STATUS = " DBIO-CALL-STATUS,            
NR2001*039140                 " BAD READ ON BORV KEY = " DBIO-CALL-KEY-AREA           
NR2001*039150             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG                   
NR2001*039160         CALL "UT8500" USING UT8500CA-AREA                               
NR2001*039170         MOVE 1                TO WA-MSG-ERR-FLAG                        
NR2001*039180         MOVE 155              TO WA-OUTPUT-ERR-MSG-NO                   
NR2001*039190         MOVE "BORV"           TO WA-DBERR-DATA-SET                      
NR2001*039200         MOVE DBIO-CALL-STATUS TO WA-DB-ERROR                            
NR2001*039210         GO TO P199-EXIT.                                                
NR2001*039220                                                                         
NR2001*039230     IF  BORV-01-CODE = 36                                               
NR2001*039240         PERFORM P200-WONER-ACCT-TRF-CHECK THRU P299-EXIT                
NR2001*039250         IF  WA-OWNER-ACCT-FLAG = "Y"                                    
NR2001*039260             MOVE BORV-36-JRNL-NO  TO WA-SAVE-36-JRNL-NO                 
NR2001*039270             MOVE SPACE            TO WA-OWNER-ACCT-FLAG                 
NR2001*039280             GO TO P110-CONT                                             
NR2001*039290         ELSE                                                            
NR2001*039300             GO TO P110-CONT                                             
NR2001*039310         END-IF                                                          
NR2001*039320     END-IF.                                                             
NR2001*039330                                                                         
NR2001*039340     IF  BORV-01-CODE = 01                                               
NR2001*039350         IF  BORV-01-JRNL-NO  =  WA-SAVE-36-JRNL-NO                      
NR2001*039360             ADD BORV-01-AMOUNT    TO WA-SAVE-TRF-AMT                    
NR2001*039370         END-IF                                                          
NR2001*039380     END-IF.                                                             
NR2001*039390     GO TO P110-CONT.                                                    
NR2001*039400 P199-EXIT.                                                              
NR2001*039410     EXIT.                                                               
NR2001 P100-READ-BOCT.                                                         
NR2001*===============                                                         
NR2001     INITIALIZE UTBOCTCA-CALL-AREA.
NR2001     MOVE BORM-SOC-NO       TO BOCT-INST-NO.
NR2001     MOVE BORM-MEMB-CUST-AC TO BOCT-ACCT-NO.
NR2001     MOVE 0                 TO BOCT-REC-NO.
NR2001     MOVE 999999999         TO BOCT-TRN-DATE.
NR2001     MOVE 1                 TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT TO TRUE.
NR2001 P110-CONT.                                                              
NR2001     MOVE BOCT-INST-NO        TO UTBOCTCA-INST-NO.
NR2001     MOVE BOCT-ACCT-NO        TO UTBOCTCA-ACCT-NO.
NR2001     MOVE BOCT-REC-NO         TO UTBOCTCA-REC-NO.
NR2001     MOVE BOCT-TRN-DATE       TO UTBOCTCA-CALL-DATE.
NR2001     MOVE 1                   TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT   TO TRUE.
NR2001     CALL "UTBOCT"         USING UTBOCTCA-CALL-AREA
NR2001                                 BOCT-RECORD-AREA.
NR2001     IF  UTBOCTCA-EOF
NR2001         GO TO P199-EXIT.                                                
NR2001     IF  NOT UTBOCTCA-OK
NR2001         MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE         
NR2001         MOVE SPACES TO UT8500CA-INPUT-MSG                               
NR2001         STRING "BR0024 : (P100) BAD READ ON BOCT "
NR2001                ", CALLCODE=" UTBOCTCA-CALL-CODE
NR2001                ", STATUS="   UTBOCTCA-STATUS
NR2001                ", CALLKEY="  UTBOCTCA-CALL-KEY
NR2001             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG                   
NR2001         CALL "UT8500" USING UT8500CA-AREA                               
NR2001         MOVE 1                TO WA-MSG-ERR-FLAG                        
NR2001         MOVE 155              TO WA-OUTPUT-ERR-MSG-NO                   
NR2001         MOVE "BOCT"           TO WA-DBERR-DATA-SET                      
NR2001         MOVE UTBOCTCA-STATUS  TO WA-DB-ERROR                            
NR2001         GO TO P199-EXIT.                                                
NR2001                                                                         
NR2001     IF  BOCT-TRAN-TYPE = 36                                               
NR2001         PERFORM P200-WONER-ACCT-TRF-CHECK THRU P299-EXIT                
NR2001         IF  WA-OWNER-ACCT-FLAG = "Y"                                    
NR2001             MOVE BOCT-JRNL-NO  TO WA-SAVE-36-JRNL-NO                 
NR2001             MOVE SPACE            TO WA-OWNER-ACCT-FLAG                 
NR2001             GO TO P110-CONT                                             
NR2001         ELSE                                                            
NR2001             GO TO P110-CONT                                             
NR2001         END-IF                                                          
NR2001     END-IF.                                                             
NR2001                                                                         
NR2001     IF  BOCT-TRAN-TYPE = 01                                               
NR2001         IF  BOCT-JRNL-NO  =  WA-SAVE-36-JRNL-NO                      
NR2001             ADD BOCT-01-AMOUNT    TO WA-SAVE-TRF-AMT                    
NR2001         END-IF                                                          
NR2001     END-IF.                                                             
NR2001     GO TO P110-CONT.                                                    
NR2001 P199-EXIT.                                                              
NR2001     EXIT.                                                               
039420*                                                                        
039430 P200-WONER-ACCT-TRF-CHECK.                                              
039440     MOVE BORM-SOC-NO         TO CUSM-SOC-NO.                            
NR2001*039450     MOVE BORV-36-ACCOUNT-NO  TO CUSM-CUST-ACCT-NO.                      
NR2001     MOVE BOCT-36-ACCOUNT-NO  TO CUSM-CUST-ACCT-NO.
039460     PERFORM P300-READ-CUSM  THRU P399-EXIT.                             
039470     MOVE CUSM-CUSTOMER-NO    TO WA-TRF-CUST-NO.                         
039480                                                                         
039490     IF  WA-BORM-CUST-NO  = WA-TRF-CUST-NO                               
039500         MOVE "Y"      TO WA-OWNER-ACCT-FLAG                             
039510     END-IF.                                                             
039520 P299-EXIT.                                                              
039530     EXIT.                                                               
039540*                                                                        
039550 P300-READ-CUSM.                                                         
039560     MOVE 71             TO DBIO-CALL-FUNC.                              
039570     MOVE "CUSM"         TO DBIO-CALL-SYS-AREA.                          
039580     MOVE CUSM-KEY       TO DBIO-CALL-KEY-AREA.                          
039590     MOVE SPACE          TO DBIO-CALL-STATUS.                            
039600     CALL "DBIO" USING                                                   
039610                            DBIO-CALL-PARAM                              
039620                            DBIO-CALL-SYS-AREA                           
039630                            DBIO-CALL-KEY-AREA                           
039640                            DBIO-CALL-STATUS                             
039650                            CUSM-RECORD-AREA.                            
039660     IF  DBIO-CALL-STATUS NOT = "****"                                   
039670         MOVE 108  TO WA-OUTPUT-ERR-MSG-NO                               
039680         MOVE 1    TO WA-MSG-ERR-FLAG                                    
039690     END-IF.                                                             
039700 P399-EXIT.                                                              
039710     EXIT.                                                               
039720*
039730/
039740*  KEYMATRIX 30 DAY LOANS - TESTS THE MFRC FLAG AND DEPENDING ON        
039750*  THE SETTING THE ADVANCE WILL EITHER BE TRANSFERRED TO THE TXN        
039760*  A/C OR MOVED TO THE AUTHORISATION FIELD ON THE BLDV OR VIA ATM       
039770*
039780 Q000-PROCESS-AUTH-TRAN.
039790* Check whether client has been paid in the future no drawdowns al     
039800* till next salary payment is due.
039810* UTSALR has already been called, this returns the date the client       
039820* has been paid up to.                                                   
039830*
039840     IF STRT-AREA-TRN-NO = 12422
039850      IF UTSALRCA-PAID-TO > STRT-AREA-POST-DT
039860         MOVE 1                   TO WA-MSG-ERR-FLAG
039870         MOVE 1888                TO WA-OUTPUT-ERR-MSG-NO
039880         GO TO Q009-EXIT.
039890*
039900* Flag setting of 4 or 5 the drawdown must be for the full approve      
039910     IF WA-INPUT-PARAM-TABLE(7) = 0
039920       IF (SOC-MFRC-FLAG = 4 OR 5) AND
039930        (WA-DUMMY-AMT NOT = BORM-APP-AMT)
039940            MOVE 1883            TO WA-OUTPUT-ERR-MSG-NO
039950            MOVE 1               TO WA-MSG-ERR-FLAG
039960            GO TO Q009-EXIT.
039970 
039980 Q010-ADV-OR-AUTH.
039990     IF SOC-MFRC-FLAG = 1 OR 4
040000        PERFORM Q100-ADV-TO-TRANS-ACCT    THRU Q109-EXIT.
040010 
040020     IF SOC-MFRC-FLAG = 2 OR 5 AND NOT
040030         (WA-INPUT-PARAM-TABLE(28) = 1)
040040        PERFORM Q200-SETUP-AUTH-FIELD     THRU Q209-EXIT.

040060     IF SOC-MFRC-FLAG = 2 OR 5 AND
040070         WA-INPUT-PARAM-TABLE(28) = 1
040080         IF  BORM-NON-PERF-BAL = 0
040090             MOVE 1859           TO WA-OUTPUT-ERR-MSG-NO
040100             MOVE 1              TO WA-MSG-ERR-FLAG
040110             GO TO Q009-EXIT
040120         END-IF
040130         IF SOC-MFRC-FLAG = 5  AND
040140            BORM-NON-PERF-BAL NOT = WA-DUMMY-AMT
040150            MOVE 1883            TO WA-OUTPUT-ERR-MSG-NO
040160            MOVE 1               TO WA-MSG-ERR-FLAG
040170            GO TO Q009-EXIT
040180         END-IF
040190         MOVE 0                  TO BORM-NON-PERF-BAL.
040200 Q009-EXIT.
040210     EXIT.
040220*
040230***
040240*
040250 Q100-ADV-TO-TRANS-ACCT.
040260     MOVE STRT-AREA-TRN-NO       TO WA-30DL-SAVE-TRN-NO.
040270     IF STRT-AREA-TRN-NO = 12522
040280        AND BORM-LOAN-BAL < (WA-DUMMY-AMT * -1)
040290            MOVE 140             TO WA-OUTPUT-ERR-MSG-NO
040300            MOVE 1               TO WA-MSG-ERR-FLAG
040310            GO TO Q109-EXIT.
040320     IF STRT-AREA-TRN-NO = 12422 OR 11064 OR 11065
040330        MOVE 11055               TO STRT-AREA-TRN-NO
040340     ELSE
040350        MOVE 16155               TO STRT-AREA-TRN-NO.
040360     MOVE BORM-TRF-ACCT-NO       TO WA-DEP-ACCT-NO.
040370     PERFORM H100-ADV-BY-TRANSFER  THRU H199-EXIT.
040380*    IF  STRT-AREA-TRN-NO NOT = 12422 AND 12522
040390*        GO TO Q109-EXIT.

040410     MOVE STRT-AREA-TRN-NO TO LINK-IN-TXCODE.
040420     PERFORM M1600-LOAD-ED2 THRU M1699-EXIT.

040440     IF WA-MSG-ERR-FLAG = 1
040450        GO TO Q109-EXIT.

040470     MOVE LINK-EDIT-TABLE         TO STRT-AREA-EDIT-MASK.
040480     MOVE LINK-POSTING-LEVEL      TO STRT-AREA-POSTING-LEVEL.
040490 Q109-EXIT.
040500     EXIT.
040510*
040520***
040530*
040540 Q200-SETUP-AUTH-FIELD.
040550* Temporarily using BORM-NON-PERF-BAL to hold the authorised amoun 
040560     IF STRT-AREA-TRN-NO = 12422
040570        MOVE WA-DUMMY-AMT        TO BORM-NON-PERF-BAL
040580     ELSE
040590        MOVE 0                   TO BORM-NON-PERF-BAL.
040600     MOVE "N"                    TO WA-30DL-UPDATE-FLAG.
040610 Q209-EXIT.
040620     EXIT.
040630*
040640***
040650*
040660 Q500-LOAD-REPAYMENTS.
040670     MOVE UTSALRCA-FREQ          TO UT4001CA-01-SALARY-FREQ.
040680     IF UTSALRCA-FREQ = "W"
040690        MOVE 4                   TO UT4001CA-01-NO-PAYMENTS
040700     ELSE
040710     IF UTSALRCA-FREQ = "F"
040720        MOVE 2                   TO UT4001CA-01-NO-PAYMENTS
040730     ELSE
040740        MOVE 1                   TO UT4001CA-01-NO-PAYMENTS.
040750     MOVE 0                      TO WA-30DL-NO-PAYS.
040760     MOVE UTSALRCA-DATE (1)      TO UT4001CA-01-SALARY-DATE (1).
040770     ADD  1                      TO WA-30DL-NO-PAYS.
040780     IF   WA-30DL-NO-PAYS = UT4001CA-01-NO-PAYMENTS
040790          GO TO Q510-CONT.
040800     MOVE UTSALRCA-DATE (2)      TO UT4001CA-01-SALARY-DATE (2).
040810     IF   WA-30DL-NO-PAYS = UT4001CA-01-NO-PAYMENTS
040820          GO TO Q510-CONT.
040830     MOVE UTSALRCA-DATE (3)      TO UT4001CA-01-SALARY-DATE (3).
040840     MOVE UTSALRCA-DATE (4)      TO UT4001CA-01-SALARY-DATE (4).
040850 Q510-CONT.
040860     IF  WA-INPUT-PARAM-TABLE (7) = 1
040870         MOVE 02                 TO UT4001CA-CALL-CODE
040880     ELSE
040890         MOVE 01                 TO UT4001CA-CALL-CODE.
040900     MOVE BORM-SOC-NO            TO UT4001CA-01-FROM-INST-NO
ST0170                                    UT0200-CALL-SOC-NO
040910                                    UT4001CA-01-TO-INST-NO.
040920     MOVE BORM-TRF-ACCT-NO       TO UT4001CA-01-FROM-ACCT
040930                                    INVM-MEMB-CUST-AC
040940     PERFORM Q600-READ-INVM THRU Q609-EXIT
040950     IF  WA-MSG-ERR-FLAG = 1
040960          GO TO Q509-EXIT.
040970     MOVE INVM-ACCT-TYPE         TO UT4001CA-01-FROM-ACCT-TYPE
ST0170                                    UT0200-CALL-ACCT-TYPE-A
040980     MOVE INVM-INT-CAT           TO UT4001CA-01-FROM-INT-CAT
ST0170                                    UT0200-CALL-INT-CAT-A
040990     MOVE "DEP"                  TO UT4001CA-01-FROM-SYS.
041000     MOVE "LON"                  TO UT4001CA-01-TO-SYS.
041010     MOVE BORM-MEMB-CUST-AC      TO UT4001CA-01-TO-ACCT.
041020     MOVE BORM-CUSTOMER-NO       TO ut4001CA-01-CUST-NO.
041030     MOVE BORM-ACT-TYPE          TO UT4001CA-01-TO-ACCT-TYPE.
041040     MOVE BORM-CAT               TO UT4001CA-01-TO-INT-CAT.
041050     MOVE BORM-DUE-AMT           TO UT4001CA-01-AMOUNT.
041060     ADD  1                      TO BORM-REPAY-COUNT.
041070     MOVE BORM-REPAY-COUNT       TO UT4001CA-01-DRAWDOWN-NO
041080     MOVE 1                      TO UT4001CA-01-INT-PAY-FLAG.
041090     MOVE 0                      TO UT4001CA-01-LOAN-INT.
041100     COMPUTE UT4001CA-01-LOAN-INT ROUNDED =
041110                      BORM-INT / UT4001CA-01-NO-PAYMENTS.
041120     MOVE 0                      TO UT4001CA-01-MAN-LOAD.
041130     MOVE SPACES                 TO UT4001RA-RET-STATUS.
ST0170     MOVE 0              TO UT0200-CALL-INDEX
ST0170                            UT0200-CALL-STATUS
ST0170     MOVE 02             TO UT0200-CALL-CODE
ST0170     CALL "UT0200"    USING UT0200-CALL-AREA
ST0170     IF   UT0200-CALL-STATUS NOT = 0
ST0170          DISPLAY "BR0024: (Q500) ERROR IN READ DEPP"
ST0170                  ", KEY =" INVM-ACCT-TYPE " - " INVM-INT-CAT
ST0170                  ", STATUS =" UT0200-CALL-STATUS
ST0170          MOVE 1   TO WA-MSG-ERR-FLAG
ST0170          MOVE 108 TO WA-OUTPUT-ERR-MSG-NO
ST0170          GO       TO Q509-EXIT
ST0170     END-IF
ST0170     MOVE WA-ACCT-PARM TO DEPP-RECORD-AREA
041140     CALL "UT4001"            USING WA-SOC-PARAMS
041150                                    STARTAREA
041160                                    BORP-RECORD-AREA
041170                                    DEPP-RECORD-AREA
041180                                    UT4001CA-CALL-AREA.
041190     IF UT4001RA-RET-STATUS NOT = "****"
041200        MOVE 1                   TO WA-MSG-ERR-FLAG
041210        MOVE 1887                TO WA-OUTPUT-ERR-MSG-NO.
041220 Q509-EXIT.
041230     EXIT.
041240*
041250***
041260*
041270 Q600-READ-INVM.
041280     MOVE STRT-AREA-SOC-NO TO INVM-SOC-NO.
041290     MOVE 01               TO DBIO-CALL-FUNC.
041300     MOVE INVM-KEY         TO DBIO-CALL-KEY-AREA.
041310     MOVE "INV"            TO DBIO-CALL-SYS-AREA.
041320     MOVE SPACES           TO DBIO-CALL-STATUS.
041330     CALL "DBIO" USING

041350                       DBIO-CALL-PARAM
041360                       DBIO-CALL-SYS-AREA
041370                       DBIO-CALL-KEY-AREA
041380                       DBIO-CALL-STATUS
041390                       WA-INVM-RECORD-AREA
041400                       DBIO-CALL-REFER-AREA.
041410     IF DBIO-CALL-STATUS NOT = "****"
041420        MOVE 223 TO WA-OUTPUT-ERR-MSG-NO
041430        MOVE 1 TO WA-MSG-ERR-FLAG.

041450 Q609-EXIT.
041460    EXIT.
041470/
041480 Q700-CANCEL-AUTHORITY.
041490** Cancel the SUK authority when correcting an advance

041510     MOVE 02                     TO UT4001CA-CALL-CODE
041520     MOVE BORM-SOC-NO            TO UT4001CA-02-INST-NO
ST0170                                    UT0200-CALL-SOC-NO
ST0170     MOVE BORM-TRF-ACCT-NO       TO INVM-MEMB-CUST-AC
ST0170     PERFORM Q600-READ-INVM THRU Q609-EXIT
ST0170     IF  WA-MSG-ERR-FLAG = 1
ST0170          GO TO Q709-EXIT.
ST0170     MOVE INVM-ACCT-TYPE         TO UT0200-CALL-ACCT-TYPE-A
ST0170     MOVE INVM-INT-CAT           TO UT0200-CALL-INT-CAT-A
041530     MOVE BORM-CUSTOMER-NO       TO UT4001CA-02-CUST-NO
041540     MOVE BORM-MEMB-CUST-AC      TO UT4001CA-02-ACCT
041550     MOVE "LON"                  TO UT4001CA-02-SYS
041560     MOVE BORM-REPAY-COUNT       TO UT4001CA-02-DRAWDOWN-NO.
ST0170     MOVE 0              TO UT0200-CALL-INDEX
ST0170                            UT0200-CALL-STATUS
ST0170     MOVE 02             TO UT0200-CALL-CODE
ST0170     CALL "UT0200"    USING UT0200-CALL-AREA
ST0170     IF   UT0200-CALL-STATUS NOT = 0
ST0170          DISPLAY "BR0024: (Q700) ERROR IN READ DEPP"
ST0170                  ", KEY =" INVM-ACCT-TYPE " - " INVM-INT-CAT
ST0170                  ", STATUS =" UT0200-CALL-STATUS
ST0170          MOVE 1   TO WA-MSG-ERR-FLAG
ST0170          MOVE 108 TO WA-OUTPUT-ERR-MSG-NO
ST0170          GO       TO Q709-EXIT
ST0170     END-IF
ST0170     MOVE WA-ACCT-PARM TO DEPP-RECORD-AREA
041570     CALL "UT4001"            USING WA-SOC-PARAMS
041580                                    STARTAREA
041590                                    BORP-RECORD-AREA
041600                                    DEPP-RECORD-AREA
041610                                    UT4001CA-CALL-AREA.
041620     IF UT4001RA-RET-STATUS NOT = "****"
041630        MOVE 1                   TO WA-MSG-ERR-FLAG
041640        MOVE 1887                TO WA-OUTPUT-ERR-MSG-NO.
041650 
041660 Q709-EXIT.
041670     EXIT.
041680/
041690*
041700*** BORROW TO PAY PROCESSING                                             
041710*
041720 R000-BORROW-TO-PAY.
041730* If a correction then bypass checks.
041740     IF STRT-AREA-TRN-NO = 11164
041750        GO TO R010-PROCESS.
041760     IF (UTSALRCA-FREQ = "W"
041770      AND BORP-BTP-ALLOWED(1) = 0)
041780     OR (UTSALRCA-FREQ = "F"
041790      AND BORP-BTP-ALLOWED(2) = 0)
041800     OR (UTSALRCA-FREQ = "M"
041810      AND BORP-BTP-ALLOWED(3) = 0)
041820        MOVE 1                TO WA-MSG-ERR-FLAG
041830        MOVE 1880             TO WA-OUTPUT-ERR-MSG-NO
041840        GO TO R009-EXIT.
041850* Check first if the client is weekly paid that 3 instalments            
041860* have already been paid.  If fortnightly, one instalment must be 
041870* paid
041880    MOVE 06                  TO UT4001CA-CALL-CODE
041890    MOVE BORM-REPAY-COUNT    TO UT4001CA-02-DRAWDOWN-NO
041900    MOVE BORM-MEMB-CUST-AC   TO UT4001CA-02-ACCT
041910    MOVE BORM-CUSTOMER-NO    TO UT4001CA-02-CUST-NO
041920    MOVE BORM-SOC-NO         TO UT4001CA-02-INST-NO
ST0170                                    UT0200-CALL-SOC-NO
ST0170    MOVE BORM-TRF-ACCT-NO    TO INVM-MEMB-CUST-AC
ST0170    PERFORM Q600-READ-INVM THRU Q609-EXIT
ST0170    IF  WA-MSG-ERR-FLAG = 1
ST0170         GO TO R009-EXIT.
ST0170    MOVE INVM-ACCT-TYPE      TO UT0200-CALL-ACCT-TYPE-A
ST0170    MOVE INVM-INT-CAT        TO UT0200-CALL-INT-CAT-A
041930    MOVE "LON"               TO UT4001CA-02-SYS
041940    MOVE SPACES              TO UT4001RA-RET-STATUS
ST0170    MOVE 0              TO UT0200-CALL-INDEX
ST0170                           UT0200-CALL-STATUS
ST0170    MOVE 02             TO UT0200-CALL-CODE
ST0170    CALL "UT0200"    USING UT0200-CALL-AREA
ST0170    IF   UT0200-CALL-STATUS NOT = 0
ST0170         DISPLAY "BR0024: (R000) ERROR IN READ DEPP"
ST0170                 ", KEY =" INVM-ACCT-TYPE " - " INVM-INT-CAT
ST0170                 ", STATUS =" UT0200-CALL-STATUS
ST0170         MOVE 1   TO WA-MSG-ERR-FLAG
ST0170         MOVE 108 TO WA-OUTPUT-ERR-MSG-NO
ST0170         GO       TO R009-EXIT
ST0170    END-IF
ST0170    MOVE WA-ACCT-PARM TO DEPP-RECORD-AREA
041950    CALL "UT4001"         USING WA-SOC-PARAMS
041960                                STARTAREA
041970                                BORP-RECORD-AREA
041980                                DEPP-RECORD-AREA
041990                                UT4001CA-CALL-AREA
042000    IF UT4001RA-RET-STATUS NOT = "****"
042010       MOVE UT8500CA-FUNC-NORMAL-DISPLAY
042020                             TO UT8500CA-CALL-CODE
042030       MOVE SPACES TO UT8500CA-INPUT-MSG
042040       STRING "BR0024:(R000)  "
042050            " BAD STATUS FROM UT4001 STATUS = "
042060             UT4001RA-RET-STATUS "  /  " BORM-KEY
042070            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
042080       CALL "UT8500" USING    UT8500CA-AREA
042090       MOVE 1                TO WA-MSG-ERR-FLAG
042100       MOVE 1887             TO WA-OUTPUT-ERR-MSG-NO
042110       GO TO R009-EXIT
042120   END-IF
042130   IF (UTSALRCA-FREQ = "W"
042140   AND  UT4001RA-06-NO-PAID-TO NOT = 03)
042150   OR (UTSALRCA-FREQ = "F"
042160   AND  UT4001RA-06-NO-PAID-TO NOT = 01)
042170       MOVE 1                TO WA-MSG-ERR-FLAG
042180       MOVE 1858             TO WA-OUTPUT-ERR-MSG-NO
042190       GO TO R009-EXIT.
042200* Drawdowns not allowed if client already paid in the future
042210    IF UTSALRCA-PAID-TO > STRT-AREA-POST-DT
042220        MOVE 1                   TO WA-MSG-ERR-FLAG
042230        MOVE 1888                TO WA-OUTPUT-ERR-MSG-NO
042240        GO TO R009-EXIT.
042250*
042260* Flag setting of 4 or 5 the drawdown must be for the full approve      
042270     IF (SOC-MFRC-FLAG = 4 OR 5) AND
042280        (WA-DUMMY-AMT NOT = BORM-APP-AMT)
042290        MOVE 1883                TO WA-OUTPUT-ERR-MSG-NO
042300        MOVE 1                   TO WA-MSG-ERR-FLAG
042310        GO TO R009-EXIT.                                                 
KEY008* Call BR0023 to process the repayment - CHANGE tran code to             
042330* 11065 or 11165                                                         
042340 R010-PROCESS.
042350* First post a 13600 interest charge txn to balance repayment
042360* if account not in arrears.
042370     PERFORM R200-POST-INT-TXN    THRU R209-EXIT.
042380     IF WA-MSG-ERR-FLAG = 1
042390        GO TO R009-EXIT.
042400     MOVE STRT-AREA-TRN-NO        TO WA-SAVE-ST-AREA-TRN-NO
042410                                     WA-SAVE-TRANS-NO.
042420     IF  STRT-AREA-TRN-NO  = 11064
042430         MOVE 11065               TO STRT-AREA-TRN-NO
042440     ELSE
042450         MOVE 11165               TO STRT-AREA-TRN-NO.
042460     MOVE STRT-AREA-TRN-NO        TO LINK-IN-TXCODE.
042470     PERFORM M1600-LOAD-ED2 THRU M1699-EXIT.
042480     MOVE STRT-AREA-DATA          TO WA-SAVE-ST-AREA-DATA.
042490     MOVE WA-INPUT-MESSAGE        TO WA-SAVE-ST-AREA-INPUT-MSG.
042500     MOVE BORM-RECORD-AREA        TO WA-SAVE-BORM-AREA.
042510     MOVE BORM-DUE-AMT            TO WA-ADV-AMOUNT
042520     MOVE 01                      TO WA-ADV-SUB-LEDG-CODE.
042530     MOVE BORM-INT-START-DATE     TO WA-INT-ST-BIN.
042540*
042550     MOVE LINK-EDIT-TABLE         TO STRT-AREA-EDIT-MASK.
042560     MOVE LINK-POSTING-LEVEL      TO STRT-AREA-POSTING-LEVEL.
042570*
042580     CALL "BR0023"        USING
042590                          STARTAREA
042600                          WA-SOC-PARAMS
042610                          BORP-RECORD-AREA
NR2001*042620                          BORV-RECORD-AREA
NR2001                          BOCT-RECORD-AREA
042630                          WA-INT-ST-BIN
042640                          WA-PASSALONG
042650                          UT0270CA-AREA
042660                          W300-ERROR-AREA  
042670                          CHECK-RESPONSE-AREA
042680                          MULTI-OVERRIDE-AREA
042690                          PBOOKCA-LINE-AREA
TB0027                          BR0023CA-AREA
TB0027                          BOIS-RECORD.
042700*                         BR0023CA-AREA.                           ***TB0027
042710     MOVE BR0023CA-TXN(1) TO BR0024CA-TXN(2).

042730     MOVE WA-SAVE-ST-AREA-INPUT-MSG TO WA-INPUT-MESSAGE.
042740     MOVE WA-SAVE-ST-AREA-DATA    TO STRT-AREA-DATA.
042750     MOVE WA-SAVE-ST-AREA-TRN-NO  TO STRT-AREA-TRN-NO.
042760     MOVE STRT-AREA-TRN-NO        TO LINK-IN-TXCODE.
042770     PERFORM M1600-LOAD-ED2 THRU M1699-EXIT.
042780     IF  WA-MSG-ERR-FLAG  = 1
042790         GO TO R009-EXIT.
042800     MOVE WA-SAVE-BORM-AREA        TO BORM-RECORD-AREA.
042810     MOVE 0                        TO BORM-LOAN-BAL
042820                                      BORM-THEO-LOAN-BAL.
042830     MOVE 0                        TO BORM-INT-ACCR
042840                                      BORM-INT-INCR.
042850     PERFORM R300-POST-11064-TXN THRU R399-EXIT.
042860     
042870     COMPUTE WA-30DL-ADV-AMT = WA-ADV-AMOUNT
042880                             - BORM-DUE-AMT.

042900     MOVE WA-ADV-AMOUNT          TO BORM-ADV-VAL.
042910     PERFORM X500-GET-RATE       THRU X509-EXIT.
042920     IF WA-MSG-ERR-FLAG = 1
042930         GO TO R009-EXIT.
042940     MOVE WA-INT-RATE-A          TO WA-30DL-INT-RATE.
042950     COMPUTE WA-30DL-INT-AMT ROUNDED = WA-ADV-AMOUNT
042960                                     * (WA-30DL-INT-RATE / 100).
042970     MOVE WA-30DL-INT-AMT        TO BORM-INT
042980                                    BORM-UNEARNED-INT.
042990     MOVE UTSALRCA-DATE (1)      TO BORM-DUE-STRT-DATE.
043000*
043010     MOVE WA-30DL-ADV-AMT        TO WA-DUMMY-AMT W800-CURR-AMT.
043020** Will need to convert amt if a cross currency txn - later.
043030     COMPUTE WA-30DL-TOT-AMT = WA-ADV-AMOUNT + BORM-INT.
043040     IF  UTSALRCA-FREQ = "W"
043050         COMPUTE BORM-DUE-AMT = WA-30DL-TOT-AMT / 4
043060     ELSE
043070     IF UTSALRCA-FREQ = "F" 
043080        COMPUTE BORM-DUE-AMT = WA-30DL-TOT-AMT / 2 
043090     ELSE 
043100        MOVE WA-30DL-TOT-AMT   TO BORM-DUE-AMT.
043110     PERFORM Q010-ADV-OR-AUTH  THRU Q009-EXIT.
043120     MOVE WA-30DL-ADV-AMT      TO WA-ADV-AMOUNT.
043130     IF UTSALRCA-FREQ = "W"
043140        MOVE 4                   TO BORM-REM-REPAYS
043150     ELSE
043160     IF UTSALRCA-FREQ = "F"
043170        MOVE 2                   TO BORM-REM-REPAYS
043180     ELSE
043190        MOVE 1                   TO BORM-REM-REPAYS.

043210 R009-EXIT.
043220     EXIT.

043240/
043250 R200-POST-INT-TXN.
043260* If account is in arrears then the interest txn has 
043270* already been posted.
043280     IF (BORM-LOAN-BAL - BORM-THEO-LOAN-BAL) > 0
043290        GO TO  R209-EXIT.
043300* Calculate int portion of repayment.
043310*    COMPUTE WA-30DL-INT-AMT = (BORM-ADV-VAL * BORM-INT-RATE)
043320*                                      / 100.
043330* N.B. The preceding calculation will need to be changed for
043340* Phase 2 and multiple drawdowns.
043350*    IF UTSALRCA-FREQ = "W"
043360*       COMPUTE WA-30DL-INT-AMT = WA-30DL-INT-AMT / 4
043370*    ELSE
043380*    IF UTSALRCA-FREQ = "F"
043390*       COMPUTE WA-30DL-INT-AMT = WA-30DL-INT-AMT / 2.
043400*
043410* First calculate how much interest needs to be accrued (for today
043420* thru to the last payment date)
043430     MOVE BORM-UNEARNED-INT TO  WA-30DL-INT-AMT.

043450     MOVE STRT-AREA-SOC-NO     TO LINK-IN-SOC-NO.
043460     MOVE 2                    TO LINK-IN-CALL-CODE.
NR2001*043470     MOVE 13600                TO BORV-01-TRN-CODE
NR2001*043480                                  LINK-IN-TXCODE.
NR2001*043490     MOVE 7                    TO BORV-01-SUB-LEDG-CODE,
NR2001     INITIALIZE BOCT-TRAN-01.
NR2001     MOVE 13600                TO BOCT-TRN-CODE
NR2001                                  LINK-IN-TXCODE.
NR2001     MOVE 7                    TO BOCT-01-SUB-LEDG-CODE.
TB0244***
TB0244*** FOR TIB
TB0244***
TB0244     IF SOC-SITE-TIB
TB0244        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
TB0244                X000-EXIT
TB0244     END-IF.
043500     ADD WA-30DL-INT-AMT       TO BORM-LOAN-BAL.
043510     CALL "UT0250"         USING  LINK-AREA.
043520     IF LINK-OUT-STAT NOT = "****"
043530        MOVE UT8500CA-FUNC-NORMAL-DISPLAY
043540                               TO UT8500CA-CALL-CODE
043550        MOVE SPACES            TO UT8500CA-INPUT-MSG
043560        STRING "BR0024: (R200) TRAN 13600 NOT "
043570               "FOUND, INST = " LINK-IN-SOC-NO
043580               " ACCOUNT NO = " BORM-MEMB-CUST-AC
043590         DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
043600         CALL "UT8500" USING   UT8500CA-AREA.
043610     IF LINK-PRIORITY-CODE = "I"
043620        ADD WA-30DL-INT-AMT    TO BORM-CAP-UNPAID-INT
043630     ELSE
043640     IF LINK-PRIORITY-CODE = "A"
043650        ADD WA-30DL-INT-AMT    TO BORM-UNPAID-ARRS-INT-BAL
043660     ELSE
043670     IF LINK-PRIORITY-CODE = "C"
043680        ADD WA-30DL-INT-AMT    TO BORM-UNPAID-CHRG-BAL
043690     ELSE
043700     IF LINK-PRIORITY-CODE = "P"
043710        ADD WA-30DL-INT-AMT    TO BORM-UNPAID-PRINCIPAL-BAL.
NR2001*043720     MOVE STRT-AREA-POST-DT    TO BORV-01-TRN-DATE
NR2001*043730                                  BORV-01-POST-DATE
NR2001*043740     MOVE 1                    TO BORV-01-CODE.
NR2001*043750     MOVE WA-30DL-INT-AMT      TO BORV-01-AMOUNT.
NR2001*043760     MOVE BORM-LOAN-BAL        TO BORV-01-BALANCE.
NR2001*TB0084     PERFORM N600-GET-ARREARS THRU N609-EXIT
NR2001*043770*--- SUBTRACT BORM-THEO-LOAN-BAL FROM BORM-LOAN-BAL
NR2001*043780*---                    GIVING    BORV-01-ARREARS.
NR2001*043790     MOVE STRT-AREA-BRANCH     TO UPTELLCA-BRCH.
NR2001*043800     MOVE STRT-AREA-TELL-NO    TO UPTELLCA-TELR.
NR2001*043810     CALL "UT0031"      USING     UPTELLCA-PARAM-1
NR2001*043820                                  UPTELLCA-PARAM-2.
NR2001*043830     MOVE UPTELLCA-TELLER-BRANCH TO BORV-01-TELL-AND-BR.
NR2001*043840     MOVE STRT-AREA-TERM-NO    TO BORV-01-BRTERM.
NR2001*043850     MOVE 0                    TO BORV-01-STATUS
NR2001*043860                                  BORV-01-CHQ-DAYS.
NR2001*043870     MOVE STRT-AREA-JRNL-NO    TO BORV-01-JRNL-NO.
NR2001*043880     MOVE STRT-AREA-MSG-TIME   TO BORV-01-POST-TIME.
NR2001     MOVE STRT-AREA-POST-DT    TO BOCT-TRN-DATE.
NR2001     MOVE 1                    TO BOCT-TRAN-TYPE.
NR2001     MOVE WA-30DL-INT-AMT      TO BOCT-01-AMOUNT.
NR2001     MOVE BORM-LOAN-BAL        TO BOCT-01-BALANCE.
NR2001     PERFORM N600-GET-ARREARS THRU N609-EXIT.
NR2001     MOVE 0                    TO BOCT-STAT
NR2001                                  BOCT-01-CHQ-DAYS.
NR2001     MOVE STRT-AREA-MSG-TIME   TO BOCT-01-REPOST-TIME.
043890     PERFORM W500-ADD-TXN   THRU  W599-EXIT.

043910     MOVE 13600                TO BR0024CA-TXN-CODE(1).
043920     MOVE WA-30DL-INT-AMT      TO BR0024CA-AMOUNT(1).
043930     MOVE BORM-LOAN-BAL        TO BR0024CA-BALANCE(1).
043940*
043950*    MOVE 98903                TO BR0024CA-TXN-CODE(4).
043960*    MOVE WA-30DL-INT-AMT      TO BR0024CA-AMOUNT(4).
043970*    MOVE 0                    TO BR0024CA-BALANCE(4).

043990 R209-EXIT.
044000      EXIT.
044010/
044020 R300-POST-11064-TXN.

NR2001*044040     IF BORM-STAT = 7
NR2001*044050        MOVE 01                TO BORV-01-SUB-LEDG-CODE
NR2001*044060     ELSE
NR2001*044070        MOVE 03                TO BORV-01-SUB-LEDG-CODE.
NR2001*TB0244***
NR2001*TB0244*** FOR TIB
NR2001*TB0244***
NR2001*TB0244     IF SOC-SITE-TIB
NR2001*TB0244        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
NR2001*TB0244                X000-EXIT
NR2001*TB0244     END-IF.
NR2001*044080     MOVE STRT-AREA-TRN-NO     TO BORV-01-TRN-CODE
NR2001*044090     MOVE STRT-AREA-POST-DT    TO BORV-01-TRN-DATE
NR2001*044100                                  BORV-01-POST-DATE
NR2001*044110     MOVE 1                    TO BORV-01-CODE.
NR2001*044120     MOVE BORM-DUE-AMT         TO BORV-01-AMOUNT.
NR2001*044130     MOVE BORM-DUE-AMT         TO BORV-01-BALANCE.
NR2001*044140     MOVE 0                    TO BORV-01-ARREARS.
NR2001*044150     MOVE STRT-AREA-BRANCH     TO UPTELLCA-BRCH.
NR2001*044160     MOVE STRT-AREA-TELL-NO    TO UPTELLCA-TELR.
NR2001*044170     CALL "UT0031"      USING     UPTELLCA-PARAM-1
NR2001*044180                                  UPTELLCA-PARAM-2.
NR2001*044190     MOVE UPTELLCA-TELLER-BRANCH TO BORV-01-TELL-AND-BR.
NR2001*044200     MOVE STRT-AREA-TERM-NO    TO BORV-01-BRTERM.
NR2001*044210     MOVE 0                    TO BORV-01-STATUS
NR2001*044220                                  BORV-01-CHQ-DAYS.
NR2001*044230     MOVE STRT-AREA-JRNL-NO    TO BORV-01-JRNL-NO.
NR2001*044240     MOVE STRT-AREA-MSG-TIME   TO BORV-01-POST-TIME.
NR2001     INITIALIZE BOCT-TRAN-01.
NR2001     IF BORM-STAT = 7
NR2001        MOVE 01                TO BOCT-01-SUB-LEDG-CODE
NR2001     ELSE
NR2001        MOVE 03                TO BOCT-01-SUB-LEDG-CODE.
NR2001***
NR2001*** FOR TIB
NR2001***
NR2001     IF SOC-SITE-TIB
NR2001        PERFORM X000-POPULATE-CHANNEL-FLAG THRU
NR2001                X000-EXIT
NR2001     END-IF.
NR2001     MOVE 1                    TO BOCT-TRAN-TYPE.
NR2001     MOVE 0                    TO BOCT-STAT.
NR2001     MOVE STRT-AREA-POST-DT    TO BOCT-TRN-DATE.
NR2001     MOVE STRT-AREA-TRN-NO     TO BOCT-TRN-CODE.
NR2001     MOVE BORM-DUE-AMT         TO BOCT-01-AMOUNT.
NR2001     MOVE BORM-DUE-AMT         TO BOCT-01-BALANCE.
NR2001     MOVE 0                    TO BOCT-01-ARREARS.
NR2001     MOVE 0                    TO BOCT-01-CHQ-DAYS.
NR2001     MOVE STRT-AREA-MSG-TIME   TO BOCT-01-REPOST-TIME.
044250     PERFORM W500-ADD-TXN   THRU  W599-EXIT.
044260     MOVE BORM-DUE-AMT         TO BORM-LOAN-BAL
044270                                  BORM-THEO-LOAN-BAL
044280                                  BORM-EOM-BASIC-BAL.

044300     MOVE STRT-AREA-TRN-NO     TO BR0024CA-TXN-CODE(3).
044310     MOVE BORM-DUE-AMT         TO BR0024CA-AMOUNT(3).
044320     MOVE BORM-LOAN-BAL        TO BR0024CA-BALANCE(3).
044330*
044340 R399-EXIT.
044350      EXIT.
KEY008*      End of Keymatrix 30 day loan process                              
044370/
044380* SPR 730232  S------S
044390 N200-STANDARD-NAME.

044410     MOVE WA-ADV-NAME-1 TO WA-1ST-BYTE-NAME.

044430     IF WA-ADV-VENDOR-NO = "0000000000"
044440        MOVE 330 TO WA-OUTPUT-ERR-MSG-NO
044450        MOVE 1 TO WA-MSG-ERR-FLAG
044460        GO TO N299-EXIT.
B17951*    MOVE 02 TO UT0320-IN-CALL-CODE.
B17951*    MOVE WA-ADV-VENDOR-NO TO UT0320-IN-VENDOR-NO.
B17951*    CALL "UT0320" USING
B17951*                  UT0320-AREA.
B17951*    IF UT0320-OUT-STAT NOT = "****"
B17951*       MOVE 331 TO WA-OUTPUT-ERR-MSG-NO
B17951*       MOVE 1 TO WA-MSG-ERR-FLAG
B17951*       GO TO N299-EXIT.
B17951*    MOVE THIRD-NAME-1 TO WA-ADV-NAME-1.
B17951*    MOVE THIRD-NAME-2 TO WA-ADV-NAME-2.
044570 N299-EXIT.
044580     EXIT.
044590* SPR 730232  E------E
044600/
044610*
044620 U000-CALL-MI0095.
044630     MOVE STRT-AREA-RECOVERY TO MI0095CA-RECOVERY-FLAG.
044640     CALL "MI0095" USING
044650                    LS-MI0095CA
044660                    WA-EDIT-MASK
044670                    BORR-PARAMS
044680                    BORM-RECORD-AREA
NR2001*044690                          BORV-RECORD-AREA
NR2001                          BOCT-RECORD-AREA
044700                          LS-RFSH-AREA
044710                          WA-TODAY-BIN-DATE
044720                          MULTI-OVERRIDE-AREA.
044730 U099-EXIT.
044740     EXIT.                                                               
044750*
044760***  THIS ROUTINE READS CUSTOMER VARIABLE
044770*
044780 V100-READ-CUSVAA.
044790     MOVE "61"             TO DBIO-CALL-SYS-AREA.
044800     MOVE "CUSMCUSV"       TO DBIO-CALL-SYS-AREA.
044810     MOVE STRT-AREA-SOC-NO TO WA-CUSV-SOC-NO.
044820     MOVE BORM-CUSTOMER-NO TO WA-CUSV-ACCT-NO.
044830     MOVE WA-CUSV-KEY      TO DBIO-CALL-KEY-AREA.
044840     MOVE 0                TO DBIO-CALL-REFER-AREA.
044850     MOVE "AA"             TO DBIO-CALL-CODE-B.
044860     CALL "DBIO" USING

044880                       DBIO-CALL-PARAM
044890                       DBIO-CALL-SYS-AREA
044900                       DBIO-CALL-KEY-AREA
044910                       DBIO-CALL-STATUS
044920                       WA-CUSV-AREA-AA
044930                       DBIO-CALL-REFER-AREA
044940                       DBIO-CALL-CODE-B.
044950 V109-EXIT.
044960     EXIT.
044970/
044980 V120-READ-CUSVB3.
044990     MOVE 61               TO DBIO-CALL-FUNC.
045000     MOVE "CUSMCUSV"       TO DBIO-CALL-SYS-AREA.
045010     MOVE STRT-AREA-SOC-NO TO WA-CUSV-SOC-NO.
045020     MOVE WA-ADV-ACCT-NO   TO WA-CUSV-ACCT-NO.
045030     MOVE WA-CUSV-KEY      TO DBIO-CALL-KEY-AREA.
045040     MOVE 0                TO DBIO-CALL-REFER-AREA.
045050     MOVE "B3"             TO DBIO-CALL-CODE-B.
045060     CALL "DBIO" USING

045080                        DBIO-CALL-PARAM
045090                        DBIO-CALL-SYS-AREA
045100                        DBIO-CALL-KEY-AREA
045110                        DBIO-CALL-STATUS
045120                        WA-CUSV-AREA-B3
045130                        DBIO-CALL-REFER-AREA
045140                        DBIO-CALL-CODE-B.
045150 V129-EXIT.
045160     EXIT.
045170*
045180 V130-READ-CUSVBB.
045190     MOVE 61               TO DBIO-CALL-FUNC.
045200     MOVE "CUSMCUSV"       TO DBIO-CALL-SYS-AREA.
045210     MOVE STRT-AREA-SOC-NO TO WA-CUSV-SOC-NO.
045220     MOVE WA-ADV-ACCT-NO   TO WA-CUSV-ACCT-NO.
045230     MOVE WA-CUSV-KEY      TO DBIO-CALL-KEY-AREA.
045240     MOVE 0                TO DBIO-CALL-REFER-AREA.
045250     MOVE "BB"             TO DBIO-CALL-CODE-B.
045260     CALL "DBIO" USING

045280                        DBIO-CALL-PARAM
045290                        DBIO-CALL-SYS-AREA
045300                        DBIO-CALL-KEY-AREA
045310                        DBIO-CALL-STATUS
045320                        WA-CUSV-AREA-BB
045330                        DBIO-CALL-REFER-AREA
045340                        DBIO-CALL-CODE-B.
045350 V139-EXIT.
045360     EXIT.
045370/
045380 V140-READ-CUSVA3.
045390     MOVE 61               TO DBIO-CALL-FUNC.
045400     MOVE "CUSMCUSV"       TO DBIO-CALL-SYS-AREA.
045410     MOVE STRT-AREA-SOC-NO TO WA-CUSV-SOC-NO.
045420     MOVE BORM-CUSTOMER-NO TO WA-CUSV-ACCT-NO.
045430     MOVE WA-CUSV-KEY      TO DBIO-CALL-KEY-AREA.
045440     MOVE 0                TO DBIO-CALL-REFER-AREA.
045450     MOVE "A3"             TO DBIO-CALL-CODE-B.
045460     CALL "DBIO" USING

045480                       DBIO-CALL-PARAM
045490                       DBIO-CALL-SYS-AREA
045500                       DBIO-CALL-KEY-AREA
045510                       DBIO-CALL-STATUS
045520                       WA-CUSV-AREA-A3
045530                       DBIO-CALL-REFER-AREA
045540                       DBIO-CALL-CODE-B.
045550 V149-EXIT.
045560     EXIT.
045570*
045580 V150-UPDATE-CUSVA3.
045590     MOVE 64        TO DBIO-CALL-FUNC.
045600     CALL "DBIO" USING

045620                       DBIO-CALL-PARAM
045630                       DBIO-CALL-SYS-AREA
045640                       DBIO-CALL-KEY-AREA
045650                       DBIO-CALL-STATUS
045660                       WA-CUSV-AREA-A3
045670                       DBIO-CALL-REFER-AREA
045680                       DBIO-CALL-CODE-B.
045690 V159-EXIT.
045700     EXIT.
045710*
045720 V160-UPDATE-CUSVAA.
045730     MOVE 64        TO DBIO-CALL-FUNC.
045740     CALL "DBIO" USING

045760                       DBIO-CALL-PARAM
045770                       DBIO-CALL-SYS-AREA
045780                       DBIO-CALL-KEY-AREA
045790                       DBIO-CALL-STATUS
045800                       WA-CUSV-AREA-AA
045810                       DBIO-CALL-REFER-AREA
045820                       DBIO-CALL-CODE-B.
045830 V169-EXIT.
045840     EXIT.
045850/
045860 V200-DB-SORD.
045870     MOVE "SORD" TO DBIOMOD-FILE
045880                    DBIOMOD-SUFFIX.
045890     MOVE "DBIO" TO DBIOMOD-PREFIX.
045900     MOVE SPACES TO DBIOMOD-RELEASE-LOCK
045910                    DBIOMOD-STATUS
045920                    DBIOMOD-ACCESS-COMMAND
045930                    DBIOMOD-ACCESS-COND.
045940     CALL DBIOMODNAME USING

045960                            DBIOMOD-FILE
045970                            DBIOMOD-KEY
045980                            SORD-RECORD-AREA
045990                            DBIOMOD-FUNCTION
046000                            DBIOMOD-KEY-NO
046010                            DBIOMOD-RELEASE-LOCK
046020                            DBIOMOD-ACCESS-COMMAND
046030                            DBIOMOD-ACCESS-COND
046040                            DBIOMOD-STATUS.
046050 V299-EXIT.
046060     EXIT.
046070/
046080 W100-SET-DUE-DT.
S11455     IF  WA-ADV-AMORT-FLAG = "S"
S11455         GO TO W199-EXIT        
S11455     END-IF.                    
046090     MOVE ZEROES TO UT0030-BINARY-DATE.
S11050     MOVE BORM-REPAY-DAY TO WS-SAVE-REPAY-DAY.
046100     IF BORP-START-METH = 01 OR 02 OR 06
TB0236        IF NOT BORP-YOUBE
046110         GO TO W199-EXIT.
046120     IF BORP-START-METH = 03
TB0159        IF NOT BORP-YOUBE
046130         IF WA-ADV-COUNT = 0
046140             GO TO W199-EXIT.
TB0159     IF  BORP-YOUBE
TB0159         INITIALIZE UT0312CA-CALL-PARAMETER
TB0159         MOVE 15                      TO UT0312CA-CALL-CODE
SC5145         IF  BOIS-PREF-INT-PERIOD > 0
SC5145         AND BOIS-PREF-INT-RATE = 0
SC9726         AND BORM-ADV-VAL = 0
S16087         AND BOIS-START-METHOD = "03"
SC5145            MOVE 18                   TO UT0312CA-CALL-CODE
SC5145            MOVE BOIS-PREF-INT-PERIOD TO UT0312CA-PREF-INT-PERIOD
SC5145         END-IF
TB0159         MOVE WA-TODAY-BIN-DATE       TO UT0312CA-EFF-DATE
TB0159         MOVE BORM-KEY                TO UT0312CA-ACCT-KEY
SC0394*        IF BORM-ADV-VAL = 0
SC8349*           MOVE WA-TODAY-BIN-DATE    TO UT0312CA-DUE-STRT-DT
SC0394*        ELSE
SC0394*           MOVE BORM-DUE-STRT-DATE   TO UT0312CA-DUE-STRT-DT
SC0394*        END-IF
SC8349         IF WA-INPUT-PARAM-TABLE(8) = 1                                        
SC8349            MOVE WA-ADV-TXN-DATE      TO UT0030-DATE-DDMMCCYY                  
SC8349            MOVE 1                    TO UT0030-FUNCTION                       
SC8349            CALL "UT0030"          USING UT0030-FUNCTION                       
SC8349                                         UT0030-DATE-AREA                      
SC8349                                         UT0030-BINARY-DATE                    
SC8349            MOVE UT0030-BINARY-DATE   TO UT0312CA-DUE-STRT-DT                  
SC8349         ELSE                                                                  
SC8349            MOVE WA-TODAY-BIN-DATE    TO UT0312CA-DUE-STRT-DT                  
SC8349         END-IF                                                                
DUEIND         MOVE BOIS-DUE-DTE-IND     TO UT0312CA-1ST-DUE-DTE-IND
TB0159         CALL "UT0312"             USING UT0312CA-CALL-AREA
TB0159         display 'UT0312CA-RET-STATUS = ' UT0312CA-RET-STATUS
TB0159         IF UT0312CA-RET-STATUS NOT = ZEROES
TB0159            MOVE 1                    TO WA-MSG-ERR-FLAG
TB0159            MOVE 3026                 TO WA-OUTPUT-ERR-MSG-NO
TB0159            MOVE UT0312CA-RET-STATUS  TO WA-OUTPUT-STATUS
TB0159            GO TO W199-EXIT
TB0159         ELSE
TB0159            MOVE UT0312CA-NEXT-DUE-DT TO BOIS-NEXT-DUE-DATE
SC5125                                         BOIS-LAST-UNPAID-DUE-DATE
TB0159            MOVE UT0312CA-PREV-DUE-DT TO BOIS-PREV-DUE-DATE
TB0159         END-IF
S10250         IF  BORP-YOUBE                                    
S10250         AND BOIS-PREF-INT-RATE = 0                        
S10250         AND BOIS-PREF-INT-PERIOD > 0                      
S10250         AND BOIS-RATE-EXP-DATE > BOIS-NEXT-DUE-DATE       
S10250             MOVE BOIS-RATE-EXP-DATE  TO BOIS-NEXT-DUE-DATE
S10250         END-IF                                            
SC2929* RECALC RATE EXPIRY DATE
SC6712*        IF BOIS-PREF-INT-RATE > 0 AND
SC6712*           BOIS-PREF-INT-PERIOD > 0 AND
SC6712*           BORM-STAT < 06
SC6712*           MOVE STRT-AREA-POST-DT TO UT0312CA-EFF-DATE
SC6712*                                     UT0312CA-DUE-STRT-DT
SC6712*           MOVE 1 TO BOIS-PREF-INT-PERIOD
SC6712*        ELSE
SC2929         IF BOIS-PREF-INT-RATE >= 0  AND
SC6712*         IF BOIS-PREF-INT-RATE = 0  AND
                   BOIS-PREF-INT-PERIOD > 0 AND
SC5377             BOIS-START-METHOD = 03 AND
                   BORM-STAT < 06     
                   IF BORM-INT-START-DATE = 0
                      MOVE STRT-AREA-POST-DT TO UT0312CA-EFF-DATE
                                           UT0312CA-DUE-STRT-DT
                   ELSE
                     MOVE BORM-INT-START-DATE TO UT0312CA-EFF-DATE
                                           UT0312CA-DUE-STRT-DT
                   END-IF
SC6712*         END-IF
SC6712*        END-IF
                  MOVE BOIS-PREF-INT-PERIOD TO UT0312CA-LOAN-TERM
                  MOVE 16 TO UT0312CA-CALL-CODE
                  CALL "UT0312"  USING
                                    UT0312CA-CALL-AREA
                  IF UT0312CA-RET-STATUS <> ZEROES
                     MOVE 296   TO WA-OUTPUT-ERR-MSG-NO
                     MOVE 1        TO WA-MSG-ERR-FLAG
                  ELSE
                     MOVE UT0312CA-MATURITY-DT TO
                                       BOIS-RATE-EXP-DATE
                  END-IF
SC2929         END-IF
SC2929*SC6712  END-IF
TB0159         GO TO W199-EXIT
TB0159     END-IF.
046150*        IF BORM-ADV-VAL > 0
046160*            GO TO W199-EXIT.
046170     IF BORP-START-METH = 04
046180         DIVIDE BORM-APP-AMT BY 2 GIVING WA-50PC-ADV
046190         IF (BORM-ADV-VAL - WA-DUMMY-AMT < WA-50PC-ADV) AND
046200            (BORM-ADV-VAL > WA-50PC-ADV)
046210             NEXT SENTENCE
046220         ELSE
046230             GO TO W199-EXIT.
046240     IF BORP-START-METH = 00
046250         IF BORM-ADV-VAL NOT = BORM-APP-AMT
046260             MOVE ZEROES TO BORM-DUE-STRT-DATE
046270                            BORM-INT-START-DATE
046280                            BORM-ADV-DATE
046290             MOVE ZERO TO BORM-PAY-DAY  BORM-REPAY-DAY
046300             GO TO W199-EXIT.
SC0941****START-FAD
           IF  ( STRT-AREA-TRN-NO = 16055 ) AND
               ( WA-INPUT-PARAM-TABLE(8) = 1 )
               PERFORM Z700-CHK-TXNDT THRU Z709-EXIT
               IF  WS-ERR-Y
015500             MOVE 1 TO WA-MSG-ERR-FLAG
015510             MOVE 3360 TO WA-OUTPUT-ERR-MSG-NO
                   GO TO W199-EXIT
               END-IF
           END-IF.
SC0941****END-FAD
046310     IF  WA-INPUT-PARAM-TABLE(8) = 1
046320         MOVE WA-ADV-TXN-DATE TO WA-TRN-DATE
046330     ELSE MOVE STRT-AREA-POST-DT TO UT0020-BINARY-DATE
046340          MOVE 1 TO UT0020-FUNCTION
046350          PERFORM X100-UT0020-PARA THRU X109-EXIT
046360          MOVE UT0020-DATE-DDMMCCYY TO WA-TRN-DATE.
046370     MOVE WA-TRN-DATE TO UT0030-DATE-DDMMCCYY.
046380     PERFORM X200-UT0030-PARA THRU X209-EXIT.
046390     IF  UT0030-BINARY-DATE = ZEROES
046400         MOVE 126 TO WA-OUTPUT-ERR-MSG-NO
046410         MOVE 1 TO WA-MSG-ERR-FLAG.
046420     IF WA-INPUT-PARAM-TABLE (7) = 1 OR
046430        WA-INPUT-PARAM-TABLE (8) = 1
046440        IF BORM-ADV-VAL = 0
TB0082**--
      **  After the correction the BORM-REPAY-DAY should retain
      **  its original value and not to have a zero value

                 IF NOT BORP-PRIORITY-TERM-BY-TERM
046450              MOVE ZERO TO BORM-PAY-DAY  BORM-REPAY-DAY
S11050           ELSE
S11050              IF WA-INPUT-PARAM-TABLE (7) = 1
S11050                 PERFORM W150-GET-ORIG-REPAY-DAY THRU W159-EXIT
S11050              END-IF
                 END-IF
TB0082**--
046460           MOVE ZEROES TO BORM-ADV-DATE
046470                          BORM-DUE-STRT-DATE
046480                          BORM-INT-START-DATE
046490           GO TO W199-EXIT.
046500     IF BORP-START-METH = 05
046510         IF BORM-INT-START-DATE = 0
046520            MOVE UT0030-BINARY-DATE TO BORM-INT-START-DATE
046530            IF BORP-CAPN-DAY = ZEROS AND
046540               BORM-PAY-DAY = ZEROS
046550               MOVE WA-TRN-DD TO BORM-PAY-DAY
046560            END-IF
046570            IF  BORM-PAY-DAY > 31
046580                MOVE 31 TO BORM-PAY-DAY
046590            END-IF
046600         END-IF
046610         IF BORM-ADV-VAL >= BORM-APP-AMT
046620            IF BORM-TERM-BASIS = "D"
046630               MOVE WA-TRN-CC TO UT0310CA-CALENDAR-IN-CC
046640               MOVE WA-TRN-YY TO UT0310CA-CALENDAR-IN-YY
046650               MOVE WA-TRN-MM TO UT0310CA-CALENDAR-IN-MM
046660               MOVE WA-TRN-DD TO UT0310CA-CALENDAR-IN-DD
046670               MOVE 0         TO UT0310CA-CALENDAR-METHOD
046680               MOVE 02        TO UT0310CA-CALL-FUNC
046690               MOVE BORP-CALENDAR-CODE TO UT0310CA-CALENDAR-CODE
046700*----MIC001-----START--------------------------------------------
046710               MOVE STRT-AREA-SOC-NO TO UT0310CA-SOC-NO
046720*----MIC001-----END----------------------------------------------
046730               CALL "UT0310" USING

046750                    UT0310CA-AREA
046760               IF UT0310CA-CALL-STATUS NOT = 0
046770                  MOVE 674 TO WA-OUTPUT-ERR-MSG-NO
046780                  MOVE 1 TO WA-MSG-ERR-FLAG
046790                  GO TO W199-EXIT
046800               END-IF
046810            END-IF
046820            MOVE UT0030-BINARY-DATE TO BORM-DUE-STRT-DATE
046830                                       BORM-INT-START-DATE
046840            IF BORP-REPAY-DAY = ZEROS AND
046850               BORM-REPAY-DAY = ZEROS
046860               MOVE WA-TRN-DD TO BORM-REPAY-DAY
046870            END-IF
046880            IF  BORM-REPAY-DAY > 31
046890                MOVE 31 TO BORM-REPAY-DAY
046900            END-IF
046910         END-IF
046920         GO TO W199-EXIT
046930     ELSE
046940         MOVE UT0030-BINARY-DATE TO BORM-DUE-STRT-DATE
046950                                    BORM-INT-START-DATE.
046960     IF BORP-CAPN-DAY = ZEROS AND
046970        BORM-PAY-DAY = ZEROS
046980        MOVE WA-TRN-DD TO BORM-PAY-DAY.
046990     IF  BORM-PAY-DAY > 31
047000         MOVE 31 TO BORM-PAY-DAY.
047010     IF BORP-REPAY-DAY = ZEROS AND
047020        BORM-REPAY-DAY = ZEROS
047030        MOVE WA-TRN-DD TO BORM-REPAY-DAY.
047040     IF  BORM-REPAY-DAY > 31
047050         MOVE 31 TO BORM-REPAY-DAY.
047060 W199-EXIT.
047070     EXIT.
047080/
S11050 W150-GET-ORIG-REPAY-DAY.
NR2001*S11050     MOVE  BORV-RECORD-AREA      TO WS-BORV-RECORD-AREA
NR2001*S11050     MOVE  SPACES                TO DBIO-CALL-PARAM
NR2001*S11050                                    DBIO-CALL-SYS-AREA
NR2001*S11050                                    DBIO-CALL-KEY-AREA
NR2001*S11050                                    DBIO-CALL-STATUS
NR2001*S11050                                    DBIO-CALL-SAVE-REFER
NR2001*S11050     MOVE  ZERO                  TO DBIO-CALL-REFER-AREA
NR2001*S11050     MOVE  07                    TO DBIO-CALL-FUNC
NR2001*S11050     MOVE  "BOR"                 TO DBIO-CALL-SYS
NR2001*S11050     MOVE  BORM-KEY              TO DBIO-CALL-KEY
NR2001*S11050     MOVE  54                    TO DBIO-CALL-TXN-TYPE
NR2001*S11050     MOVE  "N"                   TO WA-TRAN-NO-MORE-FLAG
NR2001*S11050                                    WS-REPAY-DAY-FOUND.
NR2001*S11050     MOVE  ZEROES                TO WS-OLD-REPAY-DAY.
NR2001*S11050
NR2001*S11050     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001*S11050        MOVE WA-STORE-TXN-DT     TO WA-BORV-TRN-DATE
NR2001*S11050     ELSE
NR2001*S11050        MOVE STRT-AREA-POST-DT   TO WA-BORV-TRN-DATE
NR2001*S11050     END-IF.
NR2001*S11050
NR2001*S11050     PERFORM W160-RETRIEVE-RPAY-DAY THRU W169-EXIT
NR2001*S11050       UNTIL WA-TRAN-NO-MORE.
NR2001*S11050
NR2001*S11050     IF WS-REPAY-DAY-FOUND = "Y"
NR2001*S11050        MOVE WS-OLD-REPAY-DAY    TO BORM-REPAY-DAY
NR2001*S11050     END-IF.
NR2001*S11050
NR2001*S11050     MOVE WS-BORV-RECORD-AREA    TO BORV-RECORD-AREA.
NR2001     MOVE  BOCT-RECORD-AREA      TO WS-BOCT-RECORD-AREA.
NR2001     INITIALIZE UTBOCTCA-CALL-AREA.
NR2001     MOVE BORM-SOC-NO            TO BOCT-INST-NO.
NR2001     MOVE BORM-MEMB-CUST-AC      TO BOCT-ACCT-NO.
NR2001     MOVE 0                      TO BOCT-REC-NO.
NR2003*NR2001     MOVE 999999999              TO BOCT-TRN-DATE.
NR2003     MOVE STRT-AREA-POST-DT      TO BOCT-TRN-DATE.
NR2001     MOVE 1                      TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT      TO TRUE.
NR2001     MOVE 54                     TO WS-BOCT-TRAN-TYPE.
NR2001     MOVE  "N"                   TO WA-TRAN-NO-MORE-FLAG
NR2001                                    WS-REPAY-DAY-FOUND.
NR2001     MOVE  ZEROES                TO WS-OLD-REPAY-DAY.
NR2001
NR2001     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001        MOVE WA-STORE-TXN-DT     TO WA-BOCT-TRN-DATE
NR2001     ELSE
NR2001        MOVE STRT-AREA-POST-DT   TO WA-BOCT-TRN-DATE
NR2001     END-IF.
NR2001
NR2001     PERFORM W160-RETRIEVE-RPAY-DAY THRU W169-EXIT
NR2001       UNTIL WA-TRAN-NO-MORE.
NR2001
NR2001     IF WS-REPAY-DAY-FOUND = "Y"
NR2001        MOVE WS-OLD-REPAY-DAY    TO BORM-REPAY-DAY
NR2001     END-IF.
NR2001
NR2001     MOVE WS-BOCT-RECORD-AREA    TO BOCT-RECORD-AREA.
S11050 W159-EXIT.
S11050     EXIT.
S11050/
S11050 W160-RETRIEVE-RPAY-DAY.
NR2001*S11050     CALL "DBIO" USING DBIO-CALL-PARAM
NR2001*S11050                       DBIO-CALL-SYS-AREA
NR2001*S11050                       DBIO-CALL-KEY-AREA
NR2001*S11050                       DBIO-CALL-STATUS
NR2001*S11050                       BORV-RECORD-AREA
NR2001*S11050                       DBIO-CALL-REFER-AREA
NR2001*S11050                       DBIO-CALL-TXN-TYPE.
NR2001*S11050
NR2001*S11050     IF DBIO-CALL-STATUS NOT = "****"
NR2001*S11050        OR DBIO-CALL-SAVE-REFER = "END."
NR2001*S11050        MOVE "Y"                  TO WA-TRAN-NO-MORE-FLAG
NR2001*S11050        GO TO W169-EXIT
NR2001*S11050     END-IF.
NR2001*S11050
NR2001*S11050     IF BORV-01-CODE NOT = 54
NR2001*S11050        GO TO W169-EXIT
NR2001*S11050     END-IF.
NR2001*S11050
NR2001*S11050     IF (BORV-54-JRNL-NO NOT = W800-CORR-JRNL-NO)
NR2001*S11050        OR (WA-BORV-TRN-DATE NOT = BORV-54-TRAN-DATE)
NR2001*S11050        GO TO W169-EXIT
NR2001*S11050     END-IF.
NR2001*S11050
NR2001*S11050     MOVE "Y"                     TO WA-TRAN-NO-MORE-FLAG.
NR2001*S11050     MOVE "Y"                     TO WS-REPAY-DAY-FOUND.
NR2001*S11050     MOVE BORV-54-PREV-STATUS     TO WS-OLD-REPAY-DAY.
NR2001     MOVE BOCT-INST-NO        TO UTBOCTCA-INST-NO.
NR2001     MOVE BOCT-ACCT-NO        TO UTBOCTCA-ACCT-NO.
NR2001     MOVE BOCT-REC-NO         TO UTBOCTCA-REC-NO.
NR2001     MOVE BOCT-TRN-DATE       TO UTBOCTCA-CALL-DATE.
NR2001     MOVE 1                   TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT   TO TRUE.
NR2001     CALL "UTBOCT"         USING UTBOCTCA-CALL-AREA
NR2001                                 BOCT-RECORD-AREA.
NR2001
NR2001     IF NOT UTBOCTCA-OK
NR2001        MOVE "Y"                  TO WA-TRAN-NO-MORE-FLAG
NR2001        GO TO W169-EXIT
NR2001     END-IF.
NR2003     IF BOCT-TRN-DATE < WA-BOCT-TRN-DATE
NR2003        MOVE "Y"                  TO WA-TRAN-NO-MORE-FLAG
NR2003        GO TO W169-EXIT
NR2003     END-IF.
NR2001
NR2001     IF BOCT-TRAN-TYPE NOT = WS-BOCT-TRAN-TYPE
NR2001        GO TO W169-EXIT
NR2001     END-IF.
NR2001
NR2001     IF (BOCT-JRNL-NO NOT = W800-CORR-JRNL-NO)
NR2001        OR (WA-BOCT-TRN-DATE NOT = BOCT-TRN-DATE)
NR2001        GO TO W169-EXIT
NR2001     END-IF.
NR2001
NR2001     MOVE "Y"                     TO WA-TRAN-NO-MORE-FLAG.
NR2001     MOVE "Y"                     TO WS-REPAY-DAY-FOUND.
NR2001     MOVE BOCT-54-PREV-STATUS     TO WS-OLD-REPAY-DAY.
S17755     IF   BORP-ILOAN-R
S17755     AND (BOCT-54-PREV-DUE-IND    =  "Y" OR "N")
S17755        MOVE BOCT-54-PREV-DUE-IND TO BOIS-DUE-DTE-IND
S17755     END-IF.
S11050 W169-EXIT.
S11050     EXIT.
S11050/
S17755 W170-CORR-BOCT-33.
S17755     MOVE  BOCT-RECORD-AREA      TO WS-BOCT-RECORD-AREA.
S17755     INITIALIZE UTBOCTCA-CALL-AREA.
S17755     MOVE BORM-SOC-NO            TO BOCT-INST-NO.
S17755     MOVE BORM-MEMB-CUST-AC      TO BOCT-ACCT-NO.
S17755     MOVE 0                      TO BOCT-REC-NO.
S17755     MOVE STRT-AREA-POST-DT      TO BOCT-TRN-DATE.
S17755     MOVE 1                      TO UTBOCTCA-KEY-NO.
S17755     SET  UTBOCTCA-READNEXT      TO TRUE.
S17755     MOVE 33                     TO WS-BOCT-TRAN-TYPE.
S17755     MOVE "N"                    TO WA-TRAN-NO-MORE-FLAG.
S17755     MOVE WA-STORE-TXN-DT        TO WA-BOCT-TRN-DATE.
S17755     PERFORM W180-RETRIEVE-33  THRU W189-EXIT
S17755       UNTIL WA-TRAN-NO-MORE.
S17755
S17755     MOVE WS-BOCT-RECORD-AREA    TO BOCT-RECORD-AREA.
S17755 W179-EXIT.
S17755     EXIT.
S17755 W180-RETRIEVE-33.
S17755     MOVE BOCT-INST-NO        TO UTBOCTCA-INST-NO.
S17755     MOVE BOCT-ACCT-NO        TO UTBOCTCA-ACCT-NO.
S17755     MOVE BOCT-REC-NO         TO UTBOCTCA-REC-NO.
S17755     MOVE BOCT-TRN-DATE       TO UTBOCTCA-CALL-DATE.
S17755     MOVE 1                   TO UTBOCTCA-KEY-NO.
S17755     SET  UTBOCTCA-READNEXT   TO TRUE.
S17755     CALL "UTBOCT"         USING UTBOCTCA-CALL-AREA
S17755                                 BOCT-RECORD-AREA.
S17755
S17755     IF NOT UTBOCTCA-OK
S17755        MOVE "Y"                  TO WA-TRAN-NO-MORE-FLAG
S17755        GO TO W189-EXIT
S17755     END-IF.
S17755     IF BOCT-TRAN-TYPE         NOT = WS-BOCT-TRAN-TYPE
S17755        GO TO W189-EXIT
S17755     END-IF.
S17755     IF BOCT-TRN-DATE              < WA-BOCT-TRN-DATE
S17755        MOVE "Y"                  TO WA-TRAN-NO-MORE-FLAG
S17755        GO TO W189-EXIT
S17755     END-IF.
S17755
S17755     IF  (BOCT-JRNL-NO             = W800-CORR-JRNL-NO)
S17755     AND (WA-BOCT-TRN-DATE         = BOCT-33-AMEND-DATE)
S17755         NEXT SENTENCE
S17755     ELSE
S17755         GO TO W189-EXIT
S17755     END-IF.
S17755
S17755     MOVE 20                      TO BOCT-STAT
S17755     MOVE BOCT-INST-NO            TO UTBOCTCA-INST-NO
S17755     MOVE BOCT-ACCT-NO            TO UTBOCTCA-ACCT-NO
S17755     MOVE BOCT-REC-NO             TO UTBOCTCA-REC-NO
S17755     MOVE BOCT-POST-DATE          TO UTBOCTCA-CALL-DATE
S17755     SET  UTBOCTCA-REWRITE        TO TRUE
S17755     CALL "UTBOCT" USING UTBOCTCA-CALL-AREA
S17755                         BOCT-RECORD-AREA
S17755     IF NOT UTBOCTCA-OK
S17755        MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
S17755        MOVE SPACES TO UT8500CA-INPUT-MSG
S17755        STRING "BR0024:(W180) -BOCT WRITE ERROR "
S17755                    ", CALLCODE=" UTBOCTCA-CALL-CODE
S17755                    ", STATUS="   UTBOCTCA-STATUS
S17755                    ", CALLKEY="  UTBOCTCA-CALL-KEY
S17755             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
S17755        CALL "UT8500" USING
S17755                      UT8500CA-AREA
S17755        MOVE 1          TO WA-MSG-ERR-FLAG
S17755        MOVE 155        TO WA-OUTPUT-ERR-MSG-NO
S17755        MOVE "BOCT"     TO WA-DBERR-DATA-SET
S17755        MOVE UTBOCTCA-STATUS
S17755                             TO WA-DB-ERROR
S17755        GO TO W189-EXIT
S17755     END-IF.
S17755     MOVE "Y"                     TO WA-TRAN-NO-MORE-FLAG.
S17755 W189-EXIT.
S17755     EXIT.
047090 W200-FMT-SEND-PARA.
047100******************************************************************
047110* CALL THE TRACKING FACILITY CONTROL MODULE BEFORE CALL TO FT0000.
047120*
047130* FOR MULTI CURRENCY PROCESSING DON'T SEND OK MESSAGE YET LET
047140* BR0000 SEND THE MESSAGE AFTER VALIDATION.
047150*
047160**
047170** IF FULL MULTI-CURRENCY THEN THE OK IS SENT
047180** IN BR0000 AFTER THE CALL TO UT0460
047190**
047200** NOTE: THE ABOVE NOTE HAS NOW BEEN CHANGED
047210**       IRRESPECTIVE OF THE VALUE IN THE SOC-MULTI-CURRENCY
047220**       THE O.K. WILL BE SENT FROM BR0000
047230**
047240     IF STRT-AREA-ADVICE
047250*****    IF  WA-OUTPUT-ERR-MSG-NO NOT = 0 AND 994
047260         IF  WA-OUTPUT-ERR-MSG-NO NOT = 0 AND 994 AND 999
047270             GO TO W299-EXIT.
047280**   IF  SOC-MULTI-CURRENCY = "2"
047290         IF  WA-OUTPUT-ERR-MSG-NO = 0 OR 999 OR
047300         (WA-OUTPUT-ERR-MSG-NO = 997 AND
047310         STRT-AREA-IEXEC-CNTL = 2 OR 3 OR 6 OR 7)
047320                  MOVE WA-OUTPUT-ERR-MSG-NO
047330                               TO WA-UT0460-MSG-NO-N
047340                  GO TO W299-EXIT.

047360     IF STRT-AREA-OK-MSG-CNTL-FLAG NOT = SPACE
047370        IF (WA-OUTPUT-ERR-MSG-NO < 100 AND > 0) AND
047380           PBOOKCA-VALID-TYPE
047390           PERFORM W210-PB-LINE-SET-UP THRU W219-EXIT
047400           GO TO W299-EXIT.

047420     IF SOC-LOANS-TRACKING-OPTION = "Y" AND
047430        WA-INPUT-PARAM-TABLE(22) = 1
047440      IF  NOT  STRT-REPOST-TXN                                           
047450         CALL "BR0013" USING

047470               STARTAREA
047480         GO TO W299-EXIT
047490      END-IF                                                             
047500     END-IF.
047510     IF STRT-TRICKLE-TXN
047520        GO TO W299-EXIT
047530     ELSE
047540     IF STRT-AREA-BATCH-TANDEM = "T" OR                                  
047550        STRT-AREA-EFT-TXN                                                
047560        GO TO W299-EXIT                                                  
047570     ELSE                                                                
047580     CALL "FT0000" USING

047600               STARTAREA.
047610 W299-EXIT.
047620     EXIT.
047630/
047640 W210-PB-LINE-SET-UP.
047650     IF PBOOKCA-PB-PRINT
047660        ADD 1 TO PBOOKCA-LINE-CNT
047670        MOVE WA-OUTPUT-MESSAGE TO
047680             PBOOKCA-LINE-MSG (PBOOKCA-LINE-CNT)
047690     END-IF.
047700     IF PBOOKCA-CHQ-PRINT
047710        ADD 1 TO PBOOKCA-CHQ-CNT
047720        MOVE WA-OUTPUT-MESSAGE TO
047730             PBOOKCA-CHQ-MSG (PBOOKCA-CHQ-CNT)
047740     END-IF.
047750     IF PBOOKCA-RCPT-PRINT
047760        ADD 1 TO PBOOKCA-RCPT-CNT
047770        MOVE WA-OUTPUT-MESSAGE TO
047780             PBOOKCA-RCPT-MSG (PBOOKCA-RCPT-CNT)
047790     END-IF.
047800     MOVE SPACE TO PBOOKCA-PRINT-TYPE.
047810 W219-EXIT.
047820     EXIT.
047830/
047840 W300-READ-STOP-HOLD-TRAN.
NR2001*047850     MOVE 0 TO DBIO-CALL-REFER-AREA.
NR2001*NR0001     MOVE SPACES TO DBIO-CALL-SAVE-REFER.
NR2001*047860     MOVE "BOR" TO DBIO-CALL-SYS-AREA.
NR2001*047870     MOVE STRT-AREA-SOC-NO TO WA-BORM-SOC-NO.
NR2001*047880     MOVE WA-INPUT-KEY TO WA-BORM-ACCT-NO.
NR2001*047890     MOVE WA-BORM-KEY TO DBIO-CALL-KEY-AREA.
NR2001*047900     MOVE 07 TO DBIO-CALL-FUNC.
NR2001*047910 W370-READ-AGAIN.
NR2001*047920     CALL "DBIO" USING
NR2001*
NR2001*047940                       DBIO-CALL-PARAM
NR2001*047950                       DBIO-CALL-SYS-AREA
NR2001*047960                       DBIO-CALL-KEY-AREA
NR2001*047970                       DBIO-CALL-STATUS
NR2001*047980                       BORV-RECORD-AREA
NR2001*047990                       DBIO-CALL-REFER-AREA
NR2001*048000                       DBIO-CALL-TXN-TYPE-AREA.
NR2001*048010     IF DBIO-CALL-STATUS = "XCOT"
NR2001*048020        GO TO W399-EXIT.
NR2001*048030     IF DBIO-CALL-STATUS = "****"
NR2001*048040         ADD BORV-31-HOLD-VAL TO WA-HOLD-AMT
NR2001*048050         GO TO W370-READ-AGAIN.
NR2001*048060     IF DBIO-CALL-STATUS NOT = "XCOT"
NR2001*048070        MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
NR2001*048080        MOVE SPACES TO UT8500CA-INPUT-MSG
NR2001*048090        STRING "BR0024:(W300) PROBLEM WHILE READING BORV "
NR2001*048100                WA-INPUT-KEY
NR2001*048110            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
NR2001*048120        CALL "UT8500" USING
NR2001*
NR2001*048140                            UT8500CA-AREA
NR2001*048150        MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
NR2001*048160        MOVE SPACES TO UT8500CA-INPUT-MSG
NR2001*048170        STRING DBIO-CALL-STATUS
NR2001*048180            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
NR2001*048190        CALL "UT8500" USING
NR2001*
NR2001*048210                            UT8500CA-AREA
NR2001*048220        MOVE DBIO-CALL-STATUS TO WA-DB-ERROR
NR2001*048230        MOVE "BORV" TO WA-DBERR-DATA-SET
NR2001     INITIALIZE UTBOCTCA-CALL-AREA.
NR2001     MOVE STRT-AREA-SOC-NO  TO BOCT-INST-NO.
NR2001     MOVE WA-INPUT-KEY      TO BOCT-ACCT-NO.
NR2001     MOVE 0                 TO BOCT-REC-NO.
NR2001     MOVE 999999999         TO BOCT-TRN-DATE.
NR2001     MOVE 1                 TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT TO TRUE.
NR2001     MOVE 31                TO WS-BOCT-TRAN-TYPE.
NR2001 W370-READ-AGAIN.
NR2001     MOVE BOCT-INST-NO        TO UTBOCTCA-INST-NO.
NR2001     MOVE BOCT-ACCT-NO        TO UTBOCTCA-ACCT-NO.
NR2001     MOVE BOCT-REC-NO         TO UTBOCTCA-REC-NO.
NR2001     MOVE BOCT-TRN-DATE       TO UTBOCTCA-CALL-DATE.
NR2001     MOVE 1                   TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT   TO TRUE.
NR2001     CALL "UTBOCT"         USING UTBOCTCA-CALL-AREA
NR2001                                 BOCT-RECORD-AREA.
NR2001     IF UTBOCTCA-EOF
NR2001        GO TO W399-EXIT.
NR2001     IF BOCT-TRAN-TYPE NOT = WS-BOCT-TRAN-TYPE
NR2001        GO TO W370-READ-AGAIN.
NR2001     IF UTBOCTCA-OK
NR2001        ADD BOCT-31-HOLD-VAL TO WA-HOLD-AMT
NR2001        GO TO W370-READ-AGAIN.
NR2001     IF NOT UTBOCTCA-EOF
NR2001        MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
NR2001        MOVE SPACES TO UT8500CA-INPUT-MSG
NR2001        STRING "BR0024:(W300) PROBLEM WHILE READING BOCT "
NR2001               ", CALLCODE=" UTBOCTCA-CALL-CODE
NR2001               ", STATUS="   UTBOCTCA-STATUS
NR2001               ", CALLKEY="  UTBOCTCA-CALL-KEY
NR2001            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
NR2001        CALL "UT8500" USING
NR2001                            UT8500CA-AREA
NR2001        MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
NR2001        MOVE SPACES TO UT8500CA-INPUT-MSG
NR2001        STRING UTBOCTCA-STATUS
NR2001            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
NR2001        CALL "UT8500" USING
NR2001                            UT8500CA-AREA
NR2001        MOVE UTBOCTCA-STATUS TO WA-DB-ERROR
NR2001        MOVE "BOCT" TO WA-DBERR-DATA-SET
048240        MOVE 155 TO WA-OUTPUT-ERR-MSG-NO
048250        MOVE 1 TO WA-MSG-ERR-FLAG.
048260 W399-EXIT.
048270     EXIT.
048280 W500-ADD-TXN.
NR2001*048290     IF  BORV-01-CODE = 01 AND
NR2001*048300         STRT-AREA-EFT-TXN
NR2001*S11455         MOVE X"64"            TO BORV-01-DAYFILE  
NR2001*S11455*        MOVE X"64"            TO BORV-01-DAYFILE. 
NR2001*S11455     ELSE                                          
NR2001*S11455         MOVE SPACES           TO BORV-01-DAYFILE  
NR2001*S11455     END-IF.                                       
NR2001*S11455     IF  (WA-ADV-AMORT-FLAG = "S" OR               
NR2001*S11455          WA-ADV-AMORT-FLAG = "F")                 
NR2001*S11455     AND BORP-YOUBE                                
NR2001*S11455         MOVE WA-ADV-AMORT-FLAG  TO BORV-01-DAYFILE
NR2001*S11455     END-IF.                                       
NR2001*048320     MOVE 12                     TO DBIO-CALL-FUNC.
NR2001*048330     MOVE "BOR"                  TO DBIO-CALL-SYS-AREA.
NR2001*048340     MOVE STRT-AREA-SOC-NO       TO WA-BORM-SOC-NO.
NR2001*048350     MOVE BORM-MEMB-CUST-AC      TO WA-BORM-ACCT-NO.
NR2001*048360     MOVE WA-BORM-KEY            TO DBIO-CALL-KEY-AREA.
NR2001*048370     MOVE SPACES                 TO DBIO-CALL-STATUS.
NR2001*048380     MOVE 0                      TO DBIO-CALL-REFER-AREA.
NR2001*048390     CALL "DBIO" USING
NR2001*
NR2001*048410                                 DBIO-CALL-PARAM
NR2001*048420                                 DBIO-CALL-SYS-AREA
NR2001*048430                                 DBIO-CALL-KEY-AREA
NR2001*048440                                 DBIO-CALL-STATUS
NR2001*048450                                 BORV-RECORD-AREA
NR2001*048460                                 DBIO-CALL-REFER-AREA.
NR2001*048470     IF  DBIO-CALL-STATUS NOT = "****"
NR2001*048480         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
NR2001*048490           TO UT8500CA-CALL-CODE
NR2001*048500         MOVE SPACES TO UT8500CA-INPUT-MSG
NR2001*048510         STRING "BR0024:(W500)  "
NR2001*048520                " PROBLEM WHILE ADDING TXN"
NR2001*048530                 DBIO-CALL-KEY-AREA " " DBIO-CALL-STATUS
NR2001*048540                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
NR2001*048550         CALL "UT8500" USING
NR2001*
NR2001*048570             UT8500CA-AREA
NR2001*048580         MOVE DBIO-CALL-STATUS TO WA-DB-ERROR
NR2001*048590         MOVE "BORM" TO WA-DBERR-DATA-SET
NR2001*048600         MOVE 155                 TO WA-OUTPUT-ERR-MSG-NO
NR2001*048610*        MOVE 1 TO WA-MSG-ERR-FLAG.                                      
NR2001*048620*W599-EXIT.                                                              
NR2001*048630*    EXIT.                                                               
NR2001*048640         MOVE 1 TO WA-MSG-ERR-FLAG                                       
NR2001*048650         GO TO W599-EXIT.                                                
NR2001*048660*
NR2001*048670*** IF A FINANCIAL TXN CHANGED ACCOUNT BALANCE, THEN CALL MI0095 T 
NR2001*048680*** POPULATE REFRESH TXN TABLE.
NR2001*048690*
NR2001*048700     IF  WA-INPUT-PARAM-TABLE (23) = 0                                   
NR2001*048710     AND BORV-FINANCIAL-TRANSACTION                                      
NR2001     IF  BOCT-TRAN-TYPE = 01
NR2001         IF  BOCT-TRAN-TYPE = 01 AND
NR2001             STRT-AREA-EFT-TXN
NR2001             MOVE X"64"            TO BOCT-01-DAYFILE
NR2001         ELSE
NR2001             MOVE SPACES           TO BOCT-01-DAYFILE
NR2001         END-IF
NR2001         IF  (WA-ADV-AMORT-FLAG = "S" OR
NR2001              WA-ADV-AMORT-FLAG = "F")
NR2001         AND BORP-YOUBE
NR2001             MOVE WA-ADV-AMORT-FLAG  TO BOCT-01-DAYFILE
NR2001         END-IF
NR2001     END-IF.
NR2001     INITIALIZE UTBOCTCA-CALL-AREA.
NR2001     MOVE STRT-AREA-SOC-NO     TO UTBOCTCA-INST-NO.
NR2001     MOVE BORM-MEMB-CUST-AC    TO UTBOCTCA-ACCT-NO.
NR2001     SET  UTBOCTCA-WRITE       TO TRUE.
NR2001     CALL "UTBOCT" USING UTBOCTCA-CALL-AREA
NR2001                         BOCT-RECORD-AREA.
NR2001     IF  NOT UTBOCTCA-OK
NR2001         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
NR2001           TO UT8500CA-CALL-CODE
NR2001         MOVE SPACES TO UT8500CA-INPUT-MSG
NR2001         STRING "BR0024:(W500)  "
NR2001                " PROBLEM WHILE ADDING TXN"
NR2001                ", CALLCODE=" UTBOCTCA-CALL-CODE
NR2001                ", STATUS="   UTBOCTCA-STATUS
NR2001                ", CALLKEY="  UTBOCTCA-CALL-KEY
NR2001                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
NR2001         CALL "UT8500" USING
NR2001             UT8500CA-AREA
NR2001         MOVE UTBOCTCA-STATUS TO WA-DB-ERROR
NR2001         MOVE "BOCT" TO WA-DBERR-DATA-SET
NR2001         MOVE 155                 TO WA-OUTPUT-ERR-MSG-NO
NR2001         MOVE 1 TO WA-MSG-ERR-FLAG                                       
NR2001         GO TO W599-EXIT.                                                
NR2001*
NR2001*** IF A FINANCIAL TXN CHANGED ACCOUNT BALANCE, THEN CALL MI0095 T 
NR2001*** POPULATE REFRESH TXN TABLE.
NR2001*
NR2001     IF  WA-INPUT-PARAM-TABLE (23) = 0                                   
NR2001     AND BOCT-FINANCIAL-TRANSACTION                                      
048720         MOVE 1   TO MI0095CA-CALL-CODE                                  
048730         MOVE 0   TO MI0095CA-FUNC                                       
048740         MOVE "L" TO MI0095CA-SYSTEM                                     
048750         PERFORM U000-CALL-MI0095 THRU U099-EXIT
048760     END-IF.                                                             
048770 W599-EXIT.                                                              
048780     EXIT.                                                               
048790/
048800 W800-CREAT-BLDVAA.
048810     MOVE 62 TO DBIO-CALL-FUNC.
048820     MOVE "BORM" TO DBIO-CALL-N-SYS.
048830     MOVE "BLDV" TO DBIO-CALL-SYST-VAR.
048840     MOVE BORM-MEMB-CUST-AC TO WA-BORM-ACCT-NO.
048850     MOVE STRT-AREA-SOC-NO TO WA-BORM-SOC-NO.
048860     MOVE WA-BORM-KEY TO DBIO-CALL-KEY-AREA.
048870     MOVE 0 TO DBIO-CALL-REFER-AREA.
048880     MOVE SPACES TO DBIO-CALL-STATUS.
048890     CALL "DBIO" USING

048910                       DBIO-CALL-PARAM
048920                       DBIO-CALL-SYS-AREA
048930                       DBIO-CALL-KEY-AREA
048940                       DBIO-CALL-STATUS
048950                       WA-BLDV-AREA-AA
048960                       DBIO-CALL-REFER-AREA
048970                       DBIO-CALL-TXN-TYPE-AREA.
048980     IF  DBIO-CALL-STATUS NOT = "****"
048990         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
049000           TO UT8500CA-CALL-CODE
049010         MOVE SPACES TO UT8500CA-INPUT-MSG
049020         STRING "BR0024:(W800)  "
049030                " PROBLEM WHILE ADDING TO BLDV AA "
049040                 DBIO-CALL-KEY-AREA " " DBIO-CALL-STATUS
049050                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
049060         CALL "UT8500" USING

049080             UT8500CA-AREA
049090         MOVE DBIO-CALL-STATUS TO WA-DB-ERROR
049100         MOVE "BLDV" TO WA-DBERR-DATA-SET
049110         MOVE 155                 TO WA-OUTPUT-ERR-MSG-NO
049120         MOVE 1 TO WA-MSG-ERR-FLAG.
049130 W809-EXIT.
049140     EXIT.
049150 W810-CREAT-BLDVBB.
049160     MOVE 62 TO DBIO-CALL-FUNC.
049170     MOVE "BORM" TO DBIO-CALL-N-SYS.
049180     MOVE "BLDV" TO DBIO-CALL-SYST-VAR.
049190     MOVE BORM-MEMB-CUST-AC TO WA-BORM-ACCT-NO.
049200     MOVE STRT-AREA-SOC-NO TO WA-BORM-SOC-NO.
049210     MOVE WA-BORM-KEY TO DBIO-CALL-KEY-AREA.
049220     MOVE SPACES TO DBIO-CALL-STATUS.
049230     MOVE 0 TO DBIO-CALL-REFER-AREA.
049240     CALL "DBIO" USING

049260                       DBIO-CALL-PARAM
049270                       DBIO-CALL-SYS-AREA
049280                       DBIO-CALL-KEY-AREA
049290                       DBIO-CALL-STATUS
049300                       WA-BLDV-AREA-BB
049310                       DBIO-CALL-REFER-AREA
049320                       DBIO-CALL-TXN-TYPE-AREA.
049330     IF  DBIO-CALL-STATUS NOT = "****"
049340         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
049350           TO UT8500CA-CALL-CODE
049360         MOVE SPACES TO UT8500CA-INPUT-MSG
049370         STRING "BR0024:(W810)  "
049380                " PROBLEM WHILE ADDING TO BLDV BB "
049390                 DBIO-CALL-KEY-AREA " " DBIO-CALL-STATUS
049400                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
049410         CALL "UT8500" USING

049430             UT8500CA-AREA
049440         MOVE DBIO-CALL-STATUS TO WA-DB-ERROR
049450         MOVE "BLDV" TO WA-DBERR-DATA-SET
049460         MOVE 155                 TO WA-OUTPUT-ERR-MSG-NO
049470         MOVE 1 TO WA-MSG-ERR-FLAG.
049480 W819-EXIT.
049490     EXIT.
049500/
049510 W900-SET-ADD-DUES-DTE.
049520     IF BORP-START-METH = 01 OR 02 OR 06
049530         GO TO W909-EXIT.
049540     IF BORP-START-METH = 00 OR 05
049550         IF BORM-ADD-LOAN-ADV NOT = BORM-ADD-LOAN-APP
049560             MOVE ZEROES TO BORM-ADD-DUES-STRT-DATE
049570             GO TO W909-EXIT.
049580     IF BORP-START-METH = 03
049590         IF BORM-ADD-LOAN-ADV > WA-DUMMY-AMT
049600             GO TO W909-EXIT.
049610     IF BORP-START-METH = 04
049620         DIVIDE BORM-ADD-LOAN-APP BY 2 GIVING WA-50PC-ADV
049630         IF (BORM-ADD-LOAN-ADV - WA-DUMMY-AMT < WA-50PC-ADV) AND
049640            (BORM-ADD-LOAN-ADV > WA-50PC-ADV)
049650             NEXT SENTENCE
049660         ELSE
049670             GO TO W909-EXIT.
SC0941****START-FAD
           IF  ( STRT-AREA-TRN-NO = 16055 ) AND
               ( WA-INPUT-PARAM-TABLE(8) = 1 )
               PERFORM Z700-CHK-TXNDT THRU Z709-EXIT
               IF  WS-ERR-Y
015500             MOVE 1 TO WA-MSG-ERR-FLAG
015510             MOVE 3360 TO WA-OUTPUT-ERR-MSG-NO
                   GO TO W909-EXIT
               END-IF
           END-IF.
SC0941****END-FAD
049680     IF  WA-INPUT-PARAM-TABLE(8) = 1
049690         MOVE WA-ADV-TXN-DATE TO WA-TRN-DATE
049700     ELSE MOVE STRT-AREA-POST-DT TO UT0020-BINARY-DATE
049710          MOVE 1 TO UT0020-FUNCTION
049720          PERFORM X100-UT0020-PARA THRU X109-EXIT
049730          MOVE UT0020-DATE-DDMMCCYY TO WA-TRN-DATE.
049740*
049750     IF  BORM-GROUP > 1
049760         IF  BORM-GROUP NOT = 50
049770             MOVE 20 TO WA-TRN-DD.
049780     MOVE WA-TRN-DATE TO UT0030-DATE-DDMMCCYY.
049790     PERFORM X200-UT0030-PARA THRU X209-EXIT.
049800     IF  UT0030-BINARY-DATE = ZEROES
049810         MOVE 126 TO WA-OUTPUT-ERR-MSG-NO
049820         MOVE 1 TO WA-MSG-ERR-FLAG.
049830     MOVE UT0030-BINARY-DATE TO BORM-ADD-DUES-STRT-DATE.
049840 W909-EXIT.
049850     EXIT.
049860/
049870 W1000-CHECK-LIMITS.
049880* RETREIVE FACILITY NUMBER
049890     INITIALIZE ACFR-KEY.
049900     MOVE STRT-AREA-SOC-NO  TO ACFR-SOC-NO.
049910     MOVE "BOR"             TO ACFR-SYSTEM.
049920     MOVE BORM-MEMB-CUST-AC TO ACFR-ACCT-NO.
049930     MOVE 71                TO DBIO-CALL-FUNC.
049940     MOVE ACFR-KEY          TO DBIO-CALL-KEY-AREA.
049950     MOVE "ACFR    "        TO DBIO-CALL-SYS-AREA.
049960     MOVE SPACES            TO DBIO-CALL-STATUS.
049970     CALL "DBIO" USING

049990                       DBIO-CALL-PARAM
050000                       DBIO-CALL-SYS-AREA
050010                       DBIO-CALL-KEY-AREA
050020                       DBIO-CALL-STATUS
050030                       ACFR-AREA
050040                       DBIO-CALL-REFER-AREA.
050050     IF DBIO-CALL-STATUS = "MRNF"
050060        GO TO W1099-EXIT.
050070     IF DBIO-CALL-STATUS NOT = "****"
050080        MOVE 155                          TO WA-OUTPUT-ERR-MSG-NO
050090        MOVE DBIO-CALL-N-SYS              TO WA-DBERR-DATA-SET
050100        MOVE DBIO-CALL-STATUS             TO WA-DB-ERROR
050110        MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
050120        MOVE SPACES                       TO UT8500CA-INPUT-MSG
050130        STRING "BR0024:(W1000) 'ACFR' READ ERROR, STAT- "
050140                DBIO-CALL-STATUS ", KEY- "
050150                DBIO-CALL-KEY-AREA
050160            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
050170        CALL "UT8500" USING

050190                            UT8500CA-AREA
050200        MOVE 1 TO WA-MSG-ERR-FLAG
050210        GO TO W1099-EXIT
050220     END-IF.
050230*     IF DBIO-CALL-SAVE-REFER = "END." OR
050240*        ACFR-ACCT-NO NOT = BORM-MEMB-CUST-AC
050250* NO FACILITY CONNECTED TO ACCOUNT, THEREFORE NO LIMIT UPDATE
050260* TO BE DONE
050270*       MOVE 1702 TO WA-OUTPUT-ERR-MSG-NO
050280*       MOVE 1    TO WA-MSG-ERR-FLAG
050290*        GO TO W1099-EXIT
050300*     END-IF.

050320* RETREIVE FACILITY AND ACCOUNT RELATIONSHIP
050330*    MOVE 2                TO UT0671CA-CALL-CODE.
050340*    MOVE 1                TO UT0671CA-CALL-INDEX.
050350*    MOVE STRT-AREA-SOC-NO TO UT0671CA-CALL-SOC-NO.
050360*    MOVE "BOR"            TO UT0671CA-CALL-SYSTEM.
050370*    MOVE BORM-ACT-TYPE    TO UT0671CA-CALL-ACCT-TYPE.
050380*    MOVE BORM-CAT         TO UT0671CA-CALL-INT-CAT.
050390*    MOVE 0                TO UT0671CA-CALL-PURPOSE-CD.
050400*    CALL "UT0671" USING
050410*
050420*                        UT0671CA-CALL-AREA.
050430*    IF UT0671CA-CALL-STATUS NOT = "****"
050440*       MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
050450*       MOVE SPACES                       TO UT8500CA-INPUT-MSG
050460*       STRING "BR0024:(W1000) CALL TO UT0671 ERROR, STAT- "
050470*               UT0671CA-CALL-STATUS ", KEY- "
050480*               UT0671CA-CALL-KEY
050490*           DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
050500*       CALL "UT8500" USING
050510*
050520*                           UT8500CA-AREA
050530*       MOVE 1709 TO WA-OUTPUT-ERR-MSG-NO
050540*       MOVE 1    TO WA-MSG-ERR-FLAG
050550*       GO TO W1099-EXIT
050560*    END-IF.

050580*    MOVE 0                   TO UT0680CA-CALL-STATUS.
050590*    MOVE "LON"               TO UT0680CA-SYSTEM.
050600*    MOVE BORM-CUSTOMER-NO    TO UT0680CA-CUSTOMER-NO.
050610*    MOVE ACFR-FACILITY-NO    TO UT0680CA-FACILITY-NO.
050620*    MOVE WA-DUMMY-AMT        TO UT0680CA-AMOUNT.
050630*    MOVE BORM-CURRENCY-IND   TO UT0680CA-CURRENCY.
050640*    MOVE FACR-DRAWDOWN-CHECK TO UT0680CA-DRAWDOWN-CHECK.
050650*    CALL "UT0680" USING
050660*
050670*                        UT0680CA-CALL-AREA
050680*                        STARTAREA.
050690*    IF UT0680CA-CALL-STATUS NOT = 0
050700*       MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
050710*       MOVE SPACES                       TO UT8500CA-INPUT-MSG
050720*       STRING "BR0024:(W1000) CALL TO UT0680 ERROR, STAT- "
050730*               UT0680CA-CALL-STATUS
050740*           DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
050750*       CALL "UT8500" USING
050760*
050770*                           UT8500CA-AREA
050780*       MOVE UT0680CA-CALL-STATUS TO WA-OUTPUT-ERR-MSG-NO
050790*       MOVE 1                    TO WA-MSG-ERR-FLAG
050800*       GO TO W1099-EXIT
050810*    END-IF.
050820*
050830 W1099-EXIT.
050840     EXIT.
050850*
050860*
050870/
050880 X100-UT0020-PARA.
050890*-----------------
050900     CALL "UT0020" USING
050910                         UT0020-FUNCTION
050920                         UT0020-DATE-AREA
050930                         UT0020-BINARY-DATE.
050940*
050950 X109-EXIT.
050960*----------
050970     EXIT.
050980 X200-UT0030-PARA.
050990*-----------------
051000*
051010     MOVE 1 TO UT0030-FUNCTION.
051020     CALL "UT0030" USING
051030                         UT0030-FUNCTION
051040                         UT0030-DATE-AREA
051050                         UT0030-BINARY-DATE.
051060*
051070 X209-EXIT.
051080      EXIT.
051090*
051100 X300-FORMAT-SORD-START.
051110*-----------------------
051120*
051130     MOVE STARTAREA TO WA-IN0014-PASSALONG.
SC3310     INITIALIZE IN0014-INPUT-MESSAGE.
SC3310     MOVE BOIS-SORD-AUTO-DBT-ACCT-NO
SC3310                            TO IN0014-INPUT-ACCT-NO.
SC3310     MOVE BORM-MEMB-CUST-AC  TO IN0014-INPUT-RECACC-NO.
SC3310     MOVE "LON"              TO IN0014-INPUT-REC-SYS.
SC3310     MOVE BORM-DUE-AMT       TO IN0014-INPUT-AMOUNT.
051140     MOVE 10907 TO IN0014-TRN-NO.
TB0104******************************************************************
TB0104*    next two lines of code transferred from B010-CONT
TB0104*    next lines after that indented for readability
TB0104*** 03/03/03 - commented out condition BORM-REPAY-IN-AFFECT = Y   
TB0104*** to allow partially advanced loans with standing orders to be 
TB0104*** activated in UT0014.
TB0104******************************************************************
TB0104*    IF  BORM-REPAY-IN-AFFECT NOT = "Y"
TB0104*        IF  BORM-STAT = 8
SC6302     IF BORM-REPAY-IN-AFFECT = "Y"
SC9737        AND WA-INPUT-PARAM-TABLE(7) = 0
SC6302*SC9737  GO TO X399-EXIT.
SC9737         GO TO X399-EXIT
SC9737     ELSE
SC9737        MOVE ZEROES TO WA-AFTER-BORM-CORR
SC9737        COMPUTE WA-AFTER-BORM-CORR = WA-BEFORE-BORM-ADV-VAL -
SC9737                                     WA-INPUT-AMT
SC9737        IF (WA-INPUT-PARAM-TABLE(7) = 1
SC9737           AND BORM-REPAY-IN-AFFECT = "Y"
SC9737           AND WA-AFTER-BORM-CORR <= 0) OR
SC9737           (BORM-REPAY-IN-AFFECT = SPACE OR "N")
SC9737           NEXT SENTENCE
SC9737        ELSE
SC9737           GO TO X399-EXIT
SC9737        END-IF
SC9737     END-IF.
TB0104         IF  BORM-STAT > 5
TB0104         AND BORM-STAT < 10
051150             MOVE 0     TO WA-IN0014-CALL-CODE
SC0941****START-FAD
                 IF  ( STRT-AREA-TRN-NO = 16055 ) AND
                     ( WA-INPUT-PARAM-TABLE(8) = 1 )
                   PERFORM Z700-CHK-TXNDT THRU Z709-EXIT
                   IF  WS-ERR-Y
015500               MOVE 1 TO WA-MSG-ERR-FLAG
015510               MOVE 3360 TO WA-OUTPUT-ERR-MSG-NO
015520               GO TO X399-EXIT
                   END-IF
                 END-IF
SC0941****END-FAD
SC5264*            IF  WA-INPUT-PARAM-TABLE(8) = 1
SC5264                 MOVE WA-ADV-TXN-DATE
SC3211*                       TO IN0014-INPUT-START-DATE
SC5264                        TO IN0014-INPUT-ADV-DATE
SC5264*            END-IF
051190                 MOVE STRT-AREA-POST-DT
                              TO UT0020-BINARY-DATE
051200                 MOVE 1 TO UT0020-FUNCTION
051210                 PERFORM X100-UT0020-PARA THRU X109-EXIT
TB0104                 IF SOC-SITE-TIB
TB0104                 AND BOIS-SORD-AUTO-DBT-ACCT-NO NOT = 0
SC1505                 AND BORM-REPAY-DAY NOT = 0
TB0104                 AND UT0020-DATE-DD NOT = BORM-REPAY-DAY
TB0104                    MOVE BORM-REPAY-DAY TO UT0020-DATE-DD
SC2560                 ELSE
SC2560                    IF BORP-REPAY-DAY NOT = 0
SC2560                       MOVE BORP-REPAY-DAY TO UT0020-DATE-DD
SC2560                    END-IF
TB0104                 END-IF
051220                 MOVE UT0020-DATE-DDMMCCYY
                              TO IN0014-INPUT-START-DATE
S10467                                                                  
S10467                 IF (IN0014-INPUT-ADV-MM < UT0020-DATE-MM         
S10467                  AND IN0014-INPUT-ADV-CCYY = UT0020-DATE-CCYY)   
S10467                  OR IN0014-INPUT-ADV-CCYY < UT0020-DATE-CCYY     
S10467                    MOVE BOIS-NEXT-DUE-DATE TO UT0020-BINARY-DATE 
S10467                    MOVE 1 TO UT0020-FUNCTION                     
S10467                    PERFORM X100-UT0020-PARA                      
S10467                       THRU X109-EXIT                             
S10467                    MOVE UT0020-DATE-DDMMCCYY                     
S10467                                        TO IN0014-INPUT-START-DATE
S10467                 END-IF                                           
SC3211*            END-IF
TB0104*
TB0104             IF SOC-SITE-TIB
TB0104                 MOVE BOIS-MATURITY-DATE TO IN0014-INPUT-TDATE
TB0104             END-IF
TB0104         END-IF.
TB0104*    ELSE
TB0104         IF SOC-SITE-TIB
TB0104         IF  WA-INPUT-PARAM-TABLE(7) = 1
TB0104         AND BORM-STAT = 1
TB0104            MOVE 0     TO WA-IN0014-CALL-CODE
TB0104            MOVE 0     TO IN0014-INPUT-START-DATE
TB0104            MOVE BORM-REPAY-DAY TO UT0020-DATE-DD
TB0104         END-IF.
TB0104*
051230     CALL "UT0014" USING

051250             WA-IN0014-PASSALONG
051260             WA-IN0014-CALL-CODE.
SC1371     IF  IN0014-STATUS-LEVEL-1 NOT = ZEROES
051270**   IF  IN0014-STATUS-LEVEL-1 NOT = 0
051280         MOVE 0 TO IN0014-STATUS-LEVEL-1
051290         MOVE 1 TO WA-MSG-ERR-FLAG.
051300     MOVE IN0014-OUTPUT-MESSAGE TO WA-OUTPUT-MESSAGE.
051310     MOVE IN0014-BORM-RECORD-AREA TO BORM-RECORD-AREA.
051320*
051330 X399-EXIT.
051340*----------
051350     EXIT.
051360*
051370 X400-CALL-UT0500.
051380     MOVE 1                TO UT0500CA-CALL-CODE.
051390     MOVE STRT-AREA-SOC-NO TO UT0500CA-INST-NO.
051400     MOVE BORM-BR-NO       TO UT0500CA-BRHM-NO.
051410     MOVE STRT-AREA-TELLER-LANG TO UT0500RA-LANGUAGE-CODE.
051420     MOVE SOC-LANGUAGE-CODE     TO UT0500CA-INST-LANGUAGE-CODE.
051430     CALL "UT0500" USING

051450             UT0500-CALL-PARAM.
051460 X499-EXIT.
051470     EXIT.
051480/
051490 X500-GET-RATE.
TB0069**---net rate used shld always be the latest
TB0069**---if BOIS-EFR-CHNG-IND = "1" eff float on next due date
TB0069**---and not yet due date, use current BORM-STORE-RATE
TB0069***---access bldvni table for the initial rates of a combi nego acct
TB0069**
TB0069     MOVE ZEROES TO WA-TEMP-INT-RATE
TB0069                    WA-TEMP-RT-INCR.
TB0069     MOVE SPACES TO WA-TEMP-NI-FLAG.
TB0069**
TB0069     IF  BOIS-NEGO-RATE-IND = "2"
TB0069     AND BORM-INT-RATE = 0
TB0069     AND BORM-RT-INCR  = 0
TB0069     AND BOIS-NEGO-RATE-FLAG = SPACES
TB0069         PERFORM Z4000-READ-BLDVNI THRU Z4999-EXIT
TB0069         IF WA-MSG-ERR-FLAG = 1
TB0069            GO TO X509-EXIT
TB0069         END-IF
S16668*TB0069         IF BLDV-NI-RATE-FLAG (1) = "2"
S16668         IF BLDV-NI-RATE-FLAG (1) = "2" OR "3"
TB0069            MOVE BLDV-NI-RATE (1) TO WA-TEMP-RT-INCR
S16064          IF  BOIS-EFR-CHNG-IND NOT = "1"
SC6586            MOVE 0                TO BOIS-EFR-CHNG-IND
S16064          END-IF
TB0069         ELSE
TB0069            MOVE BLDV-NI-RATE (1) TO WA-TEMP-INT-RATE
S16064          IF  BOIS-EFR-CHNG-IND NOT = "1"
SC6586            MOVE SPACES           TO BOIS-EFR-CHNG-IND
S16064          END-IF
TB0069         END-IF
TB0069         MOVE BLDV-NI-RATE-FLAG (1)  TO WA-TEMP-NI-FLAG
TB0069         IF  (WA-TEMP-INT-RATE = ZEROES)
TB0069         AND (WA-TEMP-NI-FLAG <> "3")
TB0069           MOVE 0                TO WA-TIER-LEVEL
TB0069           MOVE BORP-TIER-METH   TO WA-TIER-METHOD
TB0069           IF BORP-BASM-BASE-ID  =  SPACES
TB0069           OR BORP-BASM-RATE-ID  =  SPACES
TB0069              MOVE 0             TO WA-INT-RATE-A
TB0069           ELSE
TB0069              PERFORM X520-SEARCH-RATE-TABLE
TB0069                THRU  X529-EXIT
TB0069           END-IF
TB0069         ELSE
TB0069           MOVE WA-TEMP-INT-RATE TO WA-INT-RATE-A
TB0069         END-IF
TB0069         ADD WA-TEMP-RT-INCR     TO WA-INT-RATE-A
TB0069         GO  TO X509-EXIT
TB0069     END-IF.
TB0069**
S16275*TB0069     IF  BOIS-EFR-CHNG-IND  = "1"
S16275*TB0069     AND BOIS-NEXT-DUE-DATE <> STRT-AREA-POST-DT
S16275*TB0069         MOVE BORM-STORE-RATE  TO WA-INT-RATE-A
S16275*TB0069         GO   TO X509-EXIT
S16275*TB0069     END-IF.
TB0069**
051500     IF BORM-INT-RATE = 0
TB0069     AND (BOIS-NEGO-RATE-IND = "0"
TB0069          OR (BOIS-NEGO-RATE-IND = "2"
TB0069              AND BOIS-NI-FLOAT))
051510        MOVE 0     TO WA-TIER-LEVEL
051520        MOVE BORP-TIER-METH   TO WA-TIER-METHOD
051530        IF BORP-BASM-BASE-ID = SPACES
051540        OR BORP-BASM-RATE-ID = SPACES
051550            MOVE 0            TO WA-INT-RATE-A
051560*           PERFORM X510-FIND-RATE THRU X519-EXIT
051570        ELSE
051580            PERFORM X520-SEARCH-RATE-TABLE THRU X529-EXIT
051590     ELSE
051600        MOVE BORM-INT-RATE TO WA-INT-RATE-A.
051610     ADD BORM-RT-INCR TO WA-INT-RATE-A.
051620 X509-EXIT.
051630      EXIT.
051640*
051650*X510-FIND-RATE.
051660*    ADD 1                       TO WA-TIER-LEVEL.
051670*    IF WA-TIER-METH-1 = 1
051680*        GO TO X511
051690*    ELSE
051700*    IF WA-TIER-METH-1 = 2
051710*        GO TO X511
051720*    ELSE
051730*        MOVE 0                  TO WA-INT-RATE-A
051740*        GO TO X519-EXIT.
051750*X511.
051760*    SET BORP-I                  TO WA-TIER-LEVEL.
051770*    IF (BORP-RT-MAX-BAL(BORP-I) < BORM-LOAN-BAL) AND
051780*       (WA-TIER-LEVEL < 5)
051790*        ADD 1                   TO WA-TIER-LEVEL
051800*        GO TO X511.
051810*X520.
051820*    MOVE 10                     TO WA-TIER-SUB.
051830*X522.
051840*    IF WA-TIER-SUB = 0
051850*        MOVE 0                  TO WA-INT-RATE-A
051860*        GO TO X519-EXIT.
051870*    SET BORP-J                  TO WA-TIER-SUB.
051880*    IF BORP-RT-DT(BORP-I BORP-J) = ZEROES
051890*        SUBTRACT 1              FROM WA-TIER-SUB
051900*        GO TO X522.
051910*    IF BORP-RT-DT(BORP-I BORP-J) > WA-DMY
051920*        SUBTRACT 1              FROM WA-TIER-SUB
051930*        GO TO X522.
051940*    SET BORP-K                  TO BORP-J.
051950*    MOVE BORP-RATE(BORP-I BORP-K)
051960*                                TO WA-INT-RATE-A.
051970*X519-EXIT.
051980*    EXIT.

052000 X520-SEARCH-RATE-TABLE.
052010**** USE CALL CODE 2 AND 3 IF SEARCH MEMORY
052020     MOVE BORP-SOC-NO    TO UT0298CA-CALL-SOC-NO
052030     MOVE BORP-ACCT-TYPE TO UT0298CA-CALL-ACCT-TYPE
052040     MOVE BORP-INT-CAT   TO UT0298CA-CALL-INT-CAT
052050     MOVE BORP-BASM-BASE-ID TO UT0298CA-CALL-BASE-ID
052060     MOVE BORP-BASM-RATE-ID TO UT0298CA-CALL-RATE-ID
052070     MOVE "BOR"          TO UT0298CA-CALL-SYS
052080     IF BORP-TIER-GROUP-ID = SPACES
052090         MOVE 2 TO UT0298CA-CALL-CODE
052100     ELSE
052110         MOVE 3 TO UT0298CA-CALL-CODE
052120         MOVE BORP-TIER-GROUP-ID TO UT0298CA-CALL-TIER-ID
052130         MOVE SPACES        TO UT0298CA-CALL-TIER-RATE-ID
052140         MOVE SPACES        TO UT0298CA-ACCT-TIER-ID
052150         MOVE BORM-LOAN-BAL TO UT0298CA-CALL-TIER-MAX-VAL
052160     END-IF.
052170*** USE CALL CODE 4 AND 5 TO SEARCH DB FILE (NOT SHAREMEM OR WS)
052180**** MOVE BORP-SOC-NO        TO UT0298CA-CALL-SOC-NO
052190**** MOVE BORP-BASM-BASE-ID  TO UT0298CA-CALL-BASE-ID
052200**** MOVE BORP-BASM-RATE-ID  TO UT0298CA-CALL-RATE-ID
052210**** MOVE BORP-TIER-GROUP-ID TO UT0298CA-CALL-TIER-ID
052220**** IF BORP-TIER-GROUP-ID = SPACES
052230****     MOVE 4 TO UT0298CA-CALL-CODE
052240**** ELSE
052250****     MOVE 5 TO UT0298CA-CALL-CODE
052260****     MOVE BORM-LOAN-BAL TO UT0298CA-CALL-TIER-MAX-VAL
052270**** END-IF.
SC2192     IF  WA-BORM-STAT < 7
SC2192       AND WA-INPUT-PARAM-TABLE (8) = 1
SC2192         MOVE WA-ADV-TXN-DATE    TO UT0030-DATE-DDMMCCYY
SC2192         MOVE 1                  TO UT0030-FUNCTION
SC2192         CALL "UT0030"   USING      UT0030-FUNCTION
SC2192                                    UT0030-DATE-AREA
SC2192                                    UT0030-BINARY-DATE
SC2192        MOVE UT0030-BINARY-DATE TO UT0298CA-CALL-TXN-DATE
SC2192     ELSE
052280     MOVE WA-DMY TO UT0298CA-CALL-TXN-DATE.
052290     CALL "UT0298" USING

052310                         UT0298CA-CALL-AREA.
052320     IF UT0298CA-RET-STATUS = 0
S16466*052330         MOVE UT0298CA-RET-EFF-RATE TO WA-INT-RATE-A
S16466           MOVE  UT0298CA-RET-EFF-RATE TO WA-INT-RATE
S16466           MOVE  UT0298CA-CALL-TXN-DATE TO WA-SEARCH-RATE-DATE
S16466           PERFORM X750-SEARCH-BLDVWW THRU X750-EXIT
S16466           MOVE WA-INT-RATE            TO WA-INT-RATE-A
052340     ELSE
052350         MOVE 1920 TO WA-OUTPUT-ERR-MSG-NO
052360         MOVE 1    TO WA-MSG-ERR-FLAG
052370         MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
052380         MOVE SPACES TO UT8500CA-INPUT-MSG
052390         STRING "BR0024:(X529) - INVALID CALL TO UT0298, "
052400                "STATUS:"    UT0298CA-RET-STATUS
052410                " FOR BORP:" UT0298CA-CALL-KEY
052420                ", ACCT:"    BORM-KEY
052430             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
052440         CALL "UT8500" USING

052460                             UT8500CA-AREA.
052470 X529-EXIT.
052480     EXIT.
052490/
052500 X530-GET-LASTEST-TOM-RATE.                                             
052510*-----------------------------------------------------------------      
052520                                                                        
052530     MOVE BORM-SOC-NO              TO UT0298CA-CALL-SOC-NO.             
052540     MOVE BORM-ACT-TYPE            TO UT0298CA-CALL-ACCT-TYPE.          
052550     MOVE BORM-CAT                 TO UT0298CA-CALL-INT-CAT.            
052560     MOVE BORM-TOM-RATE-TBL-ID     TO UT0298CA-CALL-BASE-ID             
052570                                      UT0298CA-CALL-RATE-ID.            
052580     MOVE "BOR"                    TO UT0298CA-CALL-SYS.                
052590     MOVE 4                        TO UT0298CA-CALL-CODE.               
052600     MOVE STRT-AREA-POST-DT        TO UT0298CA-CALL-TXN-DATE.           
052610                                                                        
052620     CALL "UT0298" USING UT0298CA-CALL-AREA.                            
052630                                                                        
052640     IF UT0298CA-RET-STATUS NOT = 0                                     
052650        MOVE 155                     TO WA-OUTPUT-ERR-MSG-NO            
052660        MOVE 1                       TO WA-MSG-ERR-FLAG                 
052670        SET  UT8500CA-NORMAL-DISPLAY TO TRUE                            
052680        MOVE SPACES                  TO UT8500CA-INPUT-MSG              
052690        STRING "BR0024:(X530) - INVALID CALL TO UT0298"                 
052700               ", STATUS="      UT0298CA-RET-STATUS                     
052710               ", TOM RATE ID=" UT0298CA-CALL-BASE-ID                   
052720               DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG                
052730        CALL "UT8500" USING UT8500CA-AREA                               
052740     END-IF.                                                            
052750                                                                        
052760 X539-EXIT.                                                             
052770     EXIT.                                                              
052780/
052790 X700-SP-COND-COMPLY-CHK.
052800     MOVE "UU" TO DBIO-CALL-TXN-TYPE-AREA.
052810     MOVE 0 TO DBIO-CALL-REFER-AREA.
052820 X700-CALL.
052830     PERFORM X750-READ-BLDVUU THRU X759-EXIT.
052840     IF DBIO-CALL-STATUS NOT = "****"
052850        GO TO X799-EXIT.
052860     IF DBIO-CALL-SAVE-REFER = "END."
052870        GO TO X799-EXIT.
052880     IF BLDV-UU-CANCEL-FLAG = 1
052890        GO TO X700-CALL.
052900     IF BLDV-UU-COMPLY-FLAG = 0
052910        MOVE 1 TO WA-MSG-ERR-FLAG
052920        MOVE 856 TO WA-OUTPUT-ERR-MSG-NO
052930        GO TO X799-EXIT.
052940     GO TO X700-CALL.
052950 X799-EXIT.
052960     EXIT.
052970*
052980 X750-READ-BLDVUU.
052990     MOVE 61 TO DBIO-CALL-FUNC.
053000     MOVE "BORM" TO DBIO-CALL-N-SYS.
053010     MOVE "BLDV" TO DBIO-CALL-SYST-VAR.
053020     MOVE WA-INPUT-ACCT-NO TO WA-BORM-ACCT-NO.
053030     MOVE STRT-AREA-SOC-NO TO WA-BORM-SOC-NO.
053040     MOVE WA-BORM-KEY TO DBIO-CALL-KEY-AREA.
053050     MOVE SPACES TO DBIO-CALL-STATUS.
053060     CALL "DBIO" USING

053080                       DBIO-CALL-PARAM
053090                       DBIO-CALL-SYS-AREA
053100                       DBIO-CALL-KEY-AREA
053110                       DBIO-CALL-STATUS
053120                       WA-BLDV-AREA-UU
053130                       DBIO-CALL-REFER-AREA
053140                       DBIO-CALL-TXN-TYPE-AREA.
053150     IF  DBIO-CALL-STATUS  NOT = "****"
053160         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
053170           TO UT8500CA-CALL-CODE
053180         MOVE SPACES TO UT8500CA-INPUT-MSG
053190         STRING "BR0024:(X750)  "
053200                " PROBLEM WHILE READING BLDV UU "
053210                  DBIO-CALL-KEY-AREA " " DBIO-CALL-STATUS
053220                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
053230         CALL "UT8500" USING

053250             UT8500CA-AREA
053260         MOVE DBIO-CALL-STATUS TO WA-DB-ERROR
053270         MOVE "BLDV" TO WA-DBERR-DATA-SET
053280         MOVE 155                 TO WA-OUTPUT-ERR-MSG-NO
053290         MOVE 1 TO WA-MSG-ERR-FLAG.
053300 X759-EXIT.
053310     EXIT.
053320/
053330* ** WHEN AN OVERRIDABLE ERROR IS ENCOUNTERED, UT0060 WILL BE
053340*    CALLED IF CHECK IF THE TRAN'S ERROR HAS BEEN OVERRIDEN OR
053350*    NOT. IF IT HAS, OK. IF IT HASN'T, CHECK IF THE CURRENT TRAN
053360*    CARRIES A VALID OVERRIDE SIGNAL OR NOT.
053370*
053380*    AN "69" CAN BE USED TO OVERRIDE 1 AND ONLY 1 ERROR.
053390*    AN "61" CAN BE USED TO OVERRIDE MORE THAN 1 ERROR IF REQ'D
053400*
053410 Y000-OVERRIDABLE-ERROR-CHECK.

053430     MOVE ZERO                   TO WA-MSG-ERR-FLAG.

053450* ** READ AND TEST THE TELLER RECORD

053470     MOVE "11"                 TO UT0060CA-CALL-CODE.
053480     MOVE STRT-AREA-SOC-NO     TO UT0060CA-CALL-SOCIETY-NO.
053490     MOVE STRT-AREA-ABS-TERM   TO UT0060CA-CALL-TERM-NO.
053500     MOVE STRT-AREA-TELL-NO    TO UT0060CA-CALL-TELR-NO.

053520     IF WA-SUPERVISOR-OVERRIDE-IN-USE = SPACE OR "0"
053530        MOVE WA-OVER-RIDE      TO UT0060CA-CALL-OVERRIDE-SIGNAL
053540     ELSE
053550        MOVE SPACES            TO UT0060CA-CALL-OVERRIDE-SIGNAL
053560        MOVE WA-SUPERVISOR-OVERRIDE-IN-USE
053570                               TO UT0060CA-CALL-OVERRIDE-SIGN.

053590     IF (WA-INPUT-PARAM-TABLE (29) = 1)
053600     OR WA-UT0060-PSEUDO-TRANSFER
053610        MOVE WA-UT0060-SAVE-ACC-NO  TO UT0060CA-CALL-ACC-NO
053620        MOVE WA-UT0060-SAVE-TRAN-NO TO UT0060CA-CALL-TRAN-CODE
053630        MOVE 2                      TO UT0060CA-CALL-PROGRESS-FLAG
053640                                       UT0060CA-CALL-ACC-INVOLVED
053650     ELSE
053660        MOVE WA-INPUT-ACCT-NO  TO UT0060CA-CALL-ACC-NO
053670        MOVE STRT-AREA-TRN-NO  TO UT0060CA-CALL-TRAN-CODE
053680        MOVE 1                 TO UT0060CA-CALL-PROGRESS-FLAG
053690                                  UT0060CA-CALL-ACC-INVOLVED.

053710     MOVE SPACE                TO UT0060CA-CALL-OVERRIDE-SGNL-OL.

053730*
053740*    IF THE TRAN IS A BATCH TRAN REPRESENTING A FEE CHARGING
053750*       TO CUSTOMER ACCOUNT, THEN THE OVERRIDE CODE "61" WILL
053760*       ENABLE THE TRAN TO OVERRIDE ALL OVERRIDABLE ERRORS,
053770*       IF ANY. (I.E. ONE "61" MAY OVERRIDE MORE THAN ONE
053780*       OVERRIDABLE ERROR, IF NECESSARY).
053790*    IF (STRT-BATCH-TRICKLE-TXN ) AND
053800*       (WA-OVER-RIDE = "XV" OR "TT")
053810*
053820***  SET UP OVERRIDE FIELDS FOR ALL BATCH/TRICKLE FEED TXNS -
053830***  UT0060 WILL DETERMINE WHETHER TXN SHOULD BE OVERRIDDEN OR NOT
053840*
053850     IF STRT-BATCH-TRICKLE-TXN
053860        MOVE "61"              TO UT0060CA-CALL-OVERRIDE-SIGNAL
053870        MOVE WA-OVER-RIDE      TO UT0060CA-CALL-OVERRIDE-SGNL-OL.

053890     MOVE 00                   TO UT0060CA-CALL-STATUS.
053900     MOVE STRT-AREA-BATCH-TANDEM TO WK-BATCH-TANDEM.

053920     CALL "UT0060" USING

053940             UT0060CA-AREA
053950             MULTI-OVERRIDE-AREA
053960             UT0060CA-WORK-AREA.

053980     MOVE "Y"                  TO WA-CALL-UT0060-FLAG.

054000     IF UT0060CA-CALL-STATUS = 00
054010        GO TO Y090-EXIT.

054030     IF UT0060CA-CALL-STATUS = 99
054040*  **   THE CURRENT OVERRIDE SIGNAL HAS BEEN USED, SAVE/CLEAR IT
054050        MOVE WA-OVER-RIDE TO WA-OVER-RIDE-USED
054060        MOVE WA-SUPERVISOR-OVERRIDE-IN-USE TO
054070             WA-SUPERVISOR-OVERRIDE-USED
054080        MOVE SPACE TO WA-OVER-RIDE, WA-SUPERVISOR-OVERRIDE-IN-USE
054090        GO TO Y090-EXIT.

054110     IF UT0060CA-CALL-STATUS = 98
054120*  **   THE TRAN WAS OVERRIDEN BEFORE; RESTORE OLD OVERRIDE VALUE
054130        MOVE "69" TO WA-OVER-RIDE-USED
054140        IF UT0060CA-CALL-OVERRIDE-SGNL-OL = "69"
054150           MOVE SPACE TO WA-SUPERVISOR-OVERRIDE-USED
054160           GO TO Y090-EXIT
054170        ELSE
054180           MOVE UT0060CA-CALL-OVERRIDE-SIGN-OL TO
054190                WA-SUPERVISOR-OVERRIDE-USED
054200           GO TO Y090-EXIT.

054220     IF UT0060CA-CALL-STATUS = 97
054230*  **   BATCH TRAN WITH "61"; DON'T CLEAR OVERRIDE SIGNAL
054240        MOVE "61" TO WA-OVER-RIDE-USED
054250        MOVE WA-SUPERVISOR-OVERRIDE-IN-USE TO
054260             WA-SUPERVISOR-OVERRIDE-USED
054270        GO TO Y090-EXIT.

054290     MOVE 1 TO WA-MSG-ERR-FLAG.

054310     IF UT0060CA-CALL-STATUS = 01
054320        MOVE 155 TO WA-OUTPUT-ERR-MSG-NO
054330         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
054340           TO UT8500CA-CALL-CODE
054350         MOVE SPACES TO UT8500CA-INPUT-MSG
054360         STRING "BR0024:(Y000)  "
054370                " INVALID CALL CODE " UT0060CA-CALL-CODE
054380                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
054390         CALL "UT8500" USING

054410             UT8500CA-AREA
054420        GO TO Y090-EXIT.

054440     IF UT0060CA-CALL-STATUS = 02
054450        MOVE 155 TO WA-OUTPUT-ERR-MSG-NO
054460        MOVE UT0060CA-CALL-TELR-NO TO WA-CALL-TELR-NO
054470         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
054480           TO UT8500CA-CALL-CODE
054490         MOVE SPACES TO UT8500CA-INPUT-MSG
054500         STRING "BR0024:(Y000)  "
054510                " INVALID TELLER NO " WA-CALL-TELR-NO
054520                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
054530         CALL "UT8500" USING

054550             UT8500CA-AREA
054560        GO TO Y090-EXIT.

054580     IF UT0060CA-CALL-STATUS = 03 OR 09
054590        MOVE 155 TO WA-OUTPUT-ERR-MSG-NO
054600        MOVE UT0060CA-CALL-TERM-NO TO WA-CALL-TERM-NO
054610         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
054620           TO UT8500CA-CALL-CODE
054630         MOVE SPACES TO UT8500CA-INPUT-MSG
054640         STRING "BR0024:(Y000)  "
054650                " INVALID TERMINAL NO " WA-CALL-TERM-NO
054660                DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
054670         CALL "UT8500" USING

054690             UT8500CA-AREA
054700        GO TO Y090-EXIT.

054720     IF UT0060CA-CALL-STATUS = 04
054730        MOVE 465 TO WA-OUTPUT-ERR-MSG-NO
054740        GO TO Y090-EXIT.

054760     IF UT0060CA-CALL-STATUS = 05 OR 06 OR 07 OR 08
054770        MOVE UT0060CA-CALL-ERROR-CODE TO WA-OUTPUT-ERR-MSG-NO
054780        GO TO Y090-EXIT.

054800* ** CALL STATUS ERROR

054820     MOVE 155 TO WA-OUTPUT-ERR-MSG-NO.

054840     MOVE UT8500CA-FUNC-NORMAL-DISPLAY
054850       TO UT8500CA-CALL-CODE
054860     MOVE SPACES TO UT8500CA-INPUT-MSG
054870     STRING "BR0024:(Y000)  "
054880            " UT0060 CALL ERROR " UT0060CA-CALL-STATUS
054890            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
054900     CALL "UT8500" USING

054920             UT8500CA-AREA.
054930*
054940 Y090-EXIT.
054950     EXIT.
054960/
054970 Y100-CUSM-SECURITY.
054980     MOVE STRT-AREA-SOC-NO TO SEC-SOC-NO.
054990     MOVE "CUSM" TO SEC-SYSTEM.
055000     MOVE 71 TO DBIO-CALL-FUNC.
055010*
055020 Y110-READ.
055030     CALL "DBIO" USING

055050                       DBIO-CALL-PARAM
055060                       SEC-SYSTEM
055070                       SEC-KEY-AREA
055080                       SEC-STATUS
055090                       CUSM-RECORD-AREA.
055100     IF  SEC-STATUS NOT = "****"
055110         MOVE 108 TO WA-OUTPUT-ERR-MSG-NO
055120         MOVE 1 TO WA-MSG-ERR-FLAG
055130         GO TO Y199-EXIT.
055140     IF  CUSM-CUSTOMER-NO NOT = CUSM-CUST-ACCT-NO
055150         MOVE CUSM-CUSTOMER-NO TO SEC-KEY-NO
055160         GO TO Y110-READ.
055170     MOVE 1 TO UT0450-FUNCTION.
055180     MOVE "CUSM" TO UT0450-DETAILS-TYPE.
055190     CALL "UT0450" USING

055210             UT0450-CALL-AREA
055220             STARTAREA
055230             CUSM-RECORD-AREA.
055240     IF  UT0450-STATUS NOT = 0
055250         MOVE UT0450-STATUS TO WA-OUTPUT-ERR-MSG-NO
055260         MOVE 1 TO WA-MSG-ERR-FLAG.
055270*
055280 Y199-EXIT.
055290     EXIT.
055300*
055310 Y200-BORM-SECURITY.
055320     MOVE 1 TO UT0450-FUNCTION.
055330     MOVE "BORM" TO UT0450-DETAILS-TYPE.
055340     CALL "UT0450" USING

055360             UT0450-CALL-AREA
055370             STARTAREA
055380             BORM-RECORD-AREA.
055390     IF  UT0450-STATUS NOT = 0
055400         MOVE UT0450-STATUS TO WA-OUTPUT-ERR-MSG-NO
055410         MOVE 1 TO WA-MSG-ERR-FLAG
055420         GO TO Y299-EXIT.
055430     IF  SOC-ACCESS-SECURITY-IND = "C"
055440         MOVE BORM-CUSTOMER-NO TO SEC-KEY-NO
055450         PERFORM Y100-CUSM-SECURITY THRU Y199-EXIT.
055460*
055470 Y299-EXIT.
055480     EXIT.
055490*


055520* THIS CODE IS ADDED BY AXSD
055530*
055540 M301-SEARCH-OLD-TRAN.
055550     IF  WA-DUMMY-TRN-NO = 12522
055560         MOVE 5 TO BORM-STAT
055570         GO TO M309-EXIT.
055580     PERFORM M302-FIND-AN-ACCEPT THRU M308-EXIT.
055590     IF WA-MSG-ERR-FLAG NOT = 0
055600         GO TO M309-EXIT.
      *--- TSLON00042 (s)
           IF BORP-ACCEPT-TXN-REQUIRED = "N" AND
              BORP-APR-REQD            = "N"
              MOVE 1 TO BORM-STAT
S11550        IF BORP-YOUBE                                      
S11550           MOVE ZEROES               TO BOIS-FIRST-ADV-DATE
S11550        END-IF                                             
           ELSE
      *--- TSLON00042 (e)
NR2001*055610     IF BORV-01-TRN-CODE = 12440
NR2001     IF BOCT-TRN-CODE = 12440
055620        MOVE 5 TO BORM-STAT
055630     ELSE
055640        MOVE 3 TO BORM-STAT.

055660******************************************************************
055670***SPR 760165 move UPTELLCA-PARAM-1 and UPTELLCA-PARAM-2 to save
055680***area defined in working storage.
055690******************************************************************

055710     MOVE UPTELLCA-TELR TO WA-SAVE-UPTELLCA-TELR.
055720     MOVE UPTELLCA-BRCH TO WA-SAVE-UPTELLCA-BRCH.
055730     MOVE UPTELLCA-PARAM-1 TO WA-SAVE-UPTELLCA-PARAM-1.
055740     MOVE UPTELLCA-TELLER-BRANCH TO
055750          WA-SAVE-UPTELLCA-TELLER-BRANCH.
055760     MOVE UPTELLCA-PARAM-2 TO WA-SAVE-UPTELLCA-PARAM-2.

055780******************************************************************

NR2001*055800     MOVE BORV-01-TELL-AND-BR TO UPTELLCA-TELLER-BRANCH.
NR2001     MOVE BOCT-TELL-AND-BR TO UPTELLCA-TELLER-BRANCH.
055810     CALL "UT0021" USING

055830                                 UPTELLCA-PARAM-1
055840                                 UPTELLCA-PARAM-2.
055850     MOVE UPTELLCA-BRCH           TO WA-CORR-TXN-BRANCH.

055870******************************************************************
055880***SPR 760165 move WA-SAVE-UPTELLCA-PARAM-1 and
055890***WA-SAVE-UPTELLCA-PARAM-2 from the save area back to
055900***UPTELLCA-PARAM-1 and UPTELLCA-PARAM-2.
055910******************************************************************

055930     MOVE WA-SAVE-UPTELLCA-TELR TO UPTELLCA-TELR.
055940     MOVE WA-SAVE-UPTELLCA-BRCH TO UPTELLCA-BRCH.
055950     MOVE WA-SAVE-UPTELLCA-PARAM-1 TO UPTELLCA-PARAM-1.
055960     MOVE WA-SAVE-UPTELLCA-TELLER-BRANCH TO
055970          UPTELLCA-TELLER-BRANCH.
055980     MOVE WA-SAVE-UPTELLCA-PARAM-2 TO UPTELLCA-PARAM-2.

056000******************************************************************

056020 M309-EXIT.
056030     EXIT.
056040 M302-FIND-AN-ACCEPT.
NR2001*056050     MOVE 0                      TO DBIO-CALL-REFER-AREA.
NR2001*NR0050     MOVE SPACES                 TO DBIO-CALL-SAVE-REFER.
NR2001*056060     MOVE 01                     TO DBIO-CALL-TXN-TYPE.
NR2001*056070     MOVE "BOR"                  TO DBIO-CALL-SYS-AREA.
NR2001*056080     MOVE STRT-AREA-SOC-NO       TO WA-BORM-SOC-NO.
NR2001*056090     MOVE BORM-MEMB-CUST-AC      TO WA-BORM-ACCT-NO.
NR2001*056100     MOVE WA-BORM-KEY            TO DBIO-CALL-KEY-AREA.
NR2001*056110     MOVE 07                     TO DBIO-CALL-FUNC.
NR2001*056120     MOVE SPACES                 TO WA-TRN-MATCH-FOUND.
NR2001*056130     MOVE 0 TO BORV-01-TRN-CODE.
NR2003     IF WA-INPUT-PARAM-TABLE(8) = 1
NR2003        MOVE WA-STORE-TXN-DT          TO WA-BOCT-TRN-DATE
NR2003     ELSE
NR2003        MOVE STRT-AREA-POST-DT        TO WA-BOCT-TRN-DATE
NR2003     END-IF
NR2001     INITIALIZE UTBOCTCA-CALL-AREA.
NR2001     MOVE STRT-AREA-SOC-NO  TO BOCT-INST-NO.
NR2001     MOVE BORM-MEMB-CUST-AC TO BOCT-ACCT-NO.
NR2001     MOVE 0                 TO BOCT-REC-NO.
NR2003*NR2001     MOVE 999999999         TO BOCT-TRN-DATE.
NR2003     MOVE STRT-AREA-POST-DT TO BOCT-TRN-DATE.
NR2001     MOVE 1                 TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT TO TRUE.
NR2001     MOVE 01                TO WS-BOCT-TRAN-TYPE.
NR2001     MOVE SPACES            TO WA-TRN-MATCH-FOUND.
NR2001     MOVE 0                 TO BOCT-TRN-CODE.
056140     PERFORM M3022-MATCH-TRN-PARA
056150        THRU M3099-EXIT.
056160 M308-EXIT.
056170     EXIT.
056180 M3022-MATCH-TRN-PARA.
NR2001*056190     MOVE SPACES                 TO DBIO-CALL-STATUS.
NR2001*056200     CALL "DBIO" USING
NR2001*
NR2001*056220
NR2001*056230                                 DBIO-CALL-PARAM
NR2001*056240                                 DBIO-CALL-SYS-AREA
NR2001*056250                                 DBIO-CALL-KEY-AREA
NR2001*056260                                 DBIO-CALL-STATUS
NR2001*056270                                 BORV-RECORD-AREA
NR2001*056280                                 DBIO-CALL-REFER-AREA
NR2001*056290                                 DBIO-CALL-TXN-TYPE-AREA.
NR2001*056300     IF  DBIO-CALL-STATUS NOT = "****" AND "XCOT"
NR2001*056310         MOVE 1                  TO WA-MSG-ERR-FLAG
NR2001*056320         MOVE 155                TO WA-OUTPUT-ERR-MSG-NO
NR2001*056330         MOVE "BORV"             TO WA-OUTPUT-DATA-SET
NR2001*056340         MOVE DBIO-CALL-STATUS TO WA-OUTPUT-STATUS
NR2001*056350         MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
NR2001*056360         MOVE SPACES TO UT8500CA-INPUT-MSG
NR2001*056370         STRING "BR0024:(M3022) - DATA-BASE ERROR "
NR2001*056380                 "RETURN-STATUS ="  DBIO-CALL-STATUS
NR2001*056390             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
NR2001*056400         CALL "UT8500" USING
NR2001*
NR2001*056420                             UT8500CA-AREA
NR2001*056430         GO TO M3099-EXIT.
NR2001*
NR2001*056450     IF ( WA-INPUT-PARAM-TABLE(4) = 1   OR
NR2001*056460          WA-INPUT-PARAM-TABLE(5) = 1 ) AND
NR2001*056470        ( WA-TRACE-NO             = 0   AND
NR2001*056480          WA-INPUT-PARAM-TABLE(7) = 1   AND
NR2001*056490*RET***   WA-INPUT-PARAM-TABLE(8) = 1)
NR2001*056500          STRT-AREA-OTHER-OVERRIDE = "1" OR "3")
NR2001*056510          GO TO M3099-EXIT.
NR2001*TB0082**--
NR2001*TB0082**-- IF BORV-01-TRN-CODE  = 11057
NR2001*TB0082**--     GO TO M3099-EXIT.
NR2001*TB0082**--
NR2001*      *--- TSLON00042 (s) Availment correction      
NR2001*           IF BORP-ACCEPT-TXN-REQUIRED = "N" AND
NR2001*              BORP-APR-REQD            = "N"
NR2001*              GO TO M3099-EXIT.
NR2001*      *--- TSLON00042 (e)
NR2001*056530     IF BORV-01-TRN-CODE  = 12420
NR2001*056540         GO TO M3099-EXIT.
NR2001*056550     IF BORV-01-TRN-CODE NOT = 12440
NR2001*056560         GO TO M3022-MATCH-TRN-PARA.
NR2001     MOVE BOCT-INST-NO        TO UTBOCTCA-INST-NO.
NR2001     MOVE BOCT-ACCT-NO        TO UTBOCTCA-ACCT-NO.
NR2001     MOVE BOCT-REC-NO         TO UTBOCTCA-REC-NO.
NR2001     MOVE BOCT-TRN-DATE       TO UTBOCTCA-CALL-DATE.
NR2001     MOVE 1                   TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT   TO TRUE.
NR2001     CALL "UTBOCT"         USING UTBOCTCA-CALL-AREA
NR2001                                 BOCT-RECORD-AREA.
NR2001     IF NOT UTBOCTCA-OK
NR2001         MOVE 1                  TO WA-MSG-ERR-FLAG
NR2001         MOVE 155                TO WA-OUTPUT-ERR-MSG-NO
NR2001         MOVE "BOCT"             TO WA-OUTPUT-DATA-SET
NR2001         MOVE UTBOCTCA-STATUS    TO WA-OUTPUT-STATUS
NR2001         MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
NR2001         MOVE SPACES TO UT8500CA-INPUT-MSG
NR2001         STRING "BR0024:(M3022) - DATA-BASE ERROR "
NR2001                ", CALLCODE=" UTBOCTCA-CALL-CODE
NR2001                ", STATUS="   UTBOCTCA-STATUS
NR2001                ", CALLKEY="  UTBOCTCA-CALL-KEY
NR2001             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
NR2001         CALL "UT8500" USING
NR2001                             UT8500CA-AREA
NR2001         GO TO M3099-EXIT.
NR2001
NR2003     IF BOCT-TRN-DATE < WA-BOCT-TRN-DATE
NR2003        GO TO M3099-EXIT
NR2003     END-IF.
NR2003
NR2001     IF BOCT-TRAN-TYPE NOT = WS-BOCT-TRAN-TYPE
NR2001         GO TO M3022-MATCH-TRN-PARA.
NR2001
NR2001     IF ( WA-INPUT-PARAM-TABLE(4) = 1   OR
NR2001          WA-INPUT-PARAM-TABLE(5) = 1 ) AND
NR2001        ( WA-TRACE-NO             = 0   AND
NR2001          WA-INPUT-PARAM-TABLE(7) = 1   AND
NR2001          STRT-AREA-OTHER-OVERRIDE = "1" OR "3")
NR2001          GO TO M3099-EXIT.
NR2001**--
NR2001*--- TSLON00042 (s) Availment correction      
NR2001     IF BORP-ACCEPT-TXN-REQUIRED = "N" AND
NR2001        BORP-APR-REQD            = "N"
NR2001        GO TO M3099-EXIT.
NR2001*--- TSLON00042 (e)
NR2001     IF BOCT-TRN-CODE  = 12420
NR2001         GO TO M3099-EXIT.
NR2001     IF BOCT-TRN-CODE NOT = 12440
NR2001         GO TO M3022-MATCH-TRN-PARA.
056570 M3099-EXIT.
056580     EXIT.
056590*
056600*** 74I012 BEGIN ***
056610 T001-VALIDATE-FOREIGN-TXN.
056620*
056630     IF  (TPATM-MERCH-CTRY-CODE = SPACES)
056640     AND (TPATM-FOREIGN-CURR-AMT = ZERO)
056650         GO TO T099-EXIT.
056660*
056670     IF  (TPATM-MERCH-CTRY-CODE = SPACES OR SOC-COUNTRY-CODE)
056680     AND (TPATM-FOREIGN-CURR-AMT > ZERO)
056690*         DISPLAY "CODE =" TPATM-MERCH-CTRY-CODE
056700*                  "AMT=" TPATM-FOREIGN-CURR-AMT
056710         MOVE 745 TO WA-OUTPUT-ERR-MSG-NO
056720         MOVE 1   TO WA-MSG-ERR-FLAG
056730         GO TO T099-EXIT.
056740*
056750     MOVE 03 TO UT0290CA-CALL-CODE.
056760     MOVE TPATM-MERCH-CTRY-CODE TO UT0290CA-CALL-CTRY-CODE.
056770     MOVE 0                      TO UT0290CA-CALL-STATUS
056780                                    UT0290CA-CALL-MSG-NO.
056790     CALL "UT0290" USING

056810                         UT0290CA-CALL-AREA.
056820     IF UT0290CA-CALL-STATUS NOT = ZERO
056830         MOVE UT0290CA-CALL-MSG-NO TO WA-OUTPUT-ERR-MSG-NO
056840         MOVE 1                    TO WA-MSG-ERR-FLAG
056850         GO TO T099-EXIT.
056860*
056870     IF (UT0290CA-CURR-DECS = 0 AND TPATM-FOR-0-DECS > 0)
056880     OR (UT0290CA-CURR-DECS = 1 AND TPATM-FOR-1-DECS > 1)
056890     OR (UT0290CA-CURR-DECS = 2 AND TPATM-FOR-2-DECS > 2)
056900         MOVE 745      TO WA-OUTPUT-ERR-MSG-NO
056910         MOVE 1        TO WA-MSG-ERR-FLAG
056920*         DISPLAY "CODE2 =" TPATM-MERCH-CTRY-CODE
056930*                  "AMA2T=" TPATM-FOREIGN-CURR-AMT
056940         GO TO T099-EXIT.
056950*
056960 T099-EXIT.
056970     EXIT.
056980*** 74I012 END ***
056990/
057000 U9100-RETRIEVE-TEXT.
057010
057020     CALL "UT9000" USING

057040                         UT9000-AREA.
057050
057060 U9199-EXIT.
057070     EXIT.
057080*
057090* CHANGE LOAN BALANCE
057100     COPY CHANGEBAL  IN  LIBRYBOR.
057110     EXIT.
057120**********************************************************
057130 Z1000-RETRIEVE-BBLC.
057140     INITIALIZE BBLC-KEY.
057150     MOVE "READ"               TO  DBIOMOD-FUNCTION.
057160     MOVE "BBLC"               TO  DBIOMOD-FILE
057170                                   DBIOMOD-SUFFIX.
057180     MOVE "DBIO"               TO  DBIOMOD-PREFIX.
057190     MOVE STRT-AREA-SOC-NO     TO  SEC-SOC-NO
057200                                   BBLC-INST-NO.
057210     MOVE BORM-MEMB-CUST-AC    TO  SEC-KEY-NO
057220                                   BBLC-ACCT-NO.
057230     MOVE SEC-KEY-AREA         TO  DBIOMOD-KEY.
057240     MOVE ZEROES               TO  DBIOMOD-KEY-NO.
057250     MOVE SPACES               TO  DBIOMOD-STATUS
057260                                   DBIOMOD-RELEASE-LOCK
057270                                   DBIOMOD-ACCESS-COMMAND
057280                                   DBIOMOD-ACCESS-COND.
057290     CALL DBIOMODNAME USING
057300                          DBIOMOD-FILE
057310                          DBIOMOD-KEY
057320                          DBIOMOD-RECORD
057330                          DBIOMOD-FUNCTION
057340                          DBIOMOD-KEY-NO
057350                          DBIOMOD-RELEASE-LOCK
057360                          DBIOMOD-ACCESS-COMMAND
057370                          DBIOMOD-ACCESS-COND
057380                          DBIOMOD-STATUS.
057390     IF DBIOMOD-STAT NOT = "****"  AND "MRNF"
057400         SET UT8500CA-NORMAL-DISPLAY TO TRUE
057410         MOVE SPACES TO UT8500CA-INPUT-MSG
057420         STRING "BR0024:(Z1000) BBLC READ ERROR " DBIOMOD-STAT
057430                " FOR " BBLC-KEY
057440             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
057450         MOVE "N" TO UT8500CA-RESPONSE-REQD-FLAG
057460         CALL "UT8500" USING

057480                             UT8500CA-AREA
057490         MOVE "BBLC" TO WA-OUTPUT-DATA-SET
057500         MOVE DBIOMOD-STAT       TO WA-OUTPUT-STATUS
057510         MOVE 1                  TO WA-MSG-ERR-FLAG
057520         MOVE 155 TO WA-OUTPUT-ERR-MSG-NO.
057530     IF DBIOMOD-STAT = "MRNF"
057540         MOVE 1                  TO WA-MSG-ERR-FLAG
057550         MOVE 188 TO WA-OUTPUT-ERR-MSG-NO.
057560 Z1099-EXIT.
057570      EXIT.
057580 Z1100-RETRIEVE-BINS.
057590     INITIALIZE BINS-KEY.
057600     MOVE "READ"               TO  DBIOMOD-FUNCTION.
057610     MOVE "BINS"               TO  DBIOMOD-FILE
057620                                   DBIOMOD-SUFFIX.
057630     MOVE "DBIO"               TO  DBIOMOD-PREFIX.
057640     MOVE STRT-AREA-SOC-NO     TO  SEC-SOC-NO
057650                                   BINS-INST-NO.
057660     MOVE BORM-MEMB-CUST-AC    TO  SEC-KEY-NO
057670                                   BINS-ACCT-NO.
057680     MOVE SEC-KEY-AREA         TO  DBIOMOD-KEY.
057690     MOVE ZEROES               TO  DBIOMOD-KEY-NO.
057700     MOVE SPACES               TO  DBIOMOD-STATUS
057710                                   DBIOMOD-RELEASE-LOCK
057720                                   DBIOMOD-ACCESS-COMMAND
057730                                   DBIOMOD-ACCESS-COND.
057740     CALL DBIOMODNAME USING
057750                          DBIOMOD-FILE
057760                          DBIOMOD-KEY
057770                          DBIOMOD-RECORD2
057780                          DBIOMOD-FUNCTION
057790                          DBIOMOD-KEY-NO
057800                          DBIOMOD-RELEASE-LOCK
057810                          DBIOMOD-ACCESS-COMMAND
057820                          DBIOMOD-ACCESS-COND
057830                          DBIOMOD-STATUS.
057840     IF DBIOMOD-STAT NOT = "****"  AND "MRNF"
057850         SET UT8500CA-NORMAL-DISPLAY TO TRUE
057860         MOVE SPACES TO UT8500CA-INPUT-MSG
057870         STRING "BR0024:(Z1100) BINS READ ERROR " DBIOMOD-STAT
057880                " FOR " BINS-KEY
057890             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
057900         MOVE "N" TO UT8500CA-RESPONSE-REQD-FLAG
057910         CALL "UT8500" USING

057930                             UT8500CA-AREA
057940         MOVE "BINS" TO WA-OUTPUT-DATA-SET
057950         MOVE DBIOMOD-STAT       TO WA-OUTPUT-STATUS
057960         MOVE 1                  TO WA-MSG-ERR-FLAG
057970         MOVE 155 TO WA-OUTPUT-ERR-MSG-NO.
057980     IF DBIOMOD-STAT = "MRNF"
057990         MOVE 1                  TO WA-MSG-ERR-FLAG
058000         MOVE 188 TO WA-OUTPUT-ERR-MSG-NO.
058010 Z1199-EXIT.
058020      EXIT.

058040 H100-ADV-BY-TRANSFER.
SC4522    IF FEDI-FROM-TO-GL
SC4522       GO TO H199-EXIT.
058060*   PERFORM P000-MAX-CASH-ADV-VAL  THRU P099-EXIT.                       
058070    IF BORP-MAX-CASH-ADV > 0                                             
058080       PERFORM P000-MAX-CASH-ADV-VAL  THRU P099-EXIT                     
058090    END-IF.                                                              
058100    IF WA-MSG-ERR-FLAG = 1                                               
058110*      GO TO B099-EXIT.                                                  
058120       GO TO H199-EXIT. 
S19435
S19435    IF (STRT-AREA-TRN-NO = 11055 OR 16055)
S19435    AND BOIS-PROJ-CODE   = 'Q400'
S19435    AND WK-BAILOUT
S19435       MOVE STRT-AREA-SOC-NO     TO CUSM-SOC-NO
S19435       MOVE WA-DEP-ACCT-NO       TO CUSM-CUST-ACCT-NO
S19435       PERFORM P300-READ-CUSM  THRU P399-EXIT
S19435       MOVE CUSM-CUSTOMER-NO     TO WK-INVM-CUST-NO
S19435       IF BORM-CUSTOMER-NO <> WK-INVM-CUST-NO
S19435          MOVE 1    TO WA-MSG-ERR-FLAG
S19435          MOVE 4996 TO WA-OUTPUT-ERR-MSG-NO
S19435       END-IF
S19435    END-IF.
S19435    IF WA-MSG-ERR-FLAG = 1
S19435       GO TO H199-EXIT
S19435    END-IF.
SC0941****START-FAD
S11455*   IF STRT-AREA-TRN-NO = 16055         
S11455    IF STRT-AREA-TRN-NO = 16055 OR 16068
             PERFORM Z700-CHK-TXNDT THRU Z709-EXIT
             IF WS-ERR-Y
015500        MOVE 1 TO WA-MSG-ERR-FLAG
015510        MOVE 3360 TO WA-OUTPUT-ERR-MSG-NO
015520        GO TO H199-EXIT
             END-IF
          END-IF.
SC0941****END-FAD                                                 

S11455*   IF STRT-AREA-TRN-NO = 16055 OR 16155                  
S11455    IF STRT-AREA-TRN-NO = 16055 OR 16155 OR 16068 OR 16168
S12770       OR 16063 OR 16163
SC9610       OR ST-LOAN-BACKDATED-CORR-YES
058150       MOVE WA-ADV-TXN-DATE      TO WA-TEMP-TXN-DATE.

058170    MOVE STRT-AREA-TRN-NO        TO WA-SAVE-ST-AREA-TRN-NO
058180                                    WA-SAVE-TRANS-NO.
058190    MOVE STRT-AREA-DATA          TO WA-SAVE-ST-AREA-DATA.
058200    MOVE WA-INPUT-MESSAGE        TO WA-SAVE-ST-AREA-INPUT-MSG.
058210    MOVE BORM-RECORD-AREA        TO WA-SAVE-BORM-AREA.
S12770    IF STRT-AREA-TRN-NO = 11063 OR 11163 OR 16063 OR 16163
S12770       MOVE BORM-BR-NO       TO WA-SAVE-SOURCE-BRANCH
S12770    END-IF.
058220    MOVE WA-DEP-ACCT-NO          TO W800-FROM-ACCT
058230                                    WA-TRANSFER-ACCOUNT-AREA.

058250*   IF STRT-AREA-TRN-NO = 11055 OR 16055                                 
058260*      MOVE ZERO                 TO W800-CORR-JRNL-NO                    
058270*      IF (LINK-NARR-TXN-TYPE = 36)                                      
058280*        PERFORM M1700-WRITE-TYPE-36 THRU M1799-EXIT.                    
058290*   IF STRT-AREA-TRN-NO = 11055 OR 16055                                  TB0267
TB0267**  IF STRT-AREA-TRN-NO = 11055 OR 16055 OR 14055
SC7091**  IF STRT-AREA-TRN-NO = 11055 OR 16055 OR 19055
S11455*   IF STRT-AREA-TRN-NO = 11055 OR 16055 OR 19055 OR 14055
S11455    IF STRT-AREA-TRN-NO = 11055 OR 16055 OR 19055 OR 14055
S11455                       OR 16068                           
SC5827*                    OR 14155                                 SC6434
058300       MOVE ZERO                 TO W800-CORR-JRNL-NO.                   

058320    IF (LINK-NARR-TXN-TYPE = 36)                                         
058330        PERFORM M1700-WRITE-TYPE-36 THRU M1799-EXIT.                     

058350    EVALUATE STRT-AREA-TRN-NO
SC7091       WHEN 14055
SC7091       WHEN 19055
SC6854          IF WA-VIRTUAL-FROM-ACCT > 0
SC6854             MOVE 24046          TO STRT-AREA-TRN-NO
SC6854          ELSE
SC8991*            IF STRT-AREA-TRN-NO = 19055
SC8991*               MOVE 6045 TO STRT-AREA-TRN-NO
SC8991*            ELSE
SC5827             MOVE 4045 TO STRT-AREA-TRN-NO
SC8991*            END-IF
SC6854          END-IF
SC7091       WHEN 14155
SC7091       WHEN 19155
SC6854          IF WA-VIRTUAL-FROM-ACCT > 0
SC6854             MOVE 24146          TO STRT-AREA-TRN-NO
SC6854          ELSE
SC8991*            IF STRT-AREA-TRN-NO = 19155
SC8991*               MOVE 6145 TO STRT-AREA-TRN-NO
SC8991*            ELSE
SC5827             MOVE 4145 TO STRT-AREA-TRN-NO
SC8991*            END-IF
SC6854          END-IF
058360       WHEN 11055
S11455       WHEN 11068
SC8085          IF UTVTACCA-POST-METHOD = "B"
SC8085             MOVE 20045          TO STRT-AREA-TRN-NO
SC8085          ELSE
SC8289             IF (UTVTACCA-POST-METHOD = "C" AND
S18391*SC8289         (STRT-BIZTALK-IVR-TXN OR STRT-WEBLOGIC-IB-TXN)
S18391                (STRT-BIZTALK-IVR-TXN OR
S18391                 STRT-WEBLOGIC-IB-TXN OR
S18391                 STRT-DIB-TXN)
SC8289                AND WA-VIRTUAL-FROM-ACCT > 0)
SC8289                MOVE 24046       TO STRT-AREA-TRN-NO
SC8289             ELSE
SC8085                MOVE 1045           TO STRT-AREA-TRN-NO
SC8289             END-IF
SC8085          END-IF
058380       WHEN 11155
S11455       WHEN 11168
SC8085          IF UTVTACCA-POST-METHOD = "B"
SC8085             MOVE 20145          TO STRT-AREA-TRN-NO
SC8085          ELSE
SC8289             IF (UTVTACCA-POST-METHOD = "C" AND
S18391*SC8289         (STRT-BIZTALK-IVR-TXN OR STRT-WEBLOGIC-IB-TXN)
S18391                (STRT-BIZTALK-IVR-TXN OR
S18391                 STRT-WEBLOGIC-IB-TXN OR
S18391                 STRT-DIB-TXN)
SC8289                 AND WA-VIRTUAL-FROM-ACCT > 0)
SC8289                MOVE 24146       TO STRT-AREA-TRN-NO
SC8289             ELSE
SC8085                MOVE 1145           TO STRT-AREA-TRN-NO
SC8289             END-IF
SC8085          END-IF
058400       WHEN 16055
S11455       WHEN 16068
SC8085          IF UTVTACCA-POST-METHOD = "B"
SC8085             MOVE 26045          TO STRT-AREA-TRN-NO
SC8085          ELSE
SC8289             IF (UTVTACCA-POST-METHOD = "C" AND
S18391*SC8289         (STRT-BIZTALK-IVR-TXN OR STRT-WEBLOGIC-IB-TXN)
S18391                (STRT-BIZTALK-IVR-TXN OR
S18391                 STRT-WEBLOGIC-IB-TXN OR
S18391                 STRT-DIB-TXN)
SC8289                AND WA-VIRTUAL-FROM-ACCT > 0)
SC8289                MOVE 24046    TO STRT-AREA-TRN-NO
SC8289             ELSE
S18391*SC7995         IF STRT-BIZTALK-IVR-TXN OR STRT-WEBLOGIC-IB-TXN
S18391                IF STRT-BIZTALK-IVR-TXN OR
S18391                   STRT-WEBLOGIC-IB-TXN OR
S18391                   STRT-DIB-TXN
SC7995                   MOVE 1045        TO STRT-AREA-TRN-NO
SC7995                ELSE
SC8085                   MOVE 6045        TO STRT-AREA-TRN-NO
SC7995                END-IF
SC8289             END-IF
SC8085          END-IF
058420       WHEN 16155
S11455       WHEN 16168
SC8085          IF UTVTACCA-POST-METHOD = "B"
SC8085             MOVE 26145          TO STRT-AREA-TRN-NO
SC8085          ELSE
SC8289             IF (UTVTACCA-POST-METHOD = "C" AND
S18391*SC8289         (STRT-BIZTALK-IVR-TXN OR STRT-WEBLOGIC-IB-TXN)
S18391                (STRT-BIZTALK-IVR-TXN OR
S18391                 STRT-WEBLOGIC-IB-TXN OR
S18391                 STRT-DIB-TXN)
SC8289                AND WA-VIRTUAL-FROM-ACCT > 0)
SC8289                 MOVE 24146      TO STRT-AREA-TRN-NO
SC8289              ELSE
S18391*SC7995          IF STRT-BIZTALK-IVR-TXN OR STRT-WEBLOGIC-IB-TXN
S18391                 IF STRT-BIZTALK-IVR-TXN OR
S18391                    STRT-WEBLOGIC-IB-TXN OR
S18391                    STRT-DIB-TXN
SC7995                    MOVE 1145        TO STRT-AREA-TRN-NO
SC7995                 ELSE
SC9392                    IF BORP-YOUBE                            
SC9392                       MOVE 1055     TO STRT-AREA-TRN-NO     
SC9392                    ELSE                                     
SC8085                       MOVE 6145     TO STRT-AREA-TRN-NO     
SC9392                    END-IF                                   
SC7995                 END-IF
SC8289              END-IF
SC8085          END-IF
S12770       WHEN 11063
S12770          MOVE 13041 TO STRT-AREA-TRN-NO
S12770       WHEN 11163
S12770          MOVE 13141 TO STRT-AREA-TRN-NO
S12770       WHEN 16063
S12770          MOVE 15041 TO STRT-AREA-TRN-NO
S12770       WHEN 16163
S12770          MOVE 15141 TO STRT-AREA-TRN-NO
SC8085    END-EVALUATE.
SC9610    IF ST-LOAN-BACKDATED-CORR-YES
SC9610       MOVE 24143 TO STRT-AREA-TRN-NO
SC9610    END-IF.
058440    MOVE 0 TO WA-SAVE-COMM-FLAG
058450              WA-SAVE-CHANGE-FLAG.
058460    IF W800-COMMISSION > 0
058470       MOVE 1 TO WA-SAVE-COMM-FLAG.
058480    COMPUTE WA-SAVE-BASE-TO-AMOUNT =
058490            W800-BASE-CURR-AMT - W800-COMMISSION - W800-CHANGE.
058500    MOVE ZERO                    TO W800-COMMISSION
058510                                    W800-DEB-DEF-INT-DAYS
058520                                    W800-DEF-INT-DAYS
058530                                    WA-SAVE-GLDM-LEDGER-NO
058540                                    WA-ADV-CHQ-NO.
058550    MOVE BORM-BR-NO              TO WA-SAVE-GLDM-BRANCH.
S15265    MOVE BORM-BR-NO              TO WA-SAVE-SOURCE-BRANCH.
058560    MOVE SPACES                  TO W800-CHQ-DAYS
058570                                    WA-SAVE-GLDM-CL-CODE.
058580    MOVE BORM-MEMB-CUST-AC       TO W800-TO-ACCT
058590                                    WA-TRF-ACCT.
058600    MOVE WA-ADV-PROMO            TO W800-PROMO-NO.

058620    IF STRT-AREA-TRN-NO = 1145 OR 6145
058630       MULTIPLY WA-DUMMY-AMT BY -1 GIVING WA-DUMMY-AMT.

058650    MOVE W800-CURR-AMT           TO W800-TRF-AMOUNT.
058660    MOVE WA-DUMMY-AMT            TO W800-CURR-AMT.

058680    IF W800-TRF-AMOUNT = ZEROES OR
058690       W800-TRF-AMOUNT-R = SPACES                                        
058700       MOVE W800-CURR-AMT        TO W800-TRF-AMOUNT
058710                                    W800-BASE-CURR-AMT.

058730    MOVE W800-CURR-AMT-CURR-CD   TO W800-ACCT-CURR-CD.
058740    MOVE BORM-CURRENCY-IND       TO W800-CURR-AMT-CURR-CD.

058760    IF W800-ACCT-CURR-CD = SPACES
058770       MOVE BORM-CURRENCY-IND    TO W800-ACCT-CURR-CD.

058790    IF STRT-AREA-TRN-NO = 6045 OR 6145
SC8991*      IF STRT-FEP-ATM-TXN
SC8991*         MOVE WA-BACKDATE-DATE TO W800-TRF-DATE
SC8991*      ELSE
058800       MOVE WA-TEMP-TXN-DATE     TO W800-TRF-DATE
SC8991*      END-IF
SC8991    END-IF.

058820    MOVE STRT-AREA-TRN-NO TO LINK-IN-TXCODE.
058830    PERFORM M1600-LOAD-ED2 THRU M1699-EXIT.


058860    IF WA-MSG-ERR-FLAG = 1
058870       GO TO H199-EXIT.

058890    MOVE LINK-EDIT-TABLE         TO STRT-AREA-EDIT-MASK.
058900    MOVE LINK-POSTING-LEVEL      TO STRT-AREA-POSTING-LEVEL.
SC9409*   MOVE W800-FROM-ACCT          TO WA-UT0060-SAVE-ACC-NO.

SC6854    IF STRT-AREA-TRN-NO = 24046
SC8827                       OR 24146
SC8085    OR UTVTACCA-POST-METHOD = "B"
SC9610    OR ST-LOAN-BACKDATED-CORR-YES
SC9610       IF ST-LOAN-BACKDATED-CORR-YES
SC9610          MOVE WA-SUSP-BACKDT-ACCOUNT TO WA-GL-ACCT-NO
SC9610          MOVE  WA-TEMP-TXN-DATE TO WA-GL-TXN-DATE
SC9610          MOVE  WA-DUMMY-AMT     TO WA-GL-820-AMT
SC9610          MOVE  WA-GL-820-AMT    TO WA-GL-AMOUNT
SC9610       ELSE
SC6854          MOVE  WA-VIRTUAL-FROM-ACCT TO WA-GL-ACCT-NO
SC6854          MOVE  WA-INPUT-AMT         TO WA-GL-820-AMT
SC6854          MOVE  WA-GL-820-AMT        TO WA-GL-AMOUNT
SC9610       END-IF
SC8535* UT0820 will move UTVTACCA-TXN-BRANCH to JNRST-HOME-BRNCH
SC6854       CALL "UT0820" USING  STARTAREA
SC6854                            W300-ERROR-AREA
SC6854                            GL-PASSALONG
SC6854                            WA-OTHER-SAVE-AREAS
SC6854                            MULTI-OVERRIDE-AREA
SC6854                            CHECK-RESPONSE-AREA
SC7181                            UTVTACCA-CALL-PARAM
SC6854    ELSE
S12770      IF STRT-AREA-TRN-NO = 13041 OR 15041 OR 13141
S12770                         OR 15141
S12770         MOVE " " TO WA-INPUT-WAIVE-PENALTY-FLAG
S12770         MOVE 0   TO WA-INPUT-INT-REBATE-PERC
S12770         MOVE 88  TO WA-INPUT-REASON-CD
S12770         IF WA-INPUT-PARAM-TABLE(7) = 1
S12770            MOVE WA-SAVE-TRACE-NO TO WA-INPUT-JRNL-NO
S12770         END-IF
S12770         IF WA-INPUT-PARAM-TABLE(8) = 1
S12770            MOVE WA-TEMP-TXN-DATE TO WA-INPUT-DISCH-DATE
S12770         END-IF
S12770         CALL "UT0810" USING
S12770                       STARTAREA
S12770                       W300-ERROR-AREA
S12770                       CHECK-RESPONSE-AREA
S12770                       MULTI-OVERRIDE-AREA
S12770                       WA-OTHER-SAVE-AREAS
S12770                       PBOOKCA-LINE-AREA
S12770         IF ST-STATUS-LEVEL-1 = 1
S12770            MOVE 1 TO WA-MSG-ERR-FLAG
S12770         END-IF
S12770      ELSE
058930      CALL "UT0800" USING

058950                                    STARTAREA
058960                                    W300-ERROR-AREA
058970                                    WA-JRNL-CALL-AREA
058980                                    WA-PASSALONG
058990                                    MULTI-OVERRIDE-AREA
059000                                    CHECK-RESPONSE-AREA
059010                                    WA-OTHER-SAVE-AREAS
059020                                    PBOOKCA-LINE-AREA
SC9608                                    UTVTACCA-CALL-PARAM.
S15173     IF ST-STATUS-LEVEL-1 = 1
S15173        MOVE 1 TO WA-MSG-ERR-FLAG
S15173     END-IF.
059040**** RESTORE STARTAREA

059060     IF STRT-AREA-TRN-NO = 1145 OR 6145
059070        MULTIPLY WA-DUMMY-AMT BY -1 GIVING WA-DUMMY-AMT.

059090     MOVE WA-SAVE-ST-AREA-TRN-NO  TO STRT-AREA-TRN-NO.
059100     MOVE WA-SAVE-ST-AREA-INPUT-MSG TO WA-INPUT-MESSAGE.
059110     MOVE WA-SAVE-ST-AREA-DATA    TO STRT-AREA-DATA.
059120     MOVE WA-SAVE-BORM-AREA       TO BORM-RECORD-AREA.
059130     MOVE 0 TO WA-SAVE-COMM-FLAG
059140               WA-SAVE-CHANGE-FLAG.

059160 H199-EXIT.
059170    EXIT.
SC5378*
SC5378 H200-VERIFY-FEDI-FEE-TXN.
SC5378      MOVE "N" TO WA-FEDI-FEE-FLAG.
SC5378      MOVE 0   TO WA-SAVE-FEDI-TO-AMT.
SC7091*     IF NOT (STRT-AREA-TRN-NO = 11055 OR 11155)
SC7091      IF NOT (STRT-AREA-TRN-NO = 11055 OR 11155
SC7091                              OR 16055 OR 16155)
SC5378      OR NOT (WA2-FEDI-FEE-CHRG-TYPE = "1" OR "2")
SC5378         GO TO H299-EXIT.
SC5378      IF WA2-FEDI-NET-FEE-RECEIVB NUMERIC
SC5378      AND WA2-FEDI-NET-FEE-RECEIVD NUMERIC
SC5378      AND FEDI-TO-TXN-AMT NUMERIC
SC5378         COMPUTE WA-SAVE-FEDI-TO-AMT = WA-ADV-AMOUNT
SC5378                      - WA2-FEDI-NET-FEE-RECEIVD
SC5378         IF WA-SAVE-FEDI-TO-AMT = FEDI-TO-TXN-AMT
SC5378            MOVE "Y"             TO WA-FEDI-FEE-FLAG
SC5378         END-IF
SC5378      END-IF.
SC5378 H299-EXIT.
SC5378      EXIT.
SC5378*
TB0221 F000-POST-COSH-RECORD.
TB0221*------ BUILD COSH KEY.
S16782      IF   (BORM-ACT-TYPE  (1:1)   =  "6"  OR "8")
S16782          AND BOIS-NEGO-RATE-IND = "1"
S16782          AND BOIS-RATE-EXP-DATE > 0
S16782              GO TO F099-EXIT
S16782      END-IF.
S17755      IF   BORP-ILOAN-R
S19705        OR PROD-RICHART
S17755           GO TO F099-EXIT
S17755      END-IF.
TB0221      MOVE STRT-AREA-SOC-NO TO COSH-SOC-NO.
TB0221      MOVE WA-INPUT-ACCT-NO TO COSH-ACCT-NO.
TB0221*-----calculate expiry date,cost rate on first advance date.
TB0221      EVALUATE BOIS-COST-FUND-TYPE
TB0221         WHEN 1
TB0221             PERFORM F100-COST-FUND-TYPE1 THRU F199-EXIT
TB0221         WHEN 2
TB0221             PERFORM F200-COST-FUND-TYPE2 THRU F299-EXIT
TB0221         WHEN 3
TB0221             PERFORM F300-COST-FUND-TYPE3 THRU F399-EXIT
TB0221         WHEN 4
TB0221             PERFORM F400-COST-FUND-TYPE4 THRU F499-EXIT
TB0221         WHEN OTHER
TB0221             IF BOIS-PROJECT-ID NOT = ZEROES
TB0221                PERFORM F500-READ-PRJP-REC  THRU F599-EXIT
TB0221             ELSE
TB0221                GO TO F099-EXIT
TB0221             END-IF
TB0221      END-EVALUATE.
TB0221      IF WA-MSG-ERR-FLAG = 0
TB0221         PERFORM F800-WRITE-COSH-RECORD THRU F899-EXIT
TB0221         MOVE COSH-EXP-DATE   TO BOIS-COST-EXP-DATE
TB0221         MOVE COSH-SUB-CODE   TO BOIS-SUB-CODE
TB0221         MOVE WA-TEMP-SEQ-NUM TO BOIS-SUB-SEQ-NO.
TB0221 F099-EXIT.
TB0221      EXIT.

TB0221 F100-COST-FUND-TYPE1.
TB0221      MOVE BOIS-MATURITY-DATE TO COSH-EXP-DATE
TB0221      MOVE WA-TODAY-BIN-DATE  TO COSH-EFF-DATE
TB0196                                 COSH-ADV-DATE
TB0196      IF BORP-INTERBR-BASE-ID NOT = SPACES
TB0221            AND BORP-INTERBR-RATE-ID  NOT = SPACES
TB0196         MOVE BORP-INTERBR-BASE-ID TO UT0298CA-CALL-BASE-ID
TB0221         MOVE BORP-INTERBR-RATE-ID TO UT0298CA-CALL-RATE-ID
TB0221         PERFORM F600-SEARCH-RATE-TABLE THRU F699-EXIT
TB0221      END-IF.
TB0221 F199-EXIT.
TB0221      EXIT.

TB0221 F200-COST-FUND-TYPE2.
TB0221         MOVE BOIS-RATE-EXP-DATE TO COSH-EXP-DATE
TB0221         MOVE BOIS-COST-RATE     TO COSH-RATE
TB0196         MOVE WA-TODAY-BIN-DATE  TO COSH-ADV-DATE
TB0221         MOVE WA-TODAY-BIN-DATE  TO COSH-EFF-DATE.
TB0221 F299-EXIT.
TB0221      EXIT.

TB0221 F300-COST-FUND-TYPE3.
TB0221      IF BOIS-COST-CODE NOT = SPACES
TB0221         PERFORM J100-FIND-VALID-SUB-CODE THRU J199-EXIT
TB0221         IF WA-MSG-ERR-FLAG NOT = 0
TB0221            GO TO F399-EXIT
TB0221         ELSE
TB0221            MOVE WA-TODAY-BIN-DATE TO UT0020-BINARY-DATE
TB0221            MOVE 1 TO UT0020-FUNCTION
TB0221            PERFORM X100-UT0020-PARA THRU X109-EXIT
TB0221            DIVIDE 12 INTO WA-TEMP-EFFECT-PRD
TB0221                    GIVING WA-TEMP-EFFECT-PRD-YR
TB0221                         REMAINDER WA-TEMP-EFFECT-PRD-MM
TB0221            ADD WA-TEMP-EFFECT-PRD-YR  TO UT0020-DATE-CCYY
TB0221            ADD WA-TEMP-EFFECT-PRD-MM  TO UT0020-DATE-MM
TB0221            IF UT0020-DATE-MM > 12
TB0221               ADD 1 TO UT0020-DATE-CCYY
TB0221               SUBTRACT 12 FROM UT0020-DATE-MM
TB0221            END-IF
TB0221            MOVE UT0020-DATE-AREA TO UT0030-DATE-DDMMCCYY
TB0221            PERFORM X200-UT0030-PARA THRU X209-EXIT
TB0221            MOVE UT0030-BINARY-DATE  TO COSH-EXP-DATE
TB0221         END-IF
TB0221      END-IF.
TB0221      MOVE WA-TODAY-BIN-DATE  TO COSH-ADV-DATE
TB0221      MOVE COSC-COST-CODE     TO COSH-COST-CODE
TB0221      MOVE COSC-SUB-CODE      TO COSH-SUB-CODE
TB0221      MOVE WA-TODAY-BIN-DATE  TO COSH-EFF-DATE
TB0221      MOVE COSR-COST-RATE     TO COSH-RATE.
TB0221 F399-EXIT.
TB0221      EXIT.

TB0221 F400-COST-FUND-TYPE4.
TB0221      MOVE BOIS-MATURITY-DATE TO COSH-EXP-DATE
TB0221      MOVE WA-TODAY-BIN-DATE  TO COSH-EFF-DATE
TB0196                                 COSH-ADV-DATE
TB0196      IF BOIS-COST-BASE-ID NOT = SPACES
TB0221         AND BOIS-COST-RATE-ID  NOT = SPACES
TB0196         MOVE BOIS-COST-BASE-ID TO UT0298CA-CALL-BASE-ID
TB0221         MOVE BOIS-COST-RATE-ID TO UT0298CA-CALL-RATE-ID
TB0221         PERFORM F600-SEARCH-RATE-TABLE THRU F699-EXIT.
TB0221 F499-EXIT.
TB0221      EXIT.

TB0221 F500-READ-PRJP-REC.
TB0221      MOVE STRT-AREA-SOC-NO TO PRJP-SOC-NO.
TB0221      MOVE BOIS-PROJECT-ID  TO PRJP-PROJ-ID.
TB0221      MOVE 0                TO DBIOMOD-KEY-NO.
TB0221      MOVE PRJP-KEY         TO DBIOMOD-KEY
TB0221      SET READ-CMD          TO TRUE.
TB0221      PERFORM J600-PRJP-CALL-DBIOMOD THRU J699-EXIT.
TB0221      EVALUATE DBIOMOD-STAT
TB0221         WHEN "MRNF"
TB0221               MOVE 1       TO WA-MSG-ERR-FLAG
TB0221               MOVE 3684    TO WA-OUTPUT-ERR-MSG-NO
TB0221               GO TO F599-EXIT
TB0221         WHEN "****"
TB0221               MOVE WA-TODAY-BIN-DATE     TO COSH-EFF-DATE
TB0221               MOVE PRJP-COST-CODE        TO COSH-COST-CODE
TB0221               MOVE PRJP-COST-EXPIRY-DATE TO COSH-EXP-DATE
TB0221               MOVE PRJP-COST-CODE        TO COSH-COST-CODE
TB0196               IF PRJP-COST-BASE-ID NOT = SPACES
TB0221                  AND PRJP-COST-RATE-ID  NOT = SPACES
TB0221                  MOVE PRJP-COST-RATE-ID TO UT0298CA-CALL-RATE-ID
TB0196                  MOVE PRJP-COST-BASE-ID TO UT0298CA-CALL-BASE-ID
TB0221                  PERFORM F600-SEARCH-RATE-TABLE THRU F699-EXIT
TB0221               END-IF
TB0221               MOVE WA-TODAY-BIN-DATE    TO COSH-EFF-DATE
TB0221               MOVE WA-TODAY-BIN-DATE    TO COSH-ADV-DATE
TB0221         WHEN OTHER
TB0221               MOVE 1       TO WA-MSG-ERR-FLAG
TB0221               MOVE 3685    TO WA-OUTPUT-ERR-MSG-NO
TB0221               GO TO F599-EXIT
TB0221      END-EVALUATE.
TB0221 F599-EXIT.
TB0221      EXIT.

TB0221 F600-SEARCH-RATE-TABLE.
TB0221        MOVE BORP-SOC-NO        TO UT0298CA-CALL-SOC-NO
TB0221        MOVE BORP-ACCT-TYPE     TO UT0298CA-CALL-ACCT-TYPE
TB0221        MOVE BORP-INT-CAT       TO UT0298CA-CALL-INT-CAT
TB0221        MOVE "BOR"              TO UT0298CA-CALL-SYS
TB0221*       MOVE 2                  TO UT0298CA-CALL-CODE
SC0430        MOVE 4                  TO UT0298CA-CALL-CODE
TB0221        MOVE WA-TODAY-BIN-DATE  TO UT0298CA-CALL-TXN-DATE
TB0221        CALL "UT0298" USING UT0298CA-CALL-AREA
TB0221        IF UT0298CA-RET-STATUS = 0
TB0221           MOVE UT0298CA-RET-EFF-RATE TO COSH-RATE
TB0221        ELSE
TB0221           DISPLAY "BR0024:(F600) - INVALID CALL TO UT0298, "
TB0221             "STATUS:"    UT0298CA-RET-STATUS
TB0221             " FOR BORP:" UT0298CA-CALL-KEY
TB0221             ", ACCT:"   WA-INPUT-ACCT-NO
TB0221           MOVE 1     TO WA-MSG-ERR-FLAG
TB0196           MOVE 1920  TO WA-OUTPUT-ERR-MSG-NO
TB0221           GO TO F699-EXIT
TB0221      END-IF.
TB0221 F699-EXIT.
TB0221      EXIT.

TB0221 F800-WRITE-COSH-RECORD.
TB0221      MOVE WA-INPUT-ACCT-NO  TO COSH-ACCT-NO
TB0221      MOVE BORP-SOC-NO       TO COSH-SOC-NO
TB0221      MOVE 0                 TO DBIOMOD-KEY-NO.
TB0221      MOVE COSH-KEY          TO DBIOMOD-KEY
TP0019      MOVE "WRITE"           TO DBIOMOD-FUNCTION
TB0221**--  SET WRITE-CMD   TO TRUE
TB0221      PERFORM J900-COSH-CALL-DBIOMOD THRU J999-EXIT.
TB0221      EVALUATE DBIOMOD-STAT
TB0221          WHEN "****"
TB0221               CONTINUE
TB0221          WHEN OTHER
TB0221               MOVE 3662       TO WA-OUTPUT-ERR-MSG-NO
TB0221               MOVE 1          TO WA-MSG-ERR-FLAG
TB0221               GO TO F899-EXIT
TB0221      END-EVALUATE.
TB0221 F899-EXIT.
TB0221      EXIT.

SC0183 F900-DELETE-COSH-RECORD.
SC0183      MOVE BORP-SOC-NO       TO WA-COSH-SOC-NO.
SC0183      MOVE WA-INPUT-ACCT-NO  TO WA-COSH-ACCT-NO.
SC0183      MOVE 0                 TO WA-COSH-EFF-DATE.
SC0183      MOVE 0                 TO DBIOMOD-KEY-NO.
SC0183      MOVE WA-COSH-KEY       TO DBIOMOD-KEY.
SC0183      MOVE "READNEXT"        TO DBIOMOD-FUNCTION.
SC0183      PERFORM J900-COSH-CALL-DBIOMOD THRU J999-EXIT.
SC0183      EVALUATE DBIOMOD-STAT
SC0183          WHEN "****"
SC0183               CONTINUE
SC0183          WHEN "MRNF"
SC0183               GO TO F999-EXIT
SC0183          WHEN OTHER
SC0183               MOVE 3662     TO WA-OUTPUT-ERR-MSG-NO
SC0183               MOVE 1        TO WA-MSG-ERR-FLAG
SC0183               GO TO F999-EXIT
SC0183      END-EVALUATE.
SC0183      MOVE COSH-EFF-DATE     TO WA-COSH-EFF-DATE.
SC0183      MOVE WA-COSH-KEY       TO DBIOMOD-KEY.
SC0183      MOVE "DELETE"          TO DBIOMOD-FUNCTION
SC0183      PERFORM J900-COSH-CALL-DBIOMOD THRU J999-EXIT.
SC0183      EVALUATE DBIOMOD-STAT
SC0183          WHEN "****"
SC0183               CONTINUE
SC0183          WHEN "MRNF"
SC0183               CONTINUE
SC0183          WHEN OTHER
SC0183               MOVE 3662     TO WA-OUTPUT-ERR-MSG-NO
SC0183               MOVE 1        TO WA-MSG-ERR-FLAG
SC0183               GO TO F999-EXIT
SC0183      END-EVALUATE.
SC0183 F999-EXIT.
SC0183      EXIT.

TB0221 J100-FIND-VALID-SUB-CODE.
TB0221      INITIALIZE COSC-RECORD
TB0221      MOVE STRT-AREA-SOC-NO   TO COSC-SOC-NO
TB0221      MOVE BOIS-COST-CODE     TO COSC-COST-CODE
TB0221      MOVE 0                  TO DBIOMOD-KEY-NO.
TB0221      MOVE COSC-KEY           TO DBIOMOD-KEY
TB0221      SET READFIRST-CMD       TO TRUE.
TB0221      PERFORM J700-COSC-CALL-DBIOMOD THRU J799-EXIT.
TB0221      EVALUATE DBIOMOD-STAT
TB0221         WHEN "MRNF"
TB0221              PERFORM F100-COST-FUND-TYPE1 THRU F199-EXIT
TB0221         WHEN "****"
TB0221              PERFORM J300-VAL-ADV-DATE THRU J399-EXIT
TB0221         WHEN OTHER
TB0221              MOVE 1       TO WA-MSG-ERR-FLAG
TB0221              MOVE 3659    TO WA-OUTPUT-ERR-MSG-NO
TB0221              GO TO J199-EXIT
TB0221      END-EVALUATE.
TB0221      IF COSC-SUB-CODE NOT = SPACES
TB0221         PERFORM J400-FIND-COSR-SUB-CODE THRU J499-EXIT.
TB0221 J199-EXIT.
TB0221      EXIT.

TB0221 J200-READNEXT-COMMAND.
SC6094      MOVE COSC-KEY    TO DBIOMOD-KEY
TB0221      SET READNEXT-CMD TO TRUE
TB0221      MOVE "****"      TO DBIOMOD-STAT.
TB0221      PERFORM J700-COSC-CALL-DBIOMOD THRU J799-EXIT UNTIL
TB0221              ( COSC-ADV-STRT-DATE <= WA-TODAY-BIN-DATE AND
TB0221               COSC-ADV-END-DATE >= WA-TODAY-BIN-DATE AND
TB0221               COSC-COST-CODE = BOIS-COST-CODE ) OR
TB0221               DBIOMOD-STAT NOT = "****".
TB0221      IF DBIOMOD-STAT = "****"
TB0221         MOVE COSC-SUB-CODE TO COSR-SUB-CODE
TB0221      ELSE
TB0221         IF DBIOMOD-STAT = "MRNF"
TB0221            PERFORM F100-COST-FUND-TYPE1 THRU F199-EXIT
TB0221         ELSE
TB0221            MOVE 3659  TO  WA-OUTPUT-ERR-MSG-NO
TB0221            MOVE 1     TO  WA-MSG-ERR-FLAG
TB0221            GO TO J299-EXIT
TB0221         END-IF
TB0221      END-IF.
TB0221 J299-EXIT.
TB0221      EXIT.

TB0221 J300-VAL-ADV-DATE.
TB0221      IF NOT ( COSC-ADV-STRT-DATE <= WA-TODAY-BIN-DATE AND
TB0221               COSC-ADV-END-DATE >= WA-TODAY-BIN-DATE AND
TB0221               COSC-COST-CODE = BOIS-COST-CODE )
TB0221         PERFORM J200-READNEXT-COMMAND THRU J299-EXIT
TB0221      ELSE
TB0221         MOVE COSC-SUB-CODE TO COSR-SUB-CODE.
TB0221 J399-EXIT.
TB0221      EXIT.

TB0221 J400-FIND-COSR-SUB-CODE.
TB0221      INITIALIZE COSR-RECORD
TB0221      MOVE STRT-AREA-SOC-NO   TO COSR-SOC-NO
TB0221      MOVE COSC-SUB-CODE      TO COSR-SUB-CODE
TB0221      MOVE 9999               TO COSR-SEQ-NUM.
TB0221      MOVE 0                  TO DBIOMOD-KEY-NO.
TB0221      MOVE COSR-KEY           TO DBIOMOD-KEY
TB0221      SET READ-CMD            TO TRUE.
TB0221      PERFORM J800-COSR-CALL-DBIOMOD THRU J899-EXIT.
TB0221      EVALUATE DBIOMOD-STAT
TB0221         WHEN "****"
TB0221               MOVE COSR-COST-RATE  TO COSH-RATE
TB0221               MOVE COSR-EFFECT-PRD TO WA-TEMP-EFFECT-PRD
TB0221               MOVE COSR-SEQ-NUM    TO WA-TEMP-SEQ-NUM
TB0221         WHEN "MRNF"
TB0221               PERFORM J500-READNEXT-COMMAND THRU J599-EXIT
TB0221         WHEN OTHER
TB0221              MOVE 3660    TO WA-OUTPUT-ERR-MSG-NO
TB0221              MOVE 1       TO WA-MSG-ERR-FLAG
TB0221              GO TO J499-EXIT
TB0221      END-EVALUATE.
TB0221 J499-EXIT.
TB0221      EXIT.

TB0221 J500-READNEXT-COMMAND.
TB0221      MOVE COSR-KEY    TO DBIOMOD-KEY
TB0221      SET READNEXT-CMD TO TRUE
TB0221      PERFORM J800-COSR-CALL-DBIOMOD THRU J899-EXIT
TB0221      IF DBIOMOD-STAT = "****"
TB0221         MOVE COSR-COST-RATE  TO COSH-RATE
TB0221         MOVE COSR-EFFECT-PRD TO WA-TEMP-EFFECT-PRD
TB0221         MOVE COSR-SEQ-NUM    TO WA-TEMP-SEQ-NUM
TB0221      ELSE
TB0221         MOVE 3661       TO WA-OUTPUT-ERR-MSG-NO
TB0221         MOVE 1          TO WA-MSG-ERR-FLAG
TB0221         GO TO J599-EXIT
TB0221      END-IF.
TB0221 J599-EXIT.
TB0221      EXIT.

TB0221 J600-PRJP-CALL-DBIOMOD.
TB0221      MOVE "PRJP"           TO DBIOMOD-FILE
TB0221                               DBIOMOD-SUFFIX.
TB0221      MOVE "DBIO"           TO DBIOMOD-PREFIX.
TB0221      MOVE SPACES           TO DBIOMOD-RELEASE-LOCK
TB0221                               DBIOMOD-ACCESS-COMMAND
TB0221                               DBIOMOD-ACCESS-COND
TB0221                               DBIOMOD-STATUS.
TB0221
TB0221      CALL DBIOMODNAME  USING  DBIOMOD-FILE
TB0221                               DBIOMOD-KEY
TB0221                               PRJP-RECORD
TB0221                               DBIOMOD-FUNCTION
TB0221                               DBIOMOD-KEY-NO
TB0221                               DBIOMOD-RELEASE-LOCK
TB0221                               DBIOMOD-ACCESS-COMMAND
TB0221                               DBIOMOD-ACCESS-COND
TB0221                               DBIOMOD-STATUS.
TB0221
TB0221 J699-EXIT.
TB0221      EXIT.

TB0221 J700-COSC-CALL-DBIOMOD.
SC6094      MOVE COSC-KEY         TO DBIOMOD-KEY
TB0221      MOVE "COSC"           TO DBIOMOD-FILE
TB0221                               DBIOMOD-SUFFIX.
TB0221      MOVE "DBIO"           TO DBIOMOD-PREFIX.
TB0221      MOVE SPACES           TO DBIOMOD-RELEASE-LOCK
TB0221                               DBIOMOD-ACCESS-COMMAND
TB0221                               DBIOMOD-ACCESS-COND
TB0221                               DBIOMOD-STATUS.
TB0221
TB0221      CALL DBIOMODNAME  USING  DBIOMOD-FILE
TB0221                               DBIOMOD-KEY
TB0221                               COSC-RECORD
TB0221                               DBIOMOD-FUNCTION
TB0221                               DBIOMOD-KEY-NO
TB0221                               DBIOMOD-RELEASE-LOCK
TB0221                               DBIOMOD-ACCESS-COMMAND
TB0221                               DBIOMOD-ACCESS-COND
TB0221                               DBIOMOD-STATUS.
TB0221
TB0221 J799-EXIT.
TB0221      EXIT.

TB0221 J800-COSR-CALL-DBIOMOD.
TB0221      MOVE "COSR"           TO DBIOMOD-FILE
TB0221                               DBIOMOD-SUFFIX.
TB0221      MOVE "DBIO"           TO DBIOMOD-PREFIX.
TB0221      MOVE SPACES           TO DBIOMOD-RELEASE-LOCK
TB0221                               DBIOMOD-ACCESS-COMMAND
TB0221                               DBIOMOD-ACCESS-COND
TB0221                               DBIOMOD-STATUS.
TB0221
TB0221      CALL DBIOMODNAME  USING  DBIOMOD-FILE
TB0221                               DBIOMOD-KEY
TB0221                               COSR-RECORD
TB0221                               DBIOMOD-FUNCTION
TB0221                               DBIOMOD-KEY-NO
TB0221                               DBIOMOD-RELEASE-LOCK
TB0221                               DBIOMOD-ACCESS-COMMAND
TB0221                               DBIOMOD-ACCESS-COND
TB0221                               DBIOMOD-STATUS.
TB0221
TB0221 J899-EXIT.
TB0221      EXIT.

TB0221 J900-COSH-CALL-DBIOMOD.
TP0019      MOVE SPACES           TO DBIOMOD-STAT.
TB0221      MOVE "COSH"           TO DBIOMOD-FILE
TB0221                               DBIOMOD-SUFFIX.
TB0221      MOVE "DBIO"           TO DBIOMOD-PREFIX.
TB0221      MOVE SPACES           TO DBIOMOD-RELEASE-LOCK
TB0221                               DBIOMOD-ACCESS-COMMAND
TB0221                               DBIOMOD-ACCESS-COND
TB0221                               DBIOMOD-STATUS.
TB0221
TB0221      CALL DBIOMODNAME  USING  DBIOMOD-FILE
TB0221                               DBIOMOD-KEY
TB0221                               COSH-RECORD
TB0221                               DBIOMOD-FUNCTION
TB0221                               DBIOMOD-KEY-NO
TB0221                               DBIOMOD-RELEASE-LOCK
TB0221                               DBIOMOD-ACCESS-COMMAND
TB0221                               DBIOMOD-ACCESS-COND
TB0221                               DBIOMOD-STATUS.
TB0221
TB0221 J999-EXIT.
TB0221      EXIT.

TB0221*-----END OF COST HISTORY TRANSACTION.

S10293 K100-ACCESS-AO1P.
S10293      MOVE 02                 TO UTAO1PCA-CALL-CODE
S10293      MOVE ZEROES             TO UTAO1PCA-CALL-STATUS
S10293      MOVE ZEROES             TO UTAO1PCA-CALL-MSG-NO
S10293      MOVE STRT-AREA-SOC-NO   TO UTAO1PCA-INST-NO
S10293      MOVE BOIS-PROMO-TELLER  TO UTAO1PCA-PROM-TELLER
S10293      MOVE LOW-VALUES         TO UTAO1PCA-TELLER-TYPE
S10293      CALL  "UTAO1P"  USING UTAO1PCA-CALL-PARAM
S10293      IF UTAO1PCA-CALL-STATUS = 0
S10293         IF UTAO1PCA-ORG-CODE = SOC-TIF-ORG-CODE
S10293            MOVE 2            TO BOIS-TIB-ACCT-IND
S10293         ELSE
S10293            MOVE 0            TO BOIS-TIB-ACCT-IND
S10293         END-IF
S10293      ELSE
S10293          DISPLAY "BR0024:(K100) - INVALID CALL TO UTAO1P, "
S10293               "STATUS:"    UTAO1PCA-CALL-STATUS
S10293               " FOR AO1P:" UTAO1PCA-PROM-TELLER
S10293           MOVE 1             TO WA-MSG-ERR-FLAG
S10293           MOVE UTAO1PCA-CALL-MSG-NO
S10293                              TO WA-OUTPUT-ERR-MSG-NO
S10293           GO TO K199-EXIT
S10293      END-IF.
S10293 K199-EXIT.
S10293      EXIT.

059190 Z2000-READ-BIRM.
059200     MOVE "READ"               TO  DBIOMOD-FUNCTION.
059210     MOVE "BIRM"               TO  DBIOMOD-FILE
059220                                   DBIOMOD-SUFFIX.
059230     MOVE "DBIO"               TO  DBIOMOD-PREFIX.
059240     MOVE WA-BORM-KEY          TO  DBIOMOD-KEY
059250                                   BIRM-KEY.
059260     MOVE ZEROES               TO  DBIOMOD-KEY-NO.
059270     MOVE SPACES               TO  DBIOMOD-STATUS
059280                                   DBIOMOD-RELEASE-LOCK
059290                                   DBIOMOD-ACCESS-COMMAND
059300                                   DBIOMOD-ACCESS-COND.
059310     CALL DBIOMODNAME USING

059330                       DBIOMOD-FILE
059340                       DBIOMOD-KEY
059350                       BIRM-RECORD
059360                       DBIOMOD-FUNCTION
059370                       DBIOMOD-KEY-NO
059380                       DBIOMOD-RELEASE-LOCK
059390                       DBIOMOD-ACCESS-COMMAND
059400                       DBIOMOD-ACCESS-COND
059410                       DBIOMOD-STATUS.

059430     IF DBIOMOD-STAT NOT = "****"
059440         SET UT8500CA-NORMAL-DISPLAY TO TRUE
059450         MOVE SPACES TO UT8500CA-INPUT-MSG
059460         STRING "BR0024:(Z2000) BIRM READ ERROR "
059470                DBIOMOD-STAT
059480               " FOR " BIRM-KEY
059490             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
059500         MOVE "N" TO UT8500CA-RESPONSE-REQD-FLAG
059510         CALL "UT8500" USING

059530                          UT8500CA-AREA
059540         MOVE "BIRM" TO WA-DBERR-DATA-SET
059550         MOVE DBIOMOD-STAT TO WA-DB-ERROR
059560         MOVE 1            TO WA-MSG-ERR-FLAG
059570         MOVE 188 TO WA-OUTPUT-ERR-MSG-NO.
059580 Z2999-EXIT.
059590      EXIT.

059610 Z3000-REWRITE-BIRM.
059620     MOVE "REWRITE"            TO  DBIOMOD-FUNCTION.
059630     MOVE "BIRM"               TO  DBIOMOD-FILE
059640                                   DBIOMOD-SUFFIX.
059650     MOVE "DBIO"               TO  DBIOMOD-PREFIX.
059660     MOVE WA-BORM-KEY          TO  DBIOMOD-KEY
059670                                   BIRM-KEY.
059680     MOVE ZEROES               TO  DBIOMOD-KEY-NO.
059690     MOVE SPACES               TO  DBIOMOD-STATUS
059700                                   DBIOMOD-RELEASE-LOCK
059710                                   DBIOMOD-ACCESS-COMMAND
059720                                   DBIOMOD-ACCESS-COND.
059730     CALL DBIOMODNAME USING

059750                       DBIOMOD-FILE
059760                       DBIOMOD-KEY
059770                       BIRM-RECORD
059780                       DBIOMOD-FUNCTION
059790                       DBIOMOD-KEY-NO
059800                       DBIOMOD-RELEASE-LOCK
059810                       DBIOMOD-ACCESS-COMMAND
059820                       DBIOMOD-ACCESS-COND
059830                       DBIOMOD-STATUS.

059850      IF DBIOMOD-STAT NOT = "****"
059860            SET UT8500CA-NORMAL-DISPLAY TO TRUE
059870            MOVE SPACES TO UT8500CA-INPUT-MSG
059880            STRING "BR0024:(Z3000) BIRM REWRITE ERROR "
059890                   DBIOMOD-STAT
059900                  " FOR " BIRM-KEY
059910            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
059920            MOVE "N" TO UT8500CA-RESPONSE-REQD-FLAG
059930            CALL "UT8500" USING

059950                          UT8500CA-AREA
059960         MOVE "BIRM" TO WA-DBERR-DATA-SET
059970         MOVE DBIOMOD-STAT TO WA-DB-ERROR
059980         MOVE 1            TO WA-MSG-ERR-FLAG
059990         MOVE 3080 TO WA-OUTPUT-ERR-MSG-NO.
060000 Z3999-EXIT.
060010      EXIT.
TB0069**
TB0069**--start insert 
       Z4000-READ-BLDVNI.
           MOVE 61                 TO DBIO-CALL-FUNC
           MOVE STRT-AREA-SOC-NO   TO DBIO-01-SOC-NO
           MOVE WA-INPUT-ACCT-NO   TO DBIO-01-ACCT-NO
           MOVE DBIO-01-KEY        TO DBIO-CALL-KEY-AREA
           MOVE "BORM"             TO DBIO-CALL-N-SYS
           MOVE "BLDV"             TO DBIO-CALL-SYST-VAR
           MOVE "NI"               TO BLDV-NI-TRAN-TYPE
           MOVE "NI"               TO DBIO-CALL-CODE-B
           MOVE 0                  TO DBIO-CALL-REFER-AREA
           MOVE SPACES             TO DBIO-CALL-STATUS

           CALL "DBIO" USING          DBIO-CALL-PARAM
                                      DBIO-CALL-SYS-AREA
                                      DBIO-CALL-KEY-AREA
                                      DBIO-CALL-STATUS
                                      WA-BLDV-AREA-NI
                                      DBIO-CALL-REFER-AREA
                                      DBIO-CALL-TXN-TYPE-AREA.

           IF DBIO-CALL-SAVE-REFER = "END."
              MOVE 3799             TO WA-OUTPUT-ERR-MSG-NO
              MOVE 1                TO WA-MSG-ERR-FLAG
           ELSE
           IF DBIO-CALL-STATUS NOT = "****"
              MOVE 155              TO WA-OUTPUT-ERR-MSG-NO
              MOVE 1                TO WA-MSG-ERR-FLAG
              MOVE "BLDV"           TO WA-OUTPUT-DATA-SET
              MOVE DBIO-CALL-STATUS TO WA-OUTPUT-STATUS
              MOVE UT8500CA-FUNC-NORMAL-DISPLAY
                                    TO UT8500CA-CALL-CODE
              MOVE SPACES           TO UT8500CA-INPUT-MSG
              STRING "BR0024:(Z4000) READ BLDVNI ERROR"
                     ", SAVE-REFER = " DBIO-CALL-SAVE-REFER
                     ", DBIO-STAT  = " DBIO-CALL-STATUS
                     ", KEY = " DBIO-CALL-KEY-AREA
                   DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
              CALL "UT8500" USING
                                     UT8500CA-AREA.
       Z4999-EXIT.
            EXIT.
TB0069**---end insert
S10490 Z5000-BLDVNI-UPDATE.                                
S10490     MOVE STRT-AREA-SOC-NO    TO DBIO-01-SOC-NO.     
S10490     MOVE WA-INPUT-ACCT-NO    TO DBIO-01-ACCT-NO.    
S10490     MOVE DBIO-01-KEY         TO DBIO-CALL-KEY-AREA. 
S10490     MOVE 64                  TO DBIO-CALL-FUNC.     
S10490     MOVE "BORM"              TO DBIO-CALL-N-SYS     
S10490     MOVE "BLDV"              TO DBIO-CALL-SYST-VAR  
S10490     MOVE "NI"                TO BLDV-NI-TRAN-TYPE   
S10490     MOVE "NI"                TO DBIO-CALL-CODE-B    
S10490     MOVE SPACES              TO DBIO-CALL-STATUS.   
S10490                                                     
S10490     CALL "DBIO" USING DBIO-CALL-PARAM               
S10490                            DBIO-CALL-SYS-AREA       
S10490                            DBIO-CALL-KEY-AREA       
S10490                            DBIO-CALL-STATUS         
S10490                            WA-BLDV-AREA-NI          
S10490                            DBIO-CALL-REFER-AREA     
S10490                            DBIO-CALL-TXN-TYPE-AREA. 
S10490                                                     
S10490     IF DBIO-CALL-STATUS NOT = "****"                
S10490     OR DBIO-CALL-SAVE-REFER = "END."                
S10490        MOVE 155              TO WA-OUTPUT-ERR-MSG-NO
S10490        MOVE 1                TO WA-MSG-ERR-FLAG     
S10490        MOVE "BLDV"           TO WA-OUTPUT-DATA-SET   
S10490        MOVE DBIO-CALL-STATUS TO WA-OUTPUT-STATUS     
S10490        MOVE UT8500CA-FUNC-NORMAL-DISPLAY             
S10490                              TO UT8500CA-CALL-CODE   
S10490        MOVE SPACES           TO UT8500CA-INPUT-MSG   
S10490        STRING "BR0024:(Z5000) REWRITE BLDVNI ERROR"  
S10490               ", SAVE-REFER = " DBIO-CALL-SAVE-REFER 
S10490               ", DBIO-STAT  = " DBIO-CALL-STATUS     
S10490               ", KEY = " DBIO-CALL-KEY-AREA          
S10490            DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG 
S10490        CALL "UT8500" USING UT8500CA-AREA             
S10490     END-IF.                                          
S10490                                                      
S10490 Z5999-EXIT.                                          
S10490     EXIT.                                            
TB0082*
TB0082*=================================
TB0082* START OF FSLON0042 ---- ADVANCE
TB0082*=================================
TB0082*
       VALIDATE-ADVANCES.
      *------------------

S16564      IF  STRT-TRICKLE-TXN
S16564      AND BORP-FOREIGN-LABORER
S16899          MOVE BORM-SOC-NO         TO CUSM-SOC-NO
S16899          MOVE WA-DEP-ACCT-NO      TO CUSM-CUST-ACCT-NO
S16899          PERFORM P300-READ-CUSM  THRU P399-EXIT
S16899          IF WA-MSG-ERR-FLAG = 1
S16899             GO TO VALIDATE-ADVANCES-EXIT
S16899          END-IF
S16899          IF CUSM-ACCOUNT-SYSTEM = "DEP"
S16564             MOVE WA-DEP-ACCT-NO(3:14) TO BOIS-LABOR-ACCT
S16899          END-IF
S16976          IF  CUSM-ACCOUNT-SYSTEM = "GEN"
S16976          AND VIR-AC-FOR-REORG-PROD IS NUMERIC
S16976          AND VIR-AC-FOR-REORG-PROD NOT = ZEROS
S16976              MOVE VIR-AC-FOR-REORG-PROD TO CUSM-CUST-ACCT-NO
S16976              PERFORM P300-READ-CUSM  THRU P399-EXIT
S16976              IF WA-MSG-ERR-FLAG = 1
S16976                 GO TO VALIDATE-ADVANCES-EXIT
S16976              END-IF
S16976              IF CUSM-ACCOUNT-SYSTEM = "DEP"
S16976                 MOVE VIR-AC-FOR-REORG-PROD(3:14)
S16976                   TO BOIS-LABOR-ACCT
S16976              END-IF
S16976          END-IF
S16564      END-IF.
SC6175      MOVE BOIS-MATURITY-DATE TO WA-SAVE-MATURITY-DATE.  
SC6175      IF BORM-STAT < 6  
SC6175         MOVE SPACES TO BOIS-MATURITY-IND  
SC6175         IF BOIS-MATURITY-DATE > 0  
SC6175            SET BOIS-MATURITY-ENTERED TO TRUE.  

S10062      IF BORP-CONSMR-MORT-COMBI
S10062         AND (BOIS-SORD-AUTO-DBT-ACCT-NO <> 0 AND SPACES)
S10062         AND (BOIS-OD-ACCT-NUMBER = 0 OR SPACES)
S10062         MOVE 1                   TO WA-MSG-ERR-FLAG
S10062         MOVE 3677                TO WA-OUTPUT-ERR-MSG-NO
S10062         GO                       TO VALIDATE-ADVANCES-EXIT
S10062     END-IF.

S10260     IF BORM-CAPN-METHOD = 'X'                             
S10260      AND (STRT-AREA-TRN-NO NOT = 11055 AND 11155)         
S10260         MOVE 1                   TO WA-MSG-ERR-FLAG       
S10260         MOVE 201                 TO WA-OUTPUT-ERR-MSG-NO  
S10260         GO                       TO VALIDATE-ADVANCES-EXIT
S10260     END-IF.                                               
S10260                                                           

S17755    IF  BORP-ILOAN-R
S17755    AND WA-INPUT-PARAM-TABLE(7)  = 0
S17755    AND WA-INPUT-PARAM-TABLE(8)  = 1
S17755    AND WA-BEFORE-BORN-STAT      < 6
S17755      MOVE STRT-AREA-POST-DT    TO UT0020-BINARY-DATE
S17755      PERFORM Z110-CONVERT-BINARY-TO-DATE THRU Z119-EXIT
S17755      MOVE UT0020-DATE-CCYYMMDD TO WA-TEMP-CCYYMMDD
S17755      IF  WA-TEMP-DD            >= BORM-REPAY-DAY
S17755      AND WA-ADV-TXN-DATE(1:2)   < BORM-REPAY-DAY
S17755          MOVE "Y"              TO BOIS-DUE-DTE-IND
S17755      END-IF
S17755    END-IF.
      **--Computation of Maturity Date 
            IF BORM-STAT < 06 AND
               BOIS-MATURITY-DATE = ZEROES
               INITIALIZE UT0312CA-CALL-PARAMETER
TB0159         IF BORP-YOUBE
TB0159           MOVE 16 TO UT0312CA-CALL-CODE
TB0159           IF BORM-APPRV-DATE = 0
TB0159              MOVE BORM-APPLIC-ISSUE-DATE TO UT0312CA-EFF-DATE
TB0159           ELSE
TB0159              MOVE BORM-APPRV-DATE TO UT0312CA-EFF-DATE
TB0159                                      UT0312CA-DUE-STRT-DT
TB0159           END-IF
TB0159           MOVE BORM-LOAN-TRM          TO UT0312CA-LOAN-TERM
TB0159           MOVE BORM-TERM-BASIS        TO UT0312CA-TERM-BASIS
TB0159         ELSE
SC1025           IF   BORM-TERM-BASIS        =  "M"
SC1025                MOVE 16                TO UT0312CA-CALL-CODE
SC1025           ELSE
SC1025                MOVE 04                TO UT0312CA-CALL-CODE
SC1025           END-IF
SC0525*          MOVE WA-TODAY-BIN-DATE   TO UT0312CA-EFF-DATE
SC0525           IF WA-INPUT-PARAM-TABLE(8) = 1
SC0525              MOVE WA-ADV-TXN-DATE    TO UT0030-DATE-DDMMCCYY
SC0525              MOVE 1                  TO UT0030-FUNCTION
SC0525              CALL "UT0030"   USING      UT0030-FUNCTION
SC0525                                         UT0030-DATE-AREA
SC0525                                         UT0030-BINARY-DATE
SC0525              MOVE UT0030-BINARY-DATE TO UT0312CA-EFF-DATE
SC0525           ELSE
SC0525              MOVE WA-TODAY-BIN-DATE TO UT0312CA-EFF-DATE
SC0525           END-IF
SC0525
                 MOVE BORM-REPAY-SCHED    TO UT0312CA-REPAY-SCHED
                 MOVE BORM-KEY            TO UT0312CA-ACCT-KEY
TB0169           IF BORM-DUE-STRT-DATE = 0
SC0525              IF WA-INPUT-PARAM-TABLE(8) = 1
SC0525                 MOVE UT0030-BINARY-DATE TO UT0312CA-DUE-STRT-DT
SC1644*SC9916          IF BOIS-STRT-GRACE-PERIOD > UT0030-BINARY-DATE
SC1644                    MOVE UT0030-BINARY-DATE TO
SC1644                                         BOIS-STRT-GRACE-PERIOD
SC1644*SC9916          END-IF
SC0525              ELSE
SC0525                 MOVE STRT-AREA-POST-DT  TO UT0312CA-DUE-STRT-DT
SC9916                 IF BOIS-STRT-GRACE-PERIOD < STRT-AREA-POST-DT
SC9916                    MOVE STRT-AREA-POST-DT TO
SC9916                                            BOIS-STRT-GRACE-PERIOD
SC9916                 END-IF
SC0525              END-IF
SC0525*             MOVE STRT-AREA-POST-DT
SC0525*                                   TO UT0312CA-DUE-STRT-DT
TB0169           ELSE
                    MOVE BORM-DUE-STRT-DATE  TO UT0312CA-DUE-STRT-DT
TB0169           END-IF
                 MOVE BORM-REPAY-FREQ     TO UT0312CA-REPAY-FREQ
                 MOVE BORM-CAPN-METHOD    TO UT0312CA-CAPN-METHOD
                 MOVE BORM-LOAN-TRM       TO UT0312CA-LOAN-TERM
                 MOVE BORM-TERM-BASIS     TO UT0312CA-TERM-BASIS
                 MOVE BORM-REPAY-DAY      TO UT0312CA-REPAY-DAY

                 SET UT0312CA-HOLIDAY-DUE-PREV-WD TO TRUE
TB0159         END-IF
DUEIND         MOVE BOIS-DUE-DTE-IND    TO UT0312CA-1ST-DUE-DTE-IND
               CALL "UT0312" USING
                             UT0312CA-CALL-AREA

               IF UT0312CA-RET-STATUS <> ZEROES
                  MOVE 1                   TO WA-MSG-ERR-FLAG
                  MOVE 3026                TO WA-OUTPUT-ERR-MSG-NO
                  MOVE UT0312CA-RET-STATUS TO WA-OUTPUT-STATUS
                  GO                       TO VALIDATE-ADVANCES-EXIT
               ELSE
                  MOVE UT0312CA-MATURITY-DT TO BOIS-MATURITY-DATE
               END-IF

SC6175      END-IF.                                              
SC6175      IF BORM-STAT < 6                                
SC4393       AND WA-INPUT-PARAM-TABLE(8) = 1                  
SC4393       AND WA-INPUT-PARAM-TABLE(7) = 0                  
SC4393       AND NOT BORP-YOUBE                               
SC4393         MOVE WA-ADV-TXN-DATE      TO WA-ADVANCE-DATE   
SC4393         MOVE 0                    TO WA-COUNT-LOAN-TERM
sC4393                                                           
SC4393         PERFORM RECALC-LOAN-TERM                       
SC4393            THRU RECALC-LOAN-TERM-EXIT                  
SC6175         SET BORM-NO-ADDL-BILLING TO TRUE                  
SC6175         IF WA-SAVE-MATURITY-DATE NOT = 0  
SC4835            MOVE WA-COUNT-LOAN-TERM TO BORM-LOAN-TRM
SC6175                                       BORM-REM-REPAYS  
S17755            IF BORP-ILOAN-R
S17755               IF BORM-LOAN-TRM      > BORP-MAX-TERM
S17755                 MOVE BORP-MAX-TERM TO BORM-LOAN-TRM
S17755                                       BORM-REM-REPAYS
S17755                 SET BORM-1-ADDL-BILLING TO TRUE
S17755               END-IF
S17755               MOVE BORM-LOAN-TRM  TO BOIS-STRETCH-TERM
S17755            END-IF
S10467            IF (BORM-LOAN-TRM * BORM-REPAY-FREQ) > BORP-MAX-TERM  
S10467             OR (BORM-LOAN-TRM * BORM-REPAY-FREQ) < BORP-MIN-TERM 
S10467              IF (BORM-LOAN-TRM * BORM-REPAY-FREQ) > BORP-MAX-TERM
S15871               AND (BOIS-AGREE-FUNC-USE)
S15871*S10467               AND BOIS-AGREE-IND = 2
S10467                NEXT SENTENCE                                     
S10467              ELSE                                                
S10467                MOVE 771 TO WA-OUTPUT-ERR-MSG-NO                  
S10467                MOVE 1   TO WA-MSG-ERR-FLAG                       
S10467              END-IF                                              
S10467            END-IF                                                
SC6175         ELSE  
SC6175            IF WA-COUNT-LOAN-TERM > BORM-LOAN-TRM  
SC6175               SET BORM-1-ADDL-BILLING TO TRUE  
SC6175            END-IF  
SC6175         END-IF  
SC4393                                                           
SC4393         IF WA-MSG-ERR-FLAG = 1                         
SC4393            GO TO VALIDATE-ADVANCES-EXIT                
SC4393         END-IF                                         
            END-IF.

SC6309**--IF BORP-YOUBE IS MATURED DONT ALLOW DRAWDOWN FROM ACCT LIMIT
SC6309**--BUT ONLY ALLOW TO WITHDRAW FROM TEMP RECEIVABLE.
SC6309      IF BORP-YOUBE
S12709*SC6309         IF STRT-AREA-POST-DT > BOIS-MATURITY-DATE
S12709         IF (STRT-AREA-POST-DT > BOIS-MATURITY-DATE OR
S12709            (BORP-YB-PROD AND BORM-LOAN-BAL = 0 AND
S12709            (BORM-STAT = 01 OR
S12709             BORM-LST-FIN-DATE < BORM-APPRV-DATE) AND
S12709             STRT-AREA-POST-DT = BOIS-MATURITY-DATE))
S11455         AND WA-ADV-AMORT-FLAG NOT = "A"
S11455         AND WA-ADV-AMORT-FLAG NOT = "F"
S11455         AND WA-ADV-AMORT-FLAG NOT = "R"
SC6309            IF BORM-LOAN-BAL >= 0
SC6309               MOVE 2866 TO WA-OUTPUT-ERR-MSG-NO
SC6309               MOVE 1    TO WA-MSG-ERR-FLAG
SC6309               GO TO VALIDATE-ADVANCES-EXIT
SC6309            ELSE
SC6309               COMPUTE WA-TEMP-RECEIVABLE = BORM-LOAN-BAL * -1
SC6309               IF WA-INPUT-AMT > WA-TEMP-RECEIVABLE
S11246                  MOVE 4514 TO WA-OUTPUT-ERR-MSG-NO
S11246*SC6309                  MOVE 3314 TO WA-OUTPUT-ERR-MSG-NO
SC6309                  MOVE 1    TO WA-MSG-ERR-FLAG
SC6309                  GO TO VALIDATE-ADVANCES-EXIT
SC6309               END-IF
SC6309            END-IF
SC6309         END-IF
SC6309      END-IF.
S11797      IF  BORM-LOAN-BAL < 0
S11797          COMPUTE WA-AVAILABLE-LIMIT = 0
S11797                                     - BORM-LOAN-BAL
S11797                                     - BOIS-HOLD-AMT
S11797                                     - BOIS-UNAMORTIZED-DUE
S11797      ELSE
S11797          MOVE 0                    TO WA-AVAILABLE-LIMIT
S11797      END-IF.
S11218**--IF YOUBE ACCT HAVE BEEN SET TEMPORARILY STOP, DO NOT ALLOW
S11218**--WITHDRAW TXN
S12046      IF BORP-YOUBE AND BORP-SUB-TYPE = "D"
S12046         IF BORM-STOP-TRAN-IND = "Y"
S12046            AND WA-INPUT-PARAM-TABLE (5) = 1
S12046            AND WA-INPUT-PARAM-TABLE (7) NOT = 1
S12046            AND (NOT STRT-BANCSLINK
S12046             OR  WA-INPUT-PARAM-TABLE (8) = 0)
S12046            AND NOT  STRT-REPOST-TXN
S12046            AND NOT ((STRT-AREA-TRN-NO = 11058 OR 16058)
S12046            AND STRT-BATCH-TRICKLE-TXN)
S12046            AND NOT (STRT-AREA-TRN-NO = 16050
S12046            AND STRT-BATCH-TRICKLE-TXN)
S12046            AND NOT (WA-ADV-AMOUNT <= WA-AVAILABLE-LIMIT
S12046            AND WA-AVAILABLE-LIMIT > 0 )
S12046            MOVE 4632 TO WA-OUTPUT-ERR-MSG-NO
S12046            MOVE 1    TO WA-MSG-ERR-FLAG
S12046            GO TO VALIDATE-ADVANCES-EXIT
S12046         END-IF
S12046      END-IF.
S11711*S11218      IF BORP-YOUBE
S11711      IF BORP-YOUBE AND BORP-SUB-TYPE = "D"
S12046         IF BORM-STOP-TRAN-IND = "X"
S12046*S11413         IF (BORM-STOP-TRAN-IND = "Y" OR "X")
S11413*S11218         IF BORM-STOP-TRAN-IND = "Y"
S11218            AND WA-INPUT-PARAM-TABLE (5) = 1
S11377            AND WA-INPUT-PARAM-TABLE (7) NOT = 1
S11377            AND NOT  STRT-REPOST-TXN
S11395            AND NOT  STRT-BANCSLINK
S11701            AND NOT ((STRT-AREA-TRN-NO = 11058 OR 16058)
S11701            AND STRT-BATCH-TRICKLE-TXN)
S11413            AND NOT (STRT-AREA-TRN-NO = 16050
S11413            AND STRT-BATCH-TRICKLE-TXN)
S11797            AND NOT (WA-ADV-AMOUNT <= WA-AVAILABLE-LIMIT
S11797            AND WA-AVAILABLE-LIMIT > 0 )
S11218            MOVE 4632 TO WA-OUTPUT-ERR-MSG-NO
S11218            MOVE 1    TO WA-MSG-ERR-FLAG
S11218            GO TO VALIDATE-ADVANCES-EXIT
S11218         END-IF
S11218      END-IF.

S11854*S11711      IF BORP-YOUBE AND BORP-SUB-TYPE NOT = "D"
S11854      IF BORP-SUB-TYPE NOT = "D"
S17946*S11854  IF BORM-STOP-TRAN-IND = "F" OR "Y"
S17946         IF (BORM-STOP-TRAN-IND = "F" OR "Y")
S11711           AND WA-INPUT-PARAM-TABLE (5) = 1
S11711           AND WA-INPUT-PARAM-TABLE (7) NOT = 1
S17787           AND NOT  STRT-REPOST-TXN
S11711           AND NOT (STRT-AREA-TRN-NO = 16050
S11711            AND STRT-BATCH-TRICKLE-TXN)
S17946           AND NOT (WA-ADV-AMOUNT <= WA-AVAILABLE-LIMIT
S17946            AND WA-AVAILABLE-LIMIT > 0 )
S11711            MOVE 4632 TO WA-OUTPUT-ERR-MSG-NO
S11711            MOVE 1    TO WA-MSG-ERR-FLAG
S11711            GO TO VALIDATE-ADVANCES-EXIT
S11711         END-IF
S11711      END-IF.

      **--Non Performing Should not be allowed to do a drawdown
            MOVE BORM-BAD-DEBT-IND TO WA-BAD-DEBT-IND.
            IF WA-BAD-DEBT-NON-PERFORMING OR
               WA-BAD-DEBT-WRITE-OFF      OR
SC3160         WA-BAD-DEBT-WRITE-OFF-CNTRFEIT 
               MOVE 4277 TO WA-OUTPUT-ERR-MSG-NO
               MOVE 1    TO WA-MSG-ERR-FLAG
               GO TO VALIDATE-ADVANCES-EXIT
            END-IF.

ST0097** Validate store-txn-dt against conversion date
ST0097      MOVE WA-ADV-TXN-DATE       TO UT0030-DATE-DDMMCCYY
ST0097      MOVE 1                     TO UT0030-FUNCTION
ST0097      CALL "UT0030"           USING UT0030-FUNCTION
ST0097                                    UT0030-DATE-AREA
ST0097                                    UT0030-BINARY-DATE
ST0097      MOVE UT0030-BINARY-DATE    TO WA-STORE-TXN-DT
ST0097      IF WA-INPUT-PARAM-TABLE(8) = 1
SC7982*       AND WA-STORE-TXN-DT  <= BORM-LAST-ACCT-TYPE-CHANGE
SC7982        AND WA-STORE-TXN-DT  <  BORM-LAST-ACCT-TYPE-CHANGE
ST0097        AND BORM-LAST-ACCT-TYPE-CHANGE > 0
ST0097         MOVE 2168 TO WA-OUTPUT-ERR-MSG-NO
ST0097         MOVE 1    TO WA-MSG-ERR-FLAG
ST0097         GO TO VALIDATE-ADVANCES-EXIT
ST0097      END-IF.
      **--Validation of advances happens here 
SC4985**--
SC4985      IF WA-INPUT-PARAM-TABLE(08) = 1
SC4985         MOVE WA-ADV-TXN-DATE    TO UT0030-DATE-DDMMCCYY
SC4985         MOVE 1                  TO UT0030-FUNCTION
SC4985         CALL "UT0030"   USING      UT0030-FUNCTION
SC4985                                    UT0030-DATE-AREA
SC4985                                    UT0030-BINARY-DATE
SC4985         MOVE UT0030-BINARY-DATE TO WA-POST-DATE
SC4985      ELSE
            MOVE STRT-AREA-POST-DT TO WA-POST-DATE
SC4985      END-IF.
SC4985**--

SC4835      IF STRT-AREA-TRN-NO = 11060 
SC6621         OR 11055 OR 11057 
S12770         OR 11063
S17755         OR ( BORP-ILOAN-R
S17755          AND WA-INPUT-PARAM-TABLE(8) = 0
S17755          AND WA-INPUT-PARAM-TABLE(7) = 0 )
               IF (BOIS-MATURITY-DATE > 0 AND BORM-STAT < 6)
SC6621*           AND BORM-APPLIC-ISSUE-DATE < STRT-AREA-POST-DT
SC6621            AND BORM-APPLIC-ISSUE-DATE <= STRT-AREA-POST-DT
                  MOVE STRT-AREA-POST-DT TO UT0020-BINARY-DATE
                  MOVE 1 TO UT0020-FUNCTION
                  PERFORM X100-UT0020-PARA THRU X109-EXIT
                  MOVE UT0020-DATE-DDMMCCYY TO WA-ADV-TXN-DATE
                  MOVE WA-ADV-TXN-DATE      TO WA-ADVANCE-DATE
                  MOVE 0 TO WA-COUNT-LOAN-TERM
SC8398            IF NOT BORP-YOUBE
                    PERFORM RECALC-LOAN-TERM
                       THRU RECALC-LOAN-TERM-EXIT
SC8398*SC8983     ELSE
SC8398*SC8983       PERFORM YOUBE-RECALC-TERM
SC8398*SC8983               THRU YOUBE-RECALC-TERM-EXIT
SC8398*SC8983     END-IF
SC6175             SET BORM-NO-ADDL-BILLING TO TRUE  
SC6175             IF WA-SAVE-MATURITY-DATE NOT = 0  
S17218                AND NOT BORP-ALBPS
S17218                AND NOT MULTIPLE-REPAY
                      MOVE WA-COUNT-LOAN-TERM TO BORM-REM-REPAYS
                                                 BORM-LOAN-TRM
SC8380                IF BOIS-STRETCH-TERM = 0
SC8380                   MOVE WA-COUNT-LOAN-TERM TO BOIS-STRETCH-TERM
SC8380                END-IF
S17755                IF  BORP-ILOAN-R
S17755                 IF BORM-LOAN-TRM        > BORP-MAX-TERM
S17755                    MOVE BORP-MAX-TERM  TO BORM-LOAN-TRM
S17755                                           BORM-REM-REPAYS
S17755                    SET BORM-1-ADDL-BILLING TO TRUE
S17755                 END-IF
S17755                 MOVE BORM-LOAN-TRM     TO BOIS-STRETCH-TERM
S17755                END-IF
SC6175             ELSE  
SC6175                IF WA-COUNT-LOAN-TERM > BORM-LOAN-TRM  
SC6175                  SET BORM-1-ADDL-BILLING TO TRUE  
SC6175                END-IF  
SC6175             END-IF
SC8983            END-IF
               END-IF
SC4835      END-IF

            IF BORP-COMML
S16871      AND NOT BORP-CORPORATION
S19269      AND NOT BORP-PB
S20771      AND NOT BORP-FBOND
               PERFORM ACCESS-ACFR
                  THRU ACCESS-ACFR-EXIT

               IF WA-MSG-ERR-FLAG = 1
                  GO TO VALIDATE-ADVANCES-EXIT
               END-IF
          
               MOVE STRT-AREA-SOC-NO   TO FACM-INST-NO
               MOVE ACFR-FACILITY-NO   TO FACM-FACILITY-NO
               MOVE FACM-KEY           TO DBIO-CALL-KEY-AREA

               PERFORM D800-READ-FACM
                  THRU D899-EXIT

               IF WA-MSG-ERR-FLAG = 1
                  GO TO VALIDATE-ADVANCES-EXIT
               END-IF

               PERFORM ACCESS-FACA
                  THRU ACCESS-FACA-EXIT

               IF WA-MSG-ERR-FLAG = 1
                  GO TO VALIDATE-ADVANCES-EXIT
               END-IF

      *        IF STRT-AREA-TRN-NO = 11055 OR 16055  TB0267
SC2527*        IF STRT-AREA-TRN-NO = 11055 OR 16055 OR 14055
SC2527**       IF STRT-AREA-TRN-NO = 16055 OR 14055
SC7091**       IF STRT-AREA-TRN-NO = 16055 OR 14055
SC7091         IF STRT-AREA-TRN-NO = 16055 OR 19055 OR 14055
                  PERFORM VALIDATE-TRF-VIA-DEP
                     THRU VALIDATE-TRF-VIA-DEP-EXIT
                  IF WA-MSG-ERR-FLAG = 1 
                     GO TO VALIDATE-ADVANCES-EXIT
                  END-IF
               END-IF

               IF WA-INPUT-PARAM-TABLE(05) = 1
                  IF BORM-STAT < 06
                     PERFORM FIRST-ADV-VALIDATION
                        THRU FIRST-ADV-VALIDATION-EXIT
                     IF WA-MSG-ERR-FLAG <> 0
                        GO TO VALIDATE-ADVANCES-EXIT
                     END-IF
                  ELSE
                     IF BORM-STAT > 05
                        PERFORM SUCCEEDING-ADV-VALIDATION
                           THRU SUCCEEDING-ADV-VALIDATION-EXIT
                        IF WA-MSG-ERR-FLAG <> 0
                           GO TO VALIDATE-ADVANCES-EXIT
                        END-IF
                     END-IF
                  END-IF
               END-IF
            ELSE
               IF BORP-CONSMR
      *           IF STRT-AREA-TRN-NO = 11055 OR 16055
SC2527*           IF STRT-AREA-TRN-NO = 11055 OR 16055 OR 14055
SC2527**          IF STRT-AREA-TRN-NO = 16055 OR 14055
SC7091            IF STRT-AREA-TRN-NO = 16055 OR 19055 OR 14055
                     PERFORM VALIDATE-TRF-VIA-DEP
                        THRU VALIDATE-TRF-VIA-DEP-EXIT
                     IF WA-MSG-ERR-FLAG <> 0
                        GO TO VALIDATE-ADVANCES-EXIT
                     END-IF
                  END-IF

                  IF WA-INPUT-PARAM-TABLE(05) = 1
                     IF BORM-STAT < 06
                        PERFORM FIRST-ADV-VALIDATION
                           THRU FIRST-ADV-VALIDATION-EXIT
                        IF WA-MSG-ERR-FLAG <> 0
                           GO TO VALIDATE-ADVANCES-EXIT
                        END-IF
                     END-IF
                  END-IF
               END-IF
            END-IF.

       VALIDATE-ADVANCES-EXIT.
      *-----------------------
            EXIT.

       ACCESS-ACFR.
      *------------

           INITIALIZE ACFR-KEY.
           MOVE STRT-AREA-SOC-NO  TO ACFR-SOC-NO.
           MOVE "BOR"             TO ACFR-SYSTEM.
           MOVE BORM-MEMB-CUST-AC TO ACFR-ACCT-NO.
           MOVE 71                TO DBIO-CALL-FUNC.
           MOVE ACFR-KEY          TO DBIO-CALL-KEY-AREA.
           MOVE "ACFR    "        TO DBIO-CALL-SYS-AREA.
           MOVE SPACES            TO DBIO-CALL-STATUS.

           CALL "DBIO" USING
                       DBIO-CALL-PARAM
                       DBIO-CALL-SYS-AREA
                       DBIO-CALL-KEY-AREA
                       DBIO-CALL-STATUS
                       ACFR-AREA
                       DBIO-CALL-REFER-AREA.

           IF DBIO-CALL-STATUS = "MRNF"
              GO TO ACCESS-ACFR-EXIT.
           IF DBIO-CALL-STATUS NOT = "****"
              MOVE 155                          TO WA-OUTPUT-ERR-MSG-NO
              MOVE DBIO-CALL-N-SYS              TO WA-DBERR-DATA-SET
              MOVE DBIO-CALL-STATUS             TO WA-DB-ERROR
              MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
              MOVE SPACES                       TO UT8500CA-INPUT-MSG
              STRING "BR0024:(W1000) 'ACFR' READ ERROR, STAT- "
                      DBIO-CALL-STATUS ", KEY- "
                      DBIO-CALL-KEY-AREA
                  DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
              CALL "UT8500" USING
                            UT8500CA-AREA
              MOVE 1 TO WA-MSG-ERR-FLAG
              GO TO ACCESS-ACFR-EXIT
           ELSE
              MOVE ACFR-FACILITY-NO  TO WA-ACFR-FAC-NO
              MOVE ACFR-FAC-REF-CODE TO WA-ACFR-REF-CODE
           END-IF.

       ACCESS-ACFR-EXIT.
      *-----------------
            EXIT.

       ACCESS-FACA.
      *------------

           INITIALIZE FACA-ALT2-KEY.
           MOVE 80               TO DBIO-CALL-FUNC
           MOVE STRT-AREA-SOC-NO TO FACA-ALT2-INST-NO
           MOVE WA-ACFR-FAC-NO   TO FACA-ALT2-FACILITY-NO
           MOVE WA-ACFR-REF-CODE TO FACA-ALT2-REF-CODE
           MOVE FACA-ALT2-KEY    TO DBIO-CALL-KEY-AREA
           MOVE 2                TO DBIO-CALL-ALT-KEY
           MOVE SPACES           TO DBIO-CALL-STATUS
           MOVE "FACA"           TO DBIO-CALL-SYS-AREA

           CALL "DBIO" USING
                       DBIO-CALL-PARAM
                       DBIO-CALL-SYS-AREA
                       DBIO-CALL-KEY-AREA
                       DBIO-CALL-STATUS
                       FACA-AREA

           IF DBIO-CALL-STATUS NOT = "****"
              IF DBIO-CALL-STATUS  = "MRNF"
                 MOVE 1734 TO WA-OUTPUT-ERR-MSG-NO
                 MOVE 1    TO WA-MSG-ERR-FLAG
              ELSE
                 MOVE 155  TO WA-OUTPUT-ERR-MSG-NO
                 MOVE "FACA" TO WA-OUTPUT-DATA-SET
                 MOVE DBIO-CALL-STATUS TO WA-OUTPUT-STATUS
                 MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
                 MOVE SPACES  TO UT8500CA-INPUT-MSG
                 STRING "BR0001:(W3000) 'FACA' READ ERROR, STAT-"
                         DBIO-CALL-STATUS ", KEY-"
                         DBIO-CALL-KEY-AREA
                 DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
                 CALL "UT8500" USING
                               UT8500CA-AREA
                 MOVE 1 TO WA-MSG-ERR-FLAG
                 GO TO ACCESS-FACA-EXIT
              END-IF
           END-IF.

       ACCESS-FACA-EXIT.
      *-----------------
            EXIT.

      *==============================================
      * HOW TO USE THIS PROCEDURE:
      * MOVE THE DATE TO BE ADDED TO DATEADD-IN-DATE
      * MOVE NO. OF MONTHS TO DATEADD-NO-MO
      * OUTPUT DATE IS DATEADD-OUT-DATE
      *==============================================
       DATEADD-MONTH.
      *--------------

           MOVE DATEADD-IN-DATE TO DATEADD-OUT-DATE.

SC5885**   COMPUTE DATEADD-OUT-MM = DATEADD-OUT-MM + DATEADD-NO-MO.
SC5885     COMPUTE WS-TEMP        = DATEADD-OUT-MM + DATEADD-NO-MO.

SC5885**   PERFORM UNTIL DATEADD-OUT-MM <= 12
SC5885     PERFORM UNTIL WS-TEMP        <= 12
               ADD 1 TO DATEADD-OUT-CCYY
SC5885**       COMPUTE DATEADD-OUT-MM = DATEADD-OUT-MM - 12
SC5885         COMPUTE WS-TEMP        = WS-TEMP        - 12
           END-PERFORM.

SC5885     MOVE WS-TEMP            TO DATEADD-OUT-MM.
           DIVIDE DATEADD-OUT-CCYY BY 4
                  GIVING WS-TEMP REMAINDER WS-LEAP-REM.

           IF WS-LEAP-REM = ZEROES
              MOVE 29 TO DATEADD-MONTHEND-ARRAY (2)
TP0021**--               DATEADD-OUT-DD
           ELSE
              MOVE 28 TO DATEADD-MONTHEND-ARRAY (2)
TP0021**--               DATEADD-OUT-DD
           END-IF

           IF DATEADD-OUT-DD > DATEADD-MONTHEND-ARRAY(DATEADD-OUT-MM)
              MOVE DATEADD-MONTHEND-ARRAY(DATEADD-OUT-MM)
                TO DATEADD-OUT-DD
           END-IF.

       DATEADD-MONTH-EXIT.
      *-------------------
           EXIT.

       GET-INVM-ACCT-NO.
      *=================

           INITIALIZE INVM-KEY.
           MOVE STRT-AREA-SOC-NO TO INVM-SOC-NO.
           MOVE WA-DEP-ACCT-NO   TO INVM-MEMB-CUST-AC.
           MOVE 01               TO DBIO-CALL-FUNC.
           MOVE INVM-KEY         TO DBIO-CALL-KEY-AREA.

           MOVE SPACES TO DBIO-CALL-STATUS.
           MOVE "INVM" TO DBIO-CALL-SYS-AREA.

           CALL "DBIO" USING
                        DBIO-CALL-PARAM
                        DBIO-CALL-SYS-AREA
                        DBIO-CALL-KEY-AREA
                        DBIO-CALL-STATUS
                        WA-INVM-RECORD-AREA
                        DBIO-CALL-REFER-AREA.

           IF DBIO-CALL-STATUS = "MRNF"
              MOVE 0223 TO WA-OUTPUT-ERR-MSG-NO
              MOVE 1 TO WA-MSG-ERR-FLAG
              GO TO GET-INVM-ACCT-NO-EXIT
           ELSE
               IF DBIO-CALL-STATUS NOT = "****"
                  MOVE 01     TO ST-STATUS-LEVEL-1
                  MOVE 155    TO WA-OUTPUT-ERR-MSG-NO
                  MOVE "INVM" TO WA-OUTPUT-DATA-SET
                  MOVE DBIO-CALL-STATUS TO WA-OUTPUT-STATUS
                  MOVE UT8500CA-FUNC-NORMAL-DISPLAY
                                        TO UT8500CA-CALL-CODE
                  MOVE SPACES           TO UT8500CA-INPUT-MSG
                  STRING "BR0024:(H0000) 'INVM' READ ERROR, STAT "
                         DBIO-CALL-STATUS "KEY = "
                         DBIO-CALL-KEY-AREA
                         DELIMITED BY SIZE INTO
                         UT8500CA-INPUT-MSG
                  CALL "UT8500" USING
                                UT8500CA-AREA
                  MOVE 1 TO WA-MSG-ERR-FLAG
                  GO TO GET-INVM-ACCT-NO-EXIT
               END-IF
            END-IF.

       GET-INVM-ACCT-NO-EXIT.
      *----------------------
           EXIT.

       FIRST-ADV-VALIDATION.
      *=====================

      **-- Validations on the First Drawdown Transaction
      **-- List of Drawdown Transactios
      **-- 10060 10070 10080 11055 11060 11070 11080 11057

           IF BORP-COMML
              IF FACM-FIRST-DRAWDOWN-DATE = 0
      **-- fst drawdown date < fac eff date and >= fac exp date
                 IF WA-POST-DATE <  FACA-EFFECT-DATE AND
                    WA-POST-DATE >= FACA-EXPIRY-DATE
                    MOVE 3793 TO WA-OUTPUT-ERR-MSG-NO
                    MOVE 1    TO WA-MSG-ERR-FLAG
                    GO        TO FIRST-ADV-VALIDATION-EXIT
                 END-IF

      **-- fst drawdown date >= fst drawdown date
      **-- No need to use the Length in validation bec it was already
      **-- converted to date
                 IF WA-POST-DATE >= FACA-FST-DRAWDOWN-DATE
                    MOVE 3793 TO WA-OUTPUT-ERR-MSG-NO
                    MOVE 1    TO WA-MSG-ERR-FLAG
                    GO        TO FIRST-ADV-VALIDATION-EXIT
                 END-IF

SC1440**-- acct mat date > fac last dt of acct eff period
SC1440**-- according to Lin Fu and Jane of TIB
SC1440           IF FACA-LST-DTE-ACCT-EFF > ZEROES AND
SC1440              BOIS-MATURITY-DATE > FACA-LST-DTE-ACCT-EFF
SC1440              MOVE 3380 TO WA-OUTPUT-ERR-MSG-NO
SC1440              MOVE 1    TO WA-MSG-ERR-FLAG
SC1440              GO        TO FIRST-ADV-VALIDATION-EXIT
SC1440           END-IF
SC2128        ELSE
SC2128**-- acct mat date > fac last dt of acct eff period
SC2128**-- according to Lin Fu and Jane of TIB
SC2128           IF FACA-LST-DTE-ACCT-EFF > ZEROES AND
SC2128              BOIS-MATURITY-DATE > FACA-LST-DTE-ACCT-EFF
SC2128              MOVE 3380 TO WA-OUTPUT-ERR-MSG-NO
SC2128              MOVE 1    TO WA-MSG-ERR-FLAG
SC2128              GO        TO FIRST-ADV-VALIDATION-EXIT
SC2128           END-IF
              END-IF
           ELSE
              IF BORP-CONSMR
      **-- fst darwdown date < acct approval
                 IF BOIS-FST-DRAWDOWN-PD < BORM-APPRV-DATE
S17755           AND NOT BORP-ILOAN-R
S19705           AND NOT PROD-RICHART
                    MOVE 3793 TO WA-OUTPUT-ERR-MSG-NO
                    MOVE 1    TO WA-MSG-ERR-FLAG
                    GO        TO FIRST-ADV-VALIDATION-EXIT
                 END-IF

      **-- fst darwdown date > appr date + fst dd date

TP0021**--       COMPUTE WA-END-FST-ADV =
TP0021**--               (BOIS-FST-DRAWDOWN-PD + BORM-APPRV-DATE)

TP0021           MOVE BORM-APPRV-DATE TO UT0020-BINARY-DATE
TP0021           MOVE 2               TO UT0020-FUNCTION
TP0021           CALL "UT0020" USING
TP0021                         UT0020-FUNCTION
TP0021                         UT0020-DATE-AREA
TP0021                         UT0020-BINARY-DATE

TP0021           MOVE UT0020-DATE-CCYYMMDD     TO DATEADD-IN-DATE
TP0021           MOVE BOIS-FST-DRAWDOWN-LENGTH TO DATEADD-NO-MO
TP0021           PERFORM DATEADD-MONTH
TP0021              THRU DATEADD-MONTH-EXIT
TP0021           MOVE DATEADD-OUT-DATE TO UT0030-DATE-CCYYMMDD
TP0021           MOVE 2                TO UT0030-FUNCTION
TP0021           CALL "UT0030" USING
TP0021                         UT0030-FUNCTION
TP0021                         UT0030-DATE-AREA
TP0021                         UT0030-BINARY-DATE
TP0021           MOVE UT0030-BINARY-DATE TO WA-END-FST-ADV

                 IF WA-POST-DATE >= WA-END-FST-ADV
S17755           AND NOT BORP-ILOAN-R
S19705           AND NOT PROD-RICHART
                    MOVE 3793 TO WA-OUTPUT-ERR-MSG-NO
                    MOVE 1    TO WA-MSG-ERR-FLAG
                    GO        TO FIRST-ADV-VALIDATION-EXIT
                 END-IF
              END-IF
           END-IF.

SC5578**   COMENT OUT FOLLOWING, THE RECALC ALREADY EXISTED AT BR0000 *
SC4819*    MOVE ZERO TO WA-CTR-A
SC4819*    PERFORM VARYING WA-CTR-A FROM 1 BY 1 UNTIL WA-CTR-A > 2
SC4819*          MOVE STRT-AREA-POST-DT TO UT0020-BINARY-DATE
SC4819*          MOVE 2                 TO UT0020-FUNCTION
SC4819*          CALL "UT0020" USING
SC4819*                        UT0020-FUNCTION
SC4819*                        UT0020-DATE-AREA
SC4819*                        UT0020-BINARY-DATE

SC4819*          MOVE UT0020-DATE-CCYYMMDD     TO DATEADD-IN-DATE
SC4819*          MOVE BORP-PEN-TERM(WA-CTR-A)  TO DATEADD-NO-MO
SC4819*          PERFORM DATEADD-MONTH
SC4819*             THRU DATEADD-MONTH-EXIT
SC4819*          MOVE DATEADD-OUT-DATE TO UT0030-DATE-CCYYMMDD
SC4819*          MOVE 2                TO UT0030-FUNCTION
SC4819*          CALL "UT0030" USING
SC4819*                        UT0030-FUNCTION
SC4819*                        UT0030-DATE-AREA
SC4819*                        UT0030-BINARY-DATE
SC4819*          MOVE UT0030-BINARY-DATE TO WA-PENALTY-DATE
SC4819*          MOVE WA-PENALTY-DATE    TO BOIS-PEN-TERM(WA-CTR-A)
SC4819*    END-PERFORM.
SC4819*
SC4819*    MOVE ZERO TO WA-CTR-A
SC4819*    PERFORM VARYING WA-CTR-A FROM 1 BY 1 UNTIL WA-CTR-A > 2
SC4819*          MOVE STRT-AREA-POST-DT TO UT0020-BINARY-DATE
SC4819*          MOVE 2                 TO UT0020-FUNCTION
SC4819*          CALL "UT0020" USING
SC4819*                        UT0020-FUNCTION
SC4819*                        UT0020-DATE-AREA
SC4819*                        UT0020-BINARY-DATE

SC4819*          MOVE UT0020-DATE-CCYYMMDD     TO DATEADD-IN-DATE
SC4819*          MOVE BORP-CLOSE-PEN-TERM(WA-CTR-A) TO DATEADD-NO-MO
SC4819*          PERFORM DATEADD-MONTH
SC4819*             THRU DATEADD-MONTH-EXIT
SC4819*          MOVE DATEADD-OUT-DATE TO UT0030-DATE-CCYYMMDD
SC4819*          MOVE 2                TO UT0030-FUNCTION
SC4819*          CALL "UT0030" USING
SC4819*                        UT0030-FUNCTION
SC4819*                        UT0030-DATE-AREA
SC4819*                        UT0030-BINARY-DATE
SC4819*          MOVE UT0030-BINARY-DATE TO WA-PENALTY-DATE
SC4819*          MOVE WA-PENALTY-DATE TO BOIS-CLOSE-PEN-TERM(WA-CTR-A)
SC4819*    END-PERFORM.
SC5578* COMMENT OUT END *

       FIRST-ADV-VALIDATION-EXIT.
      *--------------------------
           EXIT.

       SUCCEEDING-ADV-VALIDATION.
      *==========================

      **-- Validations on the Succeeding Drawdowns
      **-- List of Drawdown Transactios
      **-- 10060 10070 10080 11055 11060 11070 11080 11057

            IF BORP-COMML
               IF WA-INPUT-PARAM-TABLE(05) = 1
                  IF BORM-STAT > 05
      **-- succeeding drawdown >= fac exp date
                  IF WA-POST-DATE >= FACA-EXPIRY-DATE
                     MOVE 3793 TO WA-OUTPUT-ERR-MSG-NO
                     MOVE 1    TO WA-MSG-ERR-FLAG
                     GO        TO SUCCEEDING-ADV-VALIDATION-EXIT
                  END-IF

      **-- drawdown period greater drawdown date + max length
                  IF FACA-TERM-BASIS = "M"
                     MOVE WA-POST-DATE TO UT0020-BINARY-DATE
                     MOVE 2            TO UT0020-FUNCTION
                     CALL "UT0020" USING
                                   UT0020-FUNCTION
                                   UT0020-DATE-AREA
                                   UT0020-BINARY-DATE

                     MOVE UT0020-DATE-CCYYMMDD    TO DATEADD-IN-DATE
                     MOVE FACA-MAX-LEN-EFF-PERIOD TO DATEADD-NO-MO
                     PERFORM DATEADD-MONTH
                        THRU DATEADD-MONTH-EXIT

                     MOVE DATEADD-OUT-DATE   TO UT0030-DATE-CCYYMMDD
                     MOVE 2                  TO UT0030-FUNCTION
                     CALL "UT0030" USING
                                   UT0030-FUNCTION
                                   UT0030-DATE-AREA
                                   UT0030-BINARY-DATE
                     MOVE UT0030-BINARY-DATE TO WA-MAX-DATE
                  ELSE
                     IF FACA-TERM-BASIS = "D"
                        COMPUTE WA-MAX-DATE =
SC2676*                    FACA-EFFECT-DATE + FACA-MAX-LEN-EFF-PERIOD
SC2676                     WA-POST-DATE + FACA-MAX-LEN-EFF-PERIOD
                     END-IF
                  END-IF

      **-- Facility Maximum Length can be zeroes
                  IF FACA-MAX-LEN-EFF-PERIOD = ZEROES
                     MOVE 99999999 TO WA-MAX-DATE
                  END-IF

      **-- acct mat date > drawdown dt + fac max len of acct eff period
                  IF BOIS-MATURITY-DATE > WA-MAX-DATE
                     MOVE 1559 TO WA-OUTPUT-ERR-MSG-NO
                     MOVE 1    TO WA-MSG-ERR-FLAG
                     GO        TO SUCCEEDING-ADV-VALIDATION-EXIT
                  END-IF

      **-- drawdown date < fac exp date nd mat date > fac max
                  IF WA-POST-DATE < FACA-EXPIRY-DATE AND
                     BOIS-MATURITY-DATE > WA-MAX-DATE
                     MOVE 1559 TO WA-OUTPUT-ERR-MSG-NO
                     MOVE 1    TO WA-MSG-ERR-FLAG
                     GO        TO SUCCEEDING-ADV-VALIDATION-EXIT
                  END-IF

      **-- acct mat date > fac last dt of acct eff period
                  IF FACA-LST-DTE-ACCT-EFF = ZEROES
                     MOVE 99999999 TO WA-LAST-DTE-ACCT-EFF
                  ELSE
                     MOVE FACA-LST-DTE-ACCT-EFF TO WA-LAST-DTE-ACCT-EFF
                  END-IF

      **-- acct mat date > fac last dt of acct eff period
                  IF BOIS-MATURITY-DATE > WA-LAST-DTE-ACCT-EFF 
SC1440**             MOVE 3793 TO WA-OUTPUT-ERR-MSG-NO
SC1440               MOVE 3380 TO WA-OUTPUT-ERR-MSG-NO
                     MOVE 1    TO WA-MSG-ERR-FLAG
                     GO        TO SUCCEEDING-ADV-VALIDATION-EXIT
                  END-IF

      **-- acct mat date > drawdown dt + fac max len acct eff period
                  IF FACA-TERM-BASIS = "M"
                     MOVE WA-POST-DATE TO UT0020-BINARY-DATE
                     MOVE 2            TO UT0020-FUNCTION
                     CALL "UT0020" USING
                                   UT0020-FUNCTION
                                   UT0020-DATE-AREA
                                   UT0020-BINARY-DATE

                     MOVE UT0020-DATE-CCYYMMDD    TO DATEADD-IN-DATE
                     MOVE FACA-MAX-LEN-EFF-PERIOD TO DATEADD-NO-MO
                     PERFORM DATEADD-MONTH
                        THRU DATEADD-MONTH-EXIT

                     MOVE DATEADD-OUT-DATE   TO UT0030-DATE-CCYYMMDD
                     MOVE 2                  TO UT0030-FUNCTION
                     CALL "UT0030" USING
                                   UT0030-FUNCTION
                                   UT0030-DATE-AREA
                                   UT0030-BINARY-DATE
                     MOVE UT0030-BINARY-DATE TO WA-MAXI-DATE
                  ELSE
                     IF FACA-TERM-BASIS = "D"
                        COMPUTE WA-MAXI-DATE =
                           WA-POST-DATE  + FACA-MAX-LEN-EFF-PERIOD
                     END-IF
                  END-IF

      **-- Facility Maximum Length can be zeroes
                  IF FACA-MAX-LEN-EFF-PERIOD = ZEROES
                     MOVE 99999999 TO WA-MAXI-DATE
                  END-IF

      **-- acct mat date > fac last dt of acct eff period or
      **-- acct mat date > drawdown dt + fac max len acct eff period
                  IF BOIS-MATURITY-DATE > WA-LAST-DTE-ACCT-EFF OR
                     BOIS-MATURITY-DATE > WA-MAXI-DATE
                     MOVE 3793 TO WA-OUTPUT-ERR-MSG-NO
                     MOVE 1    TO WA-MSG-ERR-FLAG
                     GO        TO SUCCEEDING-ADV-VALIDATION-EXIT
                  END-IF
               END-IF
            END-IF.

       SUCCEEDING-ADV-VALIDATION-EXIT.
      *-------------------------------
          EXIT.

       VALIDATE-TRF-VIA-DEP.
      *======================

          PERFORM GET-INVM-ACCT-NO
             THRU GET-INVM-ACCT-NO-EXIT.

          IF WA-MSG-ERR-FLAG = 1
             GO TO VALIDATE-TRF-VIA-DEP-EXIT
          END-IF

          IF BORM-CUSTOMER-NO <> INVM-CUSTOMER-NO
             MOVE 0    TO WA-MSG-ERR-FLAG
             MOVE 3913 TO UT0060CA-CALL-ERROR-CODE
             PERFORM Y000-OVERRIDABLE-ERROR-CHECK
                THRU Y090-EXIT

             IF WA-MSG-ERR-FLAG = 0
                MOVE 3913 TO WA-ERR-MSG-NO
             ELSE
                MOVE 3913 TO WA-OUTPUT-ERR-MSG-NO
                MOVE 1    TO WA-MSG-ERR-FLAG
                GO TO VALIDATE-TRF-VIA-DEP-EXIT
             END-IF
          END-IF.

       VALIDATE-TRF-VIA-DEP-EXIT.
      *--------------------------
              EXIT.
SC4393/                                                   
SC4393 RECALC-LOAN-TERM.                                  
SC4393     INITIALIZE UT0312CA-CALL-PARAMETER.            
SC4393     IF BORM-REPAY-DAY > 0                          
SC4393        IF  WA-ADVANCE-DD >  BORM-REPAY-DAY         
SC4393        AND BOIS-DUE-DTE-IND = "Y"                  
SC7172*SC6175 AND WA-INPUT-PARAM-TABLE (8) = 1
SC4393            ADD 1                 TO WA-ADVANCE-MM  
SC4393            IF WA-ADVANCE-MM       >  12            
SC4393               MOVE 01            TO WA-ADVANCE-MM  
SC4393               ADD  1             TO WA-ADVANCE-CCYY
SC4393            END-IF                                  
SC4393        END-IF                                      
SC4393        IF  WA-ADVANCE-DD <  BORM-REPAY-DAY         
SC4393        AND BOIS-DUE-DTE-IND NOT = "Y"              
SC7172*SC6175 AND WA-INPUT-PARAM-TABLE (8) = 1
SC4393            IF (WA-ADVANCE-DD = 30 AND WA-30-DAY-MONTH) OR
SC4393               (WA-ADVANCE-MM = 02 AND WA-ADVANCE-DD NOT < 28)
SC4393               CONTINUE
SC4393            ELSE
SC4393               SUBTRACT 1          FROM WA-ADVANCE-MM  
SC4393               IF WA-ADVANCE-MM       =  0             
SC4393                  MOVE 12            TO WA-ADVANCE-MM  
SC4393                  SUBTRACT 1       FROM WA-ADVANCE-CCYY
SC4393               END-IF                                  
SC4393            END-IF                                  
SC4393        END-IF                                      
SC4393*SC6946 MOVE 1                    TO WA-ADVANCE-DD  
SC6946*SC6175 IF WA-INPUT-PARAM-TABLE(8) = 1
SC6946           MOVE BORM-REPAY-DAY       TO WA-ADVANCE-DD
SC6946*SC6175 END-IF
SC4393     END-IF.                                        
SC4393                                                    
SC4393*    MOVE WA-ADVANCE-DATE         TO UT0030-DATE-DDMMCCYY.
S12589*SC7100     MOVE WA-ADVANCE-DATE         TO UT0020-DATE-DDMMCCYY.
S12589     MOVE WA-ADVANCE-DATE         TO WA-NEXT-DDMMCCYY.
SC7100     PERFORM Z000-CH-PROC-DT  THRU Z099-EXIT.  
S12589*SC7100     MOVE UT0020-DATE-DDMMCCYY    TO UT0030-DATE-DDMMCCYY.
S12589     MOVE WA-NEXT-DDMMCCYY    TO UT0030-DATE-DDMMCCYY.
SC4393     MOVE 1                       TO UT0030-FUNCTION.     
SC4393     CALL "UT0030" USING          UT0030-FUNCTION         
SC4393                                  UT0030-DATE-AREA        
SC4393                                  UT0030-BINARY-DATE.     
SC4393     IF UT0030-BINARY-DATE        =  ZEROES               
SC4393        MOVE 1                    TO WA-MSG-ERR-FLAG      
SC4393        MOVE 126                  TO WA-OUTPUT-ERR-MSG-NO 
SC4393        GO TO RECALC-LOAN-TERM-EXIT                       
SC4393     ELSE                                                 
SC4393        MOVE UT0030-BINARY-DATE   TO WA-ADV-TRM-DATE-BIN  
SC4393     END-IF.                                              
SC4393                                                          
SC4393     MOVE 0                       TO WA-COUNT-LOAN-TERM.  
SC4393                                                          
SC4835     MOVE 0 TO UT0312CA-MATURITY-DT
SC4393     PERFORM RECALC-LOAN-TERM-LOOP                        
SC4393        THRU RECALC-LOAN-TERM-LOOP-EXIT                   
SC4393       UNTIL UT0312CA-MATURITY-DT >= BOIS-MATURITY-DATE   
SC4393          OR WA-MSG-ERR-FLAG = 1.                         
SC4393                                                          
SC4393 RECALC-LOAN-TERM-EXIT.                                   
SC4393     EXIT.                                                
SC4393/                                                         
SC4393 RECALC-LOAN-TERM-LOOP.                                   
SC4393     MOVE 17                      TO UT0312CA-CALL-CODE.  
SC4393     MOVE WA-ADV-TRM-DATE-BIN     TO UT0312CA-EFF-DATE    
SC4393                                     UT0312CA-DUE-STRT-DT.
SC4393     MOVE 1                       TO UT0312CA-LOAN-TERM.  
S10467     MOVE BORM-REPAY-FREQ         TO UT0312CA-REPAY-FREQ.
SC4393     IF BORM-REPAY-DAY > 0                                
SC6946*SC6175 AND WA-INPUT-PARAM-TABLE (8) = 1
SC4393        MOVE BORM-REPAY-DAY       TO UT0312CA-REPAY-DAY   
SC4393     ELSE                                                 
SC4393        MOVE WA-ADVANCE-DD        TO UT0312CA-REPAY-DAY   
SC4393     END-IF.                                              
SC4393                                                          
SC4393     CALL "UT0312" USING                                  
SC4393                   UT0312CA-CALL-AREA.                    
SC4393                                                          
SC4393     IF UT0312CA-RET-STATUS <> 0                          
SC4393        MOVE 296            TO WA-OUTPUT-ERR-MSG-NO       
SC4393        MOVE 1              TO WA-MSG-ERR-FLAG            
SC4393        GO TO RECALC-LOAN-TERM-LOOP-EXIT                  
SC4393     ELSE                                                 
SC4393        ADD 1                     TO WA-COUNT-LOAN-TERM   
SC4393        MOVE UT0312CA-MATURITY-DT TO WA-ADV-TRM-DATE-BIN  
SC4394     END-IF.                                              
SC4393                            
SC4393 RECALC-LOAN-TERM-LOOP-EXIT.
SC4393     EXIT.                  
SC4393/                           
TB0082*
SC7100 Z000-CH-PROC-DT.  
S12589        IF WA-NEXT-MM = 2
S12589            IF WA-NEXT-DD > 28
S12589               IF  WA-NEXT-YY  = 0
S12589                   DIVIDE WA-NEXT-CC  BY 4 GIVING WA-LEAP-REM1
S12589                       REMAINDER WA-LEAP-REM
S12589               ELSE
S12589                   DIVIDE WA-NEXT-YY  BY 4 GIVING WA-LEAP-REM1
S12589                       REMAINDER WA-LEAP-REM
S12589               END-IF
S12589               IF WA-LEAP-YEAR
S12589                  MOVE 29             TO        WA-NEXT-DD
S12589               ELSE
S12589                  MOVE 28             TO        WA-NEXT-DD
S12589               END-IF
S12589            END-IF
S12589        ELSE
S12589        IF WA-NEXT-MM = 4 OR 6 OR 9 OR 11
S12589            IF WA-NEXT-DD > 30
S12589              MOVE 30                 TO        WA-NEXT-DD
S12589            END-IF
S12589        ELSE
S12589        IF WA-NEXT-DD > 31
S12589            MOVE 31                   TO        WA-NEXT-DD.
S12589*    IF UT0020-DATE-MM = 2
S12589*       IF UT0020-DATE-DD > 28
S12589*          MOVE 29 TO UT0020-DATE-DD
S12589*          MOVE 1  TO UT0020-FUNCTION
S12589*          CALL "UT0020" USING UT0030-FUNCTION
S12589*                              UT0020-DATE-AREA
S12589*                              UT0020-BINARY-DATE
S12589*          IF UT0020-BINARY-DATE = 2
S12589*             MOVE 28 TO UT0020-DATE-DD
S12589*          END-IF
S12589*       END-IF
S12589*    ELSE
S12589*       MOVE UT0020-DATE-MM TO WA-MONTH-DAYS
S12589*       IF WA-MONTH-31
S12589*          IF UT0020-DATE-DD > 31
S12589*             MOVE 31 TO UT0020-DATE-DD
S12589*          END-IF
S12589*       ELSE
S12589*          IF UT0020-DATE-DD > 30
S12589*             MOVE 30 TO UT0020-DATE-DD.
SC7100 Z099-EXIT.  
SC7100     EXIT.  
TB0082*===============================
TB0082* END OF FSLON0042 ---- ADVANCE
TB0082*===============================
TB0082*
TB0159*Calculation of minimum due amt for yoube loan
TB0159 Z100-CALCULATE-MIN-DUE-AMT.
TB0159    MOVE STRT-AREA-SOC-NO    TO BMPT-INST-NO
TB0159    MOVE "BOR"               TO BMPT-SYSTEM
TB0159    MOVE BORM-ACT-TYPE       TO BMPT-ACCT-TYPE
TB0159    MOVE BORM-CAT            TO BMPT-INT-CAT
TB0159    MOVE "99999999"          TO BMPT-EFFECTIVE-DATE
TB0159    MOVE BMPT-KEY            TO DBIOMOD-KEY
TB0159    MOVE ZEROES              TO DBIOMOD-KEY-NO
TB0159    MOVE "READNEXT"          TO DBIOMOD-FUNCTION
TB0159    MOVE "BMPT"              TO DBIOMOD-FILE
TB0159                                DBIOMOD-SUFFIX.
TB0159    MOVE "DBIO"              TO DBIOMOD-PREFIX
TB0159    MOVE SPACES              TO DBIOMOD-RELEASE-LOCK
TB0159                                DBIOMOD-STATUS
TB0159                                DBIOMOD-ACCESS-COMMAND
TB0159                                DBIOMOD-ACCESS-COND.
TB0159    CALL DBIOMODNAME USING    DBIOMOD-FILE
TB0159                              DBIOMOD-KEY
TB0159                              BMPT-RECORD-AREA
TB0159                              DBIOMOD-FUNCTION
TB0159                              DBIOMOD-KEY-NO
TB0159                              DBIOMOD-RELEASE-LOCK
TB0159                              DBIOMOD-ACCESS-COMMAND
TB0159                              DBIOMOD-ACCESS-COND
TB0159                              DBIOMOD-STATUS.
TB0159    IF DBIOMOD-STAT = "MRNF" OR
TB0159       DBIOMOD-STAT NOT = "****"
TB0159       MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO
TB0159            UT8500CA-CALL-CODE
TB0159       MOVE SPACES TO UT8500CA-INPUT-MSG
TB0159       STRING "BR0024:YOUBE PROCESS "
TB0159              "ERROR READING BMPTPARM TABLE " DBIOMOD-STAT
TB0159              "KEY " BMPT-KEY
TB0159              DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
TB0159              CALL "UT8500" USING UT8500CA-AREA
TB0159              GO TO Z109-EXIT.
TB0159
TB0159    IF BMPT-EFFECTIVE-DATE <= WA-TODAYS-DATE
TB0159       MOVE 0 TO RANGE-FOUND-SW
TB0159       PERFORM VARYING CTR FROM 1 BY 1 UNTIL RANGE-FOUND OR
TB0159                       CTR > 26
TB0159           IF WA-OUTSTANDING-BAL >= BMPT-MIN-AMOUNT(CTR) AND
TB0159              WA-OUTSTANDING-BAL <= BMPT-MAX-AMOUNT(CTR)
TB0159              MOVE BMPT-MAX-AMOUNT(CTR) TO WA-MAX-AMOUNT
TB0159              MOVE 1 TO RANGE-FOUND-SW
TB0159           END-IF
TB0159       END-PERFORM
TB0159
TB0159       MOVE 0 TO WA-MIN-DUE-AMT
TB0159       SUBTRACT 1 FROM CTR
TB0159       MOVE BOIS-REV-RECEIVABLE-DUE  TO WA-REV-RECEIVABLE
TB0159
TB0159       IF BMPT-MIN-REPAYMENT(CTR) NOT ZEROES
TB0159          MOVE BMPT-MIN-REPAYMENT(CTR) TO WA-FIX-MIN-REPAYMENT
TB0159          COMPUTE WA-MIN-DUE-AMT = WA-REV-RECEIVABLE +
TB0159                 WA-FIX-MIN-REPAYMENT
TB0159       ELSE
TB0159         IF BMPT-MIN-PAYMT-RATIO(CTR) NOT ZEROES
TB0159            MOVE BMPT-MIN-PAYMT-RATIO(CTR) TO WA-PAYMT-RATIO
TB0159              COMPUTE WA-MIN-DUE-AMT = WA-REV-RECEIVABLE +
TB0159                      (WA-MAX-AMOUNT * (WA-PAYMT-RATIO / 100))
TB0159         END-IF
TB0159       END-IF
TB0159    END-IF.
TB0159
TB0159 Z109-EXIT.
TB0159    EXIT.
TB0159*
TB0159 Z110-CONVERT-BINARY-TO-DATE.
TB0159
TB0159     MOVE 02 TO UT0020-FUNCTION
TB0159     CALL "UT0020" USING UT0020-FUNCTION
TB0159                               UT0020-DATE-AREA
TB0159                               UT0020-BINARY-DATE.
TB0159     IF UT0020-DATE-DDMMCCYY = ALL "9"
TB0159        MOVE 1 TO UT0312CA-RET-STATUS
TB0159        MOVE UT8500CA-FUNC-NORMAL-DISPLAY  TO UT8500CA-CALL-CODE
TB0159        MOVE SPACES TO UT8500CA-INPUT-MSG
TB0159        MOVE UT0020-BINARY-DATE            TO WA-DISP-BINARY-DT
TB0159        STRING "UT0312 (Z110) ERROR IN CONVERTING TO DATE"
TB0159               ", BINARY DATE:" WA-DISP-BINARY-DT
TB0159               DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
TB0159        CALL "UT8500" USING UT8500CA-AREA.
TB0159 Z119-EXIT.
TB0159    EXIT.
TB0159*
TB0159 Z200-BAFM-PROCESSING.
TB0159    MOVE SPACES               TO DBIOMOD-STAT.
TB0159    MOVE "BAFM"               TO  DBIOMOD-FILE
TB0159                                  DBIOMOD-SUFFIX.
TB0159    MOVE "DBIO"               TO  DBIOMOD-PREFIX.
TB0159    MOVE "****"                  TO DBIOMOD-STAT.
SC5099**start
TB0159*   MOVE WA-INPUT-ACCT-NO TO BAFM-ACCT-NO.
TB0159*   MOVE BOIS-PROMO-CODE  TO BAFM-PROMO-CODE.
TB0159*   MOVE ZEROES           TO BAFM-FEE-TYPE.
SC5099**end
TB0159*
TB0159 Z300-READ-BAFM.
TB0159    MOVE BAFM-KEY             TO  DBIOMOD-KEY.
TB0159    MOVE ZEROES               TO  DBIOMOD-KEY-NO.
TB0159    MOVE "READNEXT"           TO DBIOMOD-FUNCTION.
TB0159
TB0159    PERFORM BAFM400-ACCESS.
TB0159    IF  DBIOMOD-STAT = "MRNF"
TB0159        GO TO Z399-READ-BAFM-EXIT.
TB0159    IF  DBIOMOD-STAT NOT = "****"
TB0159        DISPLAY "BR0024:(BAFM400) BAFM " DBIOMOD-FUNCTION
TB0159                " ERROR " DBIOMOD-STAT
TB0159        GO TO Z399-READ-BAFM-EXIT.
SC1256*   MOVE BAFM-FEE-AMOUNT TO WA-TOT-FEE-AMT.
SC1256    IF (BAFM-ACCT-NO = WA-INPUT-ACCT-NO AND
SC1256       BAFM-PROMO-CODE = BOIS-PROMO-CODE)
SC5099       OR (BAFM-ACCT-NO = WA-INPUT-ACCT-NO AND
SC5099           BAFM-PROMO-CODE = WA-ADV-PROMO)
SC1256       ADD BAFM-FEE-AMOUNT TO WA-TOT-FEE-AMT
SC1256    ELSE
SC6000       MOVE "MRNF"         TO DBIOMOD-STAT
SC1256       GO TO Z399-READ-BAFM-EXIT
SC1256    END-IF.
TB0159    GO TO Z300-READ-BAFM.
TB0159 Z399-READ-BAFM-EXIT.
TB0159    EXIT.
TB0159*
TB0159 BAFM400-ACCESS.
TB0159    MOVE SPACES               TO  DBIOMOD-STATUS
TB0159                                  DBIOMOD-RELEASE-LOCK
TB0159                                  DBIOMOD-ACCESS-COMMAND
TB0159                                  DBIOMOD-ACCESS-COND.
TB0159    CALL DBIOMODNAME USING
TB0159                      DBIOMOD-FILE
TB0159                      DBIOMOD-KEY
TB0159                      BAFM-RECORD-AREA
TB0159                      DBIOMOD-FUNCTION
TB0159                      DBIOMOD-KEY-NO
TB0159                      DBIOMOD-RELEASE-LOCK
TB0159                      DBIOMOD-ACCESS-COMMAND
TB0159                      DBIOMOD-ACCESS-COND
TB0159                      DBIOMOD-STATUS.
TB0159 BAFM499-EXIT.
TB0159    EXIT.
TB0159*
TB0159 M500-CALL-UT0074.
SC8285    IF WA-INPUT-PARAM-TABLE(8) = 1     
S11455    OR WA-ADV-AMORT-FLAG = "A"
S11455    OR WA-ADV-AMORT-FLAG = "F"
S11455    OR WA-ADV-AMORT-FLAG = "R"
SC8285       GO TO M599-UT0074-EXIT          
SC8285    END-IF.                            
TB0159    INITIALIZE UT0074CA-CALL-PARAM.
TB0159    MOVE 11                  TO UT0074CA-CALL-CODE.
TB0159    MOVE "BOR"               TO UT0074CA-SYSTEM.
TB0159    MOVE STRT-AREA-JRNL-NO   TO UT0074CA-JRNL-NO.
TB0159    MOVE BOIS-REV-RECEIVABLE-CDE TO
TB0159                     UT0074CA-PRIORITY-CODE.
TB0159    MOVE 1                   TO UT0074CA-SEQUENCE-NO.
TB0159    MOVE WA-TOT-FEE-AMT      TO UT0074CA-POST-AMT.
TB0159    MOVE 9998                TO UT0074CA-BASED-TERM-NO.
TB0159    MOVE BORM-STORE-RATE     TO UT0074CA-INT-RATE.
TB0159    MOVE STRT-AREA-BRANCH    TO UPTELLCA-BRCH.
TB0159    MOVE STRT-AREA-TELL-NO   TO UPTELLCA-TELR.
TB0159    CALL "UT0031"         USING UPTELLCA-PARAM-1
TB0159                                UPTELLCA-PARAM-2.
NR2001*TB0159    MOVE UPTELLCA-TELLER-BRANCH TO BORV-01-TELL-AND-BR.
NR2001*TB0159    MOVE STRT-AREA-TERM-NO   TO BORV-01-BRTERM.
NR2001*TB0159    MOVE 0                   TO BORV-01-STATUS
NR2001*TB0159                                BORV-01-CHQ-DAYS.
NR2001*TB0159    MOVE STRT-AREA-JRNL-NO   TO BORV-01-JRNL-NO.
NR2001*TB0159    MOVE STRT-AREA-POST-DT   TO BORV-01-TRN-DATE
NR2001*TB0159                                BORV-01-POST-DATE.
NR2001*TB0159    MOVE STRT-AREA-MSG-TIME  TO BORV-01-POST-TIME.
NR2001*TB0159    MOVE 13540               TO BORV-01-TRN-CODE.
NR2001*TB0159    IF WA-INPUT-PARAM-TABLE(7) = 1
NR2001*SC6067** IF THIS IS CORRECTION WE SHOULD ALWAYS CHECK BORV
NR2001*SC6067** IF THERE WERE FEES GENERATED DURING ADVANCE.     
NR2001*SC6067** 1) SAVE BORV RECORD                              
NR2001*SC6067       MOVE BORV-RECORD-AREA   TO WA-SAVE-BORV      
NR2001*SC6067** 2) LOCATE TRAN                                   
NR2001*SC6067       PERFORM M600-LOCATE-FEES-FOR-CORR            
NR2001*SC6067          THRU M609-EXIT                            
NR2001*SC6067** 3) RESTORE BORV-RECORD-AREA                      
NR2001*SC6067       MOVE WA-SAVE-BORV       TO BORV-RECORD-AREA  
NR2001*SC6067** 4) CHECK WA-FEE-FOUND-FLAG IF THERE WAS A FEE    
NR2001*SC6067**    DO NOT CALL UT0074 IF THERE WERE NO FEES FOUND
NR2001*SC6067       IF WA-FEE-FOUND-FLAG = "N"                   
NR2001*SC6067          GO TO M599-UT0074-EXIT                    
NR2001*SC6067       END-IF                                       
NR2001*SC6067                                                    
NR2001*TB0159       ADD 100                TO BORV-01-TRN-CODE
NR2001*TB0159       MOVE W800-CORR-JRNL-NO TO UT0074CA-JRNL-NO
NR2001*TB0159    END-IF
NR2001*ST0049    SET UT0074CA-NOT-BKDT-TXN TO TRUE
NR2001*ST0049    IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001*ST0049       SET UT0074CA-BKDT-TXN   TO TRUE
NR2001*ST0049       MOVE WA-ADV-TXN-DATE    TO UT0030-DATE-DDMMCCYY
NR2001*ST0049       MOVE 1                  TO UT0030-FUNCTION
NR2001*ST0049       CALL "UT0030"   USING      UT0030-FUNCTION
NR2001*ST0049                                  UT0030-DATE-AREA
NR2001*ST0049                                  UT0030-BINARY-DATE
NR2001*ST0049       MOVE UT0030-BINARY-DATE TO BORV-01-TRN-DATE
NR2001*ST0049    END-IF.
NR2001*TB0159    CALL "UT0074" USING UT0074CA-CALL-PARAM
NR2001*TB0159                        BORM-RECORD-AREA
NR2001*TB0159                        BORV-RECORD-AREA
NR2001    MOVE UPTELLCA-TELLER-BRANCH TO BOCT-TELL-AND-BR.
NR2001    MOVE STRT-AREA-TERM-NO   TO BOCT-BRTERM.
NR2001    MOVE 0                   TO BOCT-STAT
NR2001                                BOCT-01-CHQ-DAYS.
NR2001    MOVE STRT-AREA-JRNL-NO   TO BOCT-JRNL-NO.
NR2001    MOVE STRT-AREA-POST-DT   TO BOCT-TRN-DATE
NR2001                                BOCT-POST-DATE.
NR2001    MOVE STRT-AREA-MSG-TIME  TO BOCT-01-REPOST-TIME.
NR2001    MOVE 13540               TO BOCT-TRN-CODE.
NR2001    IF WA-INPUT-PARAM-TABLE(7) = 1
NR2001** IF THIS IS CORRECTION WE SHOULD ALWAYS CHECK BOCT
NR2001** IF THERE WERE FEES GENERATED DURING ADVANCE.     
NR2001** 1) SAVE BOCT RECORD                              
NR2001       MOVE BOCT-RECORD-AREA   TO WA-SAVE-BOCT      
NR2001** 2) LOCATE TRAN                                   
NR2001       PERFORM M600-LOCATE-FEES-FOR-CORR            
NR2001          THRU M609-EXIT                            
NR2001** 3) RESTORE BOCT-RECORD-AREA                      
NR2001       MOVE WA-SAVE-BOCT       TO BOCT-RECORD-AREA  
NR2001** 4) CHECK WA-FEE-FOUND-FLAG IF THERE WAS A FEE    
NR2001**    DO NOT CALL UT0074 IF THERE WERE NO FEES FOUND
NR2001       IF WA-FEE-FOUND-FLAG = "N"                   
NR2001          GO TO M599-UT0074-EXIT                    
NR2001       END-IF                                       
NR2001                                                    
NR2001       ADD 100                TO BOCT-TRN-CODE
NR2001       MOVE W800-CORR-JRNL-NO TO UT0074CA-JRNL-NO
NR2001    END-IF
NR2001    SET UT0074CA-NOT-BKDT-TXN TO TRUE
NR2001    IF WA-INPUT-PARAM-TABLE(8) = 1
NR2001       SET UT0074CA-BKDT-TXN   TO TRUE
NR2001       MOVE WA-ADV-TXN-DATE    TO UT0030-DATE-DDMMCCYY
NR2001       MOVE 1                  TO UT0030-FUNCTION
NR2001       CALL "UT0030"   USING      UT0030-FUNCTION
NR2001                                  UT0030-DATE-AREA
NR2001                                  UT0030-BINARY-DATE
NR2001       MOVE UT0030-BINARY-DATE TO BOCT-TRN-DATE
NR2001    END-IF.
NR2001    CALL "UT0074" USING UT0074CA-CALL-PARAM
NR2001                        BORM-RECORD-AREA
NR2001                        BOCT-RECORD-AREA
TB0159                        BOIS-RECORD
TB0159                        BORP-RECORD-AREA
TB0159                        BR0023CA-AREA
TB0159                        BR0024CA-AREA
TB0159    IF UT0074CA-RET-STATUS <> ZEROES
TB0159        MOVE UT8500CA-FUNC-NORMAL-DISPLAY
TB0159                      TO UT8500CA-CALL-CODE
TB0159        MOVE SPACES TO UT8500CA-INPUT-MSG
TB0159        STRING "BR0024:(B000) ERROR UT0074, "
TB0159               ", RETURN CODE=" UT0074CA-RET-STATUS
TB0159               DELIMITED BY SIZE INTO
TB0159                            UT8500CA-INPUT-MSG
TB0159        CALL "UT8500" USING  UT8500CA-AREA
TB0159        IF UT0074CA-ERROR-MSG-NO <> ZERO
TB0159           MOVE UT0074CA-ERROR-MSG-NO TO
TB0159                WA-OUTPUT-ERR-MSG-NO
TB0159        END-IF
TB0159        MOVE 1 TO ST-STATUS-LEVEL-1
TB0159                  WA-MSG-ERR-FLAG
TB0159        PERFORM W200-FMT-SEND-PARA THRU W299-EXIT
TB0159    END-IF.
SC7197    MOVE 13540               TO BR0024CA-TXN-CODE(3)
SC7197    IF WA-INPUT-PARAM-TABLE(7) = 1                  
SC7197       ADD 100               TO BR0024CA-TXN-CODE(3)
SC7197       MULTIPLY -1 BY WA-TOT-FEE-AMT                
SC7197    END-IF.                                         
SC7197    MOVE WA-TOT-FEE-AMT      TO BR0024CA-AMOUNT(3). 
SC7197    MOVE BORM-LOAN-BAL       TO BR0024CA-BALANCE(3).
SC7197*   MOVE 13540               TO BR0024CA-TXN-CODE(5)  
SC7197*   IF WA-INPUT-PARAM-TABLE(7) = 1
SC7197*      ADD 100               TO BR0024CA-TXN-CODE(5)
SC7197*      MULTIPLY -1 BY WA-TOT-FEE-AMT
SC7197*   END-IF.
SC7197*   MOVE WA-TOT-FEE-AMT      TO BR0024CA-AMOUNT(5).
SC7197*   MOVE BORM-LOAN-BAL       TO BR0024CA-BALANCE(5).
TB0159 M599-UT0074-EXIT.
TB0159    EXIT.
SC6067                                                               
SC6067 M600-LOCATE-FEES-FOR-CORR.                                    
NR2001*SC6067     MOVE SPACES                      TO DBIO-CALL-PARAM       
NR2001*SC6067                                         DBIO-CALL-SYS-AREA    
NR2001*SC6067                                         DBIO-CALL-KEY-AREA    
NR2001*SC6067                                         DBIO-CALL-STATUS.     
NR2001*SC6067     MOVE 0                           TO DBIO-CALL-REFER-AREA. 
NR2001*SC6067*NR0050     MOVE "BEGN"                      TO DBIO-CALL-SAVE-REFER. 
NR2001*NR0050     MOVE SPACES                      TO DBIO-CALL-SAVE-REFER.
NR2001*SC6067     MOVE 07                          TO DBIO-CALL-FUNC.       
NR2001*SC6067     MOVE "BOR"                       TO DBIO-CALL-SYS.        
NR2001*SC6067     MOVE STRT-AREA-SOC-NO            TO WA-BORV-SOC-NO.       
NR2001*SC6067     MOVE BORM-MEMB-CUST-AC           TO WA-BORV-ACT-NO.       
NR2001*SC6067     MOVE WA-BORV-KEY                 TO DBIO-CALL-KEY-AREA.   
NR2001*SC6067     MOVE 01                          TO DBIO-CALL-TXN-TYPE.   
NR2001*SC6067                                                               
NR2001*SC6067     MOVE "N"                         TO WA-FEE-FOUND-FLAG     
NR2001*SC6067                                         WA-TRAN-NO-MORE-FLAG. 
NR2001*SC6067                                                               
NR2001*SC6067     IF WA-INPUT-PARAM-TABLE(8) = 1                            
NR2001*SC6067        MOVE WA-STORE-TXN-DT          TO WA-BORV-TRN-DATE      
NR2001*SC6067     ELSE                                                      
NR2001*SC6067        MOVE STRT-AREA-POST-DT        TO WA-BORV-TRN-DATE 
NR2001*SC6067     END-IF                                               
NR2001*SC6067                                                          
NR2001*SC6067     PERFORM M610-BORV-FEES-TRAN                          
NR2001     INITIALIZE UTBOCTCA-CALL-AREA.
NR2001     MOVE STRT-AREA-SOC-NO            TO BOCT-INST-NO.
NR2001     MOVE BORM-MEMB-CUST-AC           TO BOCT-ACCT-NO.
NR2001     MOVE 0                           TO BOCT-REC-NO.
NR2003*NR2001     MOVE 999999999                   TO BOCT-TRN-DATE.
NR2003     MOVE STRT-AREA-POST-DT           TO BOCT-TRN-DATE.
NR2001     MOVE 1                           TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT           TO TRUE.
NR2001     MOVE 01                          TO WS-BOCT-TRAN-TYPE.
NR2001                                                               
NR2001     MOVE "N"                         TO WA-FEE-FOUND-FLAG     
NR2001                                         WA-TRAN-NO-MORE-FLAG. 
NR2001                                                               
NR2001     IF WA-INPUT-PARAM-TABLE(8) = 1                            
NR2001        MOVE WA-STORE-TXN-DT          TO WA-BOCT-TRN-DATE      
NR2001     ELSE                                                      
NR2001        MOVE STRT-AREA-POST-DT        TO WA-BOCT-TRN-DATE 
NR2001     END-IF                                               
NR2001                                                          
NR2001     PERFORM M610-BOCT-FEES-TRAN                          
SC6067        THRU M619-EXIT                                    
SC6067       UNTIL WA-TRAN-NO-MORE                              
SC6067          OR WA-MSG-ERR-FLAG <> 0.                        
SC6067                                                          
SC6067 M609-EXIT.                                               
SC6067    EXIT.                                                 
SC6067                                                          
NR2001*SC6067 M610-BORV-FEES-TRAN.                                     
NR2001*SC6067     CALL "DBIO" USING                                    
NR2001*SC6067                            DBIO-CALL-PARAM               
NR2001*SC6067                            DBIO-CALL-SYS-AREA            
NR2001*SC6067                            DBIO-CALL-KEY-AREA            
NR2001*SC6067                            DBIO-CALL-STATUS              
NR2001*SC6067                            BORV-RECORD-AREA              
NR2001*SC6067                            DBIO-CALL-REFER-AREA          
NR2001*SC6067                            DBIO-CALL-TXN-TYPE-AREA       
NR2001*SC6067                                                          
NR2001*SC6067     IF DBIO-CALL-STATUS NOT = "****"                   
NR2001*SC6067        MOVE "Y"         TO WA-TRAN-NO-MORE-FLAG        
NR2001*SC6067        GO TO M619-EXIT                                 
NR2001*SC6067     END-IF.                                            
NR2001*SC6067                                                        
NR2001*SC6067     IF BORV-01-TRN-DATE < WA-BORV-TRN-DATE             
NR2001*SC6067        MOVE "Y"         TO WA-TRAN-NO-MORE-FLAG        
NR2001*SC6067        GO TO M619-EXIT                                 
NR2001*SC6067     END-IF.                                            
NR2001*SC6067                                                        
NR2001*SC6067     IF BORV-01-STATUS >= 20                            
NR2001*SC6067        GO TO M619-EXIT                                 
NR2001*SC6067     END-IF.                                            
NR2001*SC6067                                                        
NR2001*SC6067     IF W800-CORR-JRNL-NO = BORV-01-JRNL-NO             
NR2001*SC8034     AND BORV-01-TRN-CODE = 13540                 
NR2001*SC8034     AND BORV-01-TRN-DATE = WA-BORV-TRN-DATE      
NR2001*SC6067        MOVE "Y"            TO WA-FEE-FOUND-FLAG        
NR2001*SC6067                               WA-TRAN-NO-MORE-FLAG     
NR2001*SC6067        COMPUTE UT0074CA-POST-AMT = BORV-01-AMOUNT * -1 
NR2001*SC6067        MOVE BORV-01-AMOUNT TO WA-TOT-FEE-AMT           
NR2001*SC8226*****UPDATE PREVIOUS BORV STATUS*****
NR2001*SC8286         ADD 20              TO BORV-01-STATUS
NR2001*SC8286         MOVE 13             TO DBIO-CALL-FUNC
NR2001*SC8286         MOVE SPACES         TO DBIO-CALL-STATUS
NR2001*SC8286         CALL "DBIO"      USING
NR2001*SC8286                                DBIO-CALL-PARAM
NR2001*SC8286                                DBIO-CALL-SYS-AREA
NR2001*SC8286                                DBIO-CALL-KEY-AREA
NR2001*SC8286                                DBIO-CALL-STATUS
NR2001*SC8286                                BORV-RECORD-AREA
NR2001*SC8286                                DBIO-CALL-REFER-AREA
NR2001*SC8286         IF DBIO-CALL-STATUS NOT = "****"
NR2001*SC8286           MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
NR2001*SC8286             MOVE SPACES TO UT8500CA-INPUT-MSG
NR2001*SC8286             STRING "BR0024:(M610) -BORV WRITE ERROR "
NR2001*SC8286                     "RETURN STATUS = " DBIO-CALL-STATUS
NR2001*SC8286                 DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
NR2001*SC8286             CALL "UT8500" USING
NR2001*
NR2001*SC8286                                 UT8500CA-AREA
NR2001*SC8286             MOVE 1          TO WA-MSG-ERR-FLAG
NR2001*SC8286             MOVE 155        TO WA-OUTPUT-ERR-MSG-NO
NR2001*SC8286             MOVE "BORV"     TO WA-DBERR-DATA-SET
NR2001*SC8286             MOVE DBIO-CALL-STATUS
NR2001*SC8286                             TO WA-DB-ERROR
NR2001*SC8286             GO TO M619-EXIT
NR2001*SC8226        END-IF
NR2001*SC6067     END-IF.                                            
NR2001*SC6067                                                        
NR2001*SC6067 M619-EXIT.                                             
NR2001*SC6067    EXIT.
NR2001 M610-BOCT-FEES-TRAN.                                     
NR2001     MOVE BOCT-INST-NO        TO UTBOCTCA-INST-NO.
NR2001     MOVE BOCT-ACCT-NO        TO UTBOCTCA-ACCT-NO.
NR2001     MOVE BOCT-REC-NO         TO UTBOCTCA-REC-NO.
NR2001     MOVE BOCT-TRN-DATE       TO UTBOCTCA-CALL-DATE.
NR2001     MOVE 1                   TO UTBOCTCA-KEY-NO.
NR2001     SET  UTBOCTCA-READNEXT   TO TRUE.
NR2001     CALL "UTBOCT"         USING UTBOCTCA-CALL-AREA
NR2001                                 BOCT-RECORD-AREA.
NR2001
NR2001     IF NOT UTBOCTCA-OK  
NR2001        MOVE "Y"         TO WA-TRAN-NO-MORE-FLAG        
NR2001        GO TO M619-EXIT                                 
NR2001     END-IF.                                            
NR2001                                                        
NR2003     IF BOCT-TRN-DATE < WA-BOCT-TRN-DATE
NR2003        MOVE "Y"         TO WA-TRAN-NO-MORE-FLAG
NR2003        GO TO M619-EXIT
NR2003     END-IF.
NR2003
NR2001     IF BOCT-TRAN-TYPE NOT = WS-BOCT-TRAN-TYPE
NR2001        GO TO M619-EXIT                                 
NR2001     END-IF.                                            
NR2001
NR2003*NR2001     IF BOCT-TRN-DATE < WA-BOCT-TRN-DATE
NR2003*NR2001        MOVE "Y"         TO WA-TRAN-NO-MORE-FLAG
NR2003*NR2001        GO TO M619-EXIT
NR2003*NR2001     END-IF.
NR2001                                                        
NR2001     IF BOCT-STAT >= 20                            
NR2001        GO TO M619-EXIT                                 
NR2001     END-IF.                                            
NR2001                                                        
NR2001     IF W800-CORR-JRNL-NO = BOCT-JRNL-NO             
NR2001     AND BOCT-TRN-CODE = 13540                 
NR2001     AND BOCT-TRN-DATE = WA-BOCT-TRN-DATE      
NR2001        MOVE "Y"            TO WA-FEE-FOUND-FLAG        
NR2001                               WA-TRAN-NO-MORE-FLAG     
NR2001        COMPUTE UT0074CA-POST-AMT = BOCT-01-AMOUNT * -1 
NR2001        MOVE BOCT-01-AMOUNT TO WA-TOT-FEE-AMT           
NR2001*****UPDATE PREVIOUS BOCT STATUS*****
NR2001         ADD 20              TO BOCT-STAT
NR2001         MOVE BOCT-INST-NO        TO UTBOCTCA-INST-NO
NR2001         MOVE BOCT-ACCT-NO        TO UTBOCTCA-ACCT-NO
NR2001         MOVE BOCT-REC-NO         TO UTBOCTCA-REC-NO
NR2001         MOVE BOCT-POST-DATE      TO UTBOCTCA-CALL-DATE
NR2001         SET  UTBOCTCA-REWRITE    TO TRUE    
NR2001         CALL "UTBOCT" USING UTBOCTCA-CALL-AREA
NR2001                             BOCT-RECORD-AREA
NR2001         IF NOT UTBOCTCA-OK
NR2001           MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
NR2001             MOVE SPACES TO UT8500CA-INPUT-MSG
NR2001             STRING "BR0024:(M610) -BOCT WRITE ERROR "
NR2001                    ", CALLCODE=" UTBOCTCA-CALL-CODE
NR2001                    ", STATUS="   UTBOCTCA-STATUS
NR2001                    ", CALLKEY="  UTBOCTCA-CALL-KEY
NR2001                 DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
NR2001             CALL "UT8500" USING
NR2001                                 UT8500CA-AREA
NR2001             MOVE 1          TO WA-MSG-ERR-FLAG
NR2001             MOVE 155        TO WA-OUTPUT-ERR-MSG-NO
NR2001             MOVE "BOCT"     TO WA-DBERR-DATA-SET
NR2001             MOVE UTBOCTCA-STATUS
NR2001                             TO WA-DB-ERROR
NR2001             GO TO M619-EXIT
NR2001         END-IF
NR2001     END-IF.                                            
NR2001                                                        
NR2001 M619-EXIT.                                             
NR2001    EXIT.
SC6067         
TB0196 Z400-CREATE-PRJB.
TB0196      MOVE 2                 TO UTPRJBCA-CALL-CODE.
TB0196      MOVE ZERO              TO UTPRJBCA-CALL-STATUS.
TB0196      MOVE BORM-SOC-NO       TO UTPRJBCA-SOC-NO.
TB0196      MOVE BORM-MEMB-CUST-AC TO UTPRJBCA-ACCT-NO.
TB0196      MOVE UT1999CA-CCYYMMDD TO UTPRJBCA-CCYYMM.
TB0196      MOVE BORM-LOAN-BAL     TO UTPRJBCA-NEW-BAL(UT1999CA-DD).
TB0196      CALL "UTPRJB" USING UTPRJBCA-CALL-AREA.
TB0196      IF UTPRJBCA-CALL-STATUS NOT ZERO
TB0196         MOVE UT8500CA-FUNC-NORMAL-DISPLAY
TB0196                TO UT8500CA-CALL-CODE
TB0196         MOVE SPACES TO UT8500CA-INPUT-MSG
TB0196         STRING "BR0024:(Z400)  "
TB0196                     " ERROR WRITING PRJB "
TB0196                       UTPRJBCA-ACCT-NO " " UTPRJBCA-CALL-STATUS
TB0196              DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
TB0196              CALL "UT8500" USING
TB0196                    UT8500CA-AREA
TB0196      END-IF.
TB0196 Z499-EXIT.
TB0196     EXIT.
TB0196 Z700-UPDATE-SUBS.
TB0196     MOVE STRT-AREA-SOC-NO      TO SUBS-SOC-NO.
TB0196     MOVE BORM-MEMB-CUST-AC     TO SUBS-ACCT-NO.
TB0196     SET READ-CMD               TO TRUE.
TB0196     PERFORM Z710-ACCESS-SUBS THRU Z710-EXIT.
TB0196     IF DBIOMOD-STAT = "****"
SC7928        IF WA-BEFORE-BORN-STAT < 6
SC7928           MOVE BORM-ADV-DATE TO SUBS-START-DATE
S17497           IF PROD-MORTGAGE-POLICY-YUN
S17497              MOVE 24             TO WA-TERM-NO
S17497              PERFORM Z720-GET-MAT-DATE THRU Z720-EXIT
S17497              MOVE WA-RETURN-DATE TO SUBS-STOP-DATE
S17497           END-IF
SC7928        END-IF
TB0196        MOVE BORM-ADV-DATE TO SUBS-ADVANCE-DATE
TB0196        SET REWRITE-CMD    TO TRUE
TB0196        PERFORM Z710-ACCESS-SUBS THRU Z710-EXIT
TB0196     END-IF.
TB0196 Z700-EXIT.
TB0196     EXIT.
TB0196 Z710-ACCESS-SUBS.
TB0196     MOVE "SUBS"       TO DBIOMOD-FILE
TB0196                          DBIOMOD-SUFFIX.
TB0196     MOVE "DBIO"       TO DBIOMOD-PREFIX.
TB0196     MOVE SUBS-KEY     TO DBIOMOD-KEY.
TB0196     MOVE ZEROES       TO DBIOMOD-KEY-NO.
TB0196     MOVE SPACES       TO DBIOMOD-RELEASE-LOCK
TB0196                          DBIOMOD-STATUS
TB0196                          DBIOMOD-ACCESS-COMMAND
TB0196                          DBIOMOD-ACCESS-COND.
TB0196
TB0196     CALL DBIOMODNAME USING
TB0196                          DBIOMOD-FILE
TB0196                          DBIOMOD-KEY
TB0196                          WA-SUBS-AREA
TB0196                          DBIOMOD-FUNCTION
TB0196                          DBIOMOD-KEY-NO
TB0196                          DBIOMOD-RELEASE-LOCK
TB0196                          DBIOMOD-ACCESS-COMMAND
TB0196                          DBIOMOD-ACCESS-COND
TB0196                          DBIOMOD-STATUS.
TB0196 Z710-EXIT.
TB0196     EXIT.
TB0020**--
S17497 Z720-GET-MAT-DATE.
S17497
S17497     MOVE 0                     TO WA-RETURN-DATE.
S17497     INITIALIZE UT0312CA-CALL-AREA.
S17497     MOVE 17                    TO UT0312CA-CALL-CODE.
S17497     MOVE STRT-AREA-POST-DT     TO UT0312CA-EFF-DATE.
S17497     IF BORM-REFERRAL-DATE > 0
S17497        MOVE BORM-REFERRAL-DATE TO UT0312CA-DUE-STRT-DT
S17497     ELSE
S17497        MOVE BORM-ADV-DATE      TO UT0312CA-DUE-STRT-DT
S17497     END-IF.
S17497     MOVE UT0312CA-DUE-STRT-DT  TO UT0020-BINARY-DATE.
S17497     MOVE 1                     TO UT0020-FUNCTION.
S17497     PERFORM X100-UT0020-PARA   THRU X109-EXIT.
S17497     MOVE UT0020-DATE-DD        TO UT0312CA-REPAY-DAY.
S17497     MOVE BOIS-DUE-DTE-IND      TO UT0312CA-1ST-DUE-DTE-IND.
S17497     IF BORM-REPAY-FREQ > 0
S17497        MOVE BORM-REPAY-FREQ    TO UT0312CA-REPAY-FREQ
S17497     ELSE
S17497        MOVE BORP-REPAY-FREQ    TO UT0312CA-REPAY-FREQ
S17497     END-IF.
S17497     IF BORM-REPAY-SCHED       =  SPACE
S17497        MOVE BORP-REPAY-SCHED  TO UT0312CA-REPAY-SCHED
S17497     ELSE
S17497        MOVE BORM-REPAY-SCHED  TO UT0312CA-REPAY-SCHED
S17497     END-IF.
S17497     MOVE BORM-CAPN-METHOD     TO UT0312CA-CAPN-METHOD.
S17497     MOVE WA-TERM-NO           TO UT0312CA-LOAN-TERM.
S17497     SET  UT0312CA-HOLIDAY-DUE-PREV-WD TO TRUE.
S17497     CALL "UT0312"             USING UT0312CA-CALL-AREA.
S17497     IF UT0312CA-RET-STATUS    = 0
S17497        IF UT0312CA-MATURITY-DT  > STRT-AREA-POST-DT
S17497           MOVE UT0312CA-MATURITY-DT TO WA-RETURN-DATE
S17497        ELSE
S17497           MOVE 0              TO WA-RETURN-DATE
S17497        END-IF
S17497     ELSE
S17497        MOVE 0                 TO WA-RETURN-DATE
S17497     END-IF.
S17497
S17497 Z720-EXIT.
S17497     EXIT.
S17497**--
       D500-READ-FACD.
      *===============

           MOVE 80          TO DBIO-CALL-FUNC.
           MOVE "BEGN"      TO DBIO-CALL-SAVE-REFER
           MOVE 1           TO DBIO-CALL-ALT-KEY.
           MOVE "FACD    "  TO DBIO-CALL-SYS-AREA.
           MOVE SPACES      TO DBIO-CALL-STATUS.
           CALL "DBIO" USING
                       DBIO-CALL-PARAM
                       DBIO-CALL-SYS-AREA
                       DBIO-CALL-KEY-AREA
                       DBIO-CALL-STATUS
                       FACD-AREA
                       DBIO-CALL-REFER-AREA.

           IF DBIO-CALL-STATUS = "****"
              MOVE FACD-TEMP-LIMIT-AMT TO WA-TEMP-LMT-AMT
              IF FACD-TEMP-LIMIT-EXP-DATE NOT = ZEROES
                 MOVE FACD-TEMP-LIMIT-EXP-DATE TO WA-TEMP-EXP-DATE
              END-IF
           END-IF.

           IF DBIO-CALL-STATUS = "MRNF"
              MOVE 1    TO WA-MSG-ERR-FLAG
              MOVE 1702 TO WA-OUTPUT-ERR-MSG-NO
              GO        TO D599-EXIT
           END-IF.

           IF DBIO-CALL-STATUS NOT = "****" AND "MRNF"
              MOVE 155              TO WA-OUTPUT-ERR-MSG-NO
              MOVE 1                TO WA-MSG-ERR-FLAG
              MOVE "FACD"           TO WA-OUTPUT-DATA-SET
              MOVE DBIO-CALL-STATUS TO WA-OUTPUT-STATUS
              MOVE UT8500CA-FUNC-NORMAL-DISPLAY
                          TO UT8500CA-CALL-CODE
              MOVE SPACES TO UT8500CA-INPUT-MSG
              STRING "BR0024:(B0000) READ FACD ERROR"
                     ", SAVE-REFER = " DBIO-CALL-SAVE-REFER
                     ", DBIO-STAT  = " DBIO-CALL-STATUS
                     ", KEY = " DBIO-CALL-KEY-AREA
                  DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
              CALL "UT8500" USING
                            UT8500CA-AREA
              GO TO D599-EXIT
           END-IF.

       D599-EXIT.
      *----------
           EXIT.

TB0236 D600-YOUBE-STRT-METHOD.
TB0236      IF BOIS-START-METHOD NOT EQUAL SPACES
TB0236         IF BOIS-START-METHOD = "01"
TB0236            MOVE BORM-APPLIC-ISSUE-DATE TO BORM-INT-START-DATE
TB0236         ELSE
TB0236           IF BOIS-START-METHOD = "02"
TB0236              MOVE BORM-APPRV-DATE TO BORM-INT-START-DATE
TB0236           ELSE
TB0236             IF BOIS-START-METHOD = "03"
TB0236                IF WA-BEFORE-BORM-ADV-VAL = 0
TB0236                 MOVE STRT-AREA-POST-DT TO BORM-INT-START-DATE
TB0236                END-IF
TB0236             ELSE
TB0236               IF BOIS-START-METHOD = "04"
TB0236                  DIVIDE BORM-APP-AMT BY 2 GIVING WA-50PC-ADV
TB0236                IF (BORM-ADV-VAL - WA-DUMMY-AMT < WA-50PC-ADV) AND
TB0236                     (BORM-ADV-VAL > WA-50PC-ADV)
TB0236                    MOVE STRT-AREA-POST-DT TO BORM-INT-START-DATE
TB0236               ELSE
TB0236                 IF BOIS-START-METHOD = "07"
TB0236                   MOVE BOIS-CARD-USED-DATE TO BORM-INT-START-DATE
TB0236                 END-IF
TB0236               END-IF
TB0236             END-IF
TB0236           END-IF
TB0236         END-IF
TB0236      ELSE
TB0236         IF BORP-START-METH = 01
TB0236            MOVE BORM-APPLIC-ISSUE-DATE TO BORM-INT-START-DATE
TB0236         ELSE
TB0236            IF BORP-START-METH = 02
TB0236               MOVE BORM-APPRV-DATE TO BORM-INT-START-DATE
TB0236            ELSE
TB0236              IF BORP-START-METH = 03 AND
TB0236                 WA-BEFORE-BORM-ADV-VAL = 0
TB0236                 MOVE STRT-AREA-POST-DT TO BORM-INT-START-DATE
TB0236              ELSE
TB0236                IF BORP-START-METH = 04
TB0236                   DIVIDE BORM-APP-AMT BY 2 GIVING WA-50PC-ADV
TB0236                   IF (BORM-ADV-VAL - WA-DUMMY-AMT < WA-50PC-ADV)
TB0236                    MOVE STRT-AREA-POST-DT TO BORM-INT-START-DATE
TB0236                   END-IF
TB0236                ELSE
TB0236                 IF BORP-START-METH = 07
TB0236                    MOVE BOIS-CARD-USED-DATE TO
TB0236                         BORM-INT-START-DATE
TB0236                 END-IF
TB0236                END-IF
TB0236              END-IF
TB0236            END-IF
TB0236         END-IF
TB0236      END-IF.
TB0236
TB0236 D699-EXIT.
TB0236     EXIT.

SC5099 D700-MNGMENT-FEE.
S11455        IF WA-ADV-AMORT-FLAG = "S"                    
S11455           MOVE ZEROES               TO WA-TOT-FEE-AMT
S11455           GO TO D799-EXIT                            
S11455        END-IF.                                       
ST0079        INITIALIZE UT0270CA-AREA.
S10578        IF WA-ADV-PROMO NOT = SPACES                     
S10578           MOVE WA-ADV-PROMO         TO UT0270CA-IN-PROMO
S10578           PERFORM D730-GET-MNEMONIC-FEE                 
S10578              THRU D739-EXIT                             
S10578        END-IF.                                          
SC5099        IF (WA-ADV-PROMO = SPACES
ST0079        OR WA-INPUT-PARAM-TABLE(30) = 1)
S10578        OR  (WA-ADV-PROMO NOT = SPACES  
S10578        AND UT0270CA-GLC-OVRD-IND = "Y")
TB0159          IF BOIS-PROMO-CODE = SPACES
ST0079             MOVE 0               TO WA-TOT-FEE-AMT
SC5099*            PERFORM D720-GET-FROM-CIEP
SC5099*                    THRU D729-CIEP-EXIT
TB0159          ELSE
TB0159*           MOVE WA-INPUT-ACCT-NO TO BAFM-ACCT-NO
TB0159*           MOVE BOIS-PROMO-CODE  TO BAFM-PROMO-CODE
TB0159*           MOVE 0 TO BAFM-FEE-TYPE
TB0159*           PERFORM Z200-BAFM-PROCESSING
TB0159*                   THRU Z399-READ-BAFM-EXIT
S10578            INITIALIZE UT0270CA-AREA
ST0079            MOVE BOIS-PROMO-CODE  TO UT0270CA-IN-PROMO
ST0079            PERFORM D730-GET-MNEMONIC-FEE
ST0079                    THRU D739-EXIT
S10329            IF ( BORP-YOUBE )
S10329                 PERFORM D740-GET-DISCOUNT-FEE THRU D749-EXIT
S10329                 IF  ( WA-TOT-FEE-AMT >= WA-DIS-FEE-AMT )
S10329                       COMPUTE WA-TOT-FEE-AMT = WA-TOT-FEE-AMT
S10329                                              - WA-DIS-FEE-AMT
S10329                 ELSE
S10329                       MOVE    0      TO        WA-TOT-FEE-AMT
S10329                 END-IF
S10329            END-IF
TB0159          END-IF
SC5099        ELSE
SC5099           IF WA-ADV-PROMO = 'NF'
SC5099              MOVE 0 TO WA-TOT-FEE-AMT
SC5099           ELSE
SC5099*             MOVE WA-INPUT-ACCT-NO TO BAFM-ACCT-NO
SC5099*             MOVE WA-ADV-PROMO TO BAFM-PROMO-CODE
SC5099*             MOVE 0 TO BAFM-FEE-TYPE
SC5099*             PERFORM Z200-BAFM-PROCESSING THRU
SC5099*                     Z399-READ-BAFM-EXIT
S10578              INITIALIZE UT0270CA-AREA
ST0079              MOVE WA-ADV-PROMO     TO UT0270CA-IN-PROMO
ST0079              PERFORM D730-GET-MNEMONIC-FEE
ST0079                      THRU D739-EXIT
S10329              IF ( BORP-YOUBE )
S10329                   PERFORM D740-GET-DISCOUNT-FEE THRU D749-EXIT
S10329                   IF  ( WA-TOT-FEE-AMT >= WA-DIS-FEE-AMT )
S10329                         COMPUTE WA-TOT-FEE-AMT = WA-TOT-FEE-AMT
S10329                                                - WA-DIS-FEE-AMT
S10329                   ELSE
S10329                         MOVE    0      TO      WA-TOT-FEE-AMT
S10329                   END-IF
S10329              END-IF
SC5099*             IF DBIOMOD-STAT = "MRNF"
SC5099*                IF BOIS-PROMO-CODE = SPACES
SC5099*                  PERFORM D720-GET-FROM-CIEP
SC5099*                     THRU D729-CIEP-EXIT
SC6000*                ELSE
SC6000*                  MOVE WA-INPUT-ACCT-NO TO BAFM-ACCT-NO
SC6000*                  MOVE BOIS-PROMO-CODE  TO BAFM-PROMO-CODE
SC6000*                  MOVE 0 TO BAFM-FEE-TYPE
SC6000*                  PERFORM Z200-BAFM-PROCESSING
SC6000*                          THRU Z399-READ-BAFM-EXIT
SC5099*                END-IF
SC5099*             END-IF
SC5099           END-IF
TB0159        END-IF.

SC5099 D799-EXIT.
SC5099      EXIT.

SC5099 D720-GET-FROM-CIEP.
SC5099     INITIALIZE UTCIEPCA-CALL-PARAM
SC5099     MOVE 02 TO UTCIEPCA-CALL-CODE
SC5099     MOVE STRT-AREA-SOC-NO TO UTCIEPCA-SOC-NO
SC5099     MOVE BORP-FEE-TYPE    TO UTCIEPCA-TYPE
SC5099     CALL "UTCIEP" USING      UTCIEPCA-CALL-PARAM
SC5099     IF UTCIEPCA-CALL-STATUS NOT = 0
SC5099        MOVE 188 TO WA-OUTPUT-ERR-MSG-NO
SC5099        MOVE 1                   TO WA-MSG-ERR-FLAG
SC5099        GO TO D729-CIEP-EXIT
SC5099     END-IF
SC5099     MOVE UTCIEPCA-STD-AMOUNT TO  WA-TOT-FEE-AMT.

SC5099 D729-CIEP-EXIT.
SC5099      EXIT.

ST0079 D730-GET-MNEMONIC-FEE.
ST0079     MOVE 2                         TO UT0270CA-IN-CALL-CODE.
ST0079     MOVE STRT-AREA-SOC-NO          TO UT0270CA-IN-SOC-NO.
ST0079     MOVE SOC-LANGUAGE-CODE         TO UT0270CA-IN-LANGUAGE-CODE.
ST0079     CALL "UT0270" USING               UT0270CA-AREA.
ST0079     IF UT0270CA-OUT-STAT NOT = "****"
ST0079        MOVE 730                    TO WA-OUTPUT-ERR-MSG-NO
ST0079        MOVE 1                      TO WA-MSG-ERR-FLAG
ST0079        GO TO D739-EXIT
ST0079     END-IF.
ST0079     MOVE UT0270CA-FEE-AMOUNT       TO WA-TOT-FEE-AMT.
ST0079
ST0079
ST0079 D739-EXIT.
ST0079     EXIT.

S10329 D740-GET-DISCOUNT-FEE.
S10329*
S10329     IF ( BOIS-DIS-PROMO-CODE       <> SPACES 
S10329     AND  BOIS-DIS-EXP-DATE         >  STRT-AREA-POST-DT )
S10329          MOVE BOIS-DIS-PROMO-CODE  TO UT0270CA-IN-PROMO
S10329     ELSE
S10329          MOVE 0                    TO WA-DIS-FEE-AMT
S10329          GO                        TO D749-EXIT
S10329     END-IF.
S10329*
S10329     MOVE 2                         TO UT0270CA-IN-CALL-CODE.
S10329     MOVE STRT-AREA-SOC-NO          TO UT0270CA-IN-SOC-NO.
S10329     MOVE SOC-LANGUAGE-CODE         TO UT0270CA-IN-LANGUAGE-CODE.
S10329     CALL "UT0270" USING               UT0270CA-AREA.
S10329*
S10329     IF ( UT0270CA-OUT-STAT     NOT =  "****" )
S10329          MOVE 730                  TO WA-OUTPUT-ERR-MSG-NO
S10329          MOVE 1                    TO WA-MSG-ERR-FLAG
S10329          GO                        TO D749-EXIT
S10329     END-IF.
S10329*
S10329     MOVE UT0270CA-FEE-AMOUNT       TO WA-DIS-FEE-AMT.
S10329*
S10329 D749-EXIT.
S10329     EXIT.
S10329*
       D800-READ-FACM.
      *===============

           MOVE 71          TO DBIO-CALL-FUNC.
           MOVE "FACM    "  TO DBIO-CALL-SYS-AREA.
           MOVE SPACES      TO DBIO-CALL-STATUS.
           CALL "DBIO" USING
                       DBIO-CALL-PARAM
                       DBIO-CALL-SYS-AREA
                       DBIO-CALL-KEY-AREA
                       DBIO-CALL-STATUS
                       FACM-AREA
                       DBIO-CALL-REFER-AREA.

           IF DBIO-CALL-STATUS = "****"
              IF NOT FACM-ACTIVE
SC2973            AND NOT FACM-FREEZE
                 MOVE 1    TO WA-MSG-ERR-FLAG
                 MOVE 3941 TO WA-OUTPUT-ERR-MSG-NO
SC3850*        GO        TO D599-EXIT
SC3850         GO        TO D899-EXIT
              END-IF
           END-IF.

           IF DBIO-CALL-STATUS = "MRNF"
              MOVE 1    TO WA-MSG-ERR-FLAG
              MOVE 1702 TO WA-OUTPUT-ERR-MSG-NO
SC3850*        GO        TO D599-EXIT
SC3850         GO        TO D899-EXIT
           END-IF.

           IF DBIO-CALL-STATUS NOT = "****" AND "MRNF"
              MOVE 155              TO WA-OUTPUT-ERR-MSG-NO
              MOVE 1                TO WA-MSG-ERR-FLAG
              MOVE "FACM"           TO WA-OUTPUT-DATA-SET
              MOVE DBIO-CALL-STATUS TO WA-OUTPUT-STATUS
              MOVE UT8500CA-FUNC-NORMAL-DISPLAY
                          TO UT8500CA-CALL-CODE
              MOVE SPACES TO UT8500CA-INPUT-MSG
              STRING "BR0024:(B0000) READ FACM ERROR"
                     ", SAVE-REFER = " DBIO-CALL-SAVE-REFER
                     ", DBIO-STAT  = " DBIO-CALL-STATUS
                     ", KEY = " DBIO-CALL-KEY-AREA
                  DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
              CALL "UT8500" USING
                            UT8500CA-AREA
              GO TO D899-EXIT
           END-IF.

       D899-EXIT.
      *----------
           EXIT.
SC6924 D900-READ-BLDVNN.
SC6924     MOVE 61                 TO DBIO-CALL-FUNC.
           MOVE "NN"               TO BLDV-NI-TRAN-TYPE.
           MOVE STRT-AREA-SOC-NO   TO DBIO-01-SOC-NO.
           MOVE WA-INPUT-ACCT-NO   TO DBIO-01-ACCT-NO.
           MOVE DBIO-01-KEY        TO DBIO-CALL-KEY-AREA.
           MOVE "BORM"             TO DBIO-CALL-N-SYS.
           MOVE "BLDV"             TO DBIO-CALL-SYST-VAR.
           MOVE "NN"               TO DBIO-CALL-CODE-B.
           MOVE 0                  TO DBIO-CALL-REFER-AREA.
           MOVE SPACES             TO DBIO-CALL-STATUS.
           CALL "DBIO" USING       DBIO-CALL-PARAM
                                   DBIO-CALL-SYS-AREA
                                   DBIO-CALL-KEY-AREA
                                   DBIO-CALL-STATUS
                                   WA-BLDV-AREA-NN
                                   DBIO-CALL-REFER-AREA
                                   DBIO-CALL-TXN-TYPE-AREA.
           IF DBIO-CALL-SAVE-REFER = "END."
                MOVE 1    TO WA-MSG-ERR-FLAG
                MOVE 4779 TO WA-OUTPUT-ERR-MSG-NO
                GO TO D909-EXIT
           ELSE
             IF DBIO-CALL-STATUS NOT = "****"
                MOVE 155              TO WA-OUTPUT-ERR-MSG-NO
                MOVE 1                TO WA-MSG-ERR-FLAG
                MOVE "BLDV"           TO WA-OUTPUT-DATA-SET
                MOVE DBIO-CALL-STATUS TO WA-OUTPUT-STATUS
                MOVE UT8500CA-FUNC-NORMAL-DISPLAY
                                         TO UT8500CA-CALL-CODE
                MOVE SPACES           TO UT8500CA-INPUT-MSG
                STRING "BR0000:(D900) READ BLDVNN ERROR"
                          ", SAVE-REFER = " DBIO-CALL-SAVE-REFER
                          ", DBIO-STAT  = " DBIO-CALL-STATUS
                          ", KEY = " DBIO-CALL-KEY-AREA
                   DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
                CALL "UT8500" USING UT8500CA-AREA
                GO TO D909-EXIT
             END-IF
           END-IF.

           IF   BLDV-NN-START-DATE (1) NOT = BOIS-NEXT-DUE-DATE
                MOVE 1    TO WA-MSG-ERR-FLAG
                MOVE 4779 TO WA-OUTPUT-ERR-MSG-NO
                GO TO D909-EXIT
           END-IF.

SC6924 D909-EXIT.
SC6924     EXIT.
ST0115*                                                                
ST0115 E000-CALL-UTYENQ.                                               
ST0115*                                                                
ST0115     INITIALIZE UTYENQCA-AREA.                                   
ST0115     MOVE STRT-AREA-SOC-NO           TO UTYENQCA-INST-NO.        
ST0115     MOVE BORM-MEMB-CUST-AC          TO UTYENQCA-ACCT-NO.        
ST0115     MOVE STRT-AREA-JRNL-NO          TO UTYENQCA-JRNL-NO.        
ST0115     IF WA-INPUT-PARAM-TABLE(8) = 1                         
ST0115        MOVE WA-ADV-TXN-DATE         TO UT0030-DATE-DDMMCCYY
ST0115        MOVE 1                       TO UT0030-FUNCTION     
ST0115        CALL "UT0030"             USING UT0030-FUNCTION     
ST0115                                        UT0030-DATE-AREA    
ST0115                                        UT0030-BINARY-DATE  
ST0115        MOVE UT0030-BINARY-DATE      TO UTYENQCA-TXN-DATE   
ST0115     ELSE                                                   
ST0115        MOVE STRT-AREA-POST-DT       TO UTYENQCA-TXN-DATE   
ST0115     END-IF.                                                
ST0115     MOVE STRT-AREA-POST-DT          TO UTYENQCA-POST-DATE. 
ST0115*    MOVE STRT-AREA-POST-DT          TO UTYENQCA-TXN-DATE        
ST0115*                                       UTYENQCA-POST-DATE.      
ST0115     MOVE STRT-AREA-TRN-NO           TO UTYENQCA-TXN-CODE.       
ST0115     MOVE ZEROES                     TO UTYENQCA-STATUS.         
ST0115     MOVE LINK-TRAN-DESC             TO UTYENQCA-TXN-DESCRIPTION.
ST0115     MOVE WA-ADV-AMOUNT              TO UTYENQCA-TXN-AMOUNT.     
S12487*S12243     IF  BORP-YOUBE AND STRT-REPOST-TXN
S12487     IF  BORP-YOUBE
S12243         MOVE 2                      TO UT9002CA-CALL-CODE
S12243         CALL "UT9002"               USING UT9002CA-CALL-AREA
S12487      IF STRT-REPOST-TXN
S12243         MOVE UT9002CA-IMG0-TIME     TO WS-IMG0-TIME
S12243         MOVE WS-IMG0-TIME           TO UTYENQCA-POST-TIME
S12694         MOVE UT9002CA-IMG0-DATE     TO UT0030-DATE-CCYYMMDD
S12694         MOVE 2                      TO UT0030-FUNCTION
S12694         CALL "UT0030"               USING UT0030-FUNCTION
S12694                                           UT0030-DATE-AREA
S12694                                           UT0030-BINARY-DATE
S12694         MOVE UT0030-BINARY-DATE     TO UTYENQCA-SYSTEM-DATE
S12243      ELSE
S12243         MOVE STRT-AREA-MSG-TIME     TO UTYENQCA-POST-TIME
S12694*S12487      END-IF
S12487         MOVE UT9002CA-DATE          TO UT0030-DATE-CCYYMMDD
S12487         MOVE 2                      TO UT0030-FUNCTION
S12487         CALL "UT0030"               USING UT0030-FUNCTION
S12487                                           UT0030-DATE-AREA
S12487                                           UT0030-BINARY-DATE
S12487         MOVE UT0030-BINARY-DATE     TO UTYENQCA-SYSTEM-DATE
S12694      END-IF
S12243     END-IF.
S12243*ST0115     MOVE STRT-AREA-MSG-TIME         TO UTYENQCA-POST-TIME.
ST0115     MOVE STRT-AREA-BRANCH           TO UTYENQCA-BRANCH.
ST0115     MOVE STRT-AREA-TERM-NO          TO UTYENQCA-BRANCH-TERM.    
ST0115     MOVE STRT-AREA-TELL-NO          TO UTYENQCA-TELLER.         
ST0115     MOVE ZEROES                     TO UTYENQCA-MISC-FEE-PAID.
ST0115     MOVE ZEROES                     TO UTYENQCA-LEGAL-FEE-PAID. 
ST0115     MOVE ZEROES                     TO UTYENQCA-REV-FEE-PAID.   
ST0115     MOVE ZEROES                     TO UTYENQCA-INTEREST-PAID.  
ST0115     MOVE ZEROES                     TO UTYENQCA-PRINCIPAL-PAID. 
ST0115     MOVE ZEROES                     TO UTYENQCA-TEMP-PAY-DECR.  
ST0115     MOVE ZEROES                     TO UTYENQCA-TEMP-PAY-INCR.  
ST0115     MOVE ZEROES                     TO UTYENQCA-TEMP-REC-INCR.  
ST0115     IF WA-BEFORE-BORM-LOAN-BAL < 0                              
ST0115        IF BORM-LOAN-BAL NOT > 0                                 
ST0115           MOVE WA-ADV-AMOUNT        TO UTYENQCA-TEMP-REC-DECR   
ST0115        ELSE                                                     
ST0115           COMPUTE UTYENQCA-TEMP-REC-DECR =                      
ST0115                                  WA-BEFORE-BORM-LOAN-BAL * -1   
ST0115        END-IF                                                
ST0115     END-IF.                                                  
ST0115                                                              
S11455     IF WA-ADV-AMORT-FLAG = "S"                               
S11455        MOVE ZEROES                  TO UTYENQCA-TEMP-REC-DECR
S11455     END-IF.                                                  
S11455                                                              
ST0115     MOVE BOIS-YET-COLLECT-INT       TO UTYENQCA-YET-COLL-INT 
ST0115     MOVE BOIS-NEXT-DUE-DATE         TO UTYENQCA-NEXT-DUE-DT  
ST0115     MOVE BOIS-LAST-UNPAID-INT-DT    TO UTYENQCA-UNPAID-INT-DT
ST0115     IF WA-INPUT-PARAM-TABLE(30) = 1                          
SC8583*       MOVE ST-SEQUENCE-NO          TO UTYENQCA-ATM-SEQ-NO   
SC9373*       IF WA-INPUT-PARAM-TABLE(20) = 1                       
SC9373        IF WA-INPUT-PARAM-TABLE(29) = 1                       
SC8583           MOVE WA-TRF-ATM-TRACE-NO     TO UTYENQCA-ATM-SEQ-NO
SC8583        ELSE                                                  
SC8583           MOVE WA-WDL-ATM-TRACE-NO     TO UTYENQCA-ATM-SEQ-NO
SC8583        END-IF                                                
ST0115     ELSE                                                     
ST0115        MOVE ZEROES                  TO UTYENQCA-ATM-SEQ-NO   
ST0115     END-IF.                                                  
ST0115     MOVE BORM-LOAN-BAL              TO UTYENQCA-LOAN-BAL.    
ST0115                                                              
ST0115*    IF BORM-LOAN-BAL > 0                                     
ST0115*       MOVE BORM-LOAN-BAL           TO UTYENQCA-LOAN-BAL     
ST0115*    ELSE                                                     
ST0115*       MOVE ZEROES                  TO UTYENQCA-LOAN-BAL     
ST0115*    END-IF.                                                  
ST0115                                                              
ST0115     MOVE 01                         TO UTYENQCA-CALL-CODE.   
ST0115     CALL "UTYENQ" USING UTYENQCA-AREA.                       
ST0115                                                              
ST0115     IF UTYENQCA-RET-STATUS NOT = 0                           
ST0115        MOVE 1                       TO WA-MSG-ERR-FLAG       
ST0115        MOVE UTYENQCA-RET-ERR-MSG-NO TO WA-OUTPUT-ERR-MSG-NO  
ST0115     END-IF.                                                  
ST0115                                                              
ST0115*                                                             
ST0115 E000-EXIT.                                                   
ST0115     EXIT.                                                    
ST0115*                                                             
ST0115 E100-CALL-UTYENQ-CORR.                                     
ST0115*---------------------                                      
ST0115*                                                           
ST0115     INITIALIZE UTYENQCA-AREA.                              
ST0115     MOVE STRT-AREA-SOC-NO           TO UTYENQCA-INST-NO.   
ST0115     MOVE BORM-MEMB-CUST-AC          TO UTYENQCA-ACCT-NO.   
ST0115     MOVE W800-CORR-JRNL-NO          TO UTYENQCA-JRNL-NO.   
ST0115*    MOVE STRT-AREA-POST-DT          TO UTYENQCA-TXN-DATE.  
ST0115     MOVE STRT-AREA-POST-DT          TO UTYENQCA-POST-DATE. 
ST0115     IF WA-INPUT-PARAM-TABLE(8) = 1                         
ST0115        MOVE WA-ADV-TXN-DATE         TO UT0030-DATE-DDMMCCYY
ST0115        MOVE 1                       TO UT0030-FUNCTION     
ST0115        CALL "UT0030"             USING UT0030-FUNCTION     
ST0115                                        UT0030-DATE-AREA    
ST0115                                        UT0030-BINARY-DATE  
ST0115        MOVE UT0030-BINARY-DATE      TO UTYENQCA-TXN-DATE   
ST0115     ELSE                                                   
ST0115        MOVE STRT-AREA-POST-DT       TO UTYENQCA-TXN-DATE   
ST0115     END-IF.                                                
ST0115     COMPUTE UTYENQCA-TXN-CODE = STRT-AREA-TRN-NO - 100.    
ST0115     MOVE 10                         TO UTYENQCA-CALL-CODE. 
ST0115     CALL "UTYENQ" USING UTYENQCA-AREA.                     
ST0115                                                            
ST0115     IF UTYENQCA-RET-STATUS NOT = 0                         
ST0115        MOVE 1                       TO WA-MSG-ERR-FLAG     
ST0115        MOVE UTYENQCA-RET-ERR-MSG-NO TO WA-OUTPUT-ERR-MSG-NO
ST0115     END-IF.                                                
ST0115*                                                           
ST0115 E100-EXIT.                                                 
ST0115*---------                                                  
ST0115    EXIT.                                                   
ST0115                                                            
S17755 E200-RECONSTRUCT-BLDVNI.
S17755     PERFORM Z4000-READ-BLDVNI     THRU Z4999-EXIT.
S17755
S17755     IF WA-MSG-ERR-FLAG = 1
S17755        GO TO E200-EXIT
S17755     END-IF.
S17755
S17755     IF BLDV-NI-START-DATE (3)       <> 0
S17755        MOVE 3799                    TO WA-OUTPUT-ERR-MSG-NO
S17755        MOVE 1                       TO WA-MSG-ERR-FLAG
S17755        GO TO E200-EXIT
S17755     END-IF.
S17755
S17755     MOVE BLDV-NI-START-DATE (1)     TO UT0020-BINARY-DATE.
S17755     PERFORM Z110-CONVERT-BINARY-TO-DATE THRU Z119-EXIT.
S17755     MOVE UT0020-DATE-CCYYMMDD       TO WA-TEMP-CCYYMMDD.
S17755
S17755     IF WA-INPUT-PARAM-TABLE(8)      =  1
S17755        MOVE WA-STORE-TXN-DT         TO BLDV-NI-START-DATE (1)
S17755     ELSE
S17755        MOVE STRT-AREA-POST-DT       TO BLDV-NI-START-DATE (1)
S17755     END-IF.
S17755
S17755     IF   BLDV-NI-START-DATE (2)     =  0
S17755          MOVE BOIS-MATURITY-DATE    TO BLDV-NI-END-DATE   (1)
S17755          GO   TO   E200-100
S17755     END-IF.
S17755
S17755     MOVE BLDV-NI-START-DATE (2)     TO UT0020-BINARY-DATE.
S17755     PERFORM Z110-CONVERT-BINARY-TO-DATE THRU Z119-EXIT.
S17755
S17755     COMPUTE WA-BETWEEN-MONTH   = ( UT0020-DATE-CCYY2 * 12 +
S17755                                    UT0020-DATE-MM2 )
S17755                                - ( WA-TEMP-CCYY * 12      +
S17755                                    WA-TEMP-MM ).
S17755
S17755     INITIALIZE UT0312CA-CALL-AREA.
S17755     MOVE 17                         TO UT0312CA-CALL-CODE.
S17755     MOVE BLDV-NI-START-DATE (1)     TO UT0312CA-EFF-DATE
S17755                                        UT0312CA-DUE-STRT-DT.
S17755     MOVE WA-BETWEEN-MONTH           TO UT0312CA-LOAN-TERM.
S17755     MOVE BORM-REPAY-FREQ            TO UT0312CA-REPAY-FREQ.
S17755     MOVE WA-ADV-TXN-DATE(1:2)       TO UT0312CA-REPAY-DAY.
S17755
S17755     CALL "UT0312" USING
S17755                   UT0312CA-CALL-AREA.
S17755
S17755     IF UT0312CA-RET-STATUS <> 0
S17755        MOVE 296            TO WA-OUTPUT-ERR-MSG-NO
S17755        MOVE 1              TO WA-MSG-ERR-FLAG
S17755        GO TO E200-EXIT
S17755     END-IF.
S17755
S17755     MOVE UT0312CA-MATURITY-DT       TO BLDV-NI-START-DATE (2)
S17755                                        BLDV-NI-END-DATE   (1).
S17755 E200-100.
S17755     PERFORM Z5000-BLDVNI-UPDATE   THRU Z5999-EXIT.
S17755
S17755 E200-EXIT.
S17755     EXIT.
TB0244 X000-POPULATE-CHANNEL-FLAG.
TB0244
TB0244       IF STRT-INT-VALID-FLAG4
TB0244       AND ST-SUBSYS-CHANNEL NOT = SPACES
TB0244           MOVE STRT-AREA-BATCH-TANDEM TO
NR2001*TB0244                BORV-01-DELIVERY-FLAG
NR2001                BOCT-01-DELIVERY-FLAG
TB0244       END-IF.
TB0244 X000-EXIT.
TB0244      EXIT.
TB0020**--
S16466
S16466 X750-SEARCH-BLDVWW.
S16466     IF  BORP-FLEXI-CAFM-IND      =  0
S16466       MOVE  BORP-CAFM-TYPE      TO  WA-CAFM-TYPE
S16466     ELSE
S16466       IF  BORM-CAFM-TYPE         >  0
S16466         MOVE  BORM-CAFM-TYPE    TO  WA-CAFM-TYPE
S16466       ELSE
S16466         MOVE  BORP-CAFM-TYPE    TO  WA-CAFM-TYPE
S16466       END-IF
S16466     END-IF.
S16466     MOVE  WA-IN-PROGRESS        TO  WA-FOUND-IND.
S16466     IF  NO-CAP-OR-COLLARS
S16466       NEXT  SENTENCE
S16466     ELSE
S16466       MOVE  ZERO                TO  DBIO-CALL-REFER-AREA
S16466       MOVE  BORM-SOC-NO         TO  WA-TEMP-SOC
S16466       MOVE  BORM-MEMB-CUST-AC   TO  WA-TEMP-ACC
S16466       MOVE  WA-TEMP-KEY         TO  DBIO-CALL-KEY-AREA
S16466       MOVE  61                  TO  DBIO-CALL-FUNC
S16466       MOVE  "BORM"              TO  DBIO-CALL-N-SYS
S16466       MOVE  "BLDV"              TO  DBIO-CALL-SYST-VAR
S16466       MOVE  "WW"                TO  DBIO-CALL-TXN-TYPE-AREA
S16466       MOVE  SPACES              TO  DBIO-CALL-STATUS
S16466       PERFORM  Z1200-RETRIEVE-BLDVWW THRU Z1200-EXIT
S16466       UNTIL  NOT  NEW-RATE-IN-PROGRESS
S16466       IF  NEW-RATE-NOT-FOUND
S16466         NEXT  SENTENCE
S16466       ELSE
S16466         PERFORM  Z1300-SET-EFF-RATE THRU Z1300-EXIT
S16466       END-IF.
S16466 X750-EXIT.
S16466     EXIT.
S16466
S19705 X800-CHECK-DATE.
S19705*  GET PREVIOUS WORKING DATE
S19705     MOVE STRT-AREA-POST-DT TO UT0020-BINARY-DATE.
S19705     MOVE 2                 TO UT0020-FUNCTION.
S19705     CALL "UT0020"       USING UT0020-FUNCTION
S19705                               UT0020-DATE-AREA
S19705                               UT0020-BINARY-DATE.
S19705     MOVE UT0020-DATE-CCYYMMDD
S19705                         TO UT0310CA-CALENDAR-IN-CCYYMMDD.
S19705     MOVE 00                  TO UT0310CA-CALENDAR-CODE.
S19705     MOVE 04                  TO UT0310CA-CALL-FUNC.
S19705     MOVE ZEROES              TO UT0310CA-CALL-STATUS
S19705                                 UT0310CA-CALENDAR-METHOD.
S19705     MOVE STRT-AREA-SOC-NO TO UT0310CA-SOC-NO.
S19705     CALL "UT0310" USING UT0310CA-AREA.
S19705     IF UT0310CA-CALL-STATUS NOT = 0
S19705        MOVE 1  TO WA-MSG-ERR-FLAG
S19705        MOVE 155 TO WA-OUTPUT-ERR-MSG-NO
S19705        MOVE SPACES   TO UT8500CA-INPUT-MSG
S19705        SET  UT8500CA-NORMAL-DISPLAY TO TRUE
S19705        STRING "BR0024:(X800) ERROR CALLING UT0310"
S19705          ", STATUS="  UT0310CA-CALL-STATUS
S19705        DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
S19705        CALL "UT8500" USING UT8500CA-AREA
S19705        GO TO X800-EXIT
S19705     END-IF.
S19705     MOVE UT0310CA-CALENDAR-OUT-CCYYMMDD
S19705                              TO WA-PERV-DATE
S19705                                 UT0030-DATE-CCYYMMDD.
S19705     MOVE 2                   TO UT0030-FUNCTION.
S19705     CALL "UT0030"         USING UT0030-FUNCTION
S19705                                 UT0030-DATE-AREA
S19705                                 UT0030-BINARY-DATE.
S19705     MOVE UT0030-BINARY-DATE  TO WS-PERV-BIN-DT.
S19705
S19705 X800-EXIT.
S19705     EXIT.
S19705
S16466 Z1200-RETRIEVE-BLDVWW.
S16466     PERFORM  Z1400-READ-BLDV  THRU  Z1400-EXIT.
S16466     IF  DBIO-CALL-SAVE-REFER     =  "END."
S16466       MOVE  UT8500CA-FUNC-NORMAL-DISPLAY
S16466                                 TO  UT8500CA-CALL-CODE
S16466       MOVE  SPACES              TO  UT8500CA-INPUT-MSG
S16466       STRING  "BR0018:(Z1200) ERROR IN BLDV-WW READ "
S16466               "; ACCOUNT NO = "
S16466               DBIO-CALL-KEY
S16466               "; RETURN STATUS = "
S16466               DBIO-CALL-STATUS
S16466               "; DEFAULTED TO VARIABLE RATE."
S16466               DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
S16466        MOVE  "N"                TO  UT8500CA-RESPONSE-REQD-FLAG
S16466        CALL  "UT8500"        USING  UT8500CA-AREA
S16466        MOVE  WA-NEW-RATE-NOT-FOUND  TO  WA-FOUND-IND
S16466        GO                       TO  Z1200-EXIT
S16466     END-IF.
S16466     IF  DBIO-CALL-STATUS         =  "****"
S16466       IF  BORM-SOC-NO        NOT =  BLDV-WW-SOCIETY
S16466       OR  BORM-MEMB-CUST-AC  NOT =  BLDV-WW-MEMB-NO
S16466         MOVE  WA-NEW-RATE-NOT-FOUND
S16466                                 TO  WA-FOUND-IND
S16466       ELSE
S16466         IF  WA-SEARCH-RATE-DATE NOT <
S16466                                BLDV-WW-CAFM-START-RTE-DTE
S16466         AND WA-SEARCH-RATE-DATE  <
S16466                                BLDV-WW-CAFM-RESET-RTE-DTE
S16466           MOVE  WA-NEW-RATE-FOUND
S16466                                 TO  WA-FOUND-IND
S16466         ELSE
S16466           NEXT  SENTENCE
S16466         END-IF
S16466       END-IF
S16466     ELSE
S16466       SET  UT8500CA-NORMAL-DISPLAY  TO  TRUE
S16466       MOVE  SPACES              TO  UT8500CA-INPUT-MSG
S16466          STRING "BR0024/Z1200: ERROR IN BLDV-WW READ "
S16466                 "ACCOUNT NUMBER  "
S16466                 DBIO-CALL-KEY
S16466                 "RETURN STATUS  "
S16466                 DBIO-CALL-STATUS
S16466             DELIMITED BY SIZE INTO  UT8500CA-INPUT-MSG
S16466       CALL  "UT8500"         USING  UT8500CA-AREA
S16466       STRING "DEFAULTED TO VARIABLE RATE."
S16466             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
S16466       CALL  "UT8500"         USING  UT8500CA-AREA
S16466       MOVE  WA-NEW-RATE-NOT-FOUND  TO  WA-FOUND-IND
S16466     END-IF.
S16466*
S16466 Z1200-EXIT.
S16466     EXIT.
S16466*
S16466 Z1300-SET-EFF-RATE.
S16466     ADD  BORM-RT-INCR           TO  WA-INT-RATE.
S16466     MOVE  BLDV-WW-CAFM-TYPE     TO  WA-CAFM-TYPE.
S16466     IF  CAP-IN-FORCE
S16466       IF  WA-INT-RATE            >  BLDV-WW-CAFM-HIGH-RTE
S16466         MOVE  BLDV-WW-CAFM-HIGH-RTE
S16466                                 TO  WA-INT-RATE
S16466       END-IF
S16466     END-IF.
S16466     IF  FLOOR-IN-FORCE
S16466       IF  WA-INT-RATE            <  BLDV-WW-CAFM-LOW-RTE
S16466         MOVE  BLDV-WW-CAFM-LOW-RTE
S16466                                 TO  WA-INT-RATE
S16466       END-IF
S16466     END-IF.
S16466     IF  FIXED-IN-FORCE
S16466       MOVE  BLDV-WW-CAFM-HIGH-RTE
S16466                                 TO  WA-INT-RATE
S16466     END-IF.
S16466     IF  CAP-COLLARS-FLEXIBLE
S16466       IF  WA-INT-RATE            <  BLDV-WW-CAFM-LOW-RTE
S16466         NEXT  SENTENCE
S16466       ELSE
S16466         IF  WA-INT-RATE          <  BLDV-WW-CAFM-HIGH-RTE
S16466           MOVE  BLDV-WW-CAFM-LOW-RTE
S16466                                 TO  WA-INT-RATE
S16466         ELSE
S16466           MOVE  BLDV-WW-CAFM-RTE TO WA-INT-RATE
S16466         END-IF
S16466       END-IF
S16466     END-IF.
S16466     SUBTRACT  BORM-RT-INCR  FROM  WA-INT-RATE.
S16466*
S16466 Z1300-EXIT.
S16466     EXIT.
S16466*
S16466 Z1400-READ-BLDV.
S16466     CALL "DBIO" USING
S16466                       DBIO-CALL-PARAM
S16466                       DBIO-CALL-SYS-AREA
S16466                       DBIO-CALL-KEY-AREA
S16466                       DBIO-CALL-STATUS
S16466                       WA-BLDV-AREA-WW
S16466                       DBIO-CALL-REFER-AREA
S16466                       DBIO-CALL-TXN-TYPE-AREA.
S16466 Z1400-EXIT.
S16466     EXIT.
S16466/
TB0159*
TB0159 Z500-POST-BUCV-BPI.
TB0159*--- Post to bucv, no borv, no borm bucket update
TB0159***-calculate the elapsed no. of days from last rate ch
TB0159**--- this is the start date
TB0159     IF BORM-ADV-VAL = 0
TB0159        MOVE STRT-AREA-POST-DT TO BOIS-LAST-BPI-INT-DATE
TB0159     ELSE
SC2794        IF BOIS-LAST-BPI-INT-DATE   <= BOIS-PREV-DUE-DATE
SC2794           MOVE 0                   TO BOIS-LAST-BPI-INT-ACCR
SC2794        END-IF
TB0159        COMPUTE WA-BPI-INT-ACCR
SC2841           = (BORM-INT-ACCR + BORM-INT-ADJUSTMENT)
SC2841                            - BOIS-LAST-BPI-INT-ACCR
SC2841*          = BORM-INT-ACCR  - BOIS-LAST-BPI-INT-ACCR
TB0159
TB0159        IF WA-BPI-INT-ACCR = 0
TB0159           GO TO Z599-EXIT
TB0159        END-IF
SC2794        IF BOIS-LAST-BPI-INT-DATE   <= BOIS-PREV-DUE-DATE
SC2794           MOVE BOIS-PREV-DUE-DATE  TO UT0020-BINARY-DATE
SC2794        ELSE
TB0159        MOVE BOIS-LAST-BPI-INT-DATE TO UT0020-BINARY-DATE
SC2794        END-IF
TB0159        MOVE 2               TO UT0020-FUNCTION
TB0159        CALL "UT0020"     USING UT0020-FUNCTION
TB0159                                UT0020-DATE-AREA
TB0159                                UT0020-BINARY-DATE
TB0159        MOVE UT0020-DATE-CCYYMMDD
TB0159             TO UT0310CA-CALENDAR-IN-CCYYMMDD
TB0159
TB0159**-- this is the end date
TB0159          MOVE STRT-AREA-POST-DT TO UT0020-BINARY-DATE
TB0159          MOVE 2               TO UT0020-FUNCTION
TB0159          CALL "UT0020"     USING UT0020-FUNCTION
TB0159                                  UT0020-DATE-AREA
TB0159                                  UT0020-BINARY-DATE
TB0159          MOVE UT0020-DATE-CCYYMMDD
TB0159               TO UT0310CA-CALENDAR-OUT-CCYYMMDD
TB0159**---- call calendar util to get the length between the 2 dates
TB0159          MOVE BORP-CALENDAR-CODE TO UT0310CA-CALENDAR-CODE
TB0159          MOVE 03 TO UT0310CA-CALL-FUNC
TB0159          MOVE ZEROES             TO UT0310CA-CALL-STATUS
TB0159                                     UT0310CA-CALENDAR-METHOD
TB0159          MOVE STRT-AREA-SOC-NO   TO UT0310CA-SOC-NO
TB0159           CALL "UT0310" USING UT0310CA-AREA
TB0159           MOVE UT0310CA-CALENDAR-OUT-CODE TO DATE-CODE-VALUE
TB0159           IF UT0310CA-CALL-STATUS NOT = 0
TB0159              DISPLAY "BR0024:(Z500) - ERROR,UT0310 INTEREST DATE"
TB0159                ", FUNCTION=" UT0310CA-CALL-FUNC
TB0159                ", KEY=" BORM-KEY
TB0159                ", FROM DATE=" UT0310CA-CALENDAR-IN-CCYYMMDD
TB0159                ", TO DATE="   UT0310CA-CALENDAR-OUT-CCYYMMDD
TB0159                GO TO Z599-EXIT
TB0159           END-IF
TB0159           MOVE  UT0310CA-ELAPSE-DAYS TO WA-BPI-INT-DAYS
TB0159           PERFORM Z600-ADD-BUCV-BPI-ACCR-INT THRU Z699-EXIT
TB0159           IF UT0094CA-RET-STATUS <> 0
TB0159              GO TO Z599-EXIT
TB0159           END-IF
SC2170*          MOVE BORM-INT-ACCR            TO BOIS-LAST-BPI-INT-ACCR
SC2170           ADD  BORM-INT-ACCR BORM-INT-ADJUSTMENT
SC2170                                         TO BOIS-LAST-BPI-INT-ACCR
TB0159           MOVE STRT-AREA-POST-DT        TO BOIS-LAST-BPI-INT-DATE
TB0159     END-IF.
TB0159 Z599-EXIT.
TB0159      EXIT.
TB0159 Z600-ADD-BUCV-BPI-ACCR-INT.
TB0159     INITIALIZE UT0094CA-CALL-PARAM.
TB0159     MOVE 09                  TO UT0094CA-CALL-CODE.
TB0159     MOVE "BOR"               TO UT0094CA-SYSTEM.
ST0049*    MOVE 0                   TO UT0094CA-JRNL-NO.
ST0049     MOVE STRT-AREA-JRNL-NO   TO UT0094CA-JRNL-NO.
TB0159     MOVE "I"                 TO UT0094CA-PRIORITY-CODE.
TB0159     MOVE STRT-AREA-POST-DT   TO UT0094CA-BASED-TO-DATE.
SC2794     IF BOIS-LAST-BPI-INT-DATE   <  BOIS-PREV-DUE-DATE
SC2794        MOVE BOIS-PREV-DUE-DATE  TO UT0094CA-BASED-DATE
SC2794     ELSE
TB0159     MOVE BOIS-LAST-BPI-INT-DATE TO UT0094CA-BASED-DATE.
TB0159     MOVE WA-BPI-INT-DAYS     TO UT0094CA-BASED-DAYS.
TB0159     MOVE BORM-STORE-RATE  TO UT0094CA-INT-RATE.
TB0159     MOVE BORM-LOAN-BAL    TO UT0094CA-BASED-BAL.
TB0159     MOVE WA-BPI-INT-ACCR            TO UT0094CA-POST-AMT.
TB0159     IF NOT BORP-YOUBE
TB0159        COMPUTE WA-CURR-TERM = (BORM-LOAN-TRM - BORM-REM-REPAYS)
TB0159                                + 1
TB0159     ELSE
TB0159        MOVE 9998 TO WA-CURR-TERM
TB0159     END-IF.
TB0159     MOVE WA-CURR-TERM    TO UT0094CA-BASED-TERM-NO.
TB0159     MOVE 0               TO UT0094CA-SEQUENCE-NO.
TB0159     MOVE SPACES          TO UT0094CA-ADJ-REASON-CODE.
NR2001*TB0159     MOVE STRT-AREA-POST-DT TO BORV-01-TRN-DATE
NR2001*TB0159                             BORV-01-POST-DATE.
NR2001*TB0159     CALL "UT0094" USING UT0094CA-CALL-PARAM
NR2001*TB0159                         BORM-RECORD-AREA
NR2001*TB0159                         BORV-RECORD-AREA
NR2001     MOVE STRT-AREA-POST-DT TO BOCT-TRN-DATE
NR2001                             BOCT-POST-DATE.
NR2001     CALL "UT0094" USING UT0094CA-CALL-PARAM
NR2001                         BORM-RECORD-AREA
NR2001                         BOCT-RECORD-AREA
TB0159                         BOIS-RECORD
TB0159                         BORR-PARAMS.
TB0159     IF UT0094CA-RET-STATUS NOT = ZEROES
TB0159        MOVE UT8500CA-FUNC-NORMAL-DISPLAY
TB0159                     TO UT8500CA-CALL-CODE
TB0159        MOVE SPACES  TO UT8500CA-INPUT-MSG
TB0159        STRING "BR0024:(Z600) ERROR UT0094, "
TB0159               ", RETURN CODE="    UT0094CA-RET-STATUS
TB0159           DELIMITED BY SIZE INTO  UT8500CA-INPUT-MSG
TB0159        CALL "UT8500"        USING UT8500CA-AREA
TB0159        GO   TO Z699-EXIT
TB0159     END-IF.
TB0159 Z699-EXIT.
TB0159     EXIT.
SC0941****START-FAD
       Z700-CHK-TXNDT.
SC7091        IF   BORP-YOUBE
SC7091             GO   TO  Z709-EXIT.

              SET WS-ERR-N TO TRUE.
013870        MOVE 1 TO UT1999CA-CALL-CODE.
013880        CALL "UT1999" USING
013900             UT1999CA-CALL-AREA.
013910        MOVE UT1999CA-DD TO WS-DD.
013920        MOVE UT1999CA-MM TO WS-MM.
013930        MOVE UT1999CA-CC TO WS-CC.
013940        MOVE UT1999CA-YY TO WS-YY.

              MOVE WA-ADV-TXN-DATE TO WS-DDMMCCYY3.
              MOVE WS-DD3 TO WS-DD2.

              MOVE WS-MM3 TO WS-MM2.

              MOVE WS-CCYY3 TO WS-CCYY2.


              IF WS-CCYY-MM-DD <=  WS-CCYY-MM-DD2
                 SET WS-ERR-Y TO TRUE
              END-IF.

       Z709-EXIT.
           EXIT.
SC0941****END-FAD

SC9610 C650-GET-SUSP-FOR-GEN.
SC9610      MOVE  BORM-SOC-NO           TO  WA-SUSP-INST.
SC9610      MOVE  STRT-AREA-BRANCH      TO  WA-SUSP-BRANCH.
SC9610      MOVE  BORM-CURRENCY-IND     TO  WA-SUSP-TYPE-CURRENCY.
SC9610      MOVE  SPACE                 TO  WA-SUSP-TYPE-FILLER.
SC9610      MOVE  WA-SUSP-LOAN-REVERSAL TO  WA-SUSP-TYPE-ID.

SC9610      MOVE 71 TO ST-DBIO-CALL-CODE.
SC9610      CALL "DBIO" USING
SC9610                       ST-CALL-CODE
SC9610                       WA-SUSP-SYSTEM
SC9610                       WA-SUSP-KEY
SC9610                       WA-SUSP-STATUS
SC9610                       SUSP-RECORD-AREA.

SC9610     IF  WA-SUSP-STATUS NOT = "****"
SC9610         MOVE UT8500CA-FUNC-NORMAL-DISPLAY TO UT8500CA-CALL-CODE
SC9610         MOVE SPACES TO UT8500CA-INPUT-MSG
SC9610         STRING  "BR0024:(C650) READ ERROR 'SUSP', KEY- "
SC9610                 WA-SUSP-KEY ", STAT- " WA-SUSP-STATUS
SC9610             DELIMITED BY SIZE INTO UT8500CA-INPUT-MSG
SC9610         CALL "UT8500" USING
SC9610                             UT8500CA-AREA
SC9610         MOVE 551                TO  WA-OUTPUT-ERR-MSG-NO
SC9610         MOVE 1                  TO  WA-MSG-ERR-FLAG
SC9610     ELSE
SC9610         MOVE SUSP-ACCT-NO       TO  WA-SUSP-BACKDT-ACCOUNT
SC9610     END-IF.
SC9610
SC9610 C659-EXIT.
SC9610     EXIT.

S10139 Z800-ACCESS-INOD.
======*--------------------------------------------------------------
S10139     MOVE "****"          TO DBIOMOD-STAT.
S10139     MOVE "DBIO"          TO DBIOMOD-PREFIX.
S10139     MOVE "INOD"          TO DBIOMOD-FILE
S10139                             DBIOMOD-SUFFIX.
S10139     MOVE SPACES          TO DBIOMOD-RELEASE-LOCK
S10139                             DBIOMOD-ACCESS-COMMAND
S10139                             DBIOMOD-ACCESS-COND.
S10139
S10139     CALL DBIOMODNAME USING
S10139                             DBIOMOD-FILE
S10139                             DBIOMOD-KEY
S10139                             INOD-RECORD-AREA
S10139                             DBIOMOD-FUNCTION
S10139                             DBIOMOD-KEY-NO
S10139                             DBIOMOD-RELEASE-LOCK
S10139                             DBIOMOD-ACCESS-COMMAND
S10139                             DBIOMOD-ACCESS-COND
S10139                             DBIOMOD-STATUS.
S10139
S10139 Z809-EXIT.
S10139     EXIT.


SC8398*YOUBE-RECALC-TERM.
      *    INITIALIZE UT0312CA-CALL-PARAMETER.
      *    MOVE 0                       TO WA-COUNT-LOAN-TERM.

      *    MOVE 0 TO UT0312CA-MATURITY-DT
      *              WA-ADV-TRM-DATE-BIN
      *    MOVE STRT-AREA-POST-DT TO WA-ADV-TRM-DATE-BIN
      *    PERFORM YOUBE-RECALC-TERM-LOOP
      *       THRU YOUBE-RECALC-TERM-LOOP-EXIT
      *      UNTIL UT0312CA-MATURITY-DT >= BOIS-MATURITY-DATE
      *         OR WA-MSG-ERR-FLAG = 1.
SC8398*YOUBE-RECALC-TERM-EXIT.
SC8398*    EXIT.

SC8983*start**
SC8398*YOUBE-RECALC-TERM-LOOP.
      *    MOVE 16  TO UT0312CA-CALL-CODE.
      *    MOVE WA-ADV-TRM-DATE-BIN TO UT0312CA-EFF-DATE
      *                              UT0312CA-DUE-STRT-DT.
      *    MOVE 1 TO UT0312CA-LOAN-TERM.
      *    MOVE BORM-REPAY-DAY TO UT0312CA-REPAY-DAY.
      *    MOVE BORM-REPAY-FREQ TO UT0312CA-REPAY-FREQ.
      *    MOVE BORM-TERM-BASIS TO UT0312CA-TERM-BASIS.

      *    CALL "UT0312" USING
      *                  UT0312CA-CALL-AREA.

      *    IF UT0312CA-RET-STATUS <> 0
      *       MOVE 296            TO WA-OUTPUT-ERR-MSG-NO
      *       MOVE 1              TO WA-MSG-ERR-FLAG
      *       GO TO YOUBE-RECALC-TERM-LOOP-EXIT
      *    ELSE
SC8398*      IF UT0312CA-MATURITY-DT NOT > BOIS-MATURITY-DATE
      *       ADD 1                     TO WA-COUNT-LOAN-TERM
      *       MOVE UT0312CA-MATURITY-DT TO WA-ADV-TRM-DATE-BIN
SC8398*      END-IF
      *    END-IF.

SC8398*YOUBE-RECALC-TERM-LOOP-EXIT.
SC8398*    EXIT.
S11455 Z900-YOUBE-AMORTIZATION.                                    
S11455     INITIALIZE UTYBAMCA-AREA.                               
S11455     MOVE BORM-SOC-NO                TO UTYBAMCA-INST-NO.    
S11455     MOVE BORM-MEMB-CUST-AC          TO UTYBAMCA-ACCT-NO.    
S11455     MOVE STRT-AREA-JRNL-NO          TO UTYBAMCA-JRNL-NO.    
S11455     IF WA-INPUT-PARAM-TABLE(8) = 1                          
S11455          MOVE WA-ADV-TXN-DATE       TO UT0030-DATE-DDMMCCYY 
S11455          MOVE 1                     TO UT0030-FUNCTION      
S11455          CALL "UT0030"           USING UT0030-FUNCTION      
S11455                                        UT0030-DATE-AREA     
S11455                                        UT0030-BINARY-DATE   
S11455          MOVE UT0030-BINARY-DATE    TO UTYBAMCA-TXN-DATE    
S11455     ELSE                                                    
S11455          MOVE STRT-AREA-POST-DT     TO UTYBAMCA-TXN-DATE    
S11455     END-IF.                                                 
S11455     IF WA-INPUT-PARAM-TABLE(7) = 1                          
S11455        MOVE W800-CORR-JRNL-NO       TO UTYBAMCA-CORR-JRNL-NO
S11455     ELSE                                                    
S11455        MOVE ZEROES                  TO UTYBAMCA-CORR-JRNL-NO
S11455     END-IF.                                                 
S11455     MOVE STRT-AREA-POST-DT          TO UTYBAMCA-POST-DATE.  
S11455     MOVE STRT-AREA-TRN-NO           TO UTYBAMCA-TXN-CODE.   
S11455     MOVE WA-ADV-AMOUNT              TO UTYBAMCA-ADV-AMOUNT. 
S11455     MOVE WA-TOT-FEE-AMT             TO UTYBAMCA-FEE-AMOUNT. 
S11455     MOVE UPTELLCA-TELLER-BRANCH     TO UTYBAMCA-TELL-AND-BR.
S11455     MOVE STRT-AREA-MSG-TIME         TO UTYBAMCA-POST-TIME.  
S11455     MOVE STRT-AREA-TERM-NO          TO UTYBAMCA-BRTERM.     
S11455     MOVE WA-ADV-AMORT-FLAG          TO UTYBAMCA-AMORT-FLAG. 
S11455                                                             
S11455     IF WA-ADV-AMORT-FLAG = "S"                               
S11455        MOVE WA-BEFORE-BORM-ADV-VAL  TO BORM-ADV-VAL          
S11455        MOVE WA-BEFORE-BORM-LOAN-BAL TO BORM-LOAN-BAL         
S11455        MOVE WA-ADV-AMORT-TERM       TO UTYBAMCA-TOTAL-TERM   
S11455        MOVE ZEROES                  TO UTYBAMCA-AMORT-JRNL-NO
S11455        IF  WA-INPUT-PARAM-TABLE(8) = 1                       
S11455        AND WA-INPUT-PARAM-TABLE(7) = 0                       
S11455        AND BORM-LST-FIN-DATE > UTYBAMCA-TXN-DATE             
S11455            MOVE 4141                TO WA-OUTPUT-ERR-MSG-NO  
S11455            MOVE 1                   TO WA-MSG-ERR-FLAG       
S11455            GO TO Z900-EXIT                                   
S11455        END-IF                                                
S11455     ELSE                                                     
S11455        MOVE ZEROES                  TO UTYBAMCA-TOTAL-TERM   
S11455        MOVE WA-ADV-AMORT-JRNL-NO    TO UTYBAMCA-AMORT-JRNL-NO
S11455     END-IF.                                                  
S11455                                                              
S11455     EVALUATE TRUE                                         
S11455         WHEN WA-ADV-AMORT-FLAG = "S"                      
S11455          AND WA-INPUT-PARAM-TABLE(7) = 0                  
S11455              MOVE 01                TO UTYBAMCA-CALL-CODE 
S11455         WHEN WA-ADV-AMORT-FLAG = "S"                      
S11455          AND WA-INPUT-PARAM-TABLE(7) = 1                  
S11455              MOVE 03                TO UTYBAMCA-CALL-CODE 
S11455         WHEN (WA-ADV-AMORT-FLAG = "A" OR                  
S11455               WA-ADV-AMORT-FLAG = "F" OR                  
S11455               WA-ADV-AMORT-FLAG = "R")                    
S11455          AND WA-INPUT-PARAM-TABLE(7) = 0                  
S11455              MOVE 11                TO UTYBAMCA-CALL-CODE 
S11455         WHEN WA-ADV-AMORT-FLAG = "F"                      
S11455          AND WA-INPUT-PARAM-TABLE(7) = 1                  
S11455              MOVE 12                TO UTYBAMCA-CALL-CODE 
S11455         WHEN OTHER                                        
S11455              MOVE 3288           TO WA-OUTPUT-ERR-MSG-NO  
S11455              MOVE 1              TO WA-MSG-ERR-FLAG       
S11455              GO TO Z900-EXIT                              
S11455     END-EVALUATE.                                         
S11455                                                           
S11455     PERFORM Z910-CALL-UTYBAM                              
S11455        THRU Z910-EXIT.                                    
S11455                                                           
S11455     IF  WA-INPUT-PARAM-TABLE(8) = 1                        
S11455     AND WA-ADV-AMORT-FLAG = "S"                            
S11455        IF WA-INPUT-PARAM-TABLE(7) NOT = 1                  
S11455           PERFORM E000-CALL-UTYENQ                         
S11455              THRU E000-EXIT                                
S11455        ELSE                                                
S11455           PERFORM E100-CALL-UTYENQ-CORR                    
S11455              THRU E100-EXIT                                
S11455        END-IF                                              
S11455     END-IF.                                                
S11455                                                            
S11455 Z900-EXIT.                                                 
S11455     EXIT.                                                  
S11455                                                            
S11455 Z910-CALL-UTYBAM.                                          
S11455                                                            
S11455     CALL "UTYBAM"                USING UTYBAMCA-AREA       
S11455                                        BORM-RECORD-AREA    
S11455                                        BOIS-RECORD         
S11455                                        BORP-RECORD-AREA.   
S11455                                                            
S11455     IF NOT (UTYBAMCA-RET-STATUS = 0)                       
S11455        MOVE UTYBAMCA-RET-ERR-MSG-NO TO WA-OUTPUT-ERR-MSG-NO
S11455        MOVE 1                       TO WA-MSG-ERR-FLAG     
S11455     END-IF.                                                
S11455                                                            
S11455 Z910-EXIT.                                                 
S11455     EXIT.                                                  
S11455                                                                  
S11455 Z999-YOUBE-FIELD-VERIFICATION.                                   
S11455     MOVE SPACES                     TO WA-ADV-AMORT-FLAG.        
S11455     MOVE BOIS-NEXT-DUE-DATE         TO BOIS-LAST-UNPAID-DUE-DATE.
S11455 Z999-EXIT.                                                       
S11455     EXIT.                                                        
